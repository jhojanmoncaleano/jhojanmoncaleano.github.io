self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.0.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[0],{244:function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return u}));var o=n(164);let r=null;const c=9e4;function i(){return null==r&&(r=new o.Cache),r}function s(e){return i().get(e)}function a(e){return i().del(e)}function u(e,t){i().put(e,t,c)}},304:function(e,t,n){"use strict";function o(e){return{error:{subErrorCode:null==e?void 0:e.SubErrorCode},accessToken:null==e?void 0:e.AccessToken,accessTokenExpiry:null==e?void 0:e.AccessTokenExpiry}}n.d(t,"a",(function(){return o}))},391:function(e,t,n){"use strict";n.r(t);var o=n(433),r=n(164),c=n(244),i=n(417),s=n(210),a=n(221),u=n(198),l=n(121),d=n(130),f=n(117);const p="OWA_GetDelegationAccessToken";let h={};function k(e){return Object(l.a)("resourceTokenFromHost")?async function(e){var t;const n=Object(d.c)()?Object(d.a)():void 0;if((null==n?void 0:n.isResourceTokenPrefetchEnabled)&&await n.isResourceTokenPrefetchEnabled()&&n.getResourceToken){const o=await n.getResourceToken(Object(f.a)(),e.wwwAuthenticateHeader,e.sourceId,e.scope);if(o&&o.length>0){const e=null===(t=o.split(" ")[0])||void 0===t?void 0:t.toLowerCase(),n=o.split(" ")[1];let r=3600;if("msauth1.0"==e&&(r=86400),n)return{AccessToken:n,TokenResultCode:0,ExpiresIn:r,AccessTokenExpiry:Object(a.a)(Date.now(),r).toISOString()}}}return{}}(e):async function(e){let t=encodeURIComponent(e.client_id+e.scope+e.requestId),n={};try{n=await async function(e,t,n){let o=function(e){let t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+s.stringify(t)}(e);if(!t.document.getElementById(n)){const r=t.document.createElement("iframe");return r.src=o.toString(),r.style.display="none",r.id=n,t.document.body.appendChild(r),new Promise((o,c)=>{h[n]=function(n){let i={};try{r.contentWindow&&r.contentWindow.location.host==t.location.host&&(i=function(e,t){let n=s.parse(e),o={};n.access_token?(o.AccessToken=n.access_token,o.AccessTokenExpiry=Object(a.a)(Date.now(),parseInt(n.expires_in)).toISOString(),o.TokenResultCode=0):"login_required"==n.error||"interaction_required"==n.error||"consent_required"==n.error?(o.TokenResultCode=3,Object(u.d)(p+" MSA Failure Unauthorized",{error:n.error,param:e,requestId:t})):(o.TokenResultCode=2,Object(u.d)(p+" MSA Failure",{error:n.error,param:e,requestId:t}));return o}(r.contentWindow.location.hash.substring(1),e.requestId))}catch(t){Object(u.d)(p+" Hash Param Parsing Failure ",{err:t.toString(),message:t.message,stk:t.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),i.TokenResultCode=2,c(i)}o(i)},r.addEventListener("load",h[n],!1)})}return{TokenResultCode:2}}(e,window,t)}catch(e){n.TokenResultCode=2}finally{!function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",h[e]),t.document.body.removeChild(n),delete h[e])}(t,window)}return n}(e)}const m=3,T=1500;let w;function v(e){return new Promise((t,n)=>{(null==w&&(w=new i.a(m,g,T)),w).add({onFulfilled:t,onRejected:n,options:e})})}function g(e){return k(e.options).then(t=>{e.onFulfilled(t)}).catch(t=>{e.onRejected(t)}),Promise.resolve()}var b=n(311),A=n(304);let O=null;const j="OWA_GetDelegationAccessToken",y="https://login.live.com/oauth20_authorize.srf",I="/owa/auth/dt.aspx",_="292841";async function C(e,t,n,o,r){let i,s={scope:e,client_id:"",authorization_uri:"",redirect_uri:"",requestId:n||Object(b.a)(),sourceId:r};try{return i=await async function(e,t,n){let o=function(e){return e.client_id+e.scope+(e.sourceId||"")}(e),r=function(e,t){const n=e.get(t);let o=void 0;if(null==n?void 0:n.AccessTokenExpiry){new Date(n.AccessTokenExpiry)>new Date(Date.now())&&(o=n)}return o}(R(),o);if(null==r?void 0:r.AccessToken)return n?Object(A.a)(r):r.AccessToken;{let r,i=Object(c.a)(o);return i?r=i:(r=v(e),Object(c.b)(o,r)),r.then(e=>(function(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){const n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&R().put(e,t,n)}}(o,e),Object(c.c)(o),n?Object(A.a)(e):e.AccessToken)).catch(n=>{Object(c.c)(o),Object(u.d)(j,{category:"Promise_For_Token_Request_Failed",err:n?n.toString():"",message:n?n.message:"",scope:e.scope,requestId:e.requestId,api:t})})}}((a=s,a.redirect_uri=Object(f.a)()+I,a.authorization_uri=y,a.client_id=_,a),void 0,o),i}catch(n){return Object(u.d)(j+" GetDelegationToken Operation failed ",{err:n.toString(),message:n.message,stk:n.stack||"",scope:e,requestId:s.requestId,api:t}),i}var a}function R(){return null==O&&(O=new r.Cache),O}var E=n(13),x=n(392);let S=!1;function D(){S||(!function(){let e=Object(x.a)("/owa");Object(E.b)({baseUrl:e})}(),S=!0)}var q={NoUserLogin:"AADSTS50058",InvalidResourceUrl:"AADSTS50001",NoPreAuth:"AADSTS65001",UserAborted:"AADSTS65004",NotConsent:"AADSTS70011"};function F(e,t,n,o,r){n?e.acquireTokenPopup(t,null,n,r):e.acquireToken(t,(function(n,c){!function(e,t){if(!e)return!1;if(e.indexOf(q.NoUserLogin)>=0)return!0;if(e.indexOf(q.NoPreAuth)>=0&&t)return!0;return!1}(n,o)?r(n,c):e.acquireTokenPopup(t,null,null,r)}))}var P=n(20);const U=new P.c(()=>n.e(1323).then(n.bind(null,19532))),L=new P.a(U,e=>e.createAdalAuthenticationContext);var H=n(141);let N=(e,t,n,o,r)=>(c,i)=>{c||!i?r(c,null):(e.getCachedUser(),F(e,t,n,o,r))};const z="adalIdTokenFrame";function W(e,t,n,o,r){e.config.displayCall=function(c){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(c),window.detectUserCachedCallback=N(e,t,n,o,r),function(e,t){e._addAdalFrame(z).src="about:blank",e._loadFrame(t+"&prompt=none",z)}(e,c)},e.login()}var B=n(29);async function G(e,t,n,o,r,c){var i,s;const a=await async function(){const e=await Object(H.a)({});let t;if(0===(null==e?void 0:e.ResultCode)&&(null==e?void 0:e.AuthenticationUrl)){const n=e.AuthenticationUrl.split("/");t=n[0]+"//"+n[2]+"/"}return t||"https://login.microsoftonline.com/"}(),u=await L.importAndExecute(a,e,t),l=Object(B.a)(),d=null===(i=l.SessionSettings)||void 0===i?void 0:i.UserPrincipalName,f=null===(s=l.SessionSettings)||void 0===s?void 0:s.UserEmailAddress;u._user={profile:{upn:d||f}},u.getCachedUser()?F(u,n,o,r,c):W(u,n,o,r,c)}var M=n(434);n.d(t,"getAccessTokenforResource",(function(){return o.b})),n.d(t,"getAccessTokenforResourceAsLazy",(function(){return o.c})),n.d(t,"getDelegationTokenForOwa",(function(){return C})),n.d(t,"bootstrap",(function(){return D})),n.d(t,"getAccessTokenOnBehalfOfResource",(function(){return G})),n.d(t,"AdalErrorCode",(function(){return q})),n.d(t,"buildAuthorizationHeader",(function(){return M.a}))},433:function(e,t,n){"use strict";var o=n(164),r=n(214),c=n(221);function i(e){return Object.assign({__type:"TokenRequest:#Exchange"},e)}var s=n(52),a=n(32);var u=n(276),l=n(117),d=n(130),f=n(121),p=n(2),h=n(44),k=n(198),m=n(434);const T="OWA_GetAccessTokenForResource",w=["requestnotcomplete","requesttimeout"],v="bearer",g="msauth1.0",b=3600,A=86400;async function O(e,t,n,o,r,i,s,a){var p,h;const k=await Object(u.a)(a),m=Object(l.a)();if(k&&(e==m||e==m+"/"))return{AccessToken:k};if(e.toLowerCase().indexOf("/notificationchannel")>0||e.toLowerCase().indexOf("/outlookimageproxy.azurewebsites.net")>0)return j(e,t,n,!1,o,r,s,k,a);if(Object(f.a)("resourceTokenFromHost")){const t=Object(d.c)()?Object(d.a)():void 0;if((null==t?void 0:t.isResourceTokenPrefetchEnabled)&&await t.isResourceTokenPrefetchEnabled()&&t.getResourceToken){const n=await t.getResourceToken(e,i,a);if(n&&n.length>0){const e=n.split(" "),t=null===(p=e[0])||void 0===p?void 0:p.toLowerCase();if((t==v||t==g)&&(null===(h=e[1])||void 0===h?void 0:h.length)>0){const o=t==v?e[1]:n,r=t==g?A:b;return{AccessToken:o,TokenResultCode:0,ExpiresIn:r,AccessTokenExpiry:Object(c.a)(Date.now(),r).toISOString()}}}}}return j(e,t,n,!0,o,r,s,k,a)}async function j(e,t,n,o=!0,r,c,s,u,l){var d;const f={isUserActivity:!1,datapoint:{customData:{Scenario:T,Resource_Url:e,Retry_attempt:t,Request_Id:n,Target_Tenant_Id:c||"",Api:r||""},headersCustomData:e=>({TokenResultDetails:e.get("x-tokenresult")||"",ServerRequestId:e.get("request-id")||""}),jsonCustomData:e=>{var t;return{TokenStatus:(null===(t=null==e?void 0:e.TokenResultCode)||void 0===t?void 0:t.toString())||2}},datapointOptions:{isCore:"lamp152"==(null===(d=Object(p.y)())||void 0===d?void 0:d.toLowerCase())||Object(h.j)("auth-logAllDataPointForTokenFetching")}},returnFullResponseOnSuccess:!0,sourceId:l};u&&(f.headers=new Headers,f.headers.set("authorization",Object(m.a)(u)));let k=i({Resource:e,TargetTenantId:c,PreferIdpToken:s});o&&(k.UserToken=u);const w=await function(e,t){return void 0===e||e.__type||(e=i(e)),Object(a.a)("GetAccessTokenforResource",e,t)}(k,f);return await w.json()}async function y(e,t,n,o,r,c,i,a,u){return t<1?Promise.reject(new Error("Max retrying limit (1) reached.")):O(e,t,o,r,c,i,a,u).catch(l=>{var d,f,m,v;return function(e){var t,n;const o=e,r=null!==(n=null===(t=null==o?void 0:o.fetchErrorType)||void 0===t?void 0:t.toLowerCase())&&void 0!==n?n:"";return-1==w.indexOf(r)}(l)&&Object(s.a)(n).then(()=>y(e,t-1,2*n,o,r,c,i,a,u)),Object(k.d)(`${T}::NonTransientError`,{err:null!==(d=null==l?void 0:l.toString())&&void 0!==d?d:"",message:null!==(f=null==l?void 0:l.message)&&void 0!==f?f:"",stk:null!==(m=null==l?void 0:l.stack)&&void 0!==m?m:"",resource:e,requestId:o,apiName:null!=r?r:""},{isCore:"lamp152"==(null===(v=Object(p.y)())||void 0===v?void 0:v.toLowerCase())||Object(h.j)("auth-logAllDataPointForTokenFetching")}),Promise.reject(l)})}var I=n(417);const _=1,C=500;let R;function E(e,t,n,o,r,c,i){return new Promise((s,a)=>{(null==R&&(R=new I.a(_,x,C)),R).add({onFulfilled:s,onRejected:a,resource:e,requestId:t,apiName:n,targetTenantId:o,wwwAuthenticateHeader:r,preferIdpToken:c,sourceId:i})})}function x(e){return K(e.resource,e.apiName,e.requestId,e.targetTenantId,e.wwwAuthenticateHeader,e.preferIdpToken,e.sourceId,!0).then(t=>{e.onFulfilled(t)}).catch(t=>{e.onRejected(t)}),Promise.resolve()}var S=n(244),D=n(311),q=n(304),F=n(20);let P={"https://loki.delve.office.com/":!0,"https://www.yammer.com/":!0,"https://web.yammer.com/teams":!0,"https://fe-26.qas.bing.net/compose":!0,"https://api.diagnostics.office.com":!0,"https://outlook.office365.com/connectors":!0,"https://api.office.net":!0,"https://clients.config.office.net/":!0,"https://outlook.office.com/FocusedInboxB2":!0,"https://outlook.office.com/search":!0,"https://augloop.office.com/v2":!0,"https://arc.msn.com/v4":!0,"https://outlook-sdf.office.com":!0,"https://outlook-sdf.office365.com":!0,"https://microsoft.sharepoint.com":!1,"https://microsoft-my.sharepoint-df.com":!1,"https://webdir.online.lync.com":!1,"https://chatsvcagg.teams.microsoft.com":!1,"https://teams.microsoft.com":!1,"https://graph.microsoft.com":!1,"https://outlook.office.com":!1,"https://outlook.office365.com":!1,"https://outlook-sdf.live.com":!1,"https://outlook.live.com":!1};const U=new F.c(()=>n.e(1315).then(n.bind(null,19425))),L=new F.a(U,e=>e.fetchAccessTokenFromMsal);n.d(t,"b",(function(){return G})),n.d(t,"c",(function(){return M})),n.d(t,"a",(function(){return K}));const H=1,N=8e3,z=3,W=1500;let B=null;async function G(e,t,n,o,r,c,i){n=n||Object(D.a)();let[s,a]=M(e,t,n,o,r,!1,c,i);return s||(s=await a),s}function M(e,t,n,o,r,c,i,s){return Object(h.j)("auth-msaljs-fetchResourceToken")&&Object(f.a)("msalTokenFetch")&&P[e]?[void 0,$(e,t,n,o,r,c,i,s)]:J(e,t,n,o,r,c,i,s)}async function $(e,t,n,o,r,c,i,s){var a=await L.importAndExecute(e);if(null==a?void 0:a.AccessToken)return c?Object(q.a)(a):a.AccessToken;{let[a,u]=J(e,t,n,o,r,c,i,s);return null!=a?a:u}}function J(e,t,n,o,c,i,s,a){n=n||Object(D.a)();const u=V(e,o,s,a);let l;if(c||(l=function(e,t){const n=e.get(t);let o=void 0;if((null==n?void 0:n.AccessTokenExpiry)&&n.AccessToken){Object(r.a)(new Date(n.AccessTokenExpiry),-H)>new Date(Date.now())&&(o=n)}return o}(Q(),u)),l)return[i?Object(q.a)(l):l.AccessToken,void 0];{let r,l=Object(S.a)(u);return l?r=l:(r=E(e,n,t,o,c,s,a),Object(S.b)(u,r)),[void 0,r.then(e=>(Object(S.c)(u),i?Object(q.a)(e):e.AccessToken)).catch(r=>{Object(S.c)(u),Object(k.d)(T,{category:"Promise_For_Token_Request_Failed",err:r?r.toString():"",message:r?r.message:"",stk:r?r.stack:"",resource:e,requestId:n,targetTenantId:o||"",api:t,wwwAuthenticateHeader:c||"",showFullTokenResponse:i||!1},{isCore:Object(h.j)("auth-logAllDataPointForTokenFetching")})})]}}async function K(e,t,n,o,r,i,s,a){let u=a?await y(e,z,W,n,t,o,r,i,s):await O(e,z,n,t,o,r,i,s);if(null!=u&&0==u.TokenResultCode&&null!=u.AccessTokenExpiry){u.ExpiresIn&&u.ExpiresIn>0&&(u.AccessTokenExpiry=Object(c.a)(Date.now(),u.ExpiresIn).toISOString());const a=V(e,o,i,s),l=new Date(u.AccessTokenExpiry).getTime()-Date.now()-N;l>0&&Q().put(a,u,l,(function(c,a){K(e,t,n,o,r,i,s,!1).catch(e=>{Object(k.d)(T,{category:"Cache_Expired",err:e?e.toString():"",message:e?e.message:"",stk:e?e.stack:"",resource:c,requestId:n,targetTenantId:o||"",api:t,wwwAuthenticateHeader:r||"",preferIdpToken:i},{isCore:Object(h.j)("auth-logAllDataPointForTokenFetching")})})}))}return u}function Q(){return null==B&&(B=new o.Cache),B}function V(e,t,n,o){let r=e;return t&&(r+="|"+t),n&&(r+="|IdpToken"),o&&(r+="|"+o),r}},434:function(e,t,n){"use strict";function o(e){var t;const n=null===(t=null==e?void 0:e.split(" "))||void 0===t?void 0:t[0].toLowerCase();return"msauth1.0"==n||"bearer"==n?e:`Bearer ${e}`}n.d(t,"a",(function(){return o}))}}]);
//# sourceMappingURL=owa.0.js.map
self.scriptsLoaded['owa.0.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.0.js'] = (new Date()).getTime();