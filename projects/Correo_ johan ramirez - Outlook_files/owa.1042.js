self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.1042.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[1042],{19321:function(e,n,i){"use strict";i.r(n);const t={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"subscription",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"subscribeToHierarchyNotifications"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"EventType"}},{kind:"Field",name:{kind:"Name",value:"folderId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"itemCount"}},{kind:"Field",name:{kind:"Name",value:"unreadCount"}}]}}]}}]};var a=i(702),d=i(2040),o=i(2574),l=i(2363),r=i(4382),c=i(598),u=i(3116),s=i(1705),m=i(4516),k=i(245),F=i(1685);function f(){const e=Object(r.a)({FolderShape:Object(u.a)({BaseShape:"IdOnly",AdditionalProperties:[Object(s.a)({FieldURI:"TotalCount"}),Object(s.a)({FieldURI:"UnreadCount"})]}),Paging:null,ParentFolderIds:[Object(c.a)({Id:Object(F.a)("msgfolderroot")})],ReturnParentFolder:!0,ShapeName:null,Traversal:"Deep"});return Object(m.a)({Header:Object(k.b)(),Body:e}).then(e=>{var n,i,t;return null===(t=null===(i=null===(n=null==e?void 0:e.Body)||void 0===n?void 0:n.ResponseMessages)||void 0===i?void 0:i.Items)||void 0===t?void 0:t[0]})}var v=i(40),N=i(5766);function b(e){switch(e.EventType){case"Reload":case"QueryResultChanged":f().then(e=>{"Success"==(null==e?void 0:e.ResponseClass)?e.RootFolder.Folders.forEach(e=>{Object(l.a)(e.UnreadCount,e.TotalCount,e.FolderId.Id,!1)}):v.h.warn(y+"ResponseNotSuccess")}).catch(e=>{v.h.warn(y+":"+e.message)});break;case"RowModified":Object(o.b)(e.unreadCount,e.itemCount,e.folderId,e.displayName,e.parentFolderId),d.h.import().then(n=>{n(e)});break;case"RowAdded":Object(o.a)(e.folderId,e.parentFolderId,e.displayName,e.unreadCount,e.itemCount),d.h.import().then(n=>{n(e)});break;default:return}}function p(){const e=Object(a.a)();Object(N.a)(()=>e.subscribe({query:t}),{next:e=>b(e.data.subscribeToHierarchyNotifications),error:e=>{v.h.warn(`Hierarchy notification error ${e}`),b({EventType:"Reload"})}},"HierarchyNotifications")}const y="UpdateFolderCountsAction:";const h={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderUpdateNotification"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"totalMessageCount"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}}]}}]},g={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"NewFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"changeKey"}},{kind:"Field",name:{kind:"Name",value:"type"}},{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"displayName"}},{kind:"Field",name:{kind:"Name",value:"distinguishedFolderType"}},{kind:"Field",name:{kind:"Name",value:"FolderClass"}},{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"totalMessageCount"}},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}},{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}},{kind:"Field",name:{kind:"Name",value:"remoteFolderInfo"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"remoteFolderDisplayName"}}]}}]}}]};var C=i(20),O=i(7042),j=i(12),I=i(3669);const S=Object(C.e)(o.a,"onNewFolderNotificationClone",async e=>{if(!Object(j.i)("gqlfolders"))return;const{displayName:n,parentFolderId:i,folderId:t,unreadCount:d,totalCount:o}=e,l=await Object(O.a)(i,t);if(!l)return;const r=Object(a.a)();r.writeFragment({id:Object(I.a)(t,r),fragment:g,data:{id:t,changeKey:null,UnreadCount:d,totalMessageCount:o,displayName:n,parentFolderId:l.id,mailboxInfo:l.mailboxInfo,remoteFolderInfo:{remoteFolderDisplayName:n},distinguishedFolderType:null,childFolderIds:[],childFolderCount:0,type:"Folder:#Exchange",FolderClass:"IPF.Note",__typename:"MailFolder"}})}),w=Object(C.e)(o.b,"onUpdateFolderNotificationClone",async e=>{if(!Object(j.i)("gqlfolders"))return;const{folderId:n,unreadCount:i,totalCount:t,displayName:d,parentFolderId:o}=e,l=Object(a.a)();if(!l.readFragment({id:Object(I.a)(n,l),fragment:h}))return;const r=await Object(O.a)(o,n);r&&l.writeFragment({id:Object(I.a)(n,l),fragment:h,data:{UnreadCount:i,totalMessageCount:t,displayName:d,parentFolderId:r.id}})});i.d(n,"subscribeToHierarchyNotification",(function(){return p})),i.d(n,"onNewFolderNotificationOrchestrator",(function(){return S})),i.d(n,"onUpdateFolderNotificationOrchestrator",(function(){return w}))},3116:function(e,n,i){"use strict";function t(e){return Object.assign({__type:"FolderResponseShape:#Exchange"},e)}i.d(n,"a",(function(){return t}))},3669:function(e,n,i){"use strict";function t(e,n){const i={__typename:"MailFolder",id:e};return n.cache.identify(i)}i.d(n,"a",(function(){return t}))},4229:function(e,n,i){"use strict";i.d(n,"a",(function(){return t})),i.d(n,"d",(function(){return a})),i.d(n,"c",(function(){return d})),i.d(n,"b",(function(){return o}));const t={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderChildFolderIds"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}},{kind:"Field",name:{kind:"Name",value:"id"}},{kind:"Field",name:{kind:"Name",value:"changeKey"}},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}}]}}]},a={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"UpdateFolderChildFolderIds"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"childFolderIds"},directives:[{kind:"Directive",name:{kind:"Name",value:"client"}}]},{kind:"Field",name:{kind:"Name",value:"childFolderCount"}}]}}]},d={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderParentFolder"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"parentFolderId"}},{kind:"Field",name:{kind:"Name",value:"mailboxInfo"}}]}}]},o={kind:"Document",definitions:[{kind:"FragmentDefinition",name:{kind:"Name",value:"FolderCounts"},typeCondition:{kind:"NamedType",name:{kind:"Name",value:"MailFolder"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"UnreadCount"}},{kind:"Field",name:{kind:"Name",value:"totalMessageCount"}}]}}]}},4382:function(e,n,i){"use strict";function t(e){return Object.assign({__type:"FindFolderRequest:#Exchange"},e)}i.d(n,"a",(function(){return t}))},4516:function(e,n,i){"use strict";var t=i(32);function a(e,n){var i;return void 0===e||e.__type||(i=e,e=Object.assign({__type:"FindFolderJsonRequest:#Exchange"},i)),Object(t.a)("FindFolder",e,n)}i.d(n,"a",(function(){return a}))},5766:function(e,n,i){"use strict";var t=i(61),a=i(2),d=i(560),o=i(40);const l=10;function r(e,n,i){let r,c=0;const u={next:e=>{var i;return null===(i=n.next)||void 0===i?void 0:i.call(n,e)},complete:()=>{var e;return null===(e=n.complete)||void 0===e?void 0:e.call(n)},error:s=>{var m;Object(t.o)("GraphqlSubscriptionError",{owa_1:i,owa_2:Object(a.T)(null==s?void 0:s.toString()),owa_3:Object(a.T)(null==s?void 0:s.stack),owa_4:c},{isCore:!0}),Object(d.isApolloError)(s)&&(c++<l?(null==r||r.unsubscribe(),r=e().subscribe(u)):Object(o.d)(`${i}: too many apollo errors`)),null===(m=n.error)||void 0===m||m.call(n,s)}};return r=e().subscribe(u),{closed:!r||r.closed,unsubscribe:()=>null==r?void 0:r.unsubscribe()}}i.d(n,"a",(function(){return r}))},6036:function(e,n,i){"use strict";i.d(n,"a",(function(){return o}));var t=i(4229),a=i(702),d=i(3669);async function o(e,n){const i=Object(a.a)(),o=i.readFragment({id:Object(d.a)(e,i),fragment:t.c});if(!o)return;const l=o.parentFolderId;if(l==n)return;const r=i.readFragment({id:Object(d.a)(l,i),fragment:t.a});if(!r)return null;const c=[...r.childFolderIds],u=c.indexOf(e);u>-1&&(c.splice(u,1),i.writeFragment({id:Object(d.a)(l,i),fragment:t.d,data:{childFolderIds:[...c],childFolderCount:c.length}}))}},7042:function(e,n,i){"use strict";i.d(n,"a",(function(){return l}));var t=i(4229),a=i(702),d=i(3669),o=i(6036);async function l(e,n){const i=Object(a.a)();await Object(o.a)(n,e);const l=i.readFragment({id:Object(d.a)(e,i),fragment:t.a});if(!l)return null;const r=l.childFolderIds;return r.includes(n)||i.writeFragment({id:Object(d.a)(e,i),fragment:t.d,data:{childFolderIds:[...r,n],childFolderCount:r.length}}),i.readFragment({id:Object(d.a)(e,i),fragment:t.a})}}}]);
//# sourceMappingURL=owa.1042.js.map
self.scriptsLoaded['owa.1042.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.1042.js'] = (new Date()).getTime();