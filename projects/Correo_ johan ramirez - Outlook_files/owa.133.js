self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.133.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[133],{11788:function(e,t,n){"use strict";function r(e){const t=e&&e.Action;return t&&!!t.SourceLocation}function o(e){const t=e&&e.Action;return t&&!!t.FunctionName}function i(e){return!!e&&!!e.MenuItems}n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return i}))},14593:function(e,t){e.exports={am:"am-et",ar:"ar-sa",bg:"bg-bg","bn-in":"bn-in",ca:"ca-es",cs:"cs-cz",cy:"cy-gb",da:"da-dk",de:"de-de",el:"el-gr",en:"en-us",es:"es-es","es-mx":"es-mx",et:"et-ee",eu:"eu-es",fa:"fa-ir",fi:"fi-fi",fil:"fil-ph",fr:"fr-fr","fr-ca":"fr-ca",gl:"gl-es",gu:"gu-in",he:"he-il",hi:"hi-in",hr:"hr-hr",hu:"hu-hu",id:"id-id",is:"is-is",it:"it-it",ja:"ja-jp",kk:"kk-kz",kn:"kn-in",ko:"ko-kr","lo-la":"lo-la",lt:"lt-lt",lv:"lv-lv",ml:"ml-in",mr:"mr-in",ms:"ms-my",nl:"nl-nl","nn-no":"nn-no",no:"nb-no",pl:"pl-pl",pt:"pt-br","pt-pt":"pt-pt",ro:"ro-ro",ru:"ru-ru",sk:"sk-sk",sl:"sl-si",sr:"sr-latn-rs","sr-cyrl":"sr-cyrl-rs",sv:"sv-se",sw:"sw-ke",ta:"ta-in",te:"te-in",th:"th-th",tr:"tr-tr",uk:"uk-ua",ur:"ur-pk",vi:"vi-vn","zh-hans":"zh-cn","zh-hant":"zh-tw"}},1840:function(e,t,n){"use strict";var r=class{constructor(e,t){if(this.AddinCommands=t,!this.AddinCommands)throw new Error("AddinCommands cannot be null while constructing an addin");this.DisplayName=e.DisplayName,this.IconUrl=e.IconUrl,this.HighResolutionIconUrl=e.HighResolutionIconUrl,this.Id=e.Id}},o=n(11788),i=n(266);class a{constructor(e,t,n,r){if(this.control=e,this.tabInfo=t,this.groupInfo=n,this.extension=r,o.b(e)){const o=e;this.subCommands=[];for(const e of o.MenuItems)this.subCommands.push(new a(e,t,n,r))}}get isActionable(){return!!this.control.Action}get isMenu(){return!!this.control.MenuItems}get_EntryPoint(){if(o.c(this.control)){return this.control.Action.SourceLocation}return o.a(this.control)?this.extension.ExtensionPointCollection.FunctionFile:(Object(i.a)(this.control),"")}get_Id(){return this.extension.Id+this.control.Id}get_Label(){return this.control.Label}get_ExtensionDisplayName(){return this.extension.DisplayName}get_Size16Icon(){return this.control&&this.control.Icon?this.control.Icon.Size16Url:null}getControl(){return this.control}}var s=a;var l,c=class{constructor(e,t){this.detectedEntity=e,this.extension=t}get_EntryPoint(){return this.detectedEntity.SourceLocation}get_Id(){return this.extension.Id}get_Label(){return this.detectedEntity.Label}get_ExtensionDisplayName(){return this.extension.DisplayName}get_ActivationRule(){return this.detectedEntity.Rule}get_Size16Icon(){return this.extension.IconUrl}getControl(){return null}};!function(e){e[e.TimedOut=-1]="TimedOut",e[e.Success=0]="Success",e[e.FunctionNotFound=11101]="FunctionNotFound",e[e.NavigatedBeforeCompleted=13001]="NavigatedBeforeCompleted",e[e.PreinstalledConsented=13002]="PreinstalledConsented",e[e.Unknown=13003]="Unknown"}(l||(l={}));var d=l,u=n(3),p=n(1870),f=n(2933),m=Object(u.mutatorAction)("setAutoRunAddinCommandWaitingQueue",(e,t,n)=>{const r=Object(p.a)().autoRunAddinCommandWaitingQueue,o=Object(f.a)(n,t);r.has(o)||r.set(o,new Array),r.get(o).push(e)}),g=Object(u.mutatorAction)("destroyAutoRunAddinCommandFromWaitingQueue",(e,t,n)=>{const r=Object(p.a)().autoRunAddinCommandWaitingQueue,o=Object(f.a)(n,e);if(r.has(o)){const e=r.get(o);for(let n=0;n<e.length;n++)if(e[n].addinCommand===t){e.splice(n,1);break}0===e.length&&r.delete(o)}}),v=n(699),h=n(14);const y="DeferrablePromise timed out";class C{constructor(e){this.internalPromise=new Promise((t,n)=>{this.internalResolve=t,this.internalReject=n,this.timeout=setTimeout(()=>{n(new Error(y)),this.isRejected=!0},e)})}then(e,t){return this.internalPromise.then(e,t)}catch(e){return this.internalPromise.catch(e)}resolve(e){this.isFullfilled&&this.isRejected||(this.internalResolve(e),this.isFullfilled=!0,clearTimeout(this.timeout))}reject(e){this.isFullfilled&&this.isRejected||(this.internalReject(e),this.isRejected=!0,clearTimeout(this.timeout))}reset(e){this.timeout&&clearTimeout(this.timeout),this.timeout=setTimeout(()=>{this.reject(new Error(y)),this.isRejected=!0},e)}}Symbol.toStringTag;const _=33e4,S=3e5,A={};var I=n(44);const T=[{Id:"a7ca6c74-33fb-43a4-a3e4-781078f0eff5",Function:"addZoomButton",Name:"Zoom",FlightName:"addin-everyMeetingOnlineClient-Zoom"},{Id:"8d763f92-e8cb-4843-a9ef-9cba0dca8727",Function:"insertMeetingButton",Name:"BlueJeans",FlightName:"addin-everyMeetingOnlineClient-BlueJeans"},{Id:"39403046-5079-4d8b-a7d0-d540c95a3a5b",Function:"funcCreateMeetingButton",Name:"GoToMeeting",FlightName:"addin-everyMeetingOnlineClient-GoToMeeting"},{Id:"6df220fc-e48e-4469-8db1-6912ce109886",Function:"addMeetingApptButton",Name:"GoogleMeet",FlightName:"addin-everyMeetingOnlineClient-GoogleMeet"},{Id:"7a91e319-a65d-4ceb-909b-12203561dbf5",Function:"apptOrganizerJoinMeetingButton",Name:"Webex",FlightName:"addin-everyMeetingOnlineClient-Webex"},{Id:"0ef8b29f-ff7f-4603-b4f3-ea836b406f3f",Function:"addJioMeetButton",Name:"JioMeet",FlightName:"addin-everyMeetingOnlineClient-JioMeet"}];var O=n(2008);const x=Object(u.mutatorAction)("setUiLessAddinRunningForEMO",e=>{O.a.uiLessAddinRunningForEMO=e});var E=Object(v.action)("setUilessExtendedAddinCommand")((function(e,t,n,r){var o,i,a,s,l;const c=function(e){const t=new C(_);return A[e]=t,t.catch(e=>e.message===y?{status:d.TimedOut}:{status:d.Unknown})}(e),u=Object(f.a)(r,n),m=Object(p.a)().runningUILessExtendedAddinCommands;m.has(u)||m.set(u,new h.ObservableMap),m.get(u).set(e,t);const g=null===(i=null===(o=null==t?void 0:t.addinCommand)||void 0===o?void 0:o.extension)||void 0===i?void 0:i.Id;if(Object(I.j)("addin-everyMeetingOnline")&&(null===(l=null===(s=null===(a=null==t?void 0:t.addinCommand)||void 0===a?void 0:a.extension)||void 0===s?void 0:s.ExtensionPointCollection)||void 0===l?void 0:l.AppointmentOrganizerCommandSurface)&&g){let e;for(let t of T)if(t.Id==g){e=t.Name;break}e&&x(e)}return c})),b=n(3327),M=n(61),R=n(2),P=n(3860);let N=Object(u.action)("onAutorunExecutionCompleted",(e,t,n,r,o,i)=>({extendedAddinCommand:e,controlId:t,hostItemIndex:n,status:r,targetWindow:o,completedContext:i}));Object(u.orchestrator)(N,e=>{e.extendedAddinCommand.addinCommandTelemetry.setExecutionEndTime(),Object(M.o)("AddinExecutionCompleted",{id:Object(P.a)(e.extendedAddinCommand.addinCommand.extension),controlId:e.controlId,owa_1:Object(R.m)(),owa_2:Object(fe.c)(e.hostItemIndex),executionEndTime:e.extendedAddinCommand.addinCommandTelemetry.getExecutionEndTime()}),Ve(e.controlId,e.hostItemIndex,e.status,e.targetWindow,e.completedContext),Object(p.a)().activeAutorunUilessFrames.delete(e.controlId),w(e.hostItemIndex,e.targetWindow)});var U=N;const F=(e,t,n,r)=>{e.forEach(e=>{r&&(e.launchEventArgs=r),e.controlId=j(t,e.addinCommand.get_Id(),n),e.addinCommandTelemetry.setQueuePushTime(),m(e,t,n)})},w=(e,t)=>{k(e,t).forEach(n=>{L(e,t)&&(n.addinCommandTelemetry.setQueuePopTime(),D(n,e,t))})},D=(e,t,n)=>{const r=e.addinCommand,o=e.controlId;B(r.get_Id(),t,n)?Object(p.a)().activeAutorunUilessFrames.get(o).invokeAppCommand(r.getControl(),e.launchEventArgs):E(o,e,t,n).then(r=>{r.status==d.TimedOut&&U(e,o,t,d.TimedOut,n)}),g(t,r,n)},k=(e,t)=>{const n=Object(f.a)(t,e),r=Object(p.a)().autoRunAddinCommandWaitingQueue.get(n);return r||[]},L=(e,t)=>!(W(e,t)||H()),B=(e,t,n)=>{const r=Object(f.a)(n,t),o=Object(p.a)().runningUILessExtendedAddinCommands;let i=!1;return!!o.has(r)&&(o.get(r).forEach(t=>{const n=t.addinCommand;V(n)&&n.get_Id()===e&&(i=!0)}),i)},H=()=>{const e=Object(p.a)().runningUILessExtendedAddinCommands;let t=0;return e.forEach(e=>{e.forEach(e=>{const n=e.addinCommand;V(n)&&(t+=1)})}),t>=20},W=(e,t)=>{const n=Object(p.a)().runningUILessExtendedAddinCommands;let r=0;const o=Object(f.a)(t,e);return n.has(o)&&n.get(o).forEach(e=>{const t=e.addinCommand;V(t)&&(r+=1)}),r>=5},V=e=>e instanceof b.a,j=(e,t,n)=>{let r=null;const o=Object(f.a)(n,e),i=Object(p.a)().runningUILessExtendedAddinCommands;return i.has(o)&&i.get(o).forEach(e=>{r=G(e,t)?e.controlId:r}),r||(k(e,n).forEach(e=>{r=G(e,t)?e.controlId:r}),r||Ie())},G=(e,t)=>e.controlId&&e.addinCommand.get_Id()===t;var X=n(3738);class K{CreateAddinCommand(e,t,n,r){return new s(e,t,n,r)}CreateContextualAddinCommand(e,t){return new c(e,t)}CreateEventAddinCommand(e,t){switch(e.Type){case 1:return new s({Id:"ItemSend",Action:e},null,null,t)}return null}CreateAutoRunAddinCommand(e,t,n){let r;switch(e.Type){case 0:r="Unknown";break;case 1:r="OnNewMessageCompose";break;case 2:r="OnNewAppointmentOrganizer";break;case 3:r="OnMessageAttachmentsChanged";break;case 4:r="OnAppointmentAttachmentsChanged";break;case 5:r="OnMessageSend";break;case 6:r="OnAppointmentSend";break;case 7:r="OnMessageRecipientsChanged";break;case 8:r="OnAppointmentAttendeesChanged";break;case 9:r="OnAppointmentTimeChanged";break;case 10:r="OnAppointmentRecurrenceChanged";break;case 11:r="OnInfoBarDismissClicked";break;default:r="Unknown"}const o={Id:r,Action:e};return new b.a(e.Type,o,t,n)}}var q=n(1853);function z(e,t){switch(t){case q.a.MeetingRequest:return e.MessageReadCommandSurface;case q.a.AppointmentAttendee:return e.AppointmentAttendeeCommandSurface;case q.a.AppointmentOrganizer:return e.AppointmentOrganizerCommandSurface;case q.a.DetectedEntity:return e.DetectedEntity;case q.a.MessageCompose:return e.MessageComposeCommandSurface;case q.a.MessageRead:return e.MessageReadCommandSurface;case q.a.LaunchEvent:return e.LaunchEvent;case q.a.TrapOnSendEvent:default:return null}}const J="User",Q="MarketPlace";function $(e){return!(null==e||!e.MarketplaceAssetID||(null==e?void 0:e.OriginString)!=J||(null==e?void 0:e.TypeString)!=Q)}class Z{constructor(e){this.addinCommandFactory=e,this.GetAutoRunAddinCommands=(e,t,n)=>{if(!e)return null;const r={},o=Object(I.j)("addin-autoRun")&&Object(I.j)("addin-autoRun-shouldBlockUserInstalledStoreAddin");return e.LaunchEvents.forEach(e=>{o&&$(t)||this.isLaunchEventTypeSupported(e.Type)&&(r[e.Type.toString()]=this.addinCommandFactory.CreateAutoRunAddinCommand(e,t,n))}),new h.ObservableMap(r)}}CreateAddinIfEntryPointSupported(e,t){let n;return n=t==q.a.TrapOnSendEvent?this.GetEventsAddinCommands(e.ExtensionPointCollection.Events,e):t==q.a.DetectedEntity?this.GetContextualAddinCommand(z(e.ExtensionPointCollection,t),e):t==q.a.LaunchEvent?this.GetAutoRunAddinCommands(z(e.ExtensionPointCollection,t),e,t):this.GetAddinCommands(z(e.ExtensionPointCollection,t),e),n?new r(e,n):null}GetAddinCommands(e,t){if(!e)return null;const n={};return e.Tabs.forEach(e=>{e.Groups.forEach(r=>{r.Controls.forEach(o=>{n[o.Id]=this.addinCommandFactory.CreateAddinCommand(o,e,r,t)})})}),new h.ObservableMap(n)}GetContextualAddinCommand(e,t){if(!e)return null;const n={};return n[t.Id]=this.addinCommandFactory.CreateContextualAddinCommand(e,t),new h.ObservableMap(n)}GetEventsAddinCommands(e,t){if(!e)return null;const n={};return e.forEach(e=>{n[e.Type]=this.addinCommandFactory.CreateEventAddinCommand(e,t)}),new h.ObservableMap(n)}isLaunchEventTypeSupported(e){return 1==e||2==e||7==e||8==e||3==e||4==e||11==e||9==e||10==e}}var Y=Object(u.mutatorAction)("closeAllAutoRunCommandsforHostItemIndex",(e,t)=>{const n=Object(p.a)().autoRunAddinCommandWaitingQueue,r=Object(f.a)(t,e);n.delete(r)});function ee(){return{regExMatches:{},matchedKnownEntityTypes:[],filteredEntityMatches:{}}}var te=Object(v.action)("destroyExtensibilityHostItem")((function(e){O.a.HostItems.delete(e)}));function ne(e){return!!e&&!!e.SupportsSharedFolders}function re(e){return e.filter(e=>{return ne(function(e){const t=[...e.AddinCommands.values()];if(0==t.length)return null;return t[0].extension.ExtensionPointCollection}(e))})}function oe(e){return e.filter(e=>{return ne(e.extension.ExtensionPointCollection)})}function ie(e){return ne(e.extension.ExtensionPointCollection)}var ae=n(6533);var se=e=>{const t=Object(p.a)().EnabledAddinCommands;return t?t.getAutoRunAddinsByLaunchEventType(e).map(t=>t.AddinCommands.get(e.toString())):[]},le=n(9971),ce=n(5167),de=n(2502);function ue(e){const{activeDialogs:t}=Object(p.a)();for(let n of t.values())if(n&&e===n.controlId)return 5;return Object(ce.d)(e)?2:Object(le.a)(e)?1:Object(de.b)(e)?3:4}function pe(e){const t=Object(p.a)();return[...function(e,t){let n=[],r=t.taskPanes;for(let t of r.values())for(let r of t.values())r.hostItemIndex===e&&n.push(r.controlId);return n}(e,t),...function(e,t){let n=[];return t.runningUILessExtendedAddinCommands.forEach((t,r)=>{if(JSON.parse(r).hostItemIndex===e)for(let e of t.keys())n.push(e)}),n}(e,t),...function(e,t){const n=t.runningContextualAddinCommand;if(n&&n.hostItemIndex===e)return[t.runningContextualAddinCommand.controlId];return[]}(e,t)]}var fe=n(2720);function me(){return O.a.Context}function ge(e){const t=Object(ae.a)(e);return t&&t.extension.Id}function ve(e){return O.a.HostItems.get(e)}var he=n(9972);function ye(e){return Object(ae.a)(e).extension.WebApplicationResource}var Ce=n(3639);function _e(e){Object(Ce.a)()?e():Object(h.when)(Ce.a,e)}function Se(){return O.a.ExtensibilityStateIsDirty}var Ae=n(311);function Ie(){return Object(Ae.a)()}var Te=Object(v.action)("terminateContextualCallout")((function(){const e=Object(p.a)();e.runningContextualAddinCommand=null,e.contextualCalloutState.contextualAnchor=null,e.contextualCalloutState.activeContextualAddinCommands=[],e.contextualCalloutState.selectedTerms=[]})),Oe=Object(v.action)("initializeContextualCallout")((function(e,t,n){const r=Object(p.a)();r.runningContextualAddinCommand&&Te();const o=ve(t),i=new h.ObservableMap,a=r.contextualCalloutState;a.selectedTerms=[],e.forEach(e=>{const t=o.contextualTerms.get(e).slice();t&&t.length>0&&(a.selectedTerms.push(e),t.forEach(e=>{i.set(e.get_Id(),e)}))}),a.contextualAnchor=n,a.activeContextualAddinCommands=[...i.values()],a.hostItemIndex=t})),xe=Object(v.action)("initializeExtensibilityHostItem")((function(e){O.a.HostItems.has(e)||O.a.HostItems.set(e,{contextualTerms:null,contextualEvaluationResults:null})})),Ee=n(9973);function be(e){var t;return!!(t=e,O.a.activeDialogs.get(t))}function Me(e){return Object(p.a)().HostItems.has(e)}var Re=Object(u.mutatorAction)("setActiveDialog",(function(e,t,n){const{activeDialogs:r}=Object(p.a)(),o=Object(f.a)(t,n);e?r.set(o,e):r.delete(o)}));var Pe=Object(v.action)("setEnabledAddinCommands")((function(e){O.a.EnabledAddinCommands=e})),Ne=n(49);var Ue=Object(v.action)("setExtensibilityContext")((function(e){var t;if(null==e?void 0:e.Extensions){const n=Object(Ne.g)(),r=null===(t=null==n?void 0:n.UserOptions)||void 0===t?void 0:t.WebSuggestedRepliesEnabledForUser;let o=-1;for(let t=0;t<e.Extensions.length;t++){let n=e.Extensions[t];"599e5de2-d41c-442a-bdb4-92eafa18a0dc"===n.Id&&null==n.ExtensionPointCollection.DetectedEntity&&(n.ExtensionPointCollection.DetectedEntity=n.ExtensionPointCollection.CustomPane,n.ExtensionPointCollection.DetectedEntity.Label=n.DisplayName),r&&"bc13b9d0-5ba2-446a-956b-c583bdc94d5e"===n.Id&&Object(I.j)("mc-smartReplyWithCustomMeeting")&&(o=t)}o>=0&&e.Extensions.splice(o,1)}O.a.Context=e})),Fe=Object(v.action)("setExtensibilityStateIsDirty")((function(e){O.a.ExtensibilityStateIsDirty=e})),we=Object(v.action)("setContextualAddinCommand")((function(e,t,n){Object(p.a)().runningContextualAddinCommand=function(e,t,n){return{controlId:e,addinCommand:t,hostItemIndex:n}}(e,n,t)})),De=n(2112),ke=Object(u.mutatorAction)("setTaskPaneAddinCommand",(function(e,t,n,r,o,i,a){const{taskPanes:s}=Object(p.a)(),l=Object(De.a)(i);let c=l?l.tabId:i===window?"Main":null;const d=function(e,t,n,r,o,i,a){return{controlId:e,addinCommand:t,hostItemIndex:n,targetWindow:r,mode:o,errorType:i||0,initializationContext:a}}(e,n,t,i,o,null,a);s.has(c)||s.set(c,new h.ObservableMap),s.get(c).set(r,d)})),Le=n(3109),Be=n(3420),He=Object(u.mutatorAction)("terminateTaskPaneAddin",(function(e,t,n){const{taskPanes:r}=Object(p.a)(),o=Object(De.a)(n);let i=o?o.tabId:n===window?"Main":null;r.has(i)&&(r.get(i).delete(e),0===r.get(i).size&&r.delete(i))})),We=Object(u.mutatorAction)("terminatePersistantTaskPaneAddinWithAppId",(function(e){var t,n;const{taskPanes:r}=Object(p.a)();for(let[o,i]of r){const a=i.get("Persistent");(null===(n=null===(t=null==a?void 0:a.addinCommand)||void 0===t?void 0:t.extension)||void 0===n?void 0:n.Id)===e&&(r.get(o).delete("Persistent"),0===r.get(o).size&&r.delete(o))}})),Ve=Object(v.action)("terminateUiLessExtendedAddinCommand")((function(e,t,n,r,o){const i=Object(f.a)(r,t);!function(e,t){if(A[e]){A[e].resolve(t),delete A[e]}}(e,{status:n,allowEvent:null==o?void 0:o.allowEvent});const a=Object(p.a)().runningUILessExtendedAddinCommands;a.has(i)&&(a.get(i).delete(e),0===a.get(i).size&&a.delete(i))})),je=Object(v.action)("timeoutResetUiLessExtendedAddinCommand")((function(e){!function(e){A[e]&&A[e].reset(S)}(e)})),Ge=Object(u.mutatorAction)("toggleTaskPaneType",(function(e,t){const{taskPanes:n}=Object(p.a)();if("Persistent"===e)for(let[r,o]of n)if(1===n.get(r).size){for(let[i,a]of o)if("Persistent"===i&&a.addinCommand.extension.Id===t){const t=Object(ce.c)(i,a.hostItemIndex,a.targetWindow);n.get(r).delete(i),n.get(r).set(Object(ce.b)(e),t)}}else n.get(r).delete(e);if("NonPersistent"===e)for(let[e,r]of n)if(1===n.get(e).size){for(let[o,i]of r)if("NonPersistent"===o&&i.addinCommand.extension.Id===t||"Persistent"===o&&i.addinCommand.extension.Id!==t){const t=Object(ce.c)(o,i.hostItemIndex,i.targetWindow);n.get(e).delete(o),n.get(e).set(Object(ce.b)(o),t)}}else{const o=["Persistent","NonPersistent"];for(let i=0;i<o.length;i++){let a=o[i];const s=r.get(a);if("NonPersistent"===a&&s.addinCommand.extension.Id===t){const t=Object(ce.c)(a,s.hostItemIndex,s.targetWindow);n.get(e).delete(a),n.get(e).set(Object(ce.b)(a),t)}else"Persistent"===a&&s.addinCommand.extension.Id!==t&&n.get(e).delete(a)}}})),Xe=Object(v.action)("updateConsentState")((function(e,t,n){Object(ae.a)(t).extension.ConsentState=Number(n)})),Ke=Object(v.action)("updateContextualEvaluation")((function(e,t,n,r={hostItem:O.a.HostItems.get(e)}){const o=r.hostItem;o&&(o.contextualTerms=t,o.contextualEvaluationResults=n)})),qe=Object(v.action)("updateEntityExtractionResult")((function(e,t){e.EntityExtractionResult=t})),ze=Object(v.action)("updateExtensionSettings")((function(e,t,n){Object(ae.a)(t).extension.Settings=n})),Je=Object(u.mutatorAction)("updateFrameworkComponentHostItemIndexMap",(function(e,t,n){const{frameworkComponentHostItemIndexMap:r}=Object(p.a)();if(t&&n){const o={hostItemIndex:t,targetWindow:n};r.set(e,o)}else r.delete(e)})),Qe=Object(u.mutatorAction)("updatePersistentTaskPaneHostItem",(function(e,t,n){const r=Object(De.a)(n);let o=r?r.tabId:n===window?"Main":null;const{taskPanes:i,frameworkComponentHostItemIndexMap:a}=Object(p.a)();if(i.has(o)){const r=Object(ce.c)("Persistent",e,n);r.hostItemIndex=t,r.errorType=0}if(!i.has(o)){i.set(o,new h.ObservableMap);const e=Object(ce.c)("Persistent",t,n);i.get(o).set("Persistent",e);const r={hostItemIndex:t,targetWindow:n};a.set("exfc_main",r)}})),$e=Object(v.action)("updateMailReadSurfaceNewAddin")((function(e){O.a.mailReadSurfaceNewAddinId=e})),Ze=Object(v.action)("updateMailComposeSurfaceNewAddin")((function(e){O.a.mailComposeSurfaceNewAddinId=e})),Ye=Object(v.action)("updateCalendarSurfaceNewAddin")((function(e){O.a.calendarSurfaceNewAddinId=e})),et=Object(u.mutatorAction)("updateAnyNewAdminAddinInstalled",(function(e){O.a.anyNewAdminAddinInstalled=e}));var tt=Object(v.action)("setCompliance")((function(e){const t=JSON.parse(e);t&&t.hasOwnProperty("IsMinor")&&(O.a.compliance.isMinor=t.IsMinor)})),nt=(n(3111),n(3112));const rt=Object(u.mutatorAction)("updateUnpinnedAdminAddins",(e,t)=>{switch(t){case q.a.MessageRead:O.a.mailReadSurfaceUnpinnedAdminAddins=e;break;case q.a.MessageCompose:O.a.mailComposeSurfaceUnpinnedAdminAddins=e;break;case q.a.AppointmentOrganizer:O.a.appointmentOrganizerSurfaceUnpinnedAdminAddins=e;break;case q.a.AppointmentAttendee:O.a.appointmentAttendeeSurfaceUnpinnedAdminAddins=e}}),ot=Object(u.mutatorAction)("updateStoreToHighlightAddins",e=>{O.a.shouldHighlightUnpinnedAdminAddins=!0,O.a.themeSpecificHighlightDataStore=e});n(3113);n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return d})),n.d(t,"O",(function(){return V})),n.d(t,"e",(function(){return F})),n.d(t,"W",(function(){return w})),n.d(t,"B",(function(){return X.b})),n.d(t,"b",(function(){return K})),n.d(t,"c",(function(){return Z})),n.d(t,"g",(function(){return Y})),n.d(t,"j",(function(){return O.a})),n.d(t,"h",(function(){return ee})),n.d(t,"i",(function(){return te})),n.d(t,"l",(function(){return re})),n.d(t,"f",(function(){return ie})),n.d(t,"k",(function(){return oe})),n.d(t,"n",(function(){return ae.a})),n.d(t,"r",(function(){return se})),n.d(t,"t",(function(){return ue})),n.d(t,"q",(function(){return pe})),n.d(t,"F",(function(){return ce.c})),n.d(t,"G",(function(){return ce.d})),n.d(t,"H",(function(){return ce.e})),n.d(t,"m",(function(){return ce.a})),n.d(t,"C",(function(){return fe.c})),n.d(t,"s",(function(){return fe.a})),n.d(t,"u",(function(){return me})),n.d(t,"v",(function(){return p.a})),n.d(t,"x",(function(){return ge})),n.d(t,"z",(function(){return ve})),n.d(t,"o",(function(){return he.a})),n.d(t,"y",(function(){return z})),n.d(t,"J",(function(){return ye})),n.d(t,"P",(function(){return Ce.a})),n.d(t,"yb",(function(){return _e})),n.d(t,"Q",(function(){return Se})),n.d(t,"A",(function(){return Ie})),n.d(t,"K",(function(){return Oe})),n.d(t,"L",(function(){return xe})),n.d(t,"N",(function(){return de.e})),n.d(t,"T",(function(){return de.f})),n.d(t,"I",(function(){return de.c})),n.d(t,"S",(function(){return Ee.a})),n.d(t,"M",(function(){return be})),n.d(t,"R",(function(){return Me})),n.d(t,"U",(function(){return $})),n.d(t,"V",(function(){return U})),n.d(t,"X",(function(){return Re})),n.d(t,"ab",(function(){return Pe})),n.d(t,"bb",(function(){return Ue})),n.d(t,"cb",(function(){return Fe})),n.d(t,"Z",(function(){return we})),n.d(t,"db",(function(){return ke})),n.d(t,"eb",(function(){return E})),n.d(t,"fb",(function(){return Le.a})),n.d(t,"p",(function(){return f.a})),n.d(t,"D",(function(){return Be.a})),n.d(t,"E",(function(){return Be.b})),n.d(t,"gb",(function(){return Te})),n.d(t,"ib",(function(){return He})),n.d(t,"hb",(function(){return We})),n.d(t,"jb",(function(){return Ve})),n.d(t,"kb",(function(){return je})),n.d(t,"lb",(function(){return Ge})),n.d(t,"ob",(function(){return Xe})),n.d(t,"pb",(function(){return Ke})),n.d(t,"qb",(function(){return qe})),n.d(t,"rb",(function(){return ze})),n.d(t,"sb",(function(){return Je})),n.d(t,"vb",(function(){return Qe})),n.d(t,"ub",(function(){return $e})),n.d(t,"tb",(function(){return Ze})),n.d(t,"nb",(function(){return Ye})),n.d(t,"mb",(function(){return et})),n.d(t,"Y",(function(){return tt})),n.d(t,"w",(function(){return nt.a})),n.d(t,"xb",(function(){return rt})),n.d(t,"wb",(function(){return ot}))},3860:function(e,t,n){"use strict";n(9970);function r(e){return Telemetry.PrivacyRules.GetAssetId(OSF.StoreType.Exchange,null==e?void 0:e.MarketplaceAssetID,null==e?void 0:e.Id,null==e?void 0:e.ProviderName,null==e?void 0:e.TypeString)}var o=n(2),i=n(5),a=n(14593),s=n.n(a);n.d(t,"a",(function(){return r})),OSF.getLocalizedStringsFilePath=function(){let e=Object(o.H)()+"resources/locale/osfruntime/",t=Object(i.f)()||"en";return e+(s.a[t]||"en-us")+"/jscript/"},OSF.getManifestHostType=function(){},OSF.AppTelemetry={get enableTelemetry(){return!0}}},5167:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return l})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return d}));var r=n(1870),o=n(2112),i=n(9972);function a(e,t,n){var i;const{taskPanes:a}=Object(r.a)(),s=Object(o.a)(n);let l=s?s.tabId:n===window?"Main":null;return null===(i=null==a?void 0:a.get(l))||void 0===i?void 0:i.get(e)}function s(e){const{taskPanes:t}=Object(r.a)();if(!t)return null;for(let n of t.values())for(let t of n.values())if(t&&t.controlId===e)return t;return null}function l(e){const{taskPanes:t}=Object(r.a)();if(!t)return null;for(let n of t.values())for(let[t,r]of n)if(r&&r.controlId===e)return t;return null}function c(e){return"Persistent"===e?"NonPersistent":"Persistent"}function d(e){const t=Object(i.b)(e),n=Object(r.a)().taskPanes.get(t);if(!n)return null;for(let e of n.values())return e.targetWindow;return null}},6533:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(9971),o=n(5167),i=n(2502);function a(e){const t=Object(o.d)(e);if(t)return t.addinCommand;const n=Object(r.a)(e);return n?n.addinCommand:Object(i.b)(e)}},9970:function(e,t){
/*
    Your use of this file is governed by the Microsoft Services Agreement http://go.microsoft.com/fwlink/?LinkId=266419.

    This file also contains the following Promise implementation (with a few small modifications):
        * @overview es6-promise - a tiny implementation of Promises/A+.
        * @copyright Copyright (c) 2014 Yehuda Katz, Tom Dale, Stefan Penner and contributors (Conversion to ES6 API by Jake Archibald)
        * @license   Licensed under MIT license
        *            See https://raw.githubusercontent.com/jakearchibald/es6-promise/master/LICENSE
        * @version   2.3.0
*/
var n,r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{l(r.next(e))}catch(e){i(e)}}function s(e){try{l(r.throw(e))}catch(e){i(e)}}function l(e){e.done?o(e.value):new n((function(t){t(e.value)})).then(a,s)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(e){return function(t){return l([e,t])}}function l(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=(o=a.trys).length>0&&o[o.length-1])&&(6===i[0]||2===i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}},i=this&&this.__extends||(n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)},function(e,t){function r(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});!function(e){var t=function(){var e=!0;function t(){}return t.prototype.isMsAjaxLoaded=function(){var t="function",n="undefined";return!!(typeof Sys!==n&&typeof Type!==n&&Sys.StringBuilder&&typeof Sys.StringBuilder===t&&Type.registerNamespace&&typeof Type.registerNamespace===t&&Type.registerClass&&typeof Type.registerClass===t&&typeof Function._validateParams===t&&Sys.Serialization&&Sys.Serialization.JavaScriptSerializer&&typeof Sys.Serialization.JavaScriptSerializer.serialize===t)&&e},t.prototype.loadMsAjaxFull=function(e){var t=("https:"===window.location.protocol.toLowerCase()?"https:":"http:")+"//ajax.aspnetcdn.com/ajax/3.5/MicrosoftAjax.js";c.OUtil.loadScript(t,e)},Object.defineProperty(t.prototype,"msAjaxError",{get:function(){var e=this;return null==e._msAjaxError&&e.isMsAjaxLoaded()&&(e._msAjaxError=Error),e._msAjaxError},set:function(e){this._msAjaxError=e},enumerable:e,configurable:e}),Object.defineProperty(t.prototype,"msAjaxString",{get:function(){var e=this;return null==e._msAjaxString&&e.isMsAjaxLoaded()&&(e._msAjaxString=String),e._msAjaxString},set:function(e){this._msAjaxString=e},enumerable:e,configurable:e}),Object.defineProperty(t.prototype,"msAjaxDebug",{get:function(){var e=this;return null==e._msAjaxDebug&&e.isMsAjaxLoaded()&&(e._msAjaxDebug=Sys.Debug),e._msAjaxDebug},set:function(e){this._msAjaxDebug=e},enumerable:e,configurable:e}),t}();e.MicrosoftAjaxFactory=t}(p||(p={}));var a,s,l=new p.MicrosoftAjaxFactory,c=c||{};!function(e){var t=function(){function e(e){this._internalStorage=e}return e.prototype.getItem=function(e){try{return this._internalStorage&&this._internalStorage.getItem(e)}catch(e){return null}},e.prototype.setItem=function(e,t){try{this._internalStorage&&this._internalStorage.setItem(e,t)}catch(e){}},e.prototype.clear=function(){try{this._internalStorage&&this._internalStorage.clear()}catch(e){}},e.prototype.removeItem=function(e){try{this._internalStorage&&this._internalStorage.removeItem(e)}catch(e){}},e.prototype.getKeysWithPrefix=function(e){var t=[];try{for(var n=this._internalStorage&&this._internalStorage.length||0,r=0;r<n;r++){var o=this._internalStorage.key(r);0===o.indexOf(e)&&t.push(o)}}catch(e){}return t},e.prototype.isLocalStorageAvailable=function(){return null!=this._internalStorage},e}();e.SafeStorage=t}(p||(p={})),c.XdmFieldName={ConversationUrl:"ConversationUrl",AppId:"AppId"},c.TestFlightStart=1e3,c.TestFlightEnd=1009,c.FlightNames={UseOriginNotUrl:0,AddinEnforceHttps:2,FirstPartyAnonymousProxyReadyCheckTimeout:6,AddinRibbonIdAllowUnknown:9,ManifestParserDevConsoleLog:15,AddinActionDefinitionHybridMode:18,UseActionIdForUILessCommand:20,RequirementSetRibbonApiOnePointTwo:21,SetFocusToTaskpaneIsEnabled:22,ShortcutInfoArrayInUserPreferenceData:23,OSFTestFlight1000:c.TestFlightStart,OSFTestFlight1001:c.TestFlightStart+1,OSFTestFlight1002:c.TestFlightStart+2,OSFTestFlight1003:c.TestFlightStart+3,OSFTestFlight1004:c.TestFlightStart+4,OSFTestFlight1005:c.TestFlightStart+5,OSFTestFlight1006:c.TestFlightStart+6,OSFTestFlight1007:c.TestFlightStart+7,OSFTestFlight1008:c.TestFlightStart+8,OSFTestFlight1009:c.TestFlightEnd},c.FlightTreatmentNames={AllowStorageAccessByUserActivationOnIFrame:"Microsoft.Office.SharedOnline.AllowStorageAccessByUserActivationOnIFrame",IsPrivateAddin:"Microsoft.Office.SharedOnline.IsPrivateAddin",LogAllAddinsAsPublic:"Microsoft.Office.SharedOnline.LogAllAddinsAsPublic",AddinCommandRibbonCacheFixEnabled:"Microsoft.Office.SharedOnline.AddinCommandRibbonCacheFixEnabled",OSFSolutionRefactor:"Microsoft.Office.SharedOnline.OSFSolutionRefactor"},c.Flights=[],c.Settings={},c.WindowNameItemKeys={BaseFrameName:"baseFrameName",HostInfo:"hostInfo",XdmInfo:"xdmInfo",SerializerVersion:"serializerVersion",AppContext:"appContext",Flights:"flights"},c.OUtil=function(){var e="focus",t="https:",n="on",r="configurable",o="writable",i="enumerable",a="",s="undefined",d=!1,u=!0,f="string",m=2147483647,g=null,v="#",h=-1,y=h,C="&_xdm_Info=",_="&_serializer_version=",S="&_flights=",A="_xdm_",I=v,T="class",O={},x=g,E=g,b=(new Date).getTime();function M(){var e=m*Math.random();return(e^=b^(new Date).getMilliseconds()<<Math.floor(21*Math.random())).toString(16)}function R(){if(!x){try{var e=window.sessionStorage}catch(t){e=g}x=new p.SafeStorage(e)}return x}function P(e){for(var t,n=[],r=[],o=e.length,i=0;i<o;i++)(t=e[i]).tabIndex?t.tabIndex>0?r.push(t):0===t.tabIndex&&n.push(t):n.push(t);return r=r.sort((function(e,t){var n=e.tabIndex-t.tabIndex;return 0===n&&(n=r.indexOf(e)-r.indexOf(t)),n})),[].concat(r,n)}return{set_entropy:function(e){if(typeof e==f)for(var t=0;t<e.length;t+=4){for(var n=0,r=0;r<4&&t+r<e.length;r++)n=(n<<8)+e.charCodeAt(t+r);b^=n}else b^="number"==typeof e?e:m*Math.random();b&=m},extend:function(e,t){var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e,e.uber=t.prototype,t.prototype.constructor===Object.prototype.constructor&&(t.prototype.constructor=t)},setNamespace:function(e,t){t&&e&&!t[e]&&(t[e]={})},unsetNamespace:function(e,t){t&&e&&t[e]&&delete t[e]},serializeSettings:function(e){var t={};for(var n in e){var r=e[n];try{r=JSON?JSON.stringify(r,(function(e,t){return c.OUtil.isDate(this[e])?c.DDA.SettingsManager.DateJSONPrefix+this[e].getTime()+c.DDA.SettingsManager.DataJSONSuffix:t})):Sys.Serialization.JavaScriptSerializer.serialize(r),t[n]=r}catch(e){}}return t},deserializeSettings:function(e){var t={};for(var n in e=e||{}){var r=e[n];try{r=JSON?JSON.parse(r,(function(e,t){var n;return typeof t===f&&t&&t.length>6&&t.slice(0,5)===c.DDA.SettingsManager.DateJSONPrefix&&t.slice(h)===c.DDA.SettingsManager.DataJSONSuffix&&(n=new Date(parseInt(t.slice(5,h))))?n:t})):Sys.Serialization.JavaScriptSerializer.deserialize(r,u),t[n]=r}catch(e){}}return t},loadScript:function(e,t,n){if(e&&t){var r=window.document,o=O[e];if(o)o.loaded?t():o.pendingCallbacks.push(t);else{var i=r.createElement("script");i.type="text/javascript",o={loaded:d,pendingCallbacks:[t],timer:g},O[e]=o;var a=function(){o.timer!=g&&(clearTimeout(o.timer),delete o.timer),o.loaded=u;for(var e=o.pendingCallbacks.length,t=0;t<e;t++){o.pendingCallbacks.shift()()}},s=function(){delete O[e],o.timer!=g&&(clearTimeout(o.timer),delete o.timer);for(var t=o.pendingCallbacks.length,n=0;n<t;n++){o.pendingCallbacks.shift()()}};i.readyState?i.onreadystatechange=function(){"loaded"!=i.readyState&&"complete"!=i.readyState||(i.onreadystatechange=g,a())}:i.onload=a,i.onerror=s,n=n||3e4,o.timer=setTimeout((function(){window.navigator.userAgent.indexOf("Trident")>0?s(g):s(new Event("Script load timed out"))}),n),i.setAttribute("crossOrigin","anonymous"),i.src=e,r.getElementsByTagName("head")[0].appendChild(i)}}},loadCSS:function(e){if(e){var t=window.document,n=t.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=e,t.getElementsByTagName("head")[0].appendChild(n)}},parseEnum:function(e,t){var n=t[e.trim()];if(typeof n==s)throw l.msAjaxDebug.trace("invalid enumeration string:"+e),l.msAjaxError.argument("str");return n},delayExecutionAndCache:function(){var e={calc:arguments[0]};return function(){return e.calc&&(e.val=e.calc.apply(this,arguments),delete e.calc),e.val}},getUniqueId:function(){return(y+=1).toString()},formatString:function(){var e=arguments,t=e[0];return t.replace(/{(\d+)}/gm,(function(t,n){var r=parseInt(n,10)+1;return void 0===e[r]?"{"+n+"}":e[r]}))},generateConversationId:function(){return[M(),M(),(new Date).getTime().toString()].join("_")},getFrameName:function(e){return A+e+this.generateConversationId()},addXdmInfoAsHash:function(e,t){return c.OUtil.addInfoAsHash(e,C,t,d)},addSerializerVersionAsHash:function(e,t){return c.OUtil.addInfoAsHash(e,_,t,u)},addFlightsAsHash:function(e,t){return c.OUtil.addInfoAsHash(e,S,t,u)},addInfoAsHash:function(e,t,n,r){var o,i=(e=e.trim()||a).split(I),s=i.shift(),l=i.join(I);return o=r?[t,encodeURIComponent(n),l].join(a):[l,t,n].join(a),[s,I,o].join(a)},parseHostInfoFromWindowName:function(e,t){return c.OUtil.parseInfoFromWindowName(e,t,c.WindowNameItemKeys.HostInfo)},parseXdmInfo:function(e){var t=c.OUtil.parseXdmInfoWithGivenFragment(e,window.location.hash);return t||(t=c.OUtil.parseXdmInfoFromWindowName(e,window.name)),t},parseXdmInfoFromWindowName:function(e,t){return c.OUtil.parseInfoFromWindowName(e,t,c.WindowNameItemKeys.XdmInfo)},parseXdmInfoWithGivenFragment:function(e,t){return c.OUtil.parseInfoWithGivenFragment(C,A,d,e,t)},parseSerializerVersion:function(e){var t=c.OUtil.parseSerializerVersionWithGivenFragment(e,window.location.hash);return isNaN(t)&&(t=c.OUtil.parseSerializerVersionFromWindowName(e,window.name)),t},parseSerializerVersionFromWindowName:function(e,t){return parseInt(c.OUtil.parseInfoFromWindowName(e,t,c.WindowNameItemKeys.SerializerVersion))},parseSerializerVersionWithGivenFragment:function(e,t){return parseInt(c.OUtil.parseInfoWithGivenFragment(_,"_serializer_version=",u,e,t))},parseFlights:function(e){var t=c.OUtil.parseFlightsWithGivenFragment(e,window.location.hash);return 0==t.length&&(t=c.OUtil.parseFlightsFromWindowName(e,window.name)),t},checkFlight:function(e){return c.Flights&&c.Flights.indexOf(e)>=0},pushFlight:function(e){return c.Flights.indexOf(e)<0?(c.Flights.push(e),u):d},getBooleanSetting:function(e){return c.OUtil.getBooleanFromDictionary(c.Settings,e)},getBooleanFromDictionary:function(e,t){var n=e&&t&&void 0!==e[t]&&e[t]&&(typeof e[t]===f&&"TRUE"===e[t].toUpperCase()||"boolean"==typeof e[t]&&e[t]);return void 0!==n?n:d},parseFlightsFromWindowName:function(e,t){return c.OUtil.parseArrayWithDefault(c.OUtil.parseInfoFromWindowName(e,t,c.WindowNameItemKeys.Flights))},parseFlightsWithGivenFragment:function(e,t){return c.OUtil.parseArrayWithDefault(c.OUtil.parseInfoWithGivenFragment(S,"_flights=",u,e,t))},parseArrayWithDefault:function(e){var t=[];try{t=JSON.parse(e)}catch(e){}return Array.isArray(t)||(t=[]),t},parseInfoFromWindowName:function(e,t,n){try{var r=JSON.parse(t),o=r!=g?r[n]:g,i=R();if(!e&&i&&r!=g){var a=r[c.WindowNameItemKeys.BaseFrameName]+n;o?i.setItem(a,o):o=i.getItem(a)}return o}catch(e){return g}},parseInfoWithGivenFragment:function(e,t,n,r,o){var i=o.split(e),a=i.length>1?i[i.length-1]:g;n&&a!=g&&(a.indexOf("&")>=0&&(a=a.split("&")[0]),a=decodeURIComponent(a));var s=R();if(!r&&s){var l=window.name.indexOf(t);if(l>h){var c=window.name.indexOf(";",l);c==h&&(c=window.name.length);var d=window.name.substring(l,c);a?s.setItem(d,a):a=s.getItem(d)}}return a},getConversationId:function(){var e=window.location.search,t=g;if(e){var n=e.indexOf("&");(t=n>0?e.substring(1,n):e.substr(1))&&"="===t.charAt(t.length-1)&&(t=t.substring(0,t.length-1))&&(t=decodeURIComponent(t))}return t},getInfoItems:function(e){var t=e.split("$");return typeof t[1]==s&&(t=e.split("|")),typeof t[1]==s&&(t=e.split("%7C")),t},getXdmFieldValue:function(e,t){var n=a,r=c.OUtil.parseXdmInfo(t);if(r){var o=c.OUtil.getInfoItems(r);if(null!=o&&o.length>=3)switch(e){case c.XdmFieldName.ConversationUrl:n=o[2];break;case c.XdmFieldName.AppId:n=o[1]}}return n},validateParamObject:function(e,t){var n=Function._validateParams(arguments,[{name:"params",type:Object,mayBeNull:d},{name:"expectedProperties",type:Object,mayBeNull:d},{name:"callback",type:Function,mayBeNull:u}]);if(n)throw n;for(var r in t)if(n=Function._validateParameter(e[r],t[r],r))throw n},writeProfilerMark:function(e){window.msWriteProfilerMark&&(window.msWriteProfilerMark(e),l.msAjaxDebug.trace(e))},outputDebug:function(e){typeof l!==s&&l.msAjaxDebug&&l.msAjaxDebug.trace&&l.msAjaxDebug.trace(e)},defineNondefaultProperty:function(e,t,n,r){for(var o in n=n||{},r){var i=r[o];null==n[i]&&(n[i]=u)}return Object.defineProperty(e,t,n),e},defineNondefaultProperties:function(e,t,n){for(var r in t=t||{})c.OUtil.defineNondefaultProperty(e,r,t[r],n);return e},defineEnumerableProperty:function(e,t,n){return c.OUtil.defineNondefaultProperty(e,t,n,[i])},defineEnumerableProperties:function(e,t){return c.OUtil.defineNondefaultProperties(e,t,[i])},defineMutableProperty:function(e,t,n){return c.OUtil.defineNondefaultProperty(e,t,n,[o,i,r])},defineMutableProperties:function(e,t){return c.OUtil.defineNondefaultProperties(e,t,[o,i,r])},finalizeProperties:function(e,t){t=t||{};for(var n=Object.getOwnPropertyNames(e),r=n.length,o=0;o<r;o++){var i=n[o],a=Object.getOwnPropertyDescriptor(e,i);a.get||a.set||(a.writable=t.writable||d),a.configurable=t.configurable||d,a.enumerable=t.enumerable||u,Object.defineProperty(e,i,a)}return e},mapList:function(e,t){var n=[];if(e)for(var r in e)n.push(t(e[r]));return n},listContainsKey:function(e,t){for(var n in e)if(t==n)return u;return d},listContainsValue:function(e,t){for(var n in e)if(t==e[n])return u;return d},augmentList:function(e,t){var n=e.push?function(t,n){e.push(n)}:function(t,n){e[t]=n};for(var r in t)n(r,t[r])},redefineList:function(e,t){for(var n in e)delete e[n];for(var r in t)e[r]=t[r]},isArray:function(e){return"[object Array]"===Object.prototype.toString.apply(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.apply(e)},isDate:function(e){return"[object Date]"===Object.prototype.toString.apply(e)},addEventListener:function(e,t,r){e.addEventListener?e.addEventListener(t,r,d):Sys.Browser.agent===Sys.Browser.InternetExplorer&&e.attachEvent?e.attachEvent(n+t,r):e[n+t]=r},removeEventListener:function(e,t,r){e.removeEventListener?e.removeEventListener(t,r,d):Sys.Browser.agent===Sys.Browser.InternetExplorer&&e.detachEvent?e.detachEvent(n+t,r):e[n+t]=g},getCookieValue:function(e){return RegExp(e+"[^;]+").exec(document.cookie).toString().replace(/^[^=]+./,a)},xhrGet:function(e,t,n){var r;try{(r=new XMLHttpRequest).onreadystatechange=function(){4==r.readyState&&(200==r.status?t(r.responseText):n(r.status))},r.open("GET",e,u),r.send()}catch(e){n(e)}},xhrGetFull:function(e,t,n,r){var o,i=t;try{(o=new XMLHttpRequest).onreadystatechange=function(){4==o.readyState&&(200==o.status?n(o,i):r(o.status))},o.open("GET",e,u),o.send()}catch(e){r(e)}},encodeBase64:function(e){if(!e)return e;var t,n,r,o,i,s,l,c=[],d=[],u=0,p=e.length;do{t=e.charCodeAt(u++),n=e.charCodeAt(u++),r=e.charCodeAt(u++),l=0,o=255&t,i=t>>8,s=255&n,d[l++]=o>>2,d[l++]=(3&o)<<4|i>>4,d[l++]=(15&i)<<2|s>>6,d[l++]=63&s,isNaN(n)||(o=n>>8,i=255&r,s=r>>8,d[l++]=o>>2,d[l++]=(3&o)<<4|i>>4,d[l++]=(15&i)<<2|s>>6,d[l++]=63&s),isNaN(n)?d[l-1]=64:isNaN(r)&&(d[l-2]=64,d[l-1]=64);for(var f=0;f<l;f++)c.push("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(d[f]))}while(u<p);return c.join(a)},getSessionStorage:function(){return R()},getLocalStorage:function(){if(!E){try{var e=window.localStorage}catch(t){e=g}E=new p.SafeStorage(e)}return E},convertIntToCssHexColor:function(e){return v+(Number(e)+16777216).toString(16).slice(-6)},attachClickHandler:function(e,t){e.onclick=function(){t()},e.ontouchend=function(e){t(),e.preventDefault()}},getQueryStringParamValue:function(e,t){var n=Function._validateParams(arguments,[{name:"queryString",type:String,mayBeNull:d},{name:"paramName",type:String,mayBeNull:d}]);if(n)return l.msAjaxDebug.trace("OSF_Outil_getQueryStringParamValue: Parameters cannot be null."),a;var r=new RegExp("[\\?&]"+t+"=([^&#]*)","i");return r.test(e)?r.exec(e)[1]:(l.msAjaxDebug.trace("OSF_Outil_getQueryStringParamValue: The parameter is not found."),a)},getHostnamePortionForLogging:function(e){var t=Function._validateParams(arguments,[{name:"hostname",type:String,mayBeNull:d}]);if(t)return a;var n=e.split("."),r=n.length;return r>=2?n[r-2]+"."+n[r-1]:1==r?n[0]:void 0},isiOS:function(){return window.navigator.userAgent.match(/(iPad|iPhone|iPod)/g)?u:d},isChrome:function(){return window.navigator.userAgent.indexOf("Chrome")>0&&!c.OUtil.isEdge()},isEdge:function(){return window.navigator.userAgent.indexOf("Edge")>0},isIE:function(){return window.navigator.userAgent.indexOf("Trident")>0},isFirefox:function(){return window.navigator.userAgent.indexOf("Firefox")>0},startsWith:function(e,t,n){return n?e.substr(0,t.length)===t:e.startsWith(t)},containsPort:function(e,t,n,r){return this.startsWith(e,t+"//"+n+":"+r,u)||this.startsWith(e,n+":"+r,u)},getRedundandPortString:function(e,n){return e&&n?n.protocol==t&&this.containsPort(e,t,n.hostname,"443")?":443":"http:"==n.protocol&&this.containsPort(e,"http:",n.hostname,"80")?":80":a:a},removeChar:function(e,t){return t<e.length-1?e.substring(0,t)+e.substring(t+1):t==e.length-1?e.substring(0,e.length-1):e},cleanUrlOfChar:function(e,t){for(var n=0;n<e.length;n++)if(e.charAt(n)===t){if(n+1>=e.length)return this.removeChar(e,n);if("/"===t){if("?"===e.charAt(n+1)||e.charAt(n+1)===v)return this.removeChar(e,n)}else if("?"===t&&e.charAt(n+1)===v)return this.removeChar(e,n)}return e},cleanUrl:function(e){if(e=this.cleanUrlOfChar(e,"/"),e=this.cleanUrlOfChar(e,"?"),"https://"==(e=this.cleanUrlOfChar(e,v)).substr(0,8))(t=e.indexOf(":443"))!=h&&(t!=e.length-4&&"/"!=e.charAt(t+4)&&"?"!=e.charAt(t+4)&&e.charAt(t+4)!=v||(e=e.substring(0,t)+e.substring(t+4)));else if("http://"==e.substr(0,7)){var t;(t=e.indexOf(":80"))!=h&&(t!=e.length-3&&"/"!=e.charAt(t+3)&&"?"!=e.charAt(t+3)&&e.charAt(t+3)!=v||(e=e.substring(0,t)+e.substring(t+3)))}return e},parseUrl:function(e,n){var r=this;if(void 0===n&&(n=d),typeof e!==s&&e){var o="NotHttps",i=r.isIE(),l={protocol:void 0,hostname:void 0,host:void 0,port:void 0,pathname:void 0,search:void 0,hash:void 0,isPortPartOfUrl:void 0};try{if(i){var u=document.createElement("a");if(u.href=e,!(u&&u.protocol&&u.host&&u.hostname&&u.href&&r.cleanUrl(u.href).toLowerCase()===r.cleanUrl(e).toLowerCase()))throw"InvalidUrl";if(c.OUtil.checkFlight(c.FlightNames.AddinEnforceHttps)&&n&&u.protocol!=t)throw new Error(o);var p=r.getRedundandPortString(e,u);l.protocol=u.protocol,l.hostname=u.hostname,l.port=p==a?u.port:a,l.host=p!=a?u.hostname:u.host,l.pathname=(i?"/":a)+u.pathname,l.search=u.search,l.hash=u.hash,l.isPortPartOfUrl=r.containsPort(e,u.protocol,u.hostname,u.port)}else{var f=new URL(e);if(f&&f.protocol&&f.host&&f.hostname){if(c.OUtil.checkFlight(c.FlightNames.AddinEnforceHttps)&&n&&f.protocol!=t)throw new Error(o);l.protocol=f.protocol,l.hostname=f.hostname,l.port=f.port,l.host=f.host,l.pathname=f.pathname,l.search=f.search,l.hash=f.hash,l.isPortPartOfUrl=f.host.lastIndexOf(":"+f.port)==f.host.length-f.port.length-1}}}catch(e){if(e.message===o)throw e}return l}},shallowCopy:function(e){if(e==g)return g;if(e instanceof Object){if(Array.isArray(e)){for(var t=[],n=0;n<e.length;n++)t.push(e[n]);return t}var r=e.constructor();for(var o in e)e.hasOwnProperty(o)&&(r[o]=e[o]);return r}return e},createObject:function(e){var t=g;if(e){t={};for(var n=e.length,r=0;r<n;r++)t[e[r].name]=e[r].value}return t},addClass:function(e,t){if(!c.OUtil.hasClass(e,t)){var n=e.getAttribute(T);n?e.setAttribute(T,n+" "+t):e.setAttribute(T,t)}},removeClass:function(e,t){if(c.OUtil.hasClass(e,t)){var n=e.getAttribute(T),r=new RegExp("(\\s|^)"+t+"(\\s|$)");n=n.replace(r,a),e.setAttribute(T,n)}},hasClass:function(e,t){var n=e.getAttribute(T);return n&&n.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))},focusToFirstTabbable:function(t,n){var r,o,i=d,a=function(){i=u},s=function(e,t,n){return t<0||t>e?h:0===t&&n?h:t!==e-1||n?n?t-1:t+1:h};if(t=P(t),r=n?t.length-1:0,0===t.length)return g;for(;!i&&r>=0&&r<t.length;)o=t[r],window.focus(),o.addEventListener(e,a),o.focus(),o.removeEventListener(e,a),r=s(t.length,r,n),i||o!==document.activeElement||(i=u);return i?o:g},focusToNextTabbable:function(t,n,r){var o,i,a,s=d,l=function(){s=u},c=function(e,t,n){return t<0||t>e?h:0===t&&n?h:t!==e-1||n?n?t-1:t+1:h};if(o=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return h}(t=P(t),n),(i=c(t.length,o,r))<0)return g;for(;!s&&i>=0&&i<t.length;)(a=t[i]).addEventListener(e,l),a.focus(),a.removeEventListener(e,l),i=c(t.length,i,r),s||a!==document.activeElement||(s=u);return s?a:g},isNullOrUndefined:function(e){return typeof e===s?u:e===g?u:d},stringEndsWith:function(e,t){if(!c.OUtil.isNullOrUndefined(e)&&!c.OUtil.isNullOrUndefined(t)){if(t.length>e.length)return d;if(e.substr(e.length-t.length)===t)return u}return d},hashCode:function(e){var t=0;if(!c.OUtil.isNullOrUndefined(e))for(var n=0,r=e.length;n<r;)t=(t<<5)-t+e.charCodeAt(n++)|0;return t},getValue:function(e,t){return c.OUtil.isNullOrUndefined(e)?t:e},externalNativeFunctionExists:function(e){return"unknown"===e||e!==s}}}(),c.OUtil.Guid=function(){var e=["0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f"];return{generateNewGuid:function(){for(var t="",n=(new Date).getTime(),r=0;r<32&&n>0;r++)8!=r&&12!=r&&16!=r&&20!=r||(t+="-"),t+=e[n%16],n=Math.floor(n/16);for(;r<32;r++)8!=r&&12!=r&&16!=r&&20!=r||(t+="-"),t+=e[Math.floor(16*Math.random())];return t}}}();try{c.Flights=c.OUtil.parseFlights(!0)}catch(e){}window.OSF=c,function(e){var t="\n",n=!0,r=null,o="undefined",i=function(){function e(){}return e.isInstanceOfType=function(e,t){if(typeof t===o||t===r)return!1;if(t instanceof e)return n;var i=t.constructor;return i&&"function"==typeof i&&i.__typeName&&"Object"!==i.__typeName||(i=Object),!(i!==e)||i.__typeName&&e.__typeName&&i.__typeName===e.__typeName},e}();e.MsAjaxTypeHelper=i;var a=function(){var e="Parameter name: {0}";function n(){}return n.create=function(e,t){var n=new Error(e);if(n.message=e,t)for(var r in t)n[r]=t[r];return n.popStackFrame(),n},n.parameterCount=function(e){var t="Sys.ParameterCountException: "+(e||"Parameter count mismatch."),r=n.create(t,{name:"Sys.ParameterCountException"});return r.popStackFrame(),r},n.argument=function(r,o){var i="Sys.ArgumentException: "+(o||"Value does not fall within the expected range.");r&&(i+=t+s.format(e,r));var a=n.create(i,{name:"Sys.ArgumentException",paramName:r});return a.popStackFrame(),a},n.argumentNull=function(r,o){var i="Sys.ArgumentNullException: "+(o||"Value cannot be null.");r&&(i+=t+s.format(e,r));var a=n.create(i,{name:"Sys.ArgumentNullException",paramName:r});return a.popStackFrame(),a},n.argumentOutOfRange=function(i,a,l){var c="Sys.ArgumentOutOfRangeException: "+(l||"Specified argument was out of the range of valid values.");i&&(c+=t+s.format(e,i)),typeof a!==o&&a!==r&&(c+=t+s.format("Actual value was {0}.",a));var d=n.create(c,{name:"Sys.ArgumentOutOfRangeException",paramName:i,actualValue:a});return d.popStackFrame(),d},n.argumentType=function(r,o,i,a){var l="Sys.ArgumentTypeException: ";l+=a||(o&&i?s.format("Object of type '{0}' cannot be converted to type '{1}'.",o.getName?o.getName():o,i.getName?i.getName():i):"Object cannot be converted to the required type."),r&&(l+=t+s.format(e,r));var c=n.create(l,{name:"Sys.ArgumentTypeException",paramName:r,actualType:o,expectedType:i});return c.popStackFrame(),c},n.argumentUndefined=function(r,o){var i="Sys.ArgumentUndefinedException: "+(o||"Value cannot be undefined.");r&&(i+=t+s.format(e,r));var a=n.create(i,{name:"Sys.ArgumentUndefinedException",paramName:r});return a.popStackFrame(),a},n.invalidOperation=function(e){var t="Sys.InvalidOperationException: "+(e||"Operation is not valid due to the current state of the object."),r=n.create(t,{name:"Sys.InvalidOperationException"});return r.popStackFrame(),r},n}();e.MsAjaxError=a;var s=function(){function e(){}return e.format=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];var r=e;return r.replace(/{(\d+)}/gm,(function(e,n){var r=parseInt(n,10);return void 0===t[r]?"{"+n+"}":t[r]}))},e.startsWith=function(e,t){return e.substr(0,t.length)===t},e}();e.MsAjaxString=s;var c=function(){function e(){}return e.trace=function(){},e}();if(e.MsAjaxDebug=c,!l.isMsAjaxLoaded()){var d=function(e,t,n){void 0!==e.__typeName&&e.__typeName!==r||(e.__typeName=t),void 0!==e.__class&&e.__class!==r||(e.__class=n)};d(Function,"Function",n),d(Error,"Error",n),d(Object,"Object",n),d(String,"String",n),d(Boolean,"Boolean",n),d(Date,"Date",n),d(Number,"Number",n),d(RegExp,"RegExp",n),d(Array,"Array",n),Function.createCallback||(Function.createCallback=function(e,t){var r=Function._validateParams(arguments,[{name:"method",type:Function},{name:"context",mayBeNull:n}]);if(r)throw r;return function(){var n=arguments.length;if(n>0){for(var r=[],o=0;o<n;o++)r[o]=arguments[o];return r[n]=t,e.apply(this,r)}return e.call(this,t)}}),Function.createDelegate||(Function.createDelegate=function(e,t){var r=Function._validateParams(arguments,[{name:"instance",mayBeNull:n},{name:"method",type:Function}]);if(r)throw r;return function(){return t.apply(e,arguments)}}),Function._validateParams||(Function._validateParams=function(e,t,n){var i,a=t.length;if(n=n||typeof n===o,i=Function._validateParameterCount(e,t,n))return i.popStackFrame(),i;for(var s=0,l=e.length;s<l;s++){var c=t[Math.min(s,a-1)],d=c.name;if(c.parameterArray)d+="["+(s-a+1)+"]";else if(!n&&s>=a)break;if(i=Function._validateParameter(e[s],c,d))return i.popStackFrame(),i}return r}),Function._validateParameterCount||(Function._validateParameterCount=function(e,t,o){var i,s,l=t.length,c=e.length;if(c<l){var d=l;for(i=0;i<l;i++){var u=t[i];(u.optional||u.parameterArray)&&d--}c<d&&(s=n)}else if(o&&c>l)for(s=n,i=0;i<l;i++)if(t[i].parameterArray){s=!1;break}if(s){var p=a.parameterCount();return p.popStackFrame(),p}return r}),Function._validateParameter||(Function._validateParameter=function(e,t,n){var i,a=t.type,s=!!t.integer,l=!!t.domElement,c=!!t.mayBeNull;if(i=Function._validateParameterType(e,a,s,l,c,n))return i.popStackFrame(),i;var d=t.elementType,u=!!t.elementMayBeNull;if(a===Array&&typeof e!==o&&e!==r&&(d||!u))for(var p=!!t.elementInteger,f=!!t.elementDomElement,m=0;m<e.length;m++){var g=e[m];if(i=Function._validateParameterType(g,d,p,f,u,n+"["+m+"]"))return i.popStackFrame(),i}return r}),Function._validateParameterType||(Function._validateParameterType=function(t,n,i,a,s,l){var c;return typeof t===o?s?r:((c=e.MsAjaxError.argumentUndefined(l)).popStackFrame(),c):t===r?s?r:((c=e.MsAjaxError.argumentNull(l)).popStackFrame(),c):n&&!e.MsAjaxTypeHelper.isInstanceOfType(n,t)?((c=e.MsAjaxError.argumentType(l,typeof t,n)).popStackFrame(),c):r}),window.Type||(window.Type=Function),Type.registerNamespace||(Type.registerNamespace=function(e){for(var t=e.split("."),n=window,r=0;r<t.length;r++)n[t[r]]=n[t[r]]||{},n=n[t[r]]}),Type.prototype.registerClass||(Type.prototype.registerClass=function(e){({})}),typeof Sys===o&&Type.registerNamespace("Sys"),Error.prototype.popStackFrame||(Error.prototype.popStackFrame=function(){var e=this;if(0!==arguments.length)throw a.parameterCount();if(typeof e.stack!==o&&e.stack!==r&&typeof e.fileName!==o&&e.fileName!==r&&typeof e.lineNumber!==o&&e.lineNumber!==r){for(var n=e.stack.split(t),i=n[0],s=e.fileName+":"+e.lineNumber;typeof i!==o&&i!==r&&-1===i.indexOf(s);)n.shift(),i=n[0];var l=n[1];if(typeof l!==o&&l!==r){var c=l.match(/@(.*):(\d+)$/);typeof c!==o&&c!==r&&(e.fileName=c[1],e.lineNumber=parseInt(c[2]),n.shift(),e.stack=n.join(t))}}}),l.msAjaxError=a,l.msAjaxString=s,l.msAjaxDebug=c}}(p||(p={})),c.OUtil.setNamespace("Microsoft",window),c.OUtil.setNamespace("Office",Microsoft),c.OUtil.setNamespace("Common",Microsoft.Office),Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5},c.SerializerVersion={MsAjax:0,Browser:1},(p||(p={})).appSpecificCheckOrigin=function(){return!1},Microsoft.Office.Common.InvokeType={async:0,sync:1,asyncRegisterEvent:2,asyncUnregisterEvent:3,syncRegisterEvent:4,syncUnregisterEvent:5},Microsoft.Office.Common.InvokeResultCode={noError:0,errorInRequest:-1,errorHandlingRequest:-2,errorInResponse:-3,errorHandlingResponse:-4,errorHandlingRequestAccessDenied:-5,errorHandlingMethodCallTimedout:-6},Microsoft.Office.Common.MessageType={request:0,response:1},Microsoft.Office.Common.ActionType={invoke:0,registerEvent:1,unregisterEvent:2},Microsoft.Office.Common.ResponseType={forCalling:0,forEventing:1},Microsoft.Office.Common.HostTrustStatus={unknown:0,untrusted:1,nothttps:2,trusted:3},Microsoft.Office.Common.MethodObject=function(e,t,n){this._method=e,this._invokeType=t,this._blockingOthers=n},Microsoft.Office.Common.MethodObject.prototype={getMethod:function(){return this._method},getInvokeType:function(){return this._invokeType},getBlockingFlag:function(){return this._blockingOthers}},Microsoft.Office.Common.EventMethodObject=function(e,t){this._registerMethodObject=e,this._unregisterMethodObject=t},Microsoft.Office.Common.EventMethodObject.prototype={getRegisterMethodObject:function(){return this._registerMethodObject},getUnregisterMethodObject:function(){return this._unregisterMethodObject}},Microsoft.Office.Common.ServiceEndPoint=function(e){var t=this,n=Function._validateParams(arguments,[{name:"serviceEndPointId",type:String,mayBeNull:!1}]);if(n)throw n;t._methodObjectList={},t._eventHandlerProxyList={},t._Id=e,t._conversations={},t._policyManager=null,t._appDomains={},t._onHandleRequestError=null},Microsoft.Office.Common.ServiceEndPoint.prototype={registerMethod:function(e,t,n,r){var o="invokeType",i=!1,a=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:i},{name:"method",type:Function,mayBeNull:i},{name:o,type:Number,mayBeNull:i},{name:"blockingOthers",type:Boolean,mayBeNull:i}]);if(a)throw a;if(n!==Microsoft.Office.Common.InvokeType.async&&n!==Microsoft.Office.Common.InvokeType.sync)throw l.msAjaxError.argument(o);var s=new Microsoft.Office.Common.MethodObject(t,n,r);this._methodObjectList[e]=s},unregisterMethod:function(e){var t=Function._validateParams(arguments,[{name:"methodName",type:String,mayBeNull:!1}]);if(t)throw t;delete this._methodObjectList[e]},registerEvent:function(e,t,n){var r=!1,o=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:r},{name:"registerMethod",type:Function,mayBeNull:r},{name:"unregisterMethod",type:Function,mayBeNull:r}]);if(o)throw o;var i=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(t,Microsoft.Office.Common.InvokeType.syncRegisterEvent,r),new Microsoft.Office.Common.MethodObject(n,Microsoft.Office.Common.InvokeType.syncUnregisterEvent,r));this._methodObjectList[e]=i},registerEventEx:function(e,t,n,r,o){var i=!1,a=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:i},{name:"registerMethod",type:Function,mayBeNull:i},{name:"registerMethodInvokeType",type:Number,mayBeNull:i},{name:"unregisterMethod",type:Function,mayBeNull:i},{name:"unregisterMethodInvokeType",type:Number,mayBeNull:i}]);if(a)throw a;var s=new Microsoft.Office.Common.EventMethodObject(new Microsoft.Office.Common.MethodObject(t,n,i),new Microsoft.Office.Common.MethodObject(r,o,i));this._methodObjectList[e]=s},unregisterEvent:function(e){var t=Function._validateParams(arguments,[{name:"eventName",type:String,mayBeNull:!1}]);if(t)throw t;this.unregisterMethod(e)},registerConversation:function(e,t,n,r){var o="appDomains",i=!0,a=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:!1},{name:"conversationUrl",type:String,mayBeNull:!1,optional:i},{name:o,type:Object,mayBeNull:i,optional:i},{name:"serializerVersion",type:Number,mayBeNull:i,optional:i}]);if(a)throw a;if(n){if(!(n instanceof Array))throw l.msAjaxError.argument(o);this._appDomains[e]=n}this._conversations[e]={url:t,serializerVersion:r}},unregisterConversation:function(e){var t=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:!1}]);if(t)throw t;delete this._conversations[e]},setPolicyManager:function(e){var t="policyManager",n=Function._validateParams(arguments,[{name:t,type:Object,mayBeNull:!1}]);if(n)throw n;if(!e.checkPermission)throw l.msAjaxError.argument(t);this._policyManager=e},getPolicyManager:function(){return this._policyManager},dispose:function(){var e=null,t=this;t._methodObjectList=e,t._eventHandlerProxyList=e,t._Id=e,t._conversations=e,t._policyManager=e,t._appDomains=e,t._onHandleRequestError=e}},Microsoft.Office.Common.ClientEndPoint=function(e,t,n,r){var o="targetWindow",i=!1,a=this,s=Function._validateParams(arguments,[{name:"conversationId",type:String,mayBeNull:i},{name:o,mayBeNull:i},{name:"targetUrl",type:String,mayBeNull:i},{name:"serializerVersion",type:Number,mayBeNull:!0,optional:!0}]);if(s)throw s;try{if(!t.postMessage)throw l.msAjaxError.argument(o)}catch(e){if(!Object.prototype.hasOwnProperty.call(t,"postMessage"))throw l.msAjaxError.argument(o)}a._conversationId=e,a._targetWindow=t,a._targetUrl=n,a._callingIndex=0,a._callbackList={},a._eventHandlerList={},a._serializerVersion=null!=r?r:c.SerializerVersion.Browser,a._checkReceiverOriginAndRun=null,a._hostTrustCheckStatus=Microsoft.Office.Common.HostTrustStatus.unknown,a._checkStatusLogged=i},Microsoft.Office.Common.ClientEndPoint.prototype={invoke:function(e,t,n){var r=Function._validateParams(arguments,[{name:"targetMethodName",type:String,mayBeNull:!1},{name:"callback",type:Function,mayBeNull:!0},{name:"param",mayBeNull:!0}]);if(r)throw r;var o=this,i=function(){var r=o._callingIndex++,i=new Date,a={callback:t,createdOn:i.getTime()};n&&"object"==typeof n&&"number"==typeof n.__timeout__&&(a.timeout=n.__timeout__,delete n.__timeout__),o._callbackList[r]=a;try{if(o._hostTrustCheckStatus!==Microsoft.Office.Common.HostTrustStatus.trusted&&"ContextActivationManager_getAppContextAsync"!==e)throw"Access Denied";var s=new Microsoft.Office.Common.Request(e,Microsoft.Office.Common.ActionType.invoke,o._conversationId,r,n),l=Microsoft.Office.Common.MessagePackager.envelope(s,o._serializerVersion);o._targetWindow.postMessage(l,o._targetUrl),Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(e){try{null!==t&&t(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete o._callbackList[r]}}};o._checkReceiverOriginAndRun?o._checkReceiverOriginAndRun(i):(o._hostTrustCheckStatus=Microsoft.Office.Common.HostTrustStatus.trusted,i())},registerForEvent:function(e,t,n,r){var o=this,i=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:!1},{name:"eventHandler",type:Function,mayBeNull:!1},{name:"callback",type:Function,mayBeNull:!0},{name:"data",mayBeNull:!0,optional:!0}]);if(i)throw i;var a=o._callingIndex++,s=new Date;o._callbackList[a]={callback:n,createdOn:s.getTime()};try{var l=new Microsoft.Office.Common.Request(e,Microsoft.Office.Common.ActionType.registerEvent,o._conversationId,a,r),c=Microsoft.Office.Common.MessagePackager.envelope(l,o._serializerVersion);o._targetWindow.postMessage(c,o._targetUrl),Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer(),o._eventHandlerList[e]=t}catch(e){try{null!==n&&n(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete o._callbackList[a]}}},unregisterForEvent:function(e,t,n){var r=this,o=Function._validateParams(arguments,[{name:"targetEventName",type:String,mayBeNull:!1},{name:"callback",type:Function,mayBeNull:!0},{name:"data",mayBeNull:!0,optional:!0}]);if(o)throw o;var i=r._callingIndex++,a=new Date;r._callbackList[i]={callback:t,createdOn:a.getTime()};try{var s=new Microsoft.Office.Common.Request(e,Microsoft.Office.Common.ActionType.unregisterEvent,r._conversationId,i,n),l=Microsoft.Office.Common.MessagePackager.envelope(s,r._serializerVersion);r._targetWindow.postMessage(l,r._targetUrl),Microsoft.Office.Common.XdmCommunicationManager._startMethodTimeoutTimer()}catch(e){try{null!==t&&t(Microsoft.Office.Common.InvokeResultCode.errorInRequest,e)}finally{delete r._callbackList[i]}}finally{delete r._eventHandlerList[e]}}},Microsoft.Office.Common.XdmCommunicationManager=function(){var e="serviceEndPointId",t=!0,n="a",r="null",o="channel is not ready.",i="conversationId",a="Unknown conversation Id.",s=!1,d=null,u=[],f=d,m=d,g=10,v=s,h=d,y=65e3,C=y,_={},S={},A=s;function I(e){for(var t in _)if(_[t]._conversations[e])return _[t];throw l.msAjaxDebug.trace(a),l.msAjaxError.argument(i)}function T(e){var t=S[e];return!t&&l.msAjaxDebug.trace(a),t}function O(e){u.push(e)}function x(){if(m!==d){if(!v)if(u.length>0){E(u.shift())}else clearInterval(m),m=d}else l.msAjaxDebug.trace(o)}function E(e){v=e.getInvokeBlockingFlag(),e.invoke(),f=(new Date).getTime()}function b(){if(h){var e,t,n=0,r=new Date;for(var i in S)for(var a in(e=S[i])._callbackList){var s=e._callbackList[a];if((t=s.timeout?s.timeout:C)>=0&&Math.abs(r.getTime()-s.createdOn)>=t)try{s.callback&&s.callback(Microsoft.Office.Common.InvokeResultCode.errorHandlingMethodCallTimedout,d)}finally{delete e._callbackList[a]}else n++}0===n&&(clearInterval(h),h=d)}else l.msAjaxDebug.trace(o)}function M(){v=s}function R(e,t){var o,i,a=s;if(!(e&&t&&e!==r&&t!==r&&e.length&&t.length))return a;c.OUtil.checkFlight(c.FlightNames.AddinEnforceHttps)?a=F(e,t):(o=document.createElement(n),i=document.createElement(n),o.href=e,i.href=t,a=w(o,i));return a}function P(e,t){var o=s;if(!(t&&t!==r&&t.length&&e&&e instanceof Array&&e.length))return o;var i=document.createElement(n),a=document.createElement(n);i.href=t;for(var l=0;l<e.length&&!o;l++)-1!==e[l].indexOf("://")&&(c.OUtil.checkFlight(c.FlightNames.AddinEnforceHttps)?o=F(t,e[l]):(a.href=e[l],o=w(i,a)));return o}function N(e){if(!e||e===r)return s;var t=["^office-int\\.com$","^officeapps\\.live-int\\.com$","^.*\\.dod\\.online\\.office365\\.us$","^.*\\.gov\\.online\\.office365\\.us$","^.*\\.officeapps\\.live\\.com$","^.*\\.officeapps\\.live-int\\.com$","^.*\\.officeapps-df\\.live\\.com$","^.*\\.online\\.office\\.de$","^.*\\.partner\\.officewebapps\\.cn$","^.*\\.office\\.net$","^"+document.domain.replace(new RegExp("\\.","g"),"\\.")+"$"];return new RegExp(t.join("|")).test(e)}function U(e,o){if(!e||!o||e===r||o===r)return s;var i,a;c.OUtil.checkFlight(c.FlightNames.AddinEnforceHttps)?(i=c.OUtil.parseUrl(e,t),a=c.OUtil.parseUrl(o,t)):((i=document.createElement(n)).href=e,(a=document.createElement(n)).href=o);var l=i.protocol===a.protocol,d=i.port===a.port,u=a.hostname,p=i.hostname,f=u===p,m=s;return!f&&u.length>p.length+1&&(m=u.slice(-(p.length+1))==="."+p),d&&l&&(f||m)}function F(e,n){return w(c.OUtil.parseUrl(e,t),c.OUtil.parseUrl(n,t))}function w(e,t){return e.hostname==t.hostname&&e.protocol==t.protocol&&D(e,t)}function D(e,t){return e.port==t.port||""==e.port&&"http:"==e.protocol&&"80"==t.port||""==e.port&&"https:"==e.protocol&&"443"==t.port||""==t.port&&"http:"==t.protocol&&"80"==e.port||""==t.port&&"https:"==t.protocol&&"443"==e.port}function k(e){var o="Access Denied";if(c&&""!=e.data){var i,a=c.SerializerVersion.Browser,u=e.data;try{a=(i=Microsoft.Office.Common.MessagePackager.unenvelope(u,c.SerializerVersion.Browser))._serializerVersion!=d?i._serializerVersion:a}catch(e){return}if(i._messageType===Microsoft.Office.Common.MessageType.request){var h=e.origin==d||e.origin===r?i._origin:e.origin;try{var y=I(i._conversationId),C=y._conversations[i._conversationId];a=C.serializerVersion!=d?C.serializerVersion:a;var _=[C.url].concat(y._appDomains[i._conversationId]);if(!P(_,e.origin)&&!p.appSpecificCheckOrigin(_,e,i._origin,P))if(!U(C.url,e.origin))throw"Failed origin check";var S=i._data!=d?i._data:{};S.SecurityOrigin=e.origin;var A=y.getPolicyManager();if(A&&!A.checkPermission(i._conversationId,i._actionName,S))throw o;var b=function(e,t){var n=e._methodObjectList[t._actionName];if(!n)throw l.msAjaxDebug.trace("The specified method is not registered on service endpoint:"+t._actionName),l.msAjaxError.argument("messageObject");return t._actionType===Microsoft.Office.Common.ActionType.invoke?n:t._actionType===Microsoft.Office.Common.ActionType.registerEvent?n.getRegisterMethodObject():n.getUnregisterMethodObject()}(y,i),F=new Microsoft.Office.Common.InvokeCompleteCallback(e.source,h,i._actionName,i._conversationId,i._correlationId,M,a),w=new Microsoft.Office.Common.Invoker(b,S,F,y._eventHandlerProxyList,i._conversationId,i._actionName,a),D=t;m==d&&((f==d||(new Date).getTime()-f>g)&&!v?(E(w),D=s):m=setInterval(x,g)),D&&O(w)}catch(l){y&&y._onHandleRequestError&&y._onHandleRequestError(i,l);var k=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequest;l==o&&(k=Microsoft.Office.Common.InvokeResultCode.errorHandlingRequestAccessDenied);var L=new Microsoft.Office.Common.Response(i._actionName,i._conversationId,i._correlationId,k,Microsoft.Office.Common.ResponseType.forCalling,l),B=Microsoft.Office.Common.MessagePackager.envelope(L,a),H=s;try{H=!(!e.source||!e.source.postMessage)}catch(e){}var W=s;if(window.location.href&&e.origin&&e.origin!==r&&U(window.location.href,e.origin))W=t;else if(e.origin&&e.origin!==r)if(c.OUtil.checkFlight(c.FlightNames.AddinEnforceHttps)){W=N(c.OUtil.parseUrl(e.origin,t).hostname)}else{var V=document.createElement(n);V.href=e.origin,W=N(V.hostname)}H&&W&&e.source.postMessage(B,h)}}else{if(i._messageType!==Microsoft.Office.Common.MessageType.response)return;var j=T(i._conversationId);if(!j)return;if(j._serializerVersion=a,!R(j._targetUrl,e.origin))throw"Failed orgin check";if(i._responseType===Microsoft.Office.Common.ResponseType.forCalling){var G=j._callbackList[i._correlationId];if(G)try{G.callback&&G.callback(i._errorCode,i._data)}finally{delete j._callbackList[i._correlationId]}}else{var X=j._eventHandlerList[i._actionName];void 0!==X&&X!==d&&X(i._data)}}}}function L(){A||(!function(e){if(window.addEventListener)window.addEventListener("message",e,s);else{if(!(navigator.userAgent.indexOf("MSIE")>-1&&window.attachEvent))throw l.msAjaxDebug.trace("Browser doesn't support the required API."),l.msAjaxError.argument("Browser");window.attachEvent("onmessage",e)}}(k),A=t)}return{connect:function(e,t,n,r){var o=S[e];return o||(L(),o=new Microsoft.Office.Common.ClientEndPoint(e,t,n,r),S[e]=o),o},getClientEndPoint:function(e){var t=Function._validateParams(arguments,[{name:i,type:String,mayBeNull:s}]);if(t)throw t;return S[e]},createServiceEndPoint:function(e){L();var t=new Microsoft.Office.Common.ServiceEndPoint(e);return _[e]=t,t},getServiceEndPoint:function(t){var n=Function._validateParams(arguments,[{name:e,type:String,mayBeNull:s}]);if(n)throw n;return _[t]},deleteClientEndPoint:function(e){var t=Function._validateParams(arguments,[{name:i,type:String,mayBeNull:s}]);if(t)throw t;delete S[e]},deleteServiceEndPoint:function(t){var n=Function._validateParams(arguments,[{name:e,type:String,mayBeNull:s}]);if(n)throw n;delete _[t]},urlCompare:function(e,t){return w(e,t)},checkUrlWithAppDomains:function(e,t){return P(e,t)},isTargetSubdomainOfSourceLocation:function(e,t){return U(e,t)},_setMethodTimeout:function(e){var t=Function._validateParams(arguments,[{name:"methodTimeout",type:Number,mayBeNull:s}]);if(t)throw t;C=e<=0?y:e},_startMethodTimeoutTimer:function(){h||(h=setInterval(b,2e3))},isHostNameValidWacDomain:function(e){return N(e)},_hasSamePort:function(e,t){return D(e,t)}}}(),Microsoft.Office.Common.Message=function(e,t,n,r,o){var i=!1,a=this,s=Function._validateParams(arguments,[{name:"messageType",type:Number,mayBeNull:i},{name:"actionName",type:String,mayBeNull:i},{name:"conversationId",type:String,mayBeNull:i},{name:"correlationId",mayBeNull:i},{name:"data",mayBeNull:!0,optional:!0}]);if(s)throw s;a._messageType=e,a._actionName=t,a._conversationId=n,a._correlationId=r,a._origin=window.location.origin,a._data=void 0===o?null:o},Microsoft.Office.Common.Message.prototype={getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getOrigin:function(){return this._origin},getData:function(){return this._data},getMessageType:function(){return this._messageType}},Microsoft.Office.Common.Request=function(e,t,n,r,o){Microsoft.Office.Common.Request.uber.constructor.call(this,Microsoft.Office.Common.MessageType.request,e,n,r,o),this._actionType=t},c.OUtil.extend(Microsoft.Office.Common.Request,Microsoft.Office.Common.Message),Microsoft.Office.Common.Request.prototype.getActionType=function(){return this._actionType},Microsoft.Office.Common.Response=function(e,t,n,r,o,i){Microsoft.Office.Common.Response.uber.constructor.call(this,Microsoft.Office.Common.MessageType.response,e,t,n,i),this._errorCode=r,this._responseType=o},c.OUtil.extend(Microsoft.Office.Common.Response,Microsoft.Office.Common.Message),Microsoft.Office.Common.Response.prototype.getErrorCode=function(){return this._errorCode},Microsoft.Office.Common.Response.prototype.getResponseType=function(){return this._responseType},Microsoft.Office.Common.MessagePackager={envelope:function(e){return"object"==typeof e&&(e._serializerVersion=c.SerializerVersion.Browser),JSON.stringify(e)},unenvelope:function(e){return JSON.parse(e)}},Microsoft.Office.Common.ResponseSender=function(e,t,n,r,o,i,a){var s=!1,d=this,u=Function._validateParams(arguments,[{name:"requesterWindow",mayBeNull:s},{name:"requesterUrl",type:String,mayBeNull:s},{name:"actionName",type:String,mayBeNull:s},{name:"conversationId",type:String,mayBeNull:s},{name:"correlationId",mayBeNull:s},{name:"responsetype",type:Number,maybeNull:s},{name:"serializerVersion",type:Number,maybeNull:!0,optional:!0}]);if(u)throw u;d._requesterWindow=e,d._requesterUrl=t,d._actionName=n,d._conversationId=r,d._correlationId=o,d._invokeResultCode=Microsoft.Office.Common.InvokeResultCode.noError,d._responseType=i;var p=d;d._send=function(e){var t=function(e,t){var n="undefined",r=c.OUtil.parseUrl(e),o=c.OUtil.parseUrl(t);if(!(r&&r.hostname&&o&&o.hostname)){return s}if(!Microsoft.Office.Common.XdmCommunicationManager.urlCompare(r,o)){r&&(r.protocol,r.hostname,r.port&&r.port),o&&(o.protocol,o.hostname,o.port&&o.port);return s}return!0};try{if("dialogMessageReceived"===p._actionName&&"*"!==e.targetOrigin){if(e.targetOrigin&&!t(e.targetOrigin,p._requesterUrl))return}else if("dialogParentMessageReceived"===p._actionName&&e.targetOrigin&&"*"!==e.targetOrigin&&!t(e.targetOrigin,p._requesterUrl))return;var n=new Microsoft.Office.Common.Response(p._actionName,p._conversationId,p._correlationId,p._invokeResultCode,p._responseType,e),r=Microsoft.Office.Common.MessagePackager.envelope(n,a);p._requesterWindow.postMessage(r,p._requesterUrl)}catch(e){l.msAjaxDebug.trace("ResponseSender._send error:"+e.message)}}},Microsoft.Office.Common.ResponseSender.prototype={getRequesterWindow:function(){return this._requesterWindow},getRequesterUrl:function(){return this._requesterUrl},getActionName:function(){return this._actionName},getConversationId:function(){return this._conversationId},getCorrelationId:function(){return this._correlationId},getSend:function(){return this._send},setResultCode:function(e){this._invokeResultCode=e}},Microsoft.Office.Common.InvokeCompleteCallback=function(e,t,n,r,o,i,a){var s=this;Microsoft.Office.Common.InvokeCompleteCallback.uber.constructor.call(s,e,t,n,r,o,Microsoft.Office.Common.ResponseType.forCalling,a),s._postCallbackHandler=i;var c=s;s._send=function(e,t){null!=t&&(c._invokeResultCode=t);try{var n=new Microsoft.Office.Common.Response(c._actionName,c._conversationId,c._correlationId,c._invokeResultCode,c._responseType,e),r=Microsoft.Office.Common.MessagePackager.envelope(n,a);c._requesterWindow.postMessage(r,c._requesterUrl),c._postCallbackHandler()}catch(e){l.msAjaxDebug.trace("InvokeCompleteCallback._send error:"+e.message)}}},c.OUtil.extend(Microsoft.Office.Common.InvokeCompleteCallback,Microsoft.Office.Common.ResponseSender),Microsoft.Office.Common.Invoker=function(e,t,n,r,o,i,a){var s=!0,l=!1,c=this,d=Function._validateParams(arguments,[{name:"methodObject",mayBeNull:l},{name:"paramValue",mayBeNull:s},{name:"invokeCompleteCallback",mayBeNull:l},{name:"eventHandlerProxyList",mayBeNull:s},{name:"conversationId",type:String,mayBeNull:l},{name:"eventName",type:String,mayBeNull:l},{name:"serializerVersion",type:Number,mayBeNull:s,optional:s}]);if(d)throw d;c._methodObject=e,c._param=t,c._invokeCompleteCallback=n,c._eventHandlerProxyList=r,c._conversationId=o,c._eventName=i,c._serializerVersion=a},Microsoft.Office.Common.Invoker.prototype={invoke:function(){var e=this;try{var t;switch(e._methodObject.getInvokeType()){case Microsoft.Office.Common.InvokeType.async:e._methodObject.getMethod()(e._param,e._invokeCompleteCallback.getSend());break;case Microsoft.Office.Common.InvokeType.sync:t=e._methodObject.getMethod()(e._param),e._invokeCompleteCallback.getSend()(t);break;case Microsoft.Office.Common.InvokeType.syncRegisterEvent:var n=e._createEventHandlerProxyObject(e._invokeCompleteCallback);t=e._methodObject.getMethod()(n.getSend(),e._param),e._eventHandlerProxyList[e._conversationId+e._eventName]=n.getSend(),e._invokeCompleteCallback.getSend()(t);break;case Microsoft.Office.Common.InvokeType.syncUnregisterEvent:var r=e._eventHandlerProxyList[e._conversationId+e._eventName];t=e._methodObject.getMethod()(r,e._param),delete e._eventHandlerProxyList[e._conversationId+e._eventName],e._invokeCompleteCallback.getSend()(t);break;case Microsoft.Office.Common.InvokeType.asyncRegisterEvent:var o=e._createEventHandlerProxyObject(e._invokeCompleteCallback);e._methodObject.getMethod()(o.getSend(),e._invokeCompleteCallback.getSend(),e._param),e._eventHandlerProxyList[e._callerId+e._eventName]=o.getSend();break;case Microsoft.Office.Common.InvokeType.asyncUnregisterEvent:var i=e._eventHandlerProxyList[e._callerId+e._eventName];e._methodObject.getMethod()(i,e._invokeCompleteCallback.getSend(),e._param),delete e._eventHandlerProxyList[e._callerId+e._eventName]}}catch(t){e._invokeCompleteCallback.setResultCode(Microsoft.Office.Common.InvokeResultCode.errorInResponse),e._invokeCompleteCallback.getSend()(t)}},getInvokeBlockingFlag:function(){return this._methodObject.getBlockingFlag()},_createEventHandlerProxyObject:function(e){return new Microsoft.Office.Common.ResponseSender(e.getRequesterWindow(),e.getRequesterUrl(),e.getActionName(),e.getConversationId(),e.getCorrelationId(),Microsoft.Office.Common.ResponseType.forEventing,this._serializerVersion)}},c.OUtil.setNamespace("OSF",window),c.MessageIDs={FetchBundleUrl:0,LoadReactBundle:1,LoadBundleSuccess:2,LoadBundleError:3},c.AppName={Unsupported:0,Excel:1,Word:2,PowerPoint:4,Outlook:8,ExcelWebApp:16,WordWebApp:32,OutlookWebApp:64,Project:128,AccessWebApp:256,PowerpointWebApp:512,ExcelIOS:1024,Sway:2048,WordIOS:4096,PowerPointIOS:8192,Access:16384,Lync:32768,OutlookIOS:65536,OneNoteWebApp:131072,OneNote:262144,ExcelWinRT:524288,WordWinRT:1048576,PowerpointWinRT:2097152,OutlookAndroid:4194304,OneNoteWinRT:8388608,ExcelAndroid:8388609,VisioWebApp:8388610,OneNoteIOS:8388611,WordAndroid:8388613,PowerpointAndroid:8388614,Visio:8388615,OneNoteAndroid:4194305},c.InternalPerfMarker={DataCoercionBegin:"Agave.HostCall.CoerceDataStart",DataCoercionEnd:"Agave.HostCall.CoerceDataEnd"},c.HostCallPerfMarker={IssueCall:"Agave.HostCall.IssueCall",ReceiveResponse:"Agave.HostCall.ReceiveResponse",RuntimeExceptionRaised:"Agave.HostCall.RuntimeExecptionRaised"},c.AgaveHostAction={Select:0,UnSelect:1,CancelDialog:2,InsertAgave:3,CtrlF6In:4,CtrlF6Exit:5,CtrlF6ExitShift:6,SelectWithError:7,NotifyHostError:8,RefreshAddinCommands:9,PageIsReady:10,TabIn:11,TabInShift:12,TabExit:13,TabExitShift:14,EscExit:15,F2Exit:16,ExitNoFocusable:17,ExitNoFocusableShift:18,MouseEnter:19,MouseLeave:20,UpdateTargetUrl:21,InstallCustomFunctions:22,SendTelemetryEvent:23,UninstallCustomFunctions:24,SendMessage:25,LaunchExtensionComponent:26,StopExtensionComponent:27,RestartExtensionComponent:28,EnableTaskPaneHeaderButton:29,DisableTaskPaneHeaderButton:30,TaskPaneHeaderButtonClicked:31,RemoveAppCommandsAddin:32,RefreshRibbonGallery:33,GetOriginalControlId:34,OfficeJsReady:35,InsertDevManifest:36,InsertDevManifestError:37,SendCustomerContent:38,KeyboardShortcuts:39},c.SharedConstants={NotificationConversationIdSuffix:"_ntf"},c.DialogMessageType={DialogMessageReceived:0,DialogParentMessageReceived:1,DialogClosed:12006},c.OfficeAppContext=function(e,t,n,r,o,i,a,s,l,c,d,u,p,f,m,g,v,h,y,C,_,S,A,I,T,O,x){var E=this;E._id=e,E._appName=t,E._appVersion=n,E._appUILocale=r,E._dataLocale=o,E._docUrl=i,E._clientMode=a,E._settings=s,E._reason=l,E._osfControlType=c,E._eToken=d,E._correlationId=u,E._appInstanceId=p,E._touchEnabled=f,E._commerceAllowed=m,E._appMinorVersion=g,E._requirementMatrix=v,E._hostCustomMessage=h,E._hostFullVersion=y,E._isDialog=!1,E._clientWindowHeight=C,E._clientWindowWidth=_,E._addinName=S,E._appDomains=A,E._dialogRequirementMatrix=I,E._featureGates=T,E._officeTheme=O,E._initialDisplayMode=x,E.get_id=function(){return this._id},E.get_appName=function(){return this._appName},E.get_appVersion=function(){return this._appVersion},E.get_appUILocale=function(){return this._appUILocale},E.get_dataLocale=function(){return this._dataLocale},E.get_docUrl=function(){return this._docUrl},E.get_clientMode=function(){return this._clientMode},E.get_bindings=function(){return this._bindings},E.get_settings=function(){return this._settings},E.get_reason=function(){return this._reason},E.get_osfControlType=function(){return this._osfControlType},E.get_eToken=function(){return this._eToken},E.get_correlationId=function(){return this._correlationId},E.get_appInstanceId=function(){return this._appInstanceId},E.get_touchEnabled=function(){return this._touchEnabled},E.get_commerceAllowed=function(){return this._commerceAllowed},E.get_appMinorVersion=function(){return this._appMinorVersion},E.get_requirementMatrix=function(){return this._requirementMatrix},E.get_dialogRequirementMatrix=function(){return this._dialogRequirementMatrix},E.get_hostCustomMessage=function(){return this._hostCustomMessage},E.get_hostFullVersion=function(){return this._hostFullVersion},E.get_isDialog=function(){return this._isDialog},E.get_clientWindowHeight=function(){return this._clientWindowHeight},E.get_clientWindowWidth=function(){return this._clientWindowWidth},E.get_addinName=function(){return this._addinName},E.get_appDomains=function(){return this._appDomains},E.get_featureGates=function(){return this._featureGates},E.get_officeTheme=function(){return this._officeTheme},E.get_initialDisplayMode=function(){return this._initialDisplayMode?this._initialDisplayMode:0}},c.OsfControlType={DocumentLevel:0,ContainerLevel:1},c.ClientMode={ReadOnly:0,ReadWrite:1},c.OUtil.setNamespace("Microsoft",window),c.OUtil.setNamespace("Office",Microsoft),c.OUtil.setNamespace("Client",Microsoft.Office),c.OUtil.setNamespace("WebExtension",Microsoft.Office),Microsoft.Office.WebExtension.InitializationReason={Inserted:"inserted",DocumentOpened:"documentOpened",ControlActivation:"controlActivation"},Microsoft.Office.WebExtension.ValueFormat={Unformatted:"unformatted",Formatted:"formatted"},Microsoft.Office.WebExtension.FilterType={All:"all"},Microsoft.Office.WebExtension.Parameters={BindingType:"bindingType",CoercionType:"coercionType",ValueFormat:"valueFormat",FilterType:"filterType",Columns:"columns",SampleData:"sampleData",GoToType:"goToType",SelectionMode:"selectionMode",Id:"id",PromptText:"promptText",ItemName:"itemName",FailOnCollision:"failOnCollision",StartRow:"startRow",StartColumn:"startColumn",RowCount:"rowCount",ColumnCount:"columnCount",Callback:"callback",AsyncContext:"asyncContext",Data:"data",Rows:"rows",OverwriteIfStale:"overwriteIfStale",FileType:"fileType",EventType:"eventType",Handler:"handler",SliceSize:"sliceSize",SliceIndex:"sliceIndex",ActiveView:"activeView",Status:"status",PlatformType:"platformType",HostType:"hostType",ForceConsent:"forceConsent",ForceAddAccount:"forceAddAccount",AuthChallenge:"authChallenge",AllowConsentPrompt:"allowConsentPrompt",ForMSGraphAccess:"forMSGraphAccess",AllowSignInPrompt:"allowSignInPrompt",JsonPayload:"jsonPayload",EnableNewHosts:"enableNewHosts",AccountTypeFilter:"accountTypeFilter",AddinTrustId:"addinTrustId",Reserved:"reserved",Tcid:"tcid",Xml:"xml",Namespace:"namespace",Prefix:"prefix",XPath:"xPath",Text:"text",ImageLeft:"imageLeft",ImageTop:"imageTop",ImageWidth:"imageWidth",ImageHeight:"imageHeight",TaskId:"taskId",FieldId:"fieldId",FieldValue:"fieldValue",ServerUrl:"serverUrl",ListName:"listName",ResourceId:"resourceId",ViewType:"viewType",ViewName:"viewName",GetRawValue:"getRawValue",CellFormat:"cellFormat",TableOptions:"tableOptions",TaskIndex:"taskIndex",ResourceIndex:"resourceIndex",CustomFieldId:"customFieldId",Url:"url",MessageHandler:"messageHandler",Width:"width",Height:"height",RequireHTTPs:"requireHTTPS",MessageToParent:"messageToParent",DisplayInIframe:"displayInIframe",MessageContent:"messageContent",HideTitle:"hideTitle",UseDeviceIndependentPixels:"useDeviceIndependentPixels",PromptBeforeOpen:"promptBeforeOpen",EnforceAppDomain:"enforceAppDomain",UrlNoHostInfo:"urlNoHostInfo",TargetOrigin:"targetOrigin",AppCommandInvocationCompletedData:"appCommandInvocationCompletedData",Base64:"base64",FormId:"formId"},c.OUtil.setNamespace("DDA",c),c.DDA.DocumentMode={ReadOnly:1,ReadWrite:0},c.DDA.PropertyDescriptors={AsyncResultStatus:"AsyncResultStatus"},c.DDA.EventDescriptors={},c.DDA.ListDescriptors={},c.DDA.UI={},c.DDA.getXdmEventName=function(e,t){return t==Microsoft.Office.WebExtension.EventType.BindingSelectionChanged||t==Microsoft.Office.WebExtension.EventType.BindingDataChanged||t==Microsoft.Office.WebExtension.EventType.DataNodeDeleted||t==Microsoft.Office.WebExtension.EventType.DataNodeInserted||t==Microsoft.Office.WebExtension.EventType.DataNodeReplaced?e+"_"+t:t},c.DDA.MethodDispId={dispidMethodMin:64,dispidGetSelectedDataMethod:64,dispidSetSelectedDataMethod:65,dispidAddBindingFromSelectionMethod:66,dispidAddBindingFromPromptMethod:67,dispidGetBindingMethod:68,dispidReleaseBindingMethod:69,dispidGetBindingDataMethod:70,dispidSetBindingDataMethod:71,dispidAddRowsMethod:72,dispidClearAllRowsMethod:73,dispidGetAllBindingsMethod:74,dispidLoadSettingsMethod:75,dispidSaveSettingsMethod:76,dispidGetDocumentCopyMethod:77,dispidAddBindingFromNamedItemMethod:78,dispidAddColumnsMethod:79,dispidGetDocumentCopyChunkMethod:80,dispidReleaseDocumentCopyMethod:81,dispidNavigateToMethod:82,dispidGetActiveViewMethod:83,dispidGetDocumentThemeMethod:84,dispidGetOfficeThemeMethod:85,dispidGetFilePropertiesMethod:86,dispidClearFormatsMethod:87,dispidSetTableOptionsMethod:88,dispidSetFormatsMethod:89,dispidExecuteRichApiRequestMethod:93,dispidAppCommandInvocationCompletedMethod:94,dispidCloseContainerMethod:97,dispidGetAccessTokenMethod:98,dispidGetAuthContextMethod:99,dispidOpenBrowserWindow:102,dispidCreateDocumentMethod:105,dispidInsertFormMethod:106,dispidDisplayRibbonCalloutAsyncMethod:109,dispidGetSelectedTaskMethod:110,dispidGetSelectedResourceMethod:111,dispidGetTaskMethod:112,dispidGetResourceFieldMethod:113,dispidGetWSSUrlMethod:114,dispidGetTaskFieldMethod:115,dispidGetProjectFieldMethod:116,dispidGetSelectedViewMethod:117,dispidGetTaskByIndexMethod:118,dispidGetResourceByIndexMethod:119,dispidSetTaskFieldMethod:120,dispidSetResourceFieldMethod:121,dispidGetMaxTaskIndexMethod:122,dispidGetMaxResourceIndexMethod:123,dispidCreateTaskMethod:124,dispidAddDataPartMethod:128,dispidGetDataPartByIdMethod:129,dispidGetDataPartsByNamespaceMethod:130,dispidGetDataPartXmlMethod:131,dispidGetDataPartNodesMethod:132,dispidDeleteDataPartMethod:133,dispidGetDataNodeValueMethod:134,dispidGetDataNodeXmlMethod:135,dispidGetDataNodesMethod:136,dispidSetDataNodeValueMethod:137,dispidSetDataNodeXmlMethod:138,dispidAddDataNamespaceMethod:139,dispidGetDataUriByPrefixMethod:140,dispidGetDataPrefixByUriMethod:141,dispidGetDataNodeTextMethod:142,dispidSetDataNodeTextMethod:143,dispidMessageParentMethod:144,dispidSendMessageMethod:145,dispidExecuteFeature:146,dispidQueryFeature:147,dispidMethodMax:147},c.DDA.EventDispId={dispidEventMin:0,dispidInitializeEvent:0,dispidSettingsChangedEvent:1,dispidDocumentSelectionChangedEvent:2,dispidBindingSelectionChangedEvent:3,dispidBindingDataChangedEvent:4,dispidDocumentOpenEvent:5,dispidDocumentCloseEvent:6,dispidActiveViewChangedEvent:7,dispidDocumentThemeChangedEvent:8,dispidOfficeThemeChangedEvent:9,dispidDialogMessageReceivedEvent:10,dispidDialogNotificationShownInAddinEvent:11,dispidDialogParentMessageReceivedEvent:12,dispidObjectDeletedEvent:13,dispidObjectSelectionChangedEvent:14,dispidObjectDataChangedEvent:15,dispidContentControlAddedEvent:16,dispidActivationStatusChangedEvent:32,dispidRichApiMessageEvent:33,dispidAppCommandInvokedEvent:39,dispidOlkItemSelectedChangedEvent:46,dispidOlkRecipientsChangedEvent:47,dispidOlkAppointmentTimeChangedEvent:48,dispidOlkRecurrenceChangedEvent:49,dispidOlkAttachmentsChangedEvent:50,dispidOlkEnhancedLocationsChangedEvent:51,dispidOlkInfobarClickedEvent:52,dispidTaskSelectionChangedEvent:56,dispidResourceSelectionChangedEvent:57,dispidViewSelectionChangedEvent:58,dispidDataNodeAddedEvent:60,dispidDataNodeReplacedEvent:61,dispidDataNodeDeletedEvent:62,dispidEventMax:63},c.Constants={FileVersion:"0.0.0.0",ThreePartsFileVersion:"0.0.0",OmexAnonymousServiceName:"__omexExtensionAnonymousProxy",OmexAnonymousServiceExtension:"/anonymousserviceextension.aspx",OmexGatedServiceName:"__omexExtensionGatedProxy",OmexGatedServiceExtension:"/gatedserviceextension.aspx",OmexUnGatedServiceName:"__omexExtensionProxy",OmexUnGatedServiceExtension:"/ungatedserviceextension.aspx",OmexConsentNotificationPage:"/client/consentnotification.aspx",Http:"http",Https:"https",ProtocolSeparator:"://",SignInRedirectUrl:"/logontoliveforwac.aspx?returnurl=",ETokenParameterName:"et",ActivatedCacheKey:"__OSF_RUNTIME_.Activated.{0}.{1}.{2}",ConsentedCacheKey:"__OSF_RUNTIME_.Consented.{0}.{1}.{2}",AuthenticatedConnectMaxTries:3,IgnoreSandBoxSupport:"Ignore_SandBox_Support",IEUpgradeUrl:"https://office.microsoft.com/redir/HA102789344.aspx",OmexForceAnonymousParamName:"SKAV",OmexForceAnonymousParamValue:"274AE4CD-E50B-4342-970E-1E7F36C70037",EndPointInternalSuffix:"_internal",PreloadOfficeJsId:"OFFICEJSPRELOAD",DisplayLanguageParameterName:"_office.displayLanguage",PreloadOfficeJsUrl:"//appsforoffice.microsoft.com/preloading/preloadoffice.js",StringResourceFile:"osfruntime_strings.js"},function(e){var t=function(){function t(){}return t.init=function(t){return e.ShortcutsMappingTableManager.init(t)},t.getShortcutInfoArrayFromShortcutKey=function(t,n){if(n<1||n>255)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidKeyCode,"Invalid parameter key code: "+n);if(0==t||!e.ActionMetadataManager.containsModifierKeys(t))throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.missingModifierKey,"Missing modifier key: "+t);return e.ShortcutsMappingTableManager.getShortcutsInfo(t,n)},t.containsModifierKeys=function(t){var n=e.ExtendedManifestUtility.getPlatformName()==e.ShortcutsMappingTableManager.s_shortcutPlatformMac;return 0!=(t&(e.ShortcutsMappingTableManager.modifierKeys.SHIFT|e.ShortcutsMappingTableManager.modifierKeys.CTRL|e.ShortcutsMappingTableManager.modifierKeys.ALT|(n?e.ShortcutsMappingTableManager.modifierKeys.COMMAND:0)))},t}();e.ActionMetadataManager=t}(p||(p={})),function(e){e.TelemetryProperties={ariaTenantToken:"db334b301e7b474db5e0f02f07c51a47-a1b5bc36-1bbe-482f-a64a-c2d9cb606706-7439",nexusTenantToken:1755};var t=function(){var t="Addin Shortcut Error: Invalid key combination",n=null;function i(){}return i.getShortcutsMappingTable=function(){return i.s_shortcutsMappingTable},i.getActionName=function(e,t){return i.s_actionTable==n?n:i.s_actionTable[e]!=n?i.s_actionTable[e][t]:n},i.getKeyCodeFromVirtualKey=function(e){if(!i.s_stringToKeyCodeMap){i.s_stringToKeyCodeMap={};var t=Object.keys(i.keyCodes);for(var n in t){var r=t[n],o=i.keyCodes[r],a=i.specialCharacters[o];a&&(i.s_stringToKeyCodeMap[a]=r),i.s_stringToKeyCodeMap[o.toUpperCase()]=r}}return i.s_stringToKeyCodeMap[e.toUpperCase()]},i.convertModifierKeyToNumber=function(e){var t=(e=e.trim()).toUpperCase();return i.modifierKeys[t]==n?1==t.length||i.keyCodes[t]?(s.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Multiple virtual key",n,n,573125059),n):(s.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Invalid modifier key",n,n,573125058),n):i.modifierKeys[t]},i.convertModifierKeys=function(e){for(var t=0,r=0;r<e.length;r++){if(e[r]==n)return-1;t|=i.convertModifierKeyToNumber(e[r])}return t},i.convertStringToKeys=function(e){var r=e.split("+");if(r.length<2)return s.RuntimeTelemetryHelper.LogExceptionTag(t,n,n,n),n;var o=r.splice(0,r.length-1),a=r[r.length-1],l=i.convertModifierKeys(o),c=i.convertVirtualKeyToInt(a);return-1==c||-1==l?(s.RuntimeTelemetryHelper.LogExceptionTag(t,n,n,573125057),n):{modifierKeys:l,virtualKey:c}},i.convertVirtualKeyToInt=function(e){var t=(e=e.trim()).toUpperCase();if(1==t.length)return t.charCodeAt(0);var n=i.getKeyCodeFromVirtualKey(t);return n||-1},i.getShortcutsInfo=function(e,t){var r=[];if(i.s_shortcutsMappingTable[t]==n)return r;var o=i.s_shortcutsMappingTable[t][e];if(o==n)return r;for(var a in o)r.push({addinId:o[a].addinId,actionId:o[a].actionId,actionName:o[a].actionName});return r},i.getShortcutText=function(e,t,n){var r=i.keyCodes[t];return r||(r=String.fromCharCode(t)),i.getModifierKeyString(e,n)+"+"+r},i.getModifierKeyString=function(e,t){for(var n=[],r=1;r<=e;){if(e&r){var o=void 0;r==i.modifierKeys[i.s_optionKey.toUpperCase()]?(t||(t=i.s_shortcutPlatformWin32),o=t.toLowerCase()==i.s_shortcutPlatformMac?i.s_optionKey:i.s_altKey):o=i.keyCodesToModifierKeys[r],o&&n.push(o)}r<<=1}return(n=n.sort()).join("+")},i.getShortcutsMappingTableString=function(){return i.s_shortcutsMappingTable==n?n:JSON.stringify(i.s_shortcutsMappingTable)},i.getActionTableString=function(){return i.s_actionTable==n?n:JSON.stringify(i.s_actionTable)},i.getKeysFromShortcutPlatformAvailability=function(e){return"object"==typeof e?e[i.s_shortcutPlatformWeb]?e[i.s_shortcutPlatformWeb]:e[i.s_shortcutPlatformDefault]?e[i.s_shortcutPlatformDefault]:n:n},i.validateExtendedManifestShortcutKeys=function(r,o,a){var l=this;return e.OsfCache.get(e.OsfCache.c_osfCacheTableName,i.s_shortcutsTableCacheKey).then((function(c){var d="Addin Shortcut Error: Duplicate key combination in the same add-in",u="Addin Shortcut Error: Modifier key only contains SHIFT",p=r.shortcuts;if(p){var f={},m={};try{c&&(m=JSON.parse(c))}catch(t){if(s.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Cannot parse shortcut table cache",n,n,573125056),a)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidExtendedOverride," Addin Shortcut Error: Cannot parse shortcut table cache")}for(var g=0;g<p.length;g++){var v=i.getKeysFromShortcutPlatformAvailability(p[g].key),h=i.convertStringToKeys(v);if(h==n&&(s.RuntimeTelemetryHelper.LogExceptionTag(t,n,n,573125027),a))throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidKeyCode,t);if(h.modifierKeys==l.modifierKeys.SHIFT&&(s.RuntimeTelemetryHelper.LogExceptionTag(u,n,n,556287122),a))throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidKeyCode,u);if(m[h.virtualKey]&&m[h.virtualKey][h.modifierKeys]&&(m[h.virtualKey][h.modifierKeys].push({actionId:p[g].action,addinId:o}),s.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Warning: Duplicate key combination in existing cache",n,n,573125026)),f[h.virtualKey]==n&&(f[h.virtualKey]={}),f[h.virtualKey][h.modifierKeys]){for(var y in f[h.virtualKey][h.modifierKeys])if(f[h.virtualKey][h.modifierKeys][y].addinId==o)if(f[h.virtualKey][h.modifierKeys][y].actionId==p[g].action)s.RuntimeTelemetryHelper.LogExceptionTag("Addin Shortcut Error: Duplicate shortcut entry",n,n,573125025);else if(s.RuntimeTelemetryHelper.LogExceptionTag(d,n,n,573125024),a)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidExtendedOverride,d)}else f[h.virtualKey][h.modifierKeys]=[];f[h.virtualKey][h.modifierKeys].push({actionId:p[g].action,addinId:o})}}}))},i.createActionsByIdTable=function(e){var t={};if(e)for(var n=0;n<e.length;n++)t[e[n].id]=e[n].name;return t},i.rebuildMappingTable=function(t){i.s_shortcutsMappingTable={},i.s_actionTable={};for(var r=0;r<t.length;r++){var o=t[r].extendedManifest.shortcuts,a=t[r].extendedManifest.actions,s=t[r].addinId,l=i.createActionsByIdTable(a);if(e.ShortcutKeyDispatchManager.isCustomShortcutsEnabled()&&(i.s_actionTable[s]=l),o){for(var c=0;c<o.length;c++){var d=i.getKeysFromShortcutPlatformAvailability(o[c].key),u=i.convertStringToKeys(d);if(u==n)return;var p=l[o[c].action],f={modifierKeys:u.modifierKeys,virtualKey:u.virtualKey,actionId:o[c].action,addinId:s,actionName:p||o[c].action};i.s_shortcutsMappingTable[u.virtualKey]==n&&(i.s_shortcutsMappingTable[u.virtualKey]={}),i.s_shortcutsMappingTable[u.virtualKey][u.modifierKeys]==n&&(i.s_shortcutsMappingTable[u.virtualKey][u.modifierKeys]=[]),i.s_shortcutsMappingTable[u.virtualKey][u.modifierKeys].push(f)}i.sendShortcutTelemetry(s,o.length)}}},i.sendShortcutTelemetry=function(t,r){setTimeout((function(){var o="function",i=new c.AddinIdInfo(t);if(i.getSolutionId()&&i.getStoreTypeId())if("object"==typeof Otel&&typeof Otel.Telemetry===o&&typeof Otel.Telemetry.sendOtelEvent===o){var a={otelEvent:{eventName:"Office.Extensibility.Shortcuts.InstallationInfo",dataFields:[{name:"solutionId",dataType:1,value:i.getPrivacyCompliantSolutionId()},{name:"storeType",dataType:1,value:e.ManifestUtil.GetStoreTypeName(i.getStoreTypeId())},{name:"shortcutsCount",dataType:2,value:r}],telemetryProperties:e.TelemetryProperties}};Otel.Telemetry.sendOtelEvent(a)}else s.RuntimeTelemetryHelper.LogCommonMessageTag("Addin Shortcut Error: The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",n,573125022);else s.RuntimeTelemetryHelper.LogCommonMessageTag("Addin Shortcut Error: Couldn't get solutionid or storetype from the addinid",n,573125023)}),0)},i.getAllExtendedManifestAndBuildMappingTable=function(){return r(this,void 0,void 0,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return[4,e.OsfExtendedManifestCache.getAll()];case 1:return t=n.sent(),i.rebuildMappingTable(t),[4,e.OsfCache.set(e.OsfCache.c_osfCacheTableName,i.s_shortcutsTableCacheKey,e.ShortcutsMappingTableManager.getShortcutsMappingTableString())];case 2:return n.sent(),e.ShortcutKeyDispatchManager.isCustomShortcutsEnabled()?[4,e.OsfCache.set(e.OsfCache.c_osfCacheTableName,i.s_actionTableCacheKey,e.ShortcutsMappingTableManager.getActionTableString())]:[3,4];case 3:n.sent(),n.label=4;case 4:return[2]}}))}))},i.init=function(t){return r(this,void 0,void 0,(function(){var r,a;return o(this,(function(o){switch(o.label){case 0:return t?e.ShortcutKeyDispatchManager.isCustomShortcutsEnabled()?[4,e.OsfCache.get(e.OsfCache.c_osfCacheTableName,i.s_shortcutsTableCacheKey)]:[3,6]:[3,11];case 1:return a=o.sent(),[4,e.OsfCache.get(e.OsfCache.c_osfCacheTableName,i.s_actionTableCacheKey)];case 2:return r=o.sent(),a!=n&&r!=n?[3,4]:[4,i.getAllExtendedManifestAndBuildMappingTable()];case 3:return o.sent(),[3,5];case 4:i.s_shortcutsMappingTable=JSON.parse(a),i.s_actionTable=JSON.parse(r),o.label=5;case 5:return[3,10];case 6:return[4,e.OsfCache.get(e.OsfCache.c_osfCacheTableName,i.s_shortcutsTableCacheKey)];case 7:return(a=o.sent())!=n?[3,9]:[4,i.getAllExtendedManifestAndBuildMappingTable()];case 8:return o.sent(),[3,10];case 9:i.s_shortcutsMappingTable=JSON.parse(a),o.label=10;case 10:return[3,13];case 11:return[4,i.getAllExtendedManifestAndBuildMappingTable()];case 12:o.sent(),o.label=13;case 13:return[2]}}))}))},i.s_shortcutPlatformMac="macintosh",i.s_shortcutPlatformWin32="windows",i.s_shortcutsTableCacheKey="shortcutstablecache",i.s_shortcutsMappingTable={},i.s_shortcutPlatformWeb="web",i.s_shortcutPlatformDefault="default",i.s_altKey="Alt",i.s_optionKey="Option",i.s_stringToKeyCodeMap=n,i.s_actionTableCacheKey="actiontablecache",i.s_actionTable={},i.keyCodes={18:"Alt",192:"BackQuote",220:"\\",8:"BackSpace",20:"CapsLock",188:",",17:"Ctrl",189:"-",46:"Del",40:"Down",35:"End",13:"Enter",187:"=",27:"Esc",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",36:"Home",45:"Ins",37:"Left",219:"[",91:"Meta",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"NumPad0",97:"NumPad1",98:"NumPad2",99:"NumPad3",100:"NumPad4",101:"NumPad5",102:"NumPad6",103:"NumPad7",104:"NumPad8",105:"NumPad9",111:"NumPadDivide",110:"NumPadDot",109:"NumPadMinus",106:"NumPadMultiply",107:"NumPadPlus",34:"PageDown",33:"PageUp",179:"Pause",190:".",44:"PrintScreen",39:"Right",221:"]",145:"ScrollLock",186:";",222:"'",191:"/",32:"Space",9:"Tab",38:"Up",16:"Shift"},i.specialCharacters={"/":"SLASH","'":"SINGLEQUOTE",";":"SEMICOLON",".":"PERIOD","[":"LEFTBRACKET","]":"RIGHTBRACKET","=":"EQUALSIGN","-":"DASH",",":"COMMA","\\":"BACKSLASH"},i.modifierKeys={SHIFT:4,CTRL:8,CONTROL:8,ALT:32,OPTION:32,COMMAND:256},i.keyCodesToModifierKeys={4:"Shift",8:"Ctrl",32:"Alt",256:"Command"},i}();e.ShortcutsMappingTableManager=t}(p||(p={})),function(e){!function(t){var n="IsReactRibbonEnabled",r="ov:SourceLocation",o="resid",a="OfficeGroup",s="ov:Description",l="ov:Title",d=!0,u=!1,p="bt:Image",f="ov:VersionOverrides",m="o:OfficeApp",g=null,v="OfficeControl",h=v,y=function(e){var t=this;t.name="AddinManifestError",t.message=t.name+": "+e},C=function(e){this.name="AddinInternalError",this.message=e};function _(e,t){if(e==g)throw new y(t)}function S(e,t){for(var n="\r\n\f\b\v\t",r=0;r<n.length;++r)if(e.indexOf(n[r])>=0)throw new y(t)}var A=function(){function e(e){var t="bt:String",n=this;n.Images={},n.Urls={},n.LongStrings={},n.ShortStrings={};var r=e.manifest._xmlProcessor.selectSingleNode(m),o=e.selectSingleNode(r,[f,"ov:Resources"]);n.parseCollection(e,e.selectChildNodes(p,o,["bt:Images"]),n.Images),n.parseCollection(e,e.selectChildNodes("bt:Url",o,["bt:Urls"]),n.Urls),n.parseCollection(e,e.selectChildNodes(t,o,["bt:LongStrings"]),n.LongStrings),n.parseCollection(e,e.selectChildNodes(t,o,["bt:ShortStrings"]),n.ShortStrings)}return e.prototype.parseCollection=function(e,t,n){for(var r=t.length,o=0;o<r;o++){var i=t[o];n[i.getAttribute("id")]=e.parseLocaleAwareSettingsAndGetValue(i)}},e}();t.ManifestResourceManager=A;var I=function(){var e="Invalid characters in text value: ";function t(e,t,n,r){var o=this;o.hostType=e,o.formFactor=t,o.entitlement=n,o.manifest=r,o.resources=new A(o),o.officeGroupCount=0,o.officeControlCount=0}return t.prototype.shouldParseNode=function(e){var t=this.manifest._xmlProcessor.selectSingleNode("ov:OverriddenByRibbonApi",e);return t!=g&&this.manifest._parseBooleanNode(t)?u:d},t.prototype.parseIdRequired=function(e){var t=e.getAttribute("id");return _(t,"Id required"),t},t.prototype.parseLabel=function(e){var t=this.manifest._xmlProcessor.selectSingleNode("ov:Label",e);return t!=g?this.getShortString(t):g},t.prototype.parseLabelRequired=function(e){var t=this.parseLabel(e);return _(t,"Label required"),t},t.prototype.parseRequiredSuperTip=function(e){var t=this.parseSuperTip(e);return _(t,"SuperTip required"),t},t.prototype.parseSuperTip=function(e){var t=this,n=g,r=t.manifest._xmlProcessor.selectSingleNode("ov:Supertip",e);if(r!=g){var o,i=r;_(r=t.manifest._xmlProcessor.selectSingleNode(l,i),"Title is necessary for SuperTip."),o=t.getShortString(r),_(r=t.manifest._xmlProcessor.selectSingleNode(s,i),"Description is necessary for SuperTip."),n={title:o,description:t.getLongString(r)}}return n},t.prototype.parseRequiredIcon=function(e){var t=this.parseIcon(e);return _(t,"Icon required"),t},t.prototype.parseIcon=function(e){var t=this.selectChildNodes(p,e,["ov:Icon"]),n=t.length;if(0==n)return g;for(var r={},o=0;o<n;o++){var i=t[o];r[i.getAttribute("size")]=this.getImageResource(i)}return r},t.prototype.parseMultipleChildControls=function(e,t,n){for(var r=[],o=0;o<t.childNodes.length;o++)-1!==e.indexOf(t.childNodes[o].nodeName)&&r.push(t.childNodes[o]);return this.parseControls(r,n)},t.prototype.parseChildControls=function(e,t,n){var r=this.manifest._xmlProcessor.selectNodes(e,t);return this.parseControls(r,n)},t.prototype.parseControls=function(e,t){for(var n=[],r=e.length,o=0;o<r;o++){var i=e[o];if(this.shouldParseNode(i)){var a=t(this,i);_(a,"parser must return a control."),n.push(a)}}return n},t.prototype.parseGroupUnderTab=function(e){var t;switch(e.nodeName){case a:t=new L,this.officeGroupCount++;break;default:t=new k}return t.parse(this,e),t},t.prototype.parseControlInGroup=function(e){var n,r=e.getAttribute(t.typeAttributeName);switch(r||e.nodeName!==h||(r=v),r){case"Menu":n=new P;break;case"Button":n=new U(r);break;case v:n=new w,this.officeControlCount++;break;default:throw new y("Unsupported control type.")}return n.parse(this,e),n},t.prototype.parseMenuItem=function(e){var t=new F;return t.parse(this,e),t},t.prototype.parseLocaleAwareSettingsAndGetValue=function(e){var t=this,n={},r=e.getAttribute("DefaultValue");n[t.manifest._defaultLocale]=r,n[t.manifest._defaultLocale.toLocaleLowerCase()]=r;var o=t.manifest._xmlProcessor.selectNodes("bt:Override",e);if(o)for(var i=o.length,a=0;a<i;a++){var s=(e=o[a]).getAttribute("Locale"),l=e.getAttribute("Value");n[s]=l,n[s.toLocaleLowerCase()]=l}return t.manifest._getDefaultValue(n)},t.prototype.selectSingleNode=function(e,t){if(t==g)return e;for(var n=0;n<t.length&&(e=this.manifest._xmlProcessor.selectSingleNode(t[n],e))!=g;n++);return e},t.prototype.selectChildNodes=function(e,t,n){return(t=this.selectSingleNode(t,n))==g?[]:this.manifest._xmlProcessor.selectNodes(e,t)},t.prototype.getSingleNodeValue=function(e,t){var n=this.manifest._xmlProcessor.selectSingleNode(e,t);return n?this.manifest._xmlProcessor.getNodeValue(n):""},t.prototype.getResourceByNode=function(e,t){var n=t.getAttribute(o),r=e[n];return _(r,"resid: "+n+" not found"),r},t.prototype.getImageResource=function(e){return this.getResourceByNode(this.resources.Images,e)},t.prototype.getUrlResource=function(e){return this.getResourceByNode(this.resources.Urls,e)},t.prototype.getLongString=function(t){var n=this.getResourceByNode(this.resources.LongStrings,t);return S(n,e+n),n},t.prototype.getShortString=function(t){var n=this.getResourceByNode(this.resources.ShortStrings,t);return S(n,e+n),n},t.typeAttributeName="xsi:type",t}();t.ParsingContext=I;var T=function(){function e(){}return e.buildControls=function(e,t){for(var n=t.length,r=0;r<n;r++){t[r].apply(e)}},e}(),O=function(e,t,n){var r=this;void 0===n&&(n=u),r.multipleCustomTabsEnabled=u,r.functionFile=e,r.builder=t,r.multipleCustomTabsEnabled=n},x=function(){function e(){}return e.prototype.parse=function(e,t){var n=e.manifest._xmlProcessor,r=n.selectSingleNode(l,t);_(r,"Title is necessary for GetStarted."),this.title=e.getShortString(r);var o=n.selectSingleNode(s,t);_(o,"Description is necessary for GetStarted."),this.description=e.getLongString(o);var i=n.selectSingleNode("ov:LearnMoreUrl",t);this.learnMoreUrl=e.getUrlResource(i)},e}(),E=function(){function e(e){this.type=e}return e.prototype.buildAction=function(){},e.prototype.parse=function(){},e}(),b=function(e){function t(){return e!==g&&e.apply(this,arguments)||this}return i(t,e),t.prototype.buildAction=function(e){var t=this;return e.actionBuilder.buildShowTaskpane(t.sourceLocation,t.title,t.taskpaneId,t.sourceLocationResid)},t.prototype.parse=function(t,n){var r=this;e.prototype.parse.call(r,t,n);var i=t.manifest._xmlProcessor.selectSingleNode("ov:TaskpaneId",n);i!=g&&(r.taskpaneId=i.firstChild.nodeValue),(i=t.manifest._xmlProcessor.selectSingleNode("ov:SourceLocation ",n))!=g&&(r.sourceLocationResid=i.getAttribute(o)),(i=t.manifest._xmlProcessor.selectSingleNode(l,n))!=g&&(r.title=t.getShortString(i))},t}(function(e){function t(){var t=e!==g&&e.apply(this,arguments)||this;return t.title=g,t}return i(t,e),t.prototype.parse=function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode(r,t);_(n,"SourceLocation is necessary for ShowTaskpane action"),this.sourceLocation=e.getUrlResource(n),e.manifest.addManifestUrl(this.sourceLocation)},t}(E)),M=function(e){function t(){return e!==g&&e.apply(this,arguments)||this}return i(t,e),t.prototype.buildAction=function(e){return _(e.functionFile,"Function file source url is necessary for ExecuteFunctionAction."),e.actionBuilder.buildCallFunction(e.functionFile,this.functionName,this.controlId)},t.prototype.parse=function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode("ov:FunctionName",t);_(n,"FunctionName is necessary for ExecuteFunctionAction."),this.functionName=e.manifest._xmlProcessor.getNodeValue(n)},t}(E),R=function(){function e(){}return e.prototype.parse=function(e,t){this.id=e.parseIdRequired(t),this.label=e.parseLabelRequired(t)},e}(),P=function(e){function t(){return e!==g&&e.apply(this,arguments)||this}return i(t,e),t.prototype.apply=function(e){e.controlBuilder.startBuildMenu(this),T.buildControls(e,this.children),e.controlBuilder.endBuildMenu()},t.prototype.parse=function(t,n){var r=this;if(t.shouldParseNode(n)){e.prototype.parse.call(r,t,n),r.icon=t.parseRequiredIcon(n),r.superTip=t.parseRequiredSuperTip(n);var o=t.selectChildNodes("ov:Item",n,["ov:Items"]);r.children=t.parseControls(o,(function(e,t){return e.parseMenuItem(t)}))}},t}(R);t.MenuControl=P;var N=function(e){function t(t){var n=e.call(this)||this;return n.enabled=d,n.controlType=t,n}return i(t,e),t.prototype.apply=function(e){var t=this,n=t.action.buildAction(e),r={id:t.id,label:t.label,icon:t.icon,superTip:t.superTip,actionType:t.actionType,action:n,enabled:t.enabled};t.applyControl(e,r)},t.prototype.parse=function(t,n){var r=this;e.prototype.parse.call(r,t,n),r.icon=r.parseIcon(t,n),r.superTip=t.parseRequiredSuperTip(n);var o=t.manifest._xmlProcessor.selectSingleNode("ov:Action",n);_(o,"Action is necessary for itemControl.");var i,a=o.getAttribute(I.typeAttributeName);switch(a){case"ShowTaskpane":i=new b(a);break;case"ExecuteFunction":(i=new M(a)).controlId=r.id;break;default:throw new y("Unsupported action type.")}i.parse(t,o),r.actionType=a,r.action=i;var s=t.manifest._xmlProcessor.selectSingleNode("ov:Enabled",n);s!=g&&(r.enabled=t.manifest._parseBooleanNode(s))},t.prototype.applyControl=function(){throw new C("Not implemented method applyControl for ItemControl.")},t.prototype.parseIcon=function(e,t){return e.parseIcon(t)},t}(R),U=function(e){function t(){return e!==g&&e.apply(this,arguments)||this}return i(t,e),t.prototype.applyControl=function(e,t){e.controlBuilder.addButton(t)},t.prototype.parseIcon=function(e,t){return e.parseRequiredIcon(t)},t}(N),F=function(e){function t(){return e.call(this,"MenuItem")||this}return i(t,e),t.prototype.applyControl=function(e,t){e.controlBuilder.addMenuItem(t)},t}(N),w=function(e){function t(){var t=e.call(this,v)||this;return t.label=g,t.icon=g,t.superTip=g,t.actionType=g,t.action=g,t.enabled=d,t}return i(t,e),t.prototype.apply=function(e){var t=this,n={id:t.id,label:t.label,icon:t.icon,superTip:t.superTip,actionType:t.actionType,action:t.action,enabled:t.enabled};t.applyControl(e,n)},t.prototype.parse=function(e,t){var n=this;try{n.id=e.parseIdRequired(t)}catch(e){throw new y("Required id attribute missing for OfficeControl.")}if(c.RibbonControlIdMap&&c.RibbonControlIdMap[n.id])n.id=c.RibbonControlIdMap[n.id];else if(!c.OUtil.checkFlight(c.FlightNames.AddinRibbonIdAllowUnknown))throw new y("Unsupported control id for OfficeControl.")},t.prototype.applyControl=function(e,t){e.controlBuilder.addNativeControl(t)},t}(N),D=function(){function e(e){var t=this;t.label=g,t.isOfficeTab=u,t.visible=d,t.children=[],t.tabType="default",t.insertBefore="",t.insertAfter="",t.autoFocus=u,t.isOfficeTab=e}return e.prototype.apply=function(e){e.builder.ribbonBuilder.startBuildTab(this);for(var t=this.children.length,n=0;n<t;n++){this.children[n].apply(e)}e.builder.ribbonBuilder.endBuildTab()},e.prototype.parse=function(e,t){var r=this;r.id=e.parseIdRequired(t),r.isOfficeTab||(r.label=e.parseLabelRequired(t),c.Settings[n]&&(r.insertBefore=e.getSingleNodeValue("ov:InsertBefore",t),r.insertAfter=e.getSingleNodeValue("ov:InsertAfter",t),r.insertBefore&&("TabHome"===r.insertBefore&&(r.autoFocus=d),e.insertBefore=r.insertBefore),r.insertAfter&&(e.insertAfter=r.insertAfter))),c.Settings[n]?r.children=e.parseMultipleChildControls(["Group",a],t,(function(e,t){return e.parseGroupUnderTab(t)})):r.children=e.parseMultipleChildControls(["Group"],t,(function(e,t){return e.parseGroupUnderTab(t)}))},e}(),k=function(e){function t(){var t=e!==g&&e.apply(this,arguments)||this;return t.groupType="Custom",t}return i(t,e),t.prototype.parse=function(t,r){var o=this;t.shouldParseNode(r)&&(e.prototype.parse.call(o,t,r),o.icon=t.parseRequiredIcon(r),c.Settings[n]?o.children=t.parseMultipleChildControls(["Control",v],r,(function(e,t){return e.parseControlInGroup(t)})):o.children=t.parseMultipleChildControls(["Control"],r,(function(e,t){return e.parseControlInGroup(t)})))},t.prototype.apply=function(e){e.builder.ribbonBuilder.startBuildGroup(this),T.buildControls({functionFile:e.functionFile,actionBuilder:e.builder.actionBuilder,controlBuilder:e.builder.ribbonBuilder},this.children),e.builder.ribbonBuilder.endBuildGroup()},t}(R),L=function(e){function t(){var t=e.call(this)||this;return t.children=g,t.label=g,t.icon=g,t.groupType=a,t}return i(t,e),t.prototype.parse=function(e,t){var n=this;try{n.id=e.parseIdRequired(t)}catch(e){throw new y("Required id attribute missing for OfficeGroup.")}if(c.RibbonGroupIdMap&&c.RibbonGroupIdMap[n.id])n.id=c.RibbonGroupIdMap[n.id];else if(!c.OUtil.checkFlight(c.FlightNames.AddinRibbonIdAllowUnknown))throw new y("Unsupported id for OfficeGroup.")},t.prototype.apply=function(e){e.builder.ribbonBuilder.addNativeGroup(this)},t}(k),B=function(){function e(e){this.type=e,this.tabs=[]}return e.prototype.apply=function(e){if(this.type==e.builder.commandSurface)for(var t=this.tabs.length,n=0,r=0,o=0;o<t;o++){var i=this.tabs[o];if(i.isOfficeTab&&n<1)n++;else{if(i.isOfficeTab||!(r<1||e.multipleCustomTabsEnabled))break;r++}i.apply(e)}},e.prototype.parse=function(e,t){var n="undefined",r=e.manifest._xmlProcessor.selectSingleNode("ov:OfficeTab",t);r!=g&&((s=new D(d)).parse(e,r),this.tabs.push(s));var o=e.manifest._xmlProcessor.selectNodes("ov:CustomTab",t);if(o)for(var i=o.length,a=0;a<i;a++){var s;if((r=o[a])!=g)(s=new D(u)).parse(e,r),this.tabs.push(s)}typeof otel!==n&&typeof otel.sendTelemetryEvent!==n&&otel.sendTelemetryEvent({name:"Office.Online.Extensibility.Ribbon.OfficeGroupControlCount",dataFields:[{name:"OfficeControlCount",int64:e.officeControlCount},{name:"OfficeGroupCount",int64:e.officeGroupCount},{name:"InsertBefore",string:JSON.stringify(e.insertBefore)},{name:"InsertAfter",string:JSON.stringify(e.insertAfter)}]})},e}(),H=function(){function e(){}return e.prototype.parse=function(e,t){e.shouldParseNode(t)&&(this.id=e.parseIdRequired(t),this.children=e.parseChildControls("ov:Control",t,(function(e,t){return e.parseControlInGroup(t)})))},e.prototype.apply=function(e){e.controlBuilder.startBuildMenu({id:this.id,label:g,superTip:g}),T.buildControls(e,this.children),e.controlBuilder.endBuildMenu()},e}(),W=function(){function e(e){this.type=e}return e.prototype.apply=function(e){this.type==e.builder.commandSurface&&T.buildControls({functionFile:e.functionFile,actionBuilder:e.builder.actionBuilder,controlBuilder:e.builder.contextMenuBuilder},this.children)},e.prototype.parse=function(e,t){this.children=e.parseChildControls("ov:OfficeMenu",t,(function(e,t){var n=new H;return n.parse(e,t),n}))},e}(),V=function(){function e(e){this.type=e}return e.prototype.apply=function(){},e.prototype.parse=function(e,t){var n=this,r=e.manifest._xmlProcessor.selectSingleNode("ov:Namespace",t);r&&(n.namespaceResId=r.getAttribute(o));var i=e.manifest._xmlProcessor.selectSingleNode("ov:Script",t);if(i&&(n.scriptResId=n._parseSourceLocationResId(e,i)),!n.scriptResId)throw new y("Missing required <Script> element under element <ExtensionPoint xsi:type='CustomFunctions'>.");var a=e.manifest._xmlProcessor.selectSingleNode("ov:Page",t);if(a&&(n.pageResId=n._parseSourceLocationResId(e,a)),!n.pageResId)throw new y("Missing required <Page> element under element <ExtensionPoint xsi:type='CustomFunctions'>.");var s=e.manifest._xmlProcessor.selectSingleNode("ov:Metadata",t);if(s&&(n.metadataResId=n._parseSourceLocationResId(e,s)),!n.metadataResId)throw new y("Missing required <Metadata> element under element <ExtensionPoint xsi:type='CustomFunctions'>.")},e.prototype._parseSourceLocationResId=function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode(r,t);if(n)return n.getAttribute(o)},e}();t.CustomFunctionsExtensionPoint=V;var j=function(){function t(){var e=this;e.getStartedNode=g,e.functionFile=g,e.functionFileResid=g,e.cacheableUrls=[],e.ExtensionPoints=[]}return t.prototype.cacheableResources=function(){return this.cacheableUrls},t.prototype.apply=function(t,n,r){var o=this;void 0===r&&(r=u);try{t.startApplyAddin({entitlement:o.extensionEntitlement,manifest:o.extensionManifest,startedNode:o.getStartedNode,overrides:{type:o.type,description:o.description}});for(var i=new O(o.functionFile,t,r),a=o.ExtensionPoints.length,s=0;s<a;s++){o.ExtensionPoints[s].apply(i)}t.endApplyAddin()}catch(t){throw t instanceof y&&n.setErrorMessageForAddin(o.extensionEntitlement.assetId,Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message),c.OUtil.checkFlight(c.FlightNames.ManifestParserDevConsoleLog)&&e.DevConsole.log(t),t}},t.prototype.parse=function(e,t){var n=this;n.type=t.getAttribute(I.typeAttributeName);var r=e.manifest._xmlProcessor.selectSingleNode(s,t);r!=g&&(n.description=e.getLongString(r));for(var i=e.selectChildNodes("ov:Host",t,["ov:Hosts"]),a=g,l=i.length,c=0;c<l;c++){var d=i[c];if(d.getAttribute(I.typeAttributeName)==e.hostType){(a=e.manifest._xmlProcessor.selectSingleNode("ov:"+e.formFactor,d))==g&&(a=e.manifest._xmlProcessor.selectSingleNode("ov:AllFormFactors",d));break}}var u=e.manifest._xmlProcessor.selectSingleNode("ov:GetStarted",a);u!=g&&(n.getStartedNode=new x,n.getStartedNode.parse(e,u)),(r=e.manifest._xmlProcessor.selectSingleNode("ov:FunctionFile",a))!=g&&(n.functionFileResid=r.getAttribute(o),n.functionFile=e.getUrlResource(r),e.manifest.addManifestUrl(n.functionFile));var p=e.manifest._xmlProcessor.selectNodes("ov:ExtensionPoint",a);l=p.length;for(c=0;c<l;c++){var f,m=p[c],v=m.getAttribute(I.typeAttributeName);switch(v){case"Events":throw"Not Implemented";case"PrimaryCommandSurface":f=new B(v);break;case"ContextMenu":f=new W(v);break;case"CustomFunctions":f=new V(v);break;default:throw new y("Unsupported extension type.")}f.parse(e,m),n.ExtensionPoints.push(f)}var h=e.resources.Images;for(var C in h)n.cacheableUrls.push(h[C]);n.extensionEntitlement=e.entitlement,n.extensionManifest=e.manifest},t}();t.VersionOverrides=j;var G=function(){function e(){}return e.prototype.cacheableResources=function(){return[]},e.prototype.apply=function(){},e}(),X=function(){function t(e,t){this.hostType=e,this.formFactor=t}return t.prototype.parseExtensions=function(t,n,r){try{var o=n._xmlProcessor.selectSingleNode(m),i=n._xmlProcessor.selectSingleNode(f,o);if(i==g)return new G;var a=new j;return a.parse(new I(this.hostType,this.formFactor,t,n),i),a}catch(n){throw n instanceof y&&r.setErrorMessageForAddin(t.assetId,Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message),c.OUtil.checkFlight(c.FlightNames.ManifestParserDevConsoleLog)&&e.DevConsole.log(n),n}},t}();t.AddinCommandsManifestParser=X}(e.Parser||(e.Parser={}))}(p||(p={})),function(e){var t=function(){function t(){}return t.clearSettingsByExtendedManifest=function(t){return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getSetting().then((function(n){if(n){var r=JSON.parse(n),o=t.shortcuts;if(Object.keys(r).length>0&&o){for(var i=0;i<o.length;i++){var a=e.ShortcutsMappingTableManager.getKeysFromShortcutPlatformAvailability(o[i].key),s=e.ShortcutsMappingTableManager.convertStringToKeys(a);null!=s&&(r[s.virtualKey]&&r[s.virtualKey][s.modifierKeys]&&(delete r[s.virtualKey][s.modifierKeys],0==Object.keys(r[s.virtualKey]).length&&delete r[s.virtualKey]))}return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().saveSettings(JSON.stringify(r))}}}))},t}();e.AddinShortcutsPreferenceSettingHelper=t}(p||(p={})),function(e){!function(e){e.log=function(e){c.OUtil.getBooleanSetting("DevConsoleEnabled")}}(e.DevConsole||(e.DevConsole={}))}(p||(p={})),function(e){!function(e){var t,n="Button",r="MenuItem",o=!1,a="ShowTaskpane",s=null;!function(e){var t="LongString",n="ShortString";e[e.Image=0]="Image",e[e.Url=1]="Url",e[e[n]=2]=n,e[e[t]=3]=t}(t||(t={}));var l=function(e){this.name="AddinManifestError",this.message=this.name+": "+e};function c(e,t){if(void 0!==typeof e&&e===s)throw new l(t)}function d(e,t){if(void 0!==typeof e&&e===s&&""===e)throw new l(t)}var u=function(){function e(e,t,n,r,o,i){var a=this;a.hostType=e,a.formFactor=t,a.entitlement=n,a.manifest=r,a.ribbonData=o,a.runtimeId=i,a.actions=a.parseActions(o.actions),c(a.actions,"actions is required")}return e.prototype.parseActions=function(e){for(var t={},n=0,r=e;n<r.length;n++){var o=r[n];if(o.id&&o.type){var i;switch(o.type){case a:(i=new f).parse(this,o);break;case"ExecuteFunction":(i=new m).parse(this,o);break;default:throw new l("Unknown action type")}i.runtimeId||(i.runtimeId=this.runtimeId),t[o.id]=i}}return t},e.prototype.parseIdRequired=function(e){var t=e.id?e.id:s;return d(t,"Id required"),t},e.prototype.parseLabelRequired=function(e){var t=this.parseLabel(e);return c(t,"Label required"),t},e.prototype.parseLabel=function(e){return e.label?e.label:s},e.prototype.parseSuperTipRequired=function(e){if(!e.superTip)throw new l("Supertip required");return this.parseSuperTip(e)},e.prototype.parseSuperTip=function(e){var t={title:"",description:""};return e.superTip&&(t.title=e.superTip.title?e.superTip.title:"",t.description=e.superTip.description?e.superTip.description:""),t},e.prototype.parseIconRequired=function(e){if(e.icon)return this.parseIcon(e);throw new l("Icon required")},e.prototype.parseIcon=function(e){var t={};if(e.icon)for(var n=0,r=e.icon;n<r.length;n++){var o=r[n];o.size&&o.sourceLocation&&(t[o.size]=o.sourceLocation)}return t},e.typeAttributeName="xsi:type",e}();e.ParsingContext=u;var p=function(){function e(){}return e.prototype.clone=function(){},e.prototype.buildAction=function(){},e.prototype.parse=function(e,t){d(t.type,"Action type required."),this.type=t.type},e}(),f=function(e){function t(){var t=e!==s&&e.apply(this,arguments)||this;return t.type=a,t.title=s,t.supportsPinning=o,t}return i(t,e),t.prototype.clone=function(){var e=this,n=new t;return n.id=e.id,n.type=e.type,n.controlId=e.controlId,n.runtimeId=e.runtimeId,n.title=e.title,n.sourceLocation=e.sourceLocation,n.taskpaneId=e.taskpaneId,n.supportsPinning=e.supportsPinning,n},t.prototype.buildAction=function(e){var t=this;return e.buildShowTaskpane(t.sourceLocation,t.title,t.taskpaneId,t.runtimeId)},t.prototype.parse=function(t,n){var r=this;e.prototype.parse.call(r,t,n),d(n.taskpaneId,"Taskpane ID required"),r.taskpaneId=n.taskpaneId,d(n.sourceLocation,"Source Location required"),r.sourceLocation=n.sourceLocation,c(n.title,"Title required"),r.title=n.title,n.supportPinning||(r.supportsPinning=n.supportPinning)},t}(p),m=function(e){function t(){return e!==s&&e.apply(this,arguments)||this}return i(t,e),t.prototype.clone=function(){var e=this,n=new t;return n.id=e.id,n.type=e.type,n.controlId=e.controlId,n.runtimeId=e.runtimeId,n.functionFile=e.functionFile,n.functionName=e.functionName,n},t.prototype.buildAction=function(e){var t=this;return e.buildCallFunction(t.functionFile,t.functionName,t.controlId,t.id)},t.prototype.parse=function(t,n){e.prototype.parse.call(this,t,n),this.functionFile=n.functionFile,this.functionName=n.functionName},t}(p),g=function(){function e(){}return e.prototype.parse=function(e,t){this.id=e.parseIdRequired(t),this.label=e.parseLabelRequired(t)},e}(),v=function(e){function t(){var t=e.call(this)||this;return t.enabled=!0,t}return i(t,e),t.prototype.apply=function(){},t.prototype.parse=function(t,i){var a=this;if(e.prototype.parse.call(a,t,i),a.icon=t.parseIconRequired(i),a.superTip=t.parseSuperTipRequired(i),a.enabled=!!i.enabled||o,i.type&&(a.controlType=i.type,i.type==r||i.type==n)){if(!(i.actionId&&i.actionId in t.actions))throw new l("Action is required");var s=t.actions[i.actionId].clone();s.controlId=a.id,a.actionParsed=s,a.actionType=s.type}},t}(g),h=function(e){function t(){var t=e.call(this)||this;return t.children=[],t.controlType="Menu",t}return i(t,e),t.prototype.apply=function(t,n){e.prototype.apply.call(this,t,n),t.ribbonBuilder.startBuildMenu(this);for(var r=0,o=this.children;r<o.length;r++){o[r].apply(t,n)}t.ribbonBuilder.endBuildMenu()},t.prototype.parse=function(t,n){if(e.prototype.parse.call(this,t,n),!(n.items&&n.items instanceof Array))throw new l("Menu items required.");for(var r=0,o=n.items;r<o.length;r++){var i=o[r],a=new y;a.parse(t,i),this.children.push(a)}},t}(v);e.Menu=h;var y=function(e){function t(){var t=e.call(this)||this;return t.controlType=r,t}return i(t,e),t.prototype.apply=function(t,n){var r=this;e.prototype.apply.call(r,t,n);var o=r.actionParsed.buildAction(t.actionBuilder),i={id:r.id,label:r.label,icon:r.icon,superTip:r.superTip,actionType:r.actionType,action:o,enabled:r.enabled};t.ribbonBuilder.addMenuItem(i)},t}(v),C=function(e){function t(){var t=e.call(this)||this;return t.controlType=n,t}return i(t,e),t.prototype.apply=function(t,n){var r=this;e.prototype.apply.call(r,t,n);var o=r.actionParsed.buildAction(t.actionBuilder),i={id:r.id,label:r.label,icon:r.icon,superTip:r.superTip,actionType:r.actionType,action:o,enabled:r.enabled};t.ribbonBuilder.addButton(i)},t}(v),_=function(e){function t(){var t=e!==s&&e.apply(this,arguments)||this;return t.children=[],t}return i(t,e),t.prototype.parse=function(t,r){var o=this;e.prototype.parse.call(o,t,r),o.icon=t.parseIconRequired(r);for(var i=0,a=r.controls;i<a.length;i++){var s=a[i];switch(d(s.type,"Control type required."),s.type){case n:var c=new C;c.parse(t,s),o.children.push(c);break;case"Menu":var u=new h;u.parse(t,s),o.children.push(u);break;default:throw new l("Unknown control type.")}}},t.prototype.apply=function(e,t){e.ribbonBuilder.startBuildGroup(this);for(var n=0,r=this.children;n<r.length;n++){r[n].apply(e,t)}e.ribbonBuilder.endBuildGroup()},t}(g),S=function(){function e(){var e=this;e.label=s,e.isOfficeTab=o,e.visible=!0,e.children=[],e.tabType="contextual",e.insertBefore="",e.insertAfter=""}return e.prototype.apply=function(e,t){e.ribbonBuilder.startBuildTab(this);for(var n=0,r=this.children;n<r.length;n++){r[n].apply(e,t)}e.ribbonBuilder.endBuildTab()},e.prototype.parse=function(e,t){var n=this;n.id=t.id,n.visible=t.visible||o,n.label=e.parseLabelRequired(t);for(var r=0,i=t.groups;r<i.length;r++){var a=i[r],s=new _;s.parse(e,a),n.children.push(s)}},e}(),A=function(){function e(e,t,n){this.entitlement=t,this.manifest=n,this.tabs=e}return e.prototype.cacheableResources=function(){return[]},e.prototype.apply=function(e,t){var n={entitlement:this.entitlement,manifest:this.manifest,overrides:s,startedNode:s};e.startApplyAddin(n);for(var r=0,o=this.tabs;r<o.length;r++){o[r].apply(e,t)}e.endApplyAddin()},e}(),I=function(){function e(e,t){var n=this;n.hostType=e,n.formFactor=t,n.tabs=[],n.maxTabCount=20}return e.prototype.parse=function(e,t,n,r,o){var i=[];try{var a=new u(this.hostType,this.formFactor,e,t,n,o);a.parseActions(n.actions);for(var s=0,c=n.tabs.slice(0,this.maxTabCount);s<c.length;s++){var d=c[s],p=new S;p.parse(a,d),i.push(p)}}catch(t){throw t instanceof l&&r.setErrorMessageForAddin(e.assetId,Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message),t}return new A(i,e,t)},e}();e.AddinCommandsJsonParser=I}(e.JsonParser||(e.JsonParser={}))}(p||(p={})),function(e){var t=function(){function e(){}return e.createManifestForAddinAction=function(e,t,n,r){var o=null,i=new c.Manifest.ExtensionSettings,a=(c.FormFactor.Default,{}),s=e._UILocale.toLocaleLowerCase();a[s]=n,i._defaultHeight=o,i._defaultWidth=o,i._sourceLocations={},i._sourceLocations[s]=t;var l=e;return new c.Manifest.Manifest((function(e){e._xmlProcessor=l._xmlProcessor,e._displayNames=n!=o?a:l._displayNames,e._iconUrls=l._iconUrls,e._extensionSettings={formFactor:i},e._highResolutionIconUrls=l._highResolutionIconUrls,e._target=l._target,e._id=r!=o?r:l._id,e._version=l._version,e._providerName=l._providerName,e._idIssuer=l._idIssuer,e._alternateId=l._alternateId,e._defaultLocale=l._defaultLocale,e._signature=l._signature,e._capabilities=l._capabilities,e._hosts=l._hosts,e._descriptions=l._descriptions,e._appDomains=l._appDomains,e._permissions=l._permissions,e._requirements=l._requirements,e._webApplicationResource=l._webApplicationResource,e._webApplicationId=l._webApplicationId,e._webApplicationMsaId=l._webApplicationMsaId,e._webApplicationScopes=l._webApplicationScopes,e._webApplicationAuthorizations=l._webApplicationAuthorizations,e._ribbonExtensionControls=l._ribbonExtensionControls,e._equivalentAddins=l._equivalentAddins,e._versionOverrides=l._versionOverrides}),l._UILocale)},e.cacheManifestForAction=function(e,t,n){c.OsfManifestManager.cacheManifest(t,n,e)},e.purgeManifestForAction=function(e,t){c.OsfManifestManager.purgeManifest(e,t)},e}();e.AddinCommandsManifestManager=t}(p||(p={})),function(e){var t="##UILessContainer##",n=null;e.AddinActionContextMap={},e.AutoShowTaskPaneControlIdMap={};var r,o,i={},a={};!function(e){var t="ExclusiveForNew",n="ExclusiveForCur";e[e.Default=1]="Default",e[e[n]=2]=n,e[e[t]=3]=t}(r=e.CommandInvokeMode||(e.CommandInvokeMode={})),function(e){var t="ooeOperationNotSupported",n="ooeSuccess",r="ooeTimeout";e[e[r]=-1]=r,e[e[n]=0]=n,e[e[t]=5e3]=t}(o||(o={}));var s=function(){function r(e,t,n){this.contextProvider=e,this.manifest=n,this.entitlement=t}return r.prototype.buildShowTaskpane=function(e,t,n,r){return this.CreateManifestAndActivationContextForTaskpaneCommand(e,t,n,r)},r.prototype.buildCallFunction=function(e,t,n,r){return!t&&c.OUtil.checkFlight(c.FlightNames.UseActionIdForUILessCommand)?this.CreateManifestAndActivationContextForUILessCommand(e,r,n):this.CreateManifestAndActivationContextForUILessCommand(e,t,n)},r.prototype.CreateManifestAndActivationContextForTaskpaneCommand=function(e,t,r,a){var s=function(e,t){t==o.ooeSuccess&&r!=n&&(i[r]=e)},l=function(e,t){var r=i[e];if(r==n)return!1;var o=t.getOsfControl(r);return o!=n&&(o._sharedRuntimeId==n&&o._refresh(),!0)};return this.CreateManifestAndActivationContext(e,t,r,a,(function(e,t,o,i){r!=n&&l(r,t),e.showTaskpane(o,i,s)}))},r.prototype.CreateManifestAndActivationContext=function(t,r,o,i,s){var l=this,d=e.AddinCommandsManifestManager.createManifestForAddinAction(this.manifest,t,r,n);return function(r){var u=l.contextProvider.createActionContext(r,(function(a,u){var p=l.entitlement.assetId,f={assetId:p+(o||r),appVersion:l.entitlement.appVersion,storeId:l.entitlement.storeId,storeType:c.StoreType.InMemory,targetType:c.OsfControlTarget.TaskPane};d._inMemoryEToken=l.entitlement.eToken;var m=f.assetId,g=u==n?c.ManifestHostType.Workbook:c.getManifestHostType(u._hostType),v=r;if(u!=n){var h={ownerAssetId:p,controlId:r,originalControlId:""};u._notifyHost("0",c.AgaveHostAction.GetOriginalControlId,h),h.originalControlId!=n&&(v=h.originalControlId)}var y=n;c.OUtil.checkFlight(c.FlightNames.AddinActionDefinitionHybridMode)?t!=n?y=d.getSharedRuntimeForTaskpane(g,o||v):(y=d.getSharedRuntimeById(g,i),o=d.getTaskpaneIdByRuntimeId(g,i),f.assetId=p+o):y=d.getSharedRuntimeForTaskpane(g,o||v),y!=n&&y.Resid!=n&&y.Resid.length>0&&(m=c.OsfManifestManager.getSharedRuntimeManifestCacheKey(p,y.Resid)),e.AddinCommandsManifestManager.cacheManifestForAction(d,m,f.appVersion),s(a,u,f,d,o)}));e.AddinActionContextMap[r]=u,e.AutoShowTaskPaneControlIdMap[l.entitlement.assetId]==n&&"Office.AutoShowTaskpaneWithDocument"==o&&(e.AutoShowTaskPaneControlIdMap[l.entitlement.assetId]=r),i&&(a[l.entitlement.assetId]||(a[l.entitlement.assetId]={}),a[l.entitlement.assetId][i]||(a[l.entitlement.assetId][i]=r))}},r.prototype.CreateManifestAndActivationContextForUILessCommand=function(r,i,a){var s=this,l=function(e,t){if(t==o.ooeSuccess){var n={source:{id:a}};p.invokeAppCommand(e,i,n,(function(){}))}},d=e.AddinCommandsManifestManager.createManifestForAddinAction(this.manifest,r,n,n);return function(r){var i=s.contextProvider.createActionContext(r,(function(r,i){var a=s.entitlement.assetId,u={assetId:a+t,appVersion:s.entitlement.appVersion,storeId:s.entitlement.storeId,storeType:c.StoreType.InMemory,targetType:c.OsfControlTarget.TaskPane},f=u.assetId,m=i==n?c.ManifestHostType.Workbook:c.getManifestHostType(i._hostType),g=d.getSharedRuntimeForAppCmdsExecuteFunction(m);g!=n&&g.Resid!=n&&g.Resid.length>0&&(f=c.OsfManifestManager.getSharedRuntimeManifestCacheKey(a,g.Resid)),e.AddinCommandsManifestManager.cacheManifestForAction(d,f,u.appVersion),r.createUILessSandbox(u,d,(function(e,t){if(t==o.ooeSuccess)p.ensureOsfHostEntry(e,r);l(e,t)}))}));e.AddinActionContextMap[r]=i}},r}(),l=function(){function n(e,t){this.contextProvider=e,this.entitlement=t}return n.prototype.buildShowTaskpane=function(){var t=this;return function(n){delete e.AddinActionContextMap[n],e.AddinCommandsManifestManager.purgeManifestForAction(t.entitlement.assetId+n,t.entitlement.appVersion)}},n.prototype.buildCallFunction=function(){var n=this;return function(r){delete e.AddinActionContextMap[r],e.AddinCommandsManifestManager.purgeManifestForAction(n.entitlement.assetId+t,n.entitlement.appVersion)}},n}(),d=function(){function t(){}return t.createActionBuilder=function(e,t,n){return new s(e,t,n)},t.createDeleterActionBuilder=function(e,t){return new l(e,t)},t.bindAction=function(e,t){t(e)},t.retrieveActionContext=function(t){return e.AddinActionContextMap[t]},t.retrieveAutoShowTaskPaneControlIdMap=function(){return e.AutoShowTaskPaneControlIdMap},t.getTaskPaneControlIdFromAssetIdRuntimeId=function(e,t){return a[e]?a[e][t]:n},t}();e.DefaultControlActionBinder=d;var u=function(){function e(){this.invocationQueue={}}return e.prototype.invokeAppCommand=function(t,o,i,a,s){var l=this,d={dispid:c.DDA.EventDispId.dispidAppCommandInvokedEvent,controlId:l.osfControlId};d[0]=t,d[1]=o,d[2]=JSON.stringify(i),s=s||e.defaultTimeout;var u=i&&i.commandMode?i.commandMode:r.Default,p={args:d,onComplete:a,timeout:s,timeoutTimer:n},f=l.invocationQueue[o];f==n&&(f=[],l.invocationQueue[o]=f),!(u==r.ExclusiveForCur&&f.length>0)&&!(u==r.ExclusiveForNew&&f.length>1)&&f.push(p),1==f.length&&l.trySendInvocation(p)},e.prototype.invocationCompleted=function(e,t,r){var o=this,i=o;for(var a in o.invocationQueue){var s=o.invocationQueue[a],l=s[0];if(e==l.args[0]){if(s.length>1){s.splice(0,1);var c=s[0];window.setTimeout((function(){i.trySendInvocation(c)}),0)}else delete o.invocationQueue[a];return l.timeoutTimer!=n&&(window.clearTimeout(l.timeoutTimer),l.timeoutTimer=n),void l.onComplete(t,r)}}},e.prototype.sendInvocations=function(e){var t=this;if(t.eventHandler=e,e!=n)for(var r in t.invocationQueue){var o=t.invocationQueue[r][0];t.sendInvocation(e,o)}},e.prototype.trySendInvocation=function(e){var t=this.eventHandler;t!=n&&this.sendInvocation(t,e)},e.prototype.sendInvocation=function(e,t){var n=this,r=t.args;e(r),t.timeoutTimer=window.setTimeout((function(){n.invocationTimeout(r[0])}),t.timeout)},e.prototype.invocationTimeout=function(e){this.invocationCompleted(e,o.ooeTimeout,n)},e.prototype.disposeHost=function(){var e=this;for(var t in e.invocationQueue)return;e.host.disposeHost(e.osfControlId),e.onDisposed!=n&&e.onDisposed(e)},e.defaultTimeout=3e5,e}(),p=function(){var e="targetId",t="controlId",r="eventDispId";function i(){}return i.registerEvent=function(n,o,a){i.registerEventInternal(a[r],a[t],a[e],n,(function(e){o&&o(0==e)}))},i.unregisterEvent=function(n,o,a){i.unregisterEventInternal(a[r],a[t],a[e],n,(function(e){o&&o(0==e)}))},i.invokeAppCommand=function(e,t,n,r){var o=i.getOrCreateOsfHostEntry(e),a=i.getNextAppCommandId();o.invokeAppCommand(a,t,n,r)},i.invocationCompleted=function(e,t){var r=i.getOrCreateOsfHostEntry(e),o=t[0],a=t[1],s=t[2]?JSON.parse(t[2]):n;r.invocationCompleted(o,a,s)},i.ensureOsfHostEntry=function(e,t){var r=i.getOrCreateOsfHostEntry(e);return r.host==n&&(r.host=t),r},i.getNextAppCommandId=function(){return"AppCmd"+i._nextAppCommandId++},i.getOrCreateOsfHostEntry=function(e){var t=i._invocationQueues[e];return t==n&&((t=new u).osfControlId=e,t.onDisposed=function(e){delete i._invocationQueues[e.osfControlId]},i._invocationQueues[e]=t),t},i.registerEventInternal=function(e,t,n,r,a){switch(e){case c.DDA.EventDispId.dispidAppCommandInvokedEvent:var s=i.getOrCreateOsfHostEntry(t);return a(o.ooeSuccess),void s.sendInvocations(r)}a(o.ooeOperationNotSupported)},i.unregisterEventInternal=function(e,t,r,a,s){switch(e){case c.DDA.EventDispId.dispidAppCommandInvokedEvent:var l=i.getOrCreateOsfHostEntry(t);return l.eventHandler==a&&(l.eventHandler=n),void s(o.ooeSuccess)}s(o.ooeOperationNotSupported)},i._nextAppCommandId=0,i._invocationQueues={},i}();e.AddinCommandsRuntimeManager=p}(p||(p={})),c.ShowWindowDialogParameterKeys={Url:"url",Width:"width",Height:"height",DisplayInIframe:"displayInIframe",HideTitle:"hideTitle",UseDeviceIndependentPixels:"useDeviceIndependentPixels",PromptBeforeOpen:"promptBeforeOpen",EnforceAppDomain:"enforceAppDomain",UrlNoHostInfo:"urlNoHostInfo"},c.HostThemeButtonStyleKeys={ButtonBorderColor:"buttonBorderColor",ButtonBackgroundColor:"buttonBackgroundColor"},c.OmexPageParameterKeys={AppName:"client",AppVersion:"cv",AppUILocale:"ui",AppDomain:"appDomain",StoreLocator:"rs",AssetId:"assetid",NotificationType:"notificationType",AppCorrelationId:"corr",AuthType:"authType",AppId:"appid",Scopes:"scopes"},c.AuthType={Anonymous:0,MSA:1,OrgId:2,ADAL:3},c.OmexMessageKeys={MessageType:"messageType",MessageValue:"messageValue"},c.OmexRemoveAddinMessageKeys={RemoveAddinResultCode:"resultCode",RemoveAddinResultValue:"resultValue"},c.OmexRemoveAddinResultCode={Success:0,ClientError:400,ServerError:500,UnknownError:600},function(e){!function(e){var t="undefined",n="^https://[a-z0-9-]+.(officeapps.live|officeapps-df.live|partner.officewebapps).com/";function r(e){if(typeof JSON!==t)try{return JSON.stringify(e)}catch(e){}return""}function o(){try{var e=window.navigator.userAgent;return e.indexOf("MSIE ")>-1||e.indexOf("Trident/")>-1||e.indexOf("Edge/")>-1}catch(e){return i("Error happens in isInternetExplorer.",e),!1}}function i(e,t){l.msAjaxDebug.trace(e+" Exception details: "+r(t))}e.parseAppContextFromWindowName=function(e,t){return c.OUtil.parseInfoFromWindowName(e,t,c.WindowNameItemKeys.AppContext)},e.serializeObjectToString=r,e.isHostTrusted=function(){return new RegExp(n).test(c.getClientEndPoint()._targetUrl.toLowerCase())},e.addHostInfoAsQueryParam=function(e,t){if(!e)return null;var n,r="#",o=(e=e.trim()||"").split(r),i=o.shift(),a=o.join(r),s=i.split("?");return s.length>1?n=i+"&_host_Info="+t:s.length>0&&(n=i+"?_host_Info="+t),a?[n,r,a].join(""):n},e.getDomainForUrl=function(e){if(!e)return null;var t=document.createElement("a");return t.href=e,t.protocol+"//"+t.host},e.shouldUseLocalStorageToPassMessage=function(){try{for(var e=["Windows NT 6.1","Windows NT 6.2","Windows NT 6.3","Windows NT 10.0"],t=window.navigator.userAgent,n=0,r=e.length;n<r;n++)if(t.indexOf(e[n])>-1)return o();return!1}catch(e){return i("Error happens in shouldUseLocalStorageToPassMessage.",e),!1}},e.isInternetExplorer=o,e.removeMatchesFromLocalStorage=function(e){for(var t=c.OUtil.getLocalStorage(),n=t.getKeysWithPrefix(""),r=0,o=n.length;r<o;r++)for(var i=n[r],a=0,s=e.length;a<s;a++)if(e[a].test(i)){t.removeItem(i);break}},e.logExceptionToBrowserConsole=i,e.isTeamsWebView=function(){var e=navigator.userAgent;return/Teams\/((?:(\d+)\.)?(?:(\d+)\.)?(?:(\d+)\.\d+)).* Electron\/((?:(\d+)\.)?(?:(\d+)\.)?(?:(\d+)\.\d+))/.test(e)},e.getHostSecure=function(e){if(typeof e!==t&&e){var n=void 0,r="https:";try{var o=new URL(e);if(o&&(n=o.host),!o.protocol)throw"fallback";if(o.protocol!==r)return}catch(t){try{var i=document.createElement("a");if(i.href=e,i.protocol!==r)return;var a=e.match(new RegExp("^https://[^/?#]+","i")),s=a&&1==a.length?a[0].toLowerCase():"",l=(i.protocol+"//"+i.hostname).toLowerCase();(i.protocol+"//"+i.host).toLowerCase()!==s&&l!=s||(n="443"==i.port?i.hostname:i.host)}catch(e){return}}return n?n.toLowerCase():void 0}};var a=function(){function e(){}return e.GatedCacheKeyPrefix="__OSF_GATED_OMEX.",e.AnonymousCacheKeyPrefix="__OSF_ANONYMOUS_OMEX.",e.UngatedCacheKeyPrefix="__OSF_OMEX.",e.ActivatedCacheKeyPrefix="__OSF_RUNTIME_.Activated.",e.AppinstallAuthenticated="appinstall_authenticated.",e.Entitlement="entitle.",e.AppState="appState.",e.AppDetails="appDetails.",e.AppInstallInfo="appInstallInfo.",e.AuthenticatedAppInstallInfoCacheKey=e.GatedCacheKeyPrefix+e.AppinstallAuthenticated+"{0}.{1}.{2}.{3}",e.EntitlementsKey=e.Entitlement+"{0}.{1}",e.AppStateCacheKey="{0}"+e.AppState+"{1}.{2}",e.AppDetailKey="{0}"+e.AppDetails+"{1}",e.AppInstallInfoKey="{0}"+e.AppInstallInfo+"{1}.{2}",e.ActivatedCacheKey=e.ActivatedCacheKeyPrefix+"{0}.{1}.{2}",e}();e.CacheConstants=a}(e.WACUtils||(e.WACUtils={}))}(p||(p={})),c.XmlConstants={MaxXmlSize:1048576,MaxElementDepth:64},c.Xpath3Provider=function(e,t){var n=this;n._xmldoc=(new DOMParser).parseFromString(e,"text/xml"),n._evaluator=new XPathEvaluator,n._namespaceMapping={},n._defaultNamespace=null;for(var r,o=t.split(" "),i=0;i<o.length;++i)(r=/xmlns="([^"]*)"/g.exec(o[i]))?n._defaultNamespace=r[1]:(r=/xmlns:([^=]*)="([^"]*)"/g.exec(o[i]))&&(n._namespaceMapping[r[1]]=r[2]);n._resolver=n},c.Xpath3Provider.prototype={lookupNamespaceURI:function(e){return this._namespaceMapping[e]||this._defaultNamespace},addNamespaceMapping:function(e,t){return!this._namespaceMapping[e]&&(this._namespaceMapping[e]=t,!0)},selectSingleNode:function(e,t){var n=(t?"./":"/")+e;t=t||this.getDocumentElement();var r=this._evaluator.evaluate(n,t,this._resolver,XPathResult.FIRST_ORDERED_NODE_TYPE,null);return r?r.singleNodeValue:null},selectNodes:function(e,t){var n=(t?"./":"/")+e;t=t||this.getDocumentElement();var r=this._evaluator.evaluate(n,t,this._resolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),o=[];if(r)for(var i=r.iterateNext();i;)o.push(i),i=r.iterateNext();return o},selectNodesByXPath:function(e,t){var n=this._evaluator.evaluate(e,t,this._resolver,XPathResult.ORDERED_NODE_ITERATOR_TYPE,null),r=[];if(n)for(var o=n.iterateNext();o;)r.push(o),o=n.iterateNext();return r},getDocumentElement:function(){return this._xmldoc.documentElement}},c.IEXpathProvider=function(e,t){for(var n=null,r=["MSXML2.DOMDocument.6.0"],o=0;o<r.length;o++)try{(n=new ActiveXObject(r[o])).setProperty("ResolveExternals",!1),n.setProperty("ValidateOnParse",!1),n.setProperty("ProhibitDTD",!0),n.setProperty("MaxXMLSize",c.XmlConstants.MaxXmlSize),n.setProperty("MaxElementDepth",c.XmlConstants.MaxElementDepth),n.async=!1,n.loadXML(e),n.setProperty("SelectionLanguage","XPath"),n.setProperty("SelectionNamespaces",t);break}catch(e){l.msAjaxDebug.trace("xml doc creating error:"+e)}this._xmldoc=n},c.IEXpathProvider.prototype={selectSingleNode:function(e,t){var n=(t?"./":"/")+e;return(t=t||this.getDocumentElement()).selectSingleNode(n)},addNamespaceMapping:function(e,t){var n="SelectionNamespaces",r=this._xmldoc.getProperty(n),o="xmlns:"+e+"=",i="xmlns:"+e+'="'+t+'"';return-1==r.indexOf(o)&&(r=r+" "+i,this._xmldoc.setProperty(n,r),!0)},selectNodes:function(e,t){var n=(t?"./":"/")+e;return(t=t||this.getDocumentElement()).selectNodes(n)},selectNodesByXPath:function(e,t){return t.selectNodes(e)},getDocumentElement:function(){return this._xmldoc.documentElement},getActiveXObject:function(){return this._xmldoc}},c.DomParserProvider=function(e,t){var n=this;try{n._xmldoc=(new DOMParser).parseFromString(e,"text/xml")}catch(e){Sys.Debug.trace("xml doc creating error:"+e)}n._namespaceMapping={},n._defaultNamespace=null;for(var r,o=t.split(" "),i=0;i<o.length;++i)(r=/xmlns="([^"]*)"/g.exec(o[i]))?n._defaultNamespace=r[1]:(r=/xmlns:([^=]*)="([^"]*)"/g.exec(o[i]))&&(n._namespaceMapping[r[1]]=r[2])},c.DomParserProvider.prototype={addNamespaceMapping:function(e,t){return!this._namespaceMapping[e]&&(this._namespaceMapping[e]=t,!0)},selectSingleNode:function(e,t){var n=t||this._xmldoc,r=this._selectNodes(e,n);return 0===r.length?null:r[0]},selectNodes:function(e,t){var n=t||this._xmldoc;return this._selectNodes(e,n)},selectNodesByXPath:function(){return null},_selectNodes:function(e,t){var n=[];if(!e)return n;var r,o,i=e.split(":");if(1===i.length)r=null,o=i[0];else{if(2!==i.length)throw l.msAjaxError.argument("name");r=this._namespaceMapping[i[0]],o=i[1]}if(!t.hasChildNodes)return n;for(var a=t.childNodes,s=0;s<a.length;s++)o===this._removeNodePrefix(a[s].nodeName)&&r===a[s].namespaceURI&&n.push(a[s]);return n},_removeNodePrefix:function(e){var t=e.split(":");return 1===t.length?e:t[1]},getDocumentElement:function(){return this._xmldoc.documentElement}},c.XmlProcessor=function(e,t){var n=this,r=Function._validateParams(arguments,[{name:"xml",type:String,mayBeNull:!1},{name:"xmlNamespaces",type:String,mayBeNull:!1}]);if(r)throw r;document.implementation&&document.implementation.hasFeature("XPath","3.0")?n._provider=new c.Xpath3Provider(e,t):(n._provider=new c.IEXpathProvider(e,t),n._provider.getActiveXObject()||(n._provider=new c.DomParserProvider(e,t)))},c.XmlProcessor.prototype={addNamespaceMapping:function(e,t){var n=Function._validateParams(arguments,[{name:"namespacePrefix",type:String,mayBeNull:!1},{name:"namespaceUri",type:String,mayBeNull:!1}]);if(n)throw n;return this._provider.addNamespaceMapping(e,t)},selectSingleNode:function(e,t){var n=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1},{name:"contextNode",mayBeNull:!0,optional:!0}]);if(n)throw n;return this._provider.selectSingleNode(e,t)},selectNodes:function(e,t){var n=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1},{name:"contextNode",mayBeNull:!0,optional:!0}]);if(n)throw n;return this._provider.selectNodes(e,t)},selectNodesByXPath:function(e,t){var n=Function._validateParams(arguments,[{name:"xpath",type:String,mayBeNull:!1},{name:"contextNode",mayBeNull:!0,optional:!0}]);if(n)throw n;return t=t||this._provider.getDocumentElement(),this._provider.selectNodesByXPath(e,t)},getDocumentElement:function(){return this._provider.getDocumentElement()},getNodeValue:function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return e.text?e.text:e.textContent},getNodeText:function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return 9==this.getNodeType(e)?this.getNodeText(this.getDocumentElement()):e.text?e.text:e.textContent},setNodeText:function(e,t){var n=!1,r=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:n},{name:"text",type:String,mayBeNull:n}]);if(r)throw r;if(9==this.getNodeType(e))return n;try{e.text?e.text=t:e.textContent=t}catch(e){return n}return!0},getNodeXml:function(e){var t,n=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(n)throw n;return e.xml?t=e.xml:(t=(new XMLSerializer).serializeToString(e),2==this.getNodeType(e)&&(t=this.getNodeBaseName(e)+'="'+t+'"')),t},setNodeXml:function(e,t){var n=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1},{name:"xml",type:String,mayBeNull:!1}]);if(n)throw n;var r=new c.XmlProcessor(t,"");if(!r.isValidXml())return null;var o=r.getDocumentElement();try{e.parentNode.replaceChild(o,e)}catch(e){return null}return o},getNodeNamespaceURI:function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return e.namespaceURI},getNodePrefix:function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return e.prefix},getNodeBaseName:function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return!e.nodeType||1!=e.nodeType&&2!=e.nodeType?e.nodeName:e.baseName?e.baseName:e.localName},getNodeType:function(e){var t=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1}]);if(t)throw t;return e.nodeType},appendChild:function(e,t){var n=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1},{name:"childXml",type:String,mayBeNull:!1}]);if(n)throw n;var r=new c.XmlProcessor(t,"");if(!r.isValidXml())return null;var o=r.getDocumentElement();return e.appendChild(o),o},_getAttributeLocalName:function(e){return e.localName?e.localName:e.baseName},readAttributes:function(e,t,n){var r=Function._validateParams(arguments,[{name:"node",type:Object,mayBeNull:!1},{name:"attributesToRead",type:Object,mayBeNull:!1},{name:"objectToFill",type:Object,mayBeNull:!1}]);if(r)throw r;for(var o,i,a=0;a<e.attributes.length;a++)for(var s in o=e.attributes[a],i=this._getAttributeLocalName(o),t)i===s&&(n[t[s]]=o.value)},isValidXml:function(){var e="parsererror";if(null==this.getDocumentElement())return!1;if(this._provider._xmldoc.getElementsByTagName(e).length>0){var t=(new DOMParser).parseFromString("<","text/xml").getElementsByTagName(e)[0].namespaceURI;return this._provider._xmldoc.getElementsByTagNameNS(t,e).length<=0}return!0}},function(e){var t=function(){function e(){}return e.prototype.Serialize=function(e){try{return JSON.stringify(e)}catch(e){return null}},e.prototype.Deserialize=function(e){try{return JSON.parse(e)}catch(e){return null}},e}();e.SafeSerializer=t;var n=function(){function e(e,t){this._localStorage=e,this._serializer=t}return e.prototype.GetCacheItem=function(t,n,r,o,i){var a="cacheExpired",s=this;void 0===n&&(n=!0),void 0===i&&(i=!0),s.ValidateCurrentCache();var l=s._localStorage.getItem(t);if(l){var c=s._serializer.Deserialize(l);if(void 0!==o&&o>0&&o-c.createdOn>0)s._localStorage.removeItem(t),r&&(r[a]=!0);else{if(!n)return c.data;var d=new Date;if(Math.abs(d.getTime()-c.createdOn)<e.msPerDay*c.refreshRate)return c.data;i&&(s._localStorage.removeItem(t),r&&(r[a]=!0))}}},e.prototype.SetCacheItem=function(t,n,r){r=r||e.defaultRefreshRateInDays;var o={data:n,createdOn:(new Date).getTime(),refreshRate:r};this._localStorage.setItem(t,this._serializer.Serialize(o))},e.prototype.RemoveCacheItem=function(e){this._localStorage.removeItem(e)},e.prototype.RemoveAll=function(e){for(var t=this._localStorage.getKeysWithPrefix(e),n=0,r=t.length;n<r;n++)this._localStorage.removeItem(t[n])},e.prototype.RemoveMatches=function(e){for(var t=this._localStorage.getKeysWithPrefix(""),n=0,r=t.length;n<r;n++)for(var o=t[n],i=0,a=e.length;i<a;i++)if(e[i].test(o)){this._localStorage.removeItem(o);break}},e.prototype.ValidateCurrentCache=function(){this._localStorage.getItem(e.cacheVersionKey)!=e.currentSchemaVersion&&(this.RemoveMatches([new RegExp("__OSF_(?!.*activated).*$","i")]),this._localStorage.setItem(e.cacheVersionKey,e.currentSchemaVersion))},e.defaultRefreshRateInDays=3,e.msPerDay=864e5,e.currentSchemaVersion="1",e.checkedCache=!1,e.cacheVersionKey="osfCacheVersion",e}();e.AppsDataCacheManager=n;var r=function(e){function t(t,n){return e.call(this,t,n)||this}return i(t,e),t.prototype.GetRefreshToken=function(n,r){var o=c.OUtil.formatString(t._refreshTokenCacheKey,n,r);return e.prototype.GetCacheItem.call(this,o)},t.prototype.AddRefreshToken=function(n,r,o){var i=c.OUtil.formatString(t._refreshTokenCacheKey,r,o);e.prototype.SetCacheItem.call(this,i,n)},t.prototype.RemoveAll=function(){e.prototype.RemoveAll.call(this,t._refreshTokenCachePrefixKey)},t.prototype.RemoveRefreshToken=function(n,r){var o=c.OUtil.formatString(t._refreshTokenCacheKey,n,r);e.prototype.RemoveCacheItem.call(this,o)},t._refreshTokenCacheKey="_OSF_PRIVATECATALOG_REFRESHTOKEN_{0}_{1}",t._refreshTokenCachePrefixKey="_OSF_PRIVATECATALOG_REFRESHTOKEN",t}(n);e.TokenCacheManager=r}(p||(p={})),function(e){var t="Error",n="ResponseTime",r="Result",o="OperationMetadata",a="ErrorResult",s="AssetId",l="CorrelationId",c=!0,d=function(){function e(e){this._table=e,this._fields={}}return Object.defineProperty(e.prototype,"Fields",{get:function(){return this._fields},enumerable:c,configurable:c}),Object.defineProperty(e.prototype,"Table",{get:function(){return this._table},enumerable:c,configurable:c}),e.prototype.SerializeFields=function(){},e.prototype.SetSerializedField=function(e,t){null!=t&&(this._serializedFields[e]=t.toString())},e.prototype.SerializeRow=function(){var e=this;return e._serializedFields={},e.SetSerializedField("Table",e._table),e.SerializeFields(),JSON.stringify(e._serializedFields)},e}();e.BaseUsageData=d;var u=function(e){var t="Stage11Time",n="Stage10Time",r="Stage9Time",o="Stage8Time",d="Stage7Time",u="Stage6Time",p="Stage5Time",f="Stage4Time",m="Stage3Time",g="Stage2Time",v="Stage1Time",h="InstanceId",y="ActivationInfo",C="AppInfo";function _(){return e.call(this,"AppLoadTime")||this}return i(_,e),Object.defineProperty(_.prototype,l,{get:function(){return this.Fields[l]},set:function(e){this.Fields[l]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,C,{get:function(){return this.Fields[C]},set:function(e){this.Fields[C]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,y,{get:function(){return this.Fields[y]},set:function(e){this.Fields[y]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,h,{get:function(){return this.Fields[h]},set:function(e){this.Fields[h]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,s,{get:function(){return this.Fields[s]},set:function(e){this.Fields[s]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,v,{get:function(){return this.Fields[v]},set:function(e){this.Fields[v]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,g,{get:function(){return this.Fields[g]},set:function(e){this.Fields[g]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,m,{get:function(){return this.Fields[m]},set:function(e){this.Fields[m]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,f,{get:function(){return this.Fields[f]},set:function(e){this.Fields[f]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,p,{get:function(){return this.Fields[p]},set:function(e){this.Fields[p]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,u,{get:function(){return this.Fields[u]},set:function(e){this.Fields[u]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,d,{get:function(){return this.Fields[d]},set:function(e){this.Fields[d]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,o,{get:function(){return this.Fields[o]},set:function(e){this.Fields[o]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,r,{get:function(){return this.Fields[r]},set:function(e){this.Fields[r]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,n,{get:function(){return this.Fields[n]},set:function(e){this.Fields[n]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,t,{get:function(){return this.Fields[t]},set:function(e){this.Fields[t]=e},enumerable:c,configurable:c}),Object.defineProperty(_.prototype,a,{get:function(){return this.Fields[a]},set:function(e){this.Fields[a]=e},enumerable:c,configurable:c}),_.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(l,e.CorrelationId),e.SetSerializedField(C,e.AppInfo),e.SetSerializedField(y,e.ActivationInfo),e.SetSerializedField(h,e.InstanceId),e.SetSerializedField(s,e.AssetId),e.SetSerializedField(v,e.Stage1Time),e.SetSerializedField(g,e.Stage2Time),e.SetSerializedField(m,e.Stage3Time),e.SetSerializedField(f,e.Stage4Time),e.SetSerializedField(p,e.Stage5Time),e.SetSerializedField(u,e.Stage6Time),e.SetSerializedField(d,e.Stage7Time),e.SetSerializedField(o,e.Stage8Time),e.SetSerializedField(r,e.Stage9Time),e.SetSerializedField(n,e.Stage10Time),e.SetSerializedField(t,e.Stage11Time),e.SetSerializedField(a,e.ErrorResult)},_}(d);e.AppLoadTimeUsageData=u;var p=function(e){var t="NotificationClickInfo";function n(){return e.call(this,"AppNotification")||this}return i(n,e),Object.defineProperty(n.prototype,l,{get:function(){return this.Fields[l]},set:function(e){this.Fields[l]=e},enumerable:c,configurable:c}),Object.defineProperty(n.prototype,a,{get:function(){return this.Fields[a]},set:function(e){this.Fields[a]=e},enumerable:c,configurable:c}),Object.defineProperty(n.prototype,t,{get:function(){return this.Fields[t]},set:function(e){this.Fields[t]=e},enumerable:c,configurable:c}),n.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(l,e.CorrelationId),e.SetSerializedField(a,e.ErrorResult),e.SetSerializedField(t,e.NotificationClickInfo)},n}(d);e.AppNotificationUsageData=p;var f=function(e){function t(){return e.call(this,"AppManagementMenu")||this}return i(t,e),Object.defineProperty(t.prototype,s,{get:function(){return this.Fields[s]},set:function(e){this.Fields[s]=e},enumerable:c,configurable:c}),Object.defineProperty(t.prototype,o,{get:function(){return this.Fields[o]},set:function(e){this.Fields[o]=e},enumerable:c,configurable:c}),Object.defineProperty(t.prototype,a,{get:function(){return this.Fields[a]},set:function(e){this.Fields[a]=e},enumerable:c,configurable:c}),t.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(s,e.AssetId),e.SetSerializedField(o,e.OperationMetadata),e.SetSerializedField(a,e.ErrorResult)},t}(d);e.AppManagementMenuUsageData=f;var m=function(e){var t="LastActiveTabCount",n="LastActiveTab",r="DialogState",o="TrustPageSessionTime",a="TotalSessionTime";function l(){return e.call(this,"InsertionDialogSession")||this}return i(l,e),Object.defineProperty(l.prototype,s,{get:function(){return this.Fields[s]},set:function(e){this.Fields[s]=e},enumerable:c,configurable:c}),Object.defineProperty(l.prototype,a,{get:function(){return this.Fields[a]},set:function(e){this.Fields[a]=e},enumerable:c,configurable:c}),Object.defineProperty(l.prototype,o,{get:function(){return this.Fields[o]},set:function(e){this.Fields[o]=e},enumerable:c,configurable:c}),Object.defineProperty(l.prototype,r,{get:function(){return this.Fields[r]},set:function(e){this.Fields[r]=e},enumerable:c,configurable:c}),Object.defineProperty(l.prototype,n,{get:function(){return this.Fields[n]},set:function(e){this.Fields[n]=e},enumerable:c,configurable:c}),Object.defineProperty(l.prototype,t,{get:function(){return this.Fields[t]},set:function(e){this.Fields[t]=e},enumerable:c,configurable:c}),l.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(s,e.AssetId),e.SetSerializedField(a,e.TotalSessionTime),e.SetSerializedField(o,e.TrustPageSessionTime),e.SetSerializedField(r,e.DialogState),e.SetSerializedField(n,e.LastActiveTab),e.SetSerializedField(t,e.LastActiveTabCount)},l}(d);e.InsertionDialogSessionUsageData=m;var g=function(e){function t(){return e.call(this,"UploadFileDevCatelog")||this}return i(t,e),Object.defineProperty(t.prototype,l,{get:function(){return this.Fields[l]},set:function(e){this.Fields[l]=e},enumerable:c,configurable:c}),Object.defineProperty(t.prototype,o,{get:function(){return this.Fields[o]},set:function(e){this.Fields[o]=e},enumerable:c,configurable:c}),Object.defineProperty(t.prototype,a,{get:function(){return this.Fields[a]},set:function(e){this.Fields[a]=e},enumerable:c,configurable:c}),t.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(l,e.CorrelationId),e.SetSerializedField(o,e.OperationMetadata),e.SetSerializedField(a,e.ErrorResult)},t}(d);e.UploadFileDevCatelogUsageData=g;var v=function(e){var t="AppSizeHeight",n="AppSizeWidth",r="IsAppCommand",o="AppTargetType",a="AppVersion",s="AppId",d="StoreType";function u(){return e.call(this,"UploadFileDevCatalogUsage")||this}return i(u,e),Object.defineProperty(u.prototype,l,{get:function(){return this.Fields[l]},set:function(e){this.Fields[l]=e},enumerable:c,configurable:c}),Object.defineProperty(u.prototype,d,{get:function(){return this.Fields[d]},set:function(e){this.Fields[d]=e},enumerable:c,configurable:c}),Object.defineProperty(u.prototype,s,{get:function(){return this.Fields[s]},set:function(e){this.Fields[s]=e},enumerable:c,configurable:c}),Object.defineProperty(u.prototype,a,{get:function(){return this.Fields[a]},set:function(e){this.Fields[a]=e},enumerable:c,configurable:c}),Object.defineProperty(u.prototype,o,{get:function(){return this.Fields[o]},set:function(e){this.Fields[o]=e},enumerable:c,configurable:c}),Object.defineProperty(u.prototype,r,{get:function(){return this.Fields[r]},set:function(e){this.Fields[r]=e},enumerable:c,configurable:c}),Object.defineProperty(u.prototype,n,{get:function(){return this.Fields[n]},set:function(e){this.Fields[n]=e},enumerable:c,configurable:c}),Object.defineProperty(u.prototype,t,{get:function(){return this.Fields[t]},set:function(e){this.Fields[t]=e},enumerable:c,configurable:c}),u.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(l,e.CorrelationId),e.SetSerializedField(d,e.StoreType),e.SetSerializedField(s,e.AppId),e.SetSerializedField(a,e.AppVersion),e.SetSerializedField(o,e.AppTargetType),e.SetSerializedField(r,e.IsAppCommand),e.SetSerializedField(n,e.AppSizeWidth),e.SetSerializedField(t,e.AppSizeHeight)},u}(d);e.UploadFileDevCatalogUsageUsageData=v;var h=function(e){function o(){return e.call(this,"OneDriveCatalogGetAccessToken")||this}return i(o,e),Object.defineProperty(o.prototype,r,{get:function(){return this.Fields[r]},set:function(e){this.Fields[r]=e},enumerable:c,configurable:c}),Object.defineProperty(o.prototype,n,{get:function(){return this.Fields[n]},set:function(e){this.Fields[n]=e},enumerable:c,configurable:c}),Object.defineProperty(o.prototype,t,{get:function(){return this.Fields[t]},set:function(e){this.Fields[t]=e},enumerable:c,configurable:c}),o.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(r,e.Result),e.SetSerializedField(n,e.ResponseTime),e.SetSerializedField(t,e.Error)},o}(d);e.OneDriveCatalogGetAccessTokenUsageData=h;var y=function(e){function o(){return e.call(this,"OneDriveCatalogGetManifests")||this}return i(o,e),Object.defineProperty(o.prototype,r,{get:function(){return this.Fields[r]},set:function(e){this.Fields[r]=e},enumerable:c,configurable:c}),Object.defineProperty(o.prototype,n,{get:function(){return this.Fields[n]},set:function(e){this.Fields[n]=e},enumerable:c,configurable:c}),Object.defineProperty(o.prototype,t,{get:function(){return this.Fields[t]},set:function(e){this.Fields[t]=e},enumerable:c,configurable:c}),o.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(r,e.Result),e.SetSerializedField(n,e.ResponseTime),e.SetSerializedField(t,e.Error)},o}(d);e.OneDriveCatalogGetManifestsUsageData=y;var C=function(e){var o="id";function a(){return e.call(this,"OneDriveCatalogGetManifest")||this}return i(a,e),Object.defineProperty(a.prototype,o,{get:function(){return this.Fields.id},set:function(e){this.Fields.id=e},enumerable:c,configurable:c}),Object.defineProperty(a.prototype,r,{get:function(){return this.Fields[r]},set:function(e){this.Fields[r]=e},enumerable:c,configurable:c}),Object.defineProperty(a.prototype,n,{get:function(){return this.Fields[n]},set:function(e){this.Fields[n]=e},enumerable:c,configurable:c}),Object.defineProperty(a.prototype,t,{get:function(){return this.Fields[t]},set:function(e){this.Fields[t]=e},enumerable:c,configurable:c}),a.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(o,e.id),e.SetSerializedField(r,e.Result),e.SetSerializedField(n,e.ResponseTime),e.SetSerializedField(t,e.Error)},a}(d);e.OneDriveCatalogGetManifestUsageData=C;var _=function(e){function o(){return e.call(this,"OneDriveCatalogInsertManifest")||this}return i(o,e),Object.defineProperty(o.prototype,r,{get:function(){return this.Fields[r]},set:function(e){this.Fields[r]=e},enumerable:c,configurable:c}),Object.defineProperty(o.prototype,n,{get:function(){return this.Fields[n]},set:function(e){this.Fields[n]=e},enumerable:c,configurable:c}),Object.defineProperty(o.prototype,t,{get:function(){return this.Fields[t]},set:function(e){this.Fields[t]=e},enumerable:c,configurable:c}),o.prototype.SerializeFields=function(){var e=this;e.SetSerializedField(r,e.Result),e.SetSerializedField(n,e.ResponseTime),e.SetSerializedField(t,e.Error)},o}(d);e.OneDriveCatalogInsertManifestUsageData=_}(a||(a={})),function(e){var t,n,r,o,i=null,s="wa",l=!0,d=!1;!function(e){var t="verboseEx",n="unexpected";e[e[n]=10]=n,e[e.warning=15]="warning",e[e.info=50]="info",e[e.verbose=100]="verbose",e[e[t]=200]=t}(t=e.ULSTraceLevel||(e.ULSTraceLevel={})),function(e){var t="msoulscat_Osf_UploadFileDevCatalogUsage",n="msoulscat_Osf_UploadFileDevCatelog",r="msoulscat_Osf_InsertionDialogSession",o="msoulscat_Osf_AppManagementMenu",i="msoulscat_Osf_Runtime",a="msoulscat_Osf_Notification",s="msoulscat_Osf_Latency";e[e[s]=1401]=s,e[e[a]=1402]=a,e[e[i]=1403]=i,e[e[o]=1404]=o,e[e[r]=1405]=r,e[e[n]=1406]=n,e[e[t]=1411]=t}(n=e.ULSCat||(e.ULSCat={})),function(e){var t="IsAnonymous",n="InsertionDialogClosed",r="ConfirmationDialogCancel";e[e[r]=256]=r,e[e[n]=512]=n,e[e[t]=1024]=t}(r||(r={})),function(e){var t="TrustPageVisited",n="Canceled",r="Inserted",o="Undefined";e[e[o]=0]=o,e[e[r]=1]=r,e[e[n]=2]=n,e[e.Closed=3]="Closed",e[e[t]=8]=t}(o||(o={}));var u=function(){function e(){this.timeValue=0}return e.prototype.Start=function(){this.timeValue=-(new Date).getTime(),this.finishedMeasurement=d},e.prototype.Stop=function(){this.timeValue<0&&(this.timeValue+=(new Date).getTime(),this.finishedMeasurement=l)},Object.defineProperty(e.prototype,"Finished",{get:function(){return this.finishedMeasurement},enumerable:l,configurable:l}),Object.defineProperty(e.prototype,"ElapsedTime",{get:function(){var e=this.timeValue;return!this.Finished&&e<0&&(e=Math.abs(e)-(new Date).getTime()),e},enumerable:l,configurable:l}),e}();e.LatencyStopwatch=u;var p=function(){};e.Context=p;var f=function(){function e(){}return e.SendULSTraceTag=function(e,t,n,r){Microsoft.Office.WebExtension.FULSSupported&&Diag.UULS.trace(r,e,t,n)},e}(),m=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){f.SendULSTraceTag(e.category,e.level,t.SerializeRow(),6062431)},e.category=n.msoulscat_Osf_Notification,e.level=t.info,e}();e.NotificationLogger=m;var g=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){f.SendULSTraceTag(e.category,e.level,t.SerializeRow(),17085957)},e.category=n.msoulscat_Osf_AppManagementMenu,e.level=t.info,e}();e.AppManagementMenuLogger=g;var v=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){f.SendULSTraceTag(e.category,e.level,t.SerializeRow(),17085958)},e.category=n.msoulscat_Osf_UploadFileDevCatelog,e.level=t.info,e}();e.UploadFileDevCatelogLogger=v;var h=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){f.SendULSTraceTag(e.category,e.level,t.SerializeRow(),17834653)},e.category=n.msoulscat_Osf_UploadFileDevCatalogUsage,e.level=t.info,e}();e.UploadFileDevCatalogUsageLogger=h;var y=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){f.SendULSTraceTag(e.category,e.level,t.SerializeRow(),4748055)},e.category=n.msoulscat_Osf_Latency,e.level=t.info,e}();e.LatencyLogger=y;var C=function(){function e(){}return e.Instance=function(){return e.instance||(e.instance=new e),e.instance},e.prototype.LogData=function(t){f.SendULSTraceTag(e.category,e.level,t.SerializeRow(),17085959)},e.category=n.msoulscat_Osf_InsertionDialogSession,e.level=t.info,e}();e.InsertionDialogSessionLogger=C;var _=function(){function e(){}return e.LogNotification=function(e,t,n){var r=new a.AppNotificationUsageData;r.CorrelationId=e,r.ErrorResult=t,r.NotificationClickInfo=n,m.Instance().LogData(r)},e}();e.AppNotificationHelper=_;var S=function(){function e(){}return e.LogAppManagementMenuAction=function(e,t,n,o,i,l){var c=new a.AppManagementMenuUsageData,d=0===e.toLowerCase().indexOf(s)?parseInt(e.substring(2),10):parseInt(e,10);o&&(t|=r.InsertionDialogClosed),i&&(t|=r.IsAnonymous),c.AssetId=d,c.OperationMetadata=t,c.ErrorResult=l,g.Instance().LogData(c)},e}();e.AppManagementMenuHelper=S;var A=function(){function e(){}return e.LogUploadFileDevCatelogAction=function(e,t,n,r,o,i){var s=new a.UploadFileDevCatelogUsageData;s.CorrelationId=e,s.OperationMetadata=t,s.ErrorResult=i,v.Instance().LogData(s)},e}();e.UploadFileDevCatelogHelper=A;var I=function(){function e(){}return e.LogUploadFileDevCatalogUsageAction=function(e,t,n,r,o,i,s,l){var c=new a.UploadFileDevCatalogUsageUsageData;c.CorrelationId=e,c.StoreType=t,c.AppId=n,c.AppVersion=r,c.AppTargetType=o,c.IsAppCommand=i,c.AppSizeWidth=s,c.AppSizeHeight=l,h.Instance().LogData(c)},e}();e.UploadFileDevCatalogUsageHelper=I;var T=function(){var e="Stage11Time",r="Stage10Time",o="Stage9Time",s="Stage8Time",l="Stage7Time",c="Stage5Time",d="Stage4Time",p="Stage2Time",m="Stage1Time";function g(){}return g.GenerateActivationMessage=function(e,t){var n="";return e!=i&&(n+="ActivationRuntimeType: "+e.toString()+"|"),t!=i&&(n+="CorrelationId: "+t),n},g.ActivationStart=function(i,v,h,y,C,_){g.activatingNumber++,i.LoadTime=new a.AppLoadTimeUsageData,i.Timers={},i.LoadTime.CorrelationId=y,i.LoadTime.AppInfo=v,i.LoadTime.ActivationInfo=0,i.LoadTime.InstanceId=C,i.LoadTime.AssetId=h,i.LoadTime.Stage1Time=0,i.Timers[m]=new u,i.LoadTime.Stage2Time=0,i.Timers[p]=new u,i.LoadTime.Stage3Time=0,i.LoadTime.Stage4Time=0,i.Timers[d]=new u,i.LoadTime.Stage5Time=0,i.Timers[c]=new u,i.LoadTime.Stage6Time=g.activatingNumber,i.LoadTime.Stage7Time=0,i.Timers[l]=new u,i.LoadTime.Stage8Time=0,i.Timers[s]=new u,i.LoadTime.Stage9Time=0,i.Timers[o]=new u,i.LoadTime.Stage10Time=0,i.Timers[r]=new u,i.LoadTime.Stage11Time=0,i.Timers[e]=new u,i.LoadTime.ErrorResult=0,i.ActivationRuntimeType=_,g.StartStopwatch(i,m),f.SendULSTraceTag(n.msoulscat_Osf_Runtime,t.info,g.GenerateActivationMessage(_,y),19515419)},g.ActivationEnd=function(e){g.ActivateEndInternal(e)},g.PageStart=function(e){g.StartStopwatch(e,p)},g.PageLoaded=function(e){g.StopStopwatch(e,p)},g.ServerCallStart=function(e){g.StartStopwatch(e,d)},g.ServerCallEnd=function(e){g.StopStopwatch(e,d)},g.AuthenticationStart=function(e){g.StartStopwatch(e,c)},g.AuthenticationEnd=function(e){g.StopStopwatch(e,c)},g.EntitlementCheckStart=function(e){g.StartStopwatch(e,l)},g.EntitlementCheckEnd=function(e){g.StopStopwatch(e,l)},g.KilledAppsCheckStart=function(e){g.StartStopwatch(e,s)},g.KilledAppsCheckEnd=function(e){g.StopStopwatch(e,s)},g.AppStateCheckStart=function(e){g.StartStopwatch(e,o)},g.AppStateCheckEnd=function(e){g.StopStopwatch(e,o)},g.ManifestRequestStart=function(e){g.StartStopwatch(e,r)},g.ManifestRequestEnd=function(e){g.StopStopwatch(e,r)},g.OfficeJSStartToLoad=function(t){g.StartStopwatch(t,e)},g.OfficeJSLoaded=function(t){g.StopStopwatch(t,e)},g.SetAnonymousFlag=function(e,t){g.SetActivationInfoField(e,g.ConvertFlagToBit(t),2,0)},g.SetRetryCount=function(e,t){g.SetActivationInfoField(e,t,3,2)},g.SetManifestTrustCachedFlag=function(e,t){g.SetActivationInfoField(e,g.ConvertFlagToBit(t),2,5)},g.SetManifestDataCachedFlag=function(e,t){g.SetActivationInfoField(e,g.ConvertFlagToBit(t),2,7)},g.SetOmexHasEntitlementFlag=function(e,t){g.SetActivationInfoField(e,g.ConvertFlagToBit(t),2,9)},g.SetManifestDataInvalidFlag=function(e,t){g.SetActivationInfoField(e,g.ConvertFlagToBit(t),2,11)},g.SetAppStateDataCachedFlag=function(e,t){g.SetActivationInfoField(e,g.ConvertFlagToBit(t),2,13)},g.SetAppStateDataInvalidFlag=function(e,t){g.SetActivationInfoField(e,g.ConvertFlagToBit(t),2,15)},g.SetActivationRuntimeType=function(e,t){g.SetActivationInfoField(e,t,2,17)},g.SetErrorResult=function(e,t){e.LoadTime&&(e.LoadTime.ErrorResult=t,g.ActivateEndInternal(e))},g.SetBit=function(e,t,n,r){g.SetActivationInfoField(e,t,r||2,n)},g.StartStopwatch=function(e,t){e.LoadTime&&e.Timers&&e.Timers[t]&&(e.Timers[t].Start(),g.UpdateActivatingNumber(e))},g.StopStopwatch=function(e,t){e.LoadTime&&e.Timers&&e.Timers[t]&&(e.Timers[t].Stop(),g.UpdateActivatingNumber(e))},g.ConvertFlagToBit=function(e){return e?2:1},g.SetActivationInfoField=function(e,t,n,r){e.LoadTime&&(g.UpdateActivatingNumber(e),e.LoadTime.ActivationInfo=g.SetBitField(e.LoadTime.ActivationInfo,t,n,r))},g.SetBitField=function(e,t,n,r){return e&~(Math.pow(2,n)-1<<r)|t<<r},g.UpdateActivatingNumber=function(e){e.LoadTime&&(e.LoadTime.Stage6Time=e.LoadTime.Stage6Time>g.activatingNumber?e.LoadTime.Stage6Time:g.activatingNumber)},g.ActivateEndInternal=function(e){if(e.LoadTime){if(g.StopStopwatch(e,m),e.Timers)for(var r in e.Timers)e.Timers[r].ElapsedTime!=i&&(e.LoadTime[r]=e.Timers[r].ElapsedTime);f.SendULSTraceTag(n.msoulscat_Osf_Runtime,t.info,g.GenerateActivationMessage(e.ActivationRuntimeType,e.LoadTime.CorrelationId),19515420),y.Instance().LogData(e.LoadTime),e.LoadTime=i,g.activatingNumber--}},g.activatingNumber=0,g}();e.AppLoadTimeHelper=T;var O=function(){var e=" AppCorrelationId:";function r(){}return r.LogProxyFailure=function(e,n,o){var a;e==i&&(e=""),a=c.OUtil.formatString("appCorrelationId:{0}, methodName:{1}",e,n),Object.keys(o).forEach((function(e){var t=o[e];t!=i&&(t=t.toString()),a+=", "+e+":"+t})),f.SendULSTraceTag(r.category,t.warning,a,6062432)},r.LogExceptionTag=function(n,o,a,s){var l=n;o&&(o.name&&(l+=" Exception name:"+o.name+"."),o.paramName&&(l+=" Param name:"+o.paramName+"."),o.message&&(l+=" Message:"+o.message+"."),o.stack&&(l+=" [Stack:"+o.stack+"]")),a!=i&&(l+=e+a+"."),f.SendULSTraceTag(r.category,t.warning,l,s)},r.LogCommonMessageTag=function(n,o,a){o!=i&&(n+=e+o+"."),f.SendULSTraceTag(r.category,t.info,n,a)},r.category=n.msoulscat_Osf_Runtime,r}();e.RuntimeTelemetryHelper=O;var x=function(){function e(){}return e.LogInsertionDialogSession=function(e,t,n,r,i,l){var c=new a.InsertionDialogSessionUsageData,d=0===e.toLowerCase().indexOf(s)?parseInt(e.substring(2),10):parseInt(e,10),u=o.Undefined;u|=r?o.Inserted:o.Canceled,n>0&&(u|=o.TrustPageVisited),c.AssetId=d,c.TotalSessionTime=t,c.TrustPageSessionTime=n,c.DialogState=u,c.LastActiveTab=i,c.LastActiveTabCount=l,C.Instance().LogData(c)},e}();e.InsertionDialogSessionHelper=x;var E=function(){function e(){}return e.IsPrivateAddin=function(e,r,o,a,u){switch((e||"").toLowerCase()){case c.StoreType.OMEX:case c.StoreType.HardCodedPreinstall:case c.StoreType.FirstParty:case c.StoreType.Sdx:case c.StoreType.WopiCatalog:return d;case c.StoreType.SPCatalog:case c.StoreType.SPApp:case c.StoreType.FileSystem:case c.StoreType.Registry:case c.StoreType.OneDrive:case c.StoreType.UploadFileDevCatalog:return l;case c.StoreType.PrivateCatalog:return u&&0===u.toLowerCase().indexOf(s)?d:r&&0===r.toLowerCase().indexOf(s)?d:l;case c.StoreType.Exchange:var p=a!=i?a.toLowerCase():i;if(p&&"default"===p||"marketplace"===p||"preinstalled"===p||"marketplaceprivatecatalog"===p)return d;var m=o!=i?o.toLowerCase():i;return m&&"microsoft"===m||"microsoft corp"===m||"microsoft corp."===m||"microsoft corporation"===m?d:l;case c.StoreType.InMemory:default:return f.SendULSTraceTag(n.msoulscat_Osf_Notification,t.warning,"Unknown StoreType: "+e+" in function IsPrivateAddin.",571494615),l}},e.GetAssetId=function(t,n,r,o,i){return e.IsPrivateAddin(t,n,o,i)?e.privateAssetId:r},e.privateAssetId="PRIVATE",e}();e.PrivacyRules=E}(s||(s={})),function(e){var t,n=!0,i=!1,a=null,l=function(){function e(){this.m_osfControlId=a,this.m_isControlReady=i,this.m_queue=[]}return Object.defineProperty(e.prototype,"osfControlId",{get:function(){return this.m_osfControlId},set:function(e){this.m_osfControlId=e},enumerable:n,configurable:n}),Object.defineProperty(e.prototype,"isControlReady",{get:function(){return this.m_isControlReady},set:function(e){this.m_isControlReady=e},enumerable:n,configurable:n}),Object.defineProperty(e.prototype,"isEmpty",{get:function(){return 0===this.m_queue.length},enumerable:n,configurable:n}),e.prototype.queueAction=function(e,t){var n={eventData:e,actionSender:t};this.m_queue.push(n)},e.prototype.sendActions=function(){var e=this;return new Promise((function(t){window.setTimeout((function(){for(;e.m_queue.length>0;){var n=e.m_queue[0];e.m_queue.splice(0,1),e.sendAction(n)}t()}),0)}))},e.prototype.sendAction=function(e){var t=e.eventData,n=e.actionSender;t&&n&&this.m_isControlReady&&n(this.m_osfControlId,t)},e}();!function(e){e[e.Unknown=0]="Unknown",e[e.Host=1]="Host",e[e.Addin=2]="Addin"}(t||(t={}));var d=function(){var d="The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",u="function",p="Couldn't get solutionId or storetype from the addinid",f="addinId",m="ownerType",g="undefined";function v(){}return v.init=function(){return v.s_usedShortcutAddins={},v.s_isCustomShortcutsEnabled=c.OUtil.getBooleanSetting("EnableCustomShortcuts"),e.ActionMetadataManager.init(n).then((function(){if(v.isAddinShortcutsPreferenceSettingHelperSupported())return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().loadShortcutsPreferenceMappingTable()}))},v.isCustomShortcutsEnabled=function(){return v.s_isCustomShortcutsEnabled},v.isConflictFound=function(e,t){return e&&t.length>0||!e&&t.length>1},v.isAddinShortcutsPreferenceSettingHelperSupported=function(){return typeof Common!==g&&Common.App&&Common.App.AppsForOffice&&Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper&&Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance()},v.tryDispatchShortcutKey=function(r,o,l,d,u,p,h){var y="Error: Invalid Parameter";try{if(!d)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidParameter,y);if(!u)throw new e.OsfRuntimeError(e.OsfRuntimeErrorCode.invalidParameter,y);var C=v.s_isCustomShortcutsEnabled?v.getShortcutInfoArrayFromShortcutKey(r,o):e.ActionMetadataManager.getShortcutInfoArrayFromShortcutKey(r,o);return C&&0!==C.length?!l&&1===C.length&&C[0].addinId&&C[0].actionId?((!h||h==C[0].addinId)&&v.callActionHandlerAndLogUsage(d,C[0].addinId,C[0].actionId),n):v.isConflictFound(!!l,C)?(typeof Common!==g&&Common.App&&Common.App.AppsForOffice&&Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper?Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getSetting().then((function(g){if(g){var y=JSON.parse(g);if(y[o.toString()]){var _=y[o.toString()][r.toString()];if(_)if(_[m]==t.Addin){for(var S=i,A=0;A<C.length;A++)if(_[f]==C[A].addinId){S=n;break}if(S)return void((!h||h==_[f])&&v.callActionHandlerAndLogUsage(d,_[f],_.action));s.RuntimeTelemetryHelper.LogCommonMessageTag("Action owner do not exist",a,573125068)}else{if(_[m]==t.Host&&!h)return void u();s.RuntimeTelemetryHelper.LogCommonMessageTag("Action owner type isn't support",a,573125067)}}}var I=[];l&&I.push({addinId:a,addinName:a,action:a,actionDescription:l,ownerType:t.Host});for(A=0;A<C.length;A++){var T=new c.AddinIdInfo(C[A].addinId),O=c.OsfManifestManager.getCachedManifest(T.getSolutionId(),T.getSolutionVersion());O&&I.push({addinId:C[A].addinId,addinName:O._displayNames[O._UILocale.toLowerCase()]==a?O._displayNames[O._defaultLocale.toLocaleLowerCase()]:O._displayNames[O._UILocale.toLowerCase()],action:C[A].actionId,actionDescription:C[A].actionName,ownerType:t.Addin})}if(1==I.length){if(I[0].ownerType==t.Host)return u(),n;if(I[0].ownerType==t.Addin)return v.callActionHandlerAndLogUsage(d,I[0].addinId,I[0].action),n}var x={modifiers:r,keyCode:o,shortcutText:e.ShortcutsMappingTableManager.getShortcutText(r,o,e.ExtendedManifestUtility.getPlatformName()),shortcutDisplayInfoArray:I};p(x).then((function(e){e>=0&&x.shortcutDisplayInfoArray[e]&&v.enableShortcutKey(x.shortcutDisplayInfoArray[e].ownerType,x.shortcutDisplayInfoArray[e].addinId,x.shortcutDisplayInfoArray[e].action,r,o).then((function(){x.shortcutDisplayInfoArray[e].ownerType==t.Addin?(!h||h==x.shortcutDisplayInfoArray[e].addinId)&&v.callActionHandlerAndLogUsage(d,x.shortcutDisplayInfoArray[e].addinId,x.shortcutDisplayInfoArray[e].action):x.shortcutDisplayInfoArray[e].ownerType==t.Host&&!h&&u()})),setTimeout((function(){v.sendShortcutConflictInfoTelemetry(x,e)}),0)}))})):s.RuntimeTelemetryHelper.LogCommonMessageTag("AddinShortcutsPreferenceSettingHelper isn't ready",a,573125065),n):i:i}catch(e){return s.RuntimeTelemetryHelper.LogExceptionTag("Failed to disptach the shortcut key",e,a,573125064),i}},v.getShortcutInfoArrayFromShortcutKey=function(t,n){if(!v.isAddinShortcutsPreferenceSettingHelperSupported())throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();var r=[],o=Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getShortcutInfoArray(t,n);Array.isArray(o)&&o.length>0&&o.forEach((function(t){var n=e.ShortcutsMappingTableManager.getActionName(t.addinId,t.action);r.push({addinId:t.addinId,actionId:t.action,actionName:n})}));var i=e.ShortcutsMappingTableManager.getShortcutsMappingTable();if(i!=a&&i[n]!=a){var s=i[n][t];Array.isArray(s)&&s.length>0&&s.forEach((function(t){if(!Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().isActionCustomized(t.addinId,t.actionId)){var n=e.ShortcutsMappingTableManager.getActionName(t.addinId,t.actionId);r.push({addinId:t.addinId,actionId:t.actionId,actionName:n})}}))}return r},v.callActionHandlerAndLogUsage=function(e,t,n){e(t,n),setTimeout((function(){v.sendShortcutUsageTelemetry(t)}),0)},v.enableShortcutKey=function(e,t,n,r,o){return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().saveSetting(e,t,n,r,o)},v.sendQueuedActions=function(e){var t=v.getOrCreateAddinActionQueue(e);t&&(t.isControlReady=n,t.sendActions())},v.queueOrSendActionIfControlReady=function(e,t,n){var r=v.getOrCreateAddinActionQueue(e);r.isControlReady?r.isEmpty?n(e,t):(r.queueAction(t,n),r.sendActions()):r.queueAction(t,n)},v.getOrCreateAddinActionQueue=function(e){var t=v.s_actionQueues[e];return t||((t=new l).osfControlId=e,v.s_actionQueues[e]=t),t},v.sendShortcutUsageTelemetry=function(t){if(t){if(!v.s_usedShortcutAddins[t]){v.s_usedShortcutAddins[t]=n;var r=new c.AddinIdInfo(t);if(!r.getStoreTypeId()||!r.getSolutionId())return void s.RuntimeTelemetryHelper.LogCommonMessageTag(p,a,573125063);if("object"==typeof Otel&&typeof Otel.Telemetry===u&&typeof Otel.Telemetry.sendOtelEvent===u){var o={otelEvent:{eventName:"Office.Extensibility.Shortcuts.RuntimeInfo",dataFields:[{name:"shortcutBeingUsed",dataType:0,value:n},{name:"solutionId",dataType:1,value:r.getPrivacyCompliantSolutionId()},{name:"storeType",dataType:1,value:e.ManifestUtil.GetStoreTypeName(r.getStoreTypeId())}],telemetryProperties:e.TelemetryProperties}};Otel.Telemetry.sendOtelEvent(o)}else s.RuntimeTelemetryHelper.LogCommonMessageTag(d,a,573125062)}}else s.RuntimeTelemetryHelper.LogCommonMessageTag("AddinId is null",a,558724994)},v.sendShortcutConflictInfoTelemetry=function(r,o){var i,l=a,f=a;if(o>=0&&r.shortcutDisplayInfoArray.length>o&&r.shortcutDisplayInfoArray[o].ownerType==t.Addin){if(!r.shortcutDisplayInfoArray[o].addinId)return void s.RuntimeTelemetryHelper.LogCommonMessageTag("Couldn't get the addinid",a,558724993);var m=new c.AddinIdInfo(r.shortcutDisplayInfoArray[o].addinId);if(l=m.getPrivacyCompliantSolutionId(),f=e.ManifestUtil.GetStoreTypeName(m.getStoreTypeId()),!l||!f)return void s.RuntimeTelemetryHelper.LogCommonMessageTag(p,a,558724992)}"object"==typeof Otel&&typeof Otel.Telemetry===u&&typeof Otel.Telemetry.sendOtelEvent===u?i={otelEvent:{eventName:"Office.Extensibility.Shortcuts.ConflictInfo",dataFields:[{name:"FConflictWithExcel",dataType:0,value:r.shortcutDisplayInfoArray[0].ownerType==t.Host},{name:"ConflictVectorSize",dataType:2,value:r.shortcutDisplayInfoArray.length},{name:"KeyCode",dataType:2,value:r.keyCode},{name:"ModifierKeys",dataType:2,value:r.modifiers},{name:"SolutionId",dataType:1,value:l},{name:"StoreType",dataType:1,value:f}],telemetryProperties:e.TelemetryProperties}}:s.RuntimeTelemetryHelper.LogCommonMessageTag(d,a,573125061),o>=0?i&&(i.otelEvent.dataFields.push({name:"ExcelHostShortcutGotOverride",dataType:0,value:r.shortcutDisplayInfoArray[0].ownerType==t.Host&&r.shortcutDisplayInfoArray[o].ownerType!=t.Host}),Otel.Telemetry.sendOtelEvent(i)):i&&(i.otelEvent.dataFields.push({name:"UserCanceledConflictUI",dataType:0,value:n}),Otel.Telemetry.sendOtelEvent(i))},v.checkShortcutsInUse=function(r,o){var s="shortcuts";if(r==a)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException(s);if(o==a)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException("isShortcutKeyUsedByHost");if(!v.isAddinShortcutsPreferenceSettingHelperSupported())throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();return Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getSetting().then((function(l){var c=a;l&&(c=JSON.parse(l));for(var d=[],u=0;u<r.length;++u){var p=e.ShortcutsMappingTableManager.convertStringToKeys(r[u]);if(p==a)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException(s);if(c&&c[p.virtualKey.toString()]){var f=c[p.virtualKey.toString()][p.modifierKeys.toString()];if(f&&(f[m]==t.Addin||f[m]==t.Host)){d.push(n);continue}}if(o(p.modifierKeys,p.virtualKey))d.push(n);else{var g=v.getShortcutInfoArrayFromShortcutKey(p.modifierKeys,p.virtualKey);Array.isArray(g)&&g.length>0?d.push(n):d.push(i)}}return d}))},v.getShortcuts=function(n){if(n==a||0===n.length)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException(f);if(!v.isAddinShortcutsPreferenceSettingHelperSupported())throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();return new Promise((function(r){var o=Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getShortcutsPreferenceMappingTable(),i={},s=function(r){var s=function(s){var l=o!=a&&o[r]!=a?o[r][s]:a;if(l&&l.ownerType==t.Addin&&l.addinId==n){var c=e.ShortcutsMappingTableManager.getShortcutText(parseInt(s),parseInt(r),e.ExtendedManifestUtility.getPlatformName());i[l.action]=c}else{var d=Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getShortcutInfoArray(s,r);Array.isArray(d)&&d.length>0&&d.forEach((function(t){if(t.addinId==n){var o=e.ShortcutsMappingTableManager.getShortcutText(parseInt(s),parseInt(r),e.ExtendedManifestUtility.getPlatformName());i[t.action]=o}}))}};for(var l in o[r])s(l)};for(var l in o)s(l);var c=e.ShortcutsMappingTableManager.getShortcutsMappingTable(),d=function(r){var s=function(s){var l=c[r][s];Array.isArray(l)&&l.length>0&&l.forEach((function(l){if(l.addinId==n&&!Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().isActionCustomized(l.addinId,l.actionId)){var c=o!=a&&o[r]!=a?o[r][s]:a,d=a;(!c||c.ownerType==t.Addin&&c.addinId==l.addinId&&c.action==l.actionId)&&(d=e.ShortcutsMappingTableManager.getShortcutText(l.modifierKeys,l.virtualKey,e.ExtendedManifestUtility.getPlatformName())),i[l.actionId]=d}}))};for(var l in c[r])s(l)};for(var l in c)d(l);r(i)}))},v.replaceShortcuts=function(n,i){return r(this,void 0,void 0,(function(){var r,s,l,c,d,u,p,m,g,h,y,C;return o(this,(function(o){switch(o.label){case 0:if(n==a||0===n.length)throw OfficeExtension.WacRuntime.Utility.createInvalidArgumentException(f);if(!v.isAddinShortcutsPreferenceSettingHelperSupported())throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();return[4,v.getShortcuts(n)];case 1:for(l in r=o.sent(),s=[],i)s.push(l);c=0,o.label=2;case 2:if(!(c<s.length))return[3,7];if(d=s[c],r[d]==a)throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException();if(u=r[d],(p=e.ShortcutsMappingTableManager.convertStringToKeys(u))==a)throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException;return(m=i[d])!=a?[3,4]:[4,Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().removeActionFromShortcutInfoArray(n,d)];case 3:return o.sent(),[3,6];case 4:if((g=e.ShortcutsMappingTableManager.convertStringToKeys(m))==a)throw OfficeExtension.WacRuntime.Utility.createInvalidOperationException;return p.modifierKeys==g.modifierKeys&&p.virtualKey==g.virtualKey?[3,6]:(Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().isActionCustomized(n,d)&&Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().removeActionFromShortcutInfoArray(n,d),h={ownerType:t.Addin,addinId:n,action:d},y=[h],C=Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().getShortcutInfoArray(g.modifierKeys,g.virtualKey),Array.isArray(C)&&C.length>0&&y.concat(C),[4,Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().setShortcutInfoArray(g.modifierKeys,g.virtualKey,y)]);case 5:o.sent(),o.label=6;case 6:return c++,[3,2];case 7:return[2]}}))}))},v.s_usedShortcutAddins={},v.s_actionQueues={},v.s_isCustomShortcutsEnabled=i,v}();e.ShortcutKeyDispatchManager=d}(p||(p={}));var d='xmlns="urn:schemas-microsoft-com:office:office" xmlns:o="urn:schemas-microsoft-com:office:office"';c.AppVersion={access:"ZAC150",excel:"ZXL150",excelwebapp:"WAE160",outlook:"ZOL150",outlookwebapp:"MOW150",powerpoint:"ZPP151",powerpointwebapp:"WAP160",project:"ZPJ150",word:"ZWD150",wordwebapp:"WAW160",onenotewebapp:"WAO160",visio:"ZVO161",visiowebapp:"WAV161"},c.AppSubType={Taskpane:1,Content:2,Contextual:3,Dictionary:4},c.ClientAppInfoReturnType={urlOnly:0,etokenOnly:1,both:2};var u,p;c.HostSpecificFileVersionDefault="16.00",c.HostSpecificFileVersionMap={access:{web:"16.00"},agavito:{winrt:"16.00"},excel:{ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},onenote:{android:"16.00",web:"16.00",win32:"16.00",winrt:"16.00"},outlook:{ios:"16.00",mac:"16.00",web:"16.01",win32:"16.02"},powerpoint:{ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},project:{win32:"16.00"},sway:{web:"16.00"},word:{ios:"16.00",mac:"16.00",web:"16.00",win32:"16.01",winrt:"16.00"},visio:{web:"16.00",win32:"16.00"}},c.HostType={Excel:"Excel",Outlook:"Outlook",Access:"Access",PowerPoint:"PowerPoint",Word:"Word",Sway:"Sway",OneNote:"OneNote",Visio:"Visio"},c.ManifestHostType={Workbook:"Workbook",Document:"Document",Presentation:"Presentation",Notebook:"Notebook",Mailbox:"Mailbox",Drawing:"Drawing"},c.HostPlatform={Web:"Web"},c.getAppVerCode=function(e){var t,n="Invalid appName.";switch(e){case c.AppName.ExcelWebApp:t="excel.exe";break;case c.AppName.AccessWebApp:t="ZAC";break;case c.AppName.PowerpointWebApp:t="WAP";break;case c.AppName.WordWebApp:t="WAW";break;case c.AppName.OneNoteWebApp:t="WAO";break;case c.AppName.VisioWebApp:t="WAV";break;default:throw l.msAjaxDebug.trace(n),n}return t},c.getModernAppVerCode=function(e){var t,n="Invalid appName.";switch(e){case c.AppName.ExcelWebApp:t="WAC_Excel";break;case c.AppName.PowerpointWebApp:t="WAC_PowerPoint";break;case c.AppName.WordWebApp:t="WAC_Word";break;case c.AppName.OneNoteWebApp:t="WAC_OneNote";break;case c.AppName.OutlookWebApp:t="WAC_Outlook";break;case c.AppName.VisioWebApp:t="WAC_Visio";break;default:throw l.msAjaxDebug.trace(n),n}return t},c.getManifestHostType=function(e){var t;switch(e){case c.HostType.Excel:t=c.ManifestHostType.Workbook;break;case c.HostType.Word:t=c.ManifestHostType.Document;break;case c.HostType.PowerPoint:t=c.ManifestHostType.Presentation;break;case c.HostType.OneNote:t=c.ManifestHostType.Notebook;break;case c.HostType.Outlook:t=c.ManifestHostType.Mailbox;break;case c.HostType.Visio:t=c.ManifestHostType.Drawing;break;default:throw l.msAjaxDebug.trace("Invalid host type."),"Invalid hostType."}return t},c.Capability={Mailbox:"Mailbox",Document:"Document",Workbook:"Workbook",Project:"Project",Presentation:"Presentation",Database:"Database",Sway:"Sway",Notebook:"Notebook",Drawing:"Drawing"},c.HostCapability={Excel:c.Capability.Workbook,Outlook:c.Capability.Mailbox,Access:c.Capability.Database,PowerPoint:c.Capability.Presentation,Word:c.Capability.Document,Sway:c.Capability.Sway,OneNote:c.Capability.Notebook,Visio:c.Capability.Drawing},c.OsfControlTarget={Undefined:-1,InContent:0,TaskPane:1,Contextual:2},c.OsfControlPermission={Restricted:1,ReadDocument:2,WriteDocument:4,ReadItem:32,ReadWriteMailbox:64,ReadAllDocument:131,ReadWriteDocument:135},c.OsfControlStatus={NotActivated:1,Activated:2,AppStoreNotReachable:3,InvalidOsfControl:4,UnsupportedStore:5,UnknownStore:6,ActivationFailed:7,NotSandBoxSupported:8},c.OsfControlPageStatus={NotStarted:1,Loading:2,Ready:3,FailedHandleRequest:4,FailedOriginCheck:5,FailedPermissionCheck:6},c.StoreType={OMEX:"omex",SPCatalog:"spcatalog",SPApp:"spapp",Exchange:"exchange",FileSystem:"filesystem",Registry:"registry",InMemory:"inmemory",OneDrive:"onedrive",PrivateCatalog:"excatalog",HardCodedPreinstall:"hardcodedpreinstall",FirstParty:"firstparty",UploadFileDevCatalog:"uploadfiledevcatalog",Sdx:"sdxcatalog",WopiCatalog:"wopicatalog"},c.StoreTypeEnum={MarketPlace:0,Catalog:1,SPApp:2,Exchange:3,FileSystem:4,Registry:5,OneDrive:9,PrivateCatalog:10,HardCodedPreinstall:11,FirstParty:12,Sdx:14,UploadFileDevCatalog:15,WopiCatalog:16},c.ManifestIdIssuer={Microsoft:"Microsoft",Custom:"Custom"},c.OmexClientAppStatus={OK:1,UnknownAssetId:2,KilledAsset:3,NoEntitlement:4,DownloadsExceeded:5,Expired:6,Invalid:7,Revoked:8,ServerError:9,BadRequest:10,LimitedTrial:11,TrialNotSupported:12,EntitlementDeactivated:13,VersionMismatch:14,VersionNotSupported:15,UserIsMinor:16},c.OmexState={Killed:0,OK:1,Withdrawn:2,Flagged:3,DeveloperWithdrawn:4},c.OmexTrialType={None:0,Office:1,External:2},c.OmexEntitlementType={Free:"free",Trial:"trial",Paid:"paid"},c.OmexAuthNStatus={NotAttempted:-1,CheckFailed:0,Authenticated:1,Anonymous:2,Unknown:3},c.OmexRemoveAppStatus={Failed:0,Success:1},c.OfficeAppType={ContentApp:c.OsfControlTarget.InContent,TaskPaneApp:c.OsfControlTarget.TaskPane,MailApp:c.OsfControlTarget.Contextual},c.FormFactor={Default:"DefaultSettings",Desktop:"DesktopSettings",Tablet:"TabletSettings",Phone:"PhoneSettings"},c.OsfOfficeExtensionManagerPerfMarker={GetEntitlementStart:"Agave.OfficeExtensionManager.GetEntitlementStart",GetEntitlementEnd:"Agave.OfficeExtensionManager.GetEntitlementEnd"},c.OsfControlActivationPerfMarker={ActivationStart:"Agave.AgaveActivationStart",ActivationEnd:"Agave.AgaveActivationEnd",DeactivationStart:"Agave.AgaveDeactivationStart",DeactivationEnd:"Agave.AgaveDeactivationEnd",SelectionTimeout:"Agave.AgaveSelectionTimeout"},c.NotificationUxPerfMarker={RenderLoadingAnimationStart:"Agave.NotificationUx.RenderLoadingAnimationStart",RenderLoadingAnimationEnd:"Agave.NotificationUx.RenderLoadingAnimationEnd",RemoveLoadingAnimationStart:"Agave.NotificationUx.RemoveLoadingAnimationStart",RemoveLoadingAnimationEnd:"Agave.NotificationUx.RemoveLoadingAnimationEnd",RenderStage1Start:"Agave.NotificationUx.RenderStage1Start",RenderStage1End:"Agave.NotificationUx.RenderStage1End",RemoveStage1Start:"Agave.NotificationUx.RemoveStage1Start",RemoveStage1End:"Agave.NotificationUx.RemoveStage1End",RenderStage2Start:"Agave.NotificationUx.RenderStage2Start",RenderStage2End:"Agave.NotificationUx.RenderStage2End",RemoveStage2Start:"Agave.NotificationUx.RemoveStage2Start",RemoveStage2End:"Agave.NotificationUx.RemoveStage2End"},c.ProxyCallStatusCode={Succeeded:1,Failed:0,ProxyNotReady:-1},c.UpnCheckCode={NotSet:0,Match:1,NotMatch:2},c.HostFrameTrustState={NotInitialized:0,NotImplemented:1,NotReady:2,Exempted:3,NotTrusted:4,Trusted:5},c.ClientAppInfoReturnType={urlOnly:0,etokenOnly:1,both:2},c.SQMDataPoints={DATAID_APPSFOROFFICEUSAGE:10595,DATAID_APPSFOROFFICENOTIFICATIONS:10942},c.BWsaStreamTypes={Static:1},c.BWsaConfig={defaultMaxStreamRows:1e3},c.ErrorStatusCodes={E_OEM_EXTENSION_NOT_ENTITLED:2147758662,E_MANIFEST_SERVER_UNAVAILABLE:2147758672,E_USER_NOT_SIGNED_IN:2147758677,E_MANIFEST_DOES_NOT_EXIST:2147758673,E_OEM_EXTENSION_KILLED:2147758660,E_OEM_OMEX_EXTENSION_KILLED:2147758686,E_MANIFEST_UPDATE_AVAILABLE:2147758681,S_OEM_EXTENSION_TRIAL_MODE:275013,E_OEM_EXTENSION_WITHDRAWN_FROM_SALE:2147758690,E_TOKEN_EXPIRED:2147758675,E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED:2147757992,E_MANIFEST_REFERENCE_INVALID:2147758678,S_USER_CLICKED_BUY:274205,E_MANIFEST_INVALID_VALUE_FORMAT:2147758654,E_TRUSTCENTER_MOE_UNACTIVATED:2147757996,S_OEM_EXTENSION_FLAGGED:275040,S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE:275041,E_BROWSER_VERSION:2147758194,E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR:-2147209295,E_PRIVACY_SERVICE_DISABLED_ADMIN:2147758792,WAC_AgaveUnsupportedStoreType:1041,WAC_AgaveActivationError:1042,WAC_ActivateAttempLoading:1043,WAC_HTML5IframeSandboxNotSupport:1044,WAC_AgaveRequirementsErrorOmex:1045,WAC_AgaveRequirementsError:1046,WAC_AgaveOriginCheckError:1047,WAC_AgavePermissionCheckError:1048,WAC_AgaveHostHandleRequestError:1049,WAC_AgaveUnknownClientAppStatus:1050,WAC_AgaveAnonymousProxyCreationError:1051,WAC_AgaveOsfControlActivationError:1052,WAC_AgaveEntitlementRequestFailure:1053,WAC_AgaveManifestRequestFailure:1054,WAC_AgaveManifestAndEtokenRequestFailure:1055,WAC_FirstPartyAddInListRequestFailure:1056,WAC_SDX_DMSRequestFailed:1058,WAC_SDX_AssetIdNotInDMSResponse:1059,WAC_CustomFunctionsRegistrationError:1060,WAC_WopiHostCheckStatusNotTrusted:1061,WAC_WopiHostCheckStatusNotReady:1062,WAC_AgaveIRMBlockError:1063},c.InvokeResultCode={S_OK:0,E_REQUEST_TIME_OUT:-2147471590,E_USER_NOT_SIGNED_IN:-2147208619,E_CATALOG_ACCESS_DENIED:-2147471591,E_CATALOG_REQUEST_FAILED:-2147471589,E_OEM_NO_NETWORK_CONNECTION:-2147208640,E_PROVIDER_NOT_REGISTERED:-2147208617,E_OEM_CACHE_SHUTDOWN:-2147208637,E_OEM_REMOVED_FAILED:-2147209421,E_CATALOG_NO_APPS:-1,E_GENERIC_ERROR:-1e3,S_HIDE_PROVIDER:10},c.OmexClientNames=function(){var e={},t=c.AppName;return e[t.ExcelWebApp]="WAC_Excel",e[t.WordWebApp]="WAC_Word",e[t.OutlookWebApp]="WAC_Outlook",e[t.AccessWebApp]="WAC_Access",e[t.PowerpointWebApp]="WAC_Powerpoint",e[t.OneNoteWebApp]="WAC_OneNote",e[t.VisioWebApp]="WAC_Visio",e}(),c.OmexAppVersions=function(){var e={},t=c.AppName;return e[t.ExcelWebApp]=c.AppVersion.excelwebapp,e[t.WordWebApp]=c.AppVersion.wordwebapp,e[t.OutlookWebApp]=c.AppVersion.outlookwebapp,e[t.AccessWebApp]=c.AppVersion.access,e[t.PowerpointWebApp]=c.AppVersion.powerpointwebapp,e[t.OneNoteWebApp]=c.AppVersion.onenotewebapp,e[t.VisioWebApp]=c.AppVersion.visiowebapp,e}(),c.ActivationTypes={V1Enabled:0,V1S2SEnabled:1,V2Enabled:2,V2S2SEnabled:3},c.ManifestRequestTypes={Manifest:1,Etoken:2,Both:3},c.HostInfoFlags={None:0,SharedApp:1,CustomFunction:2,ProtectedDocDisable:4,ExperimentJsEnabled:8,PublicAddin:16},c.MaxAppContextLength=10240,c.HostFeatureGateFlags={None:0,Enable3rdPartySetAppContextInIFrameName:2},c.SdxAssetIds={Ideas:"fa000000029",ExperimentationSdx:"fa000000059"},c.ExtendedManifestSupportTokens={Requirements:"RequirementsToken",Locale:"LocaleToken",TokenReplaceRegex:"\\$\\{token\\.(\\w+)\\}",ResourceTokenRegEx:"^\\$\\{resource\\.([A-Za-z0-9_-]+)\\}$",ExtendedManifestLoggingPrefix:"Extended Manifest",ExtendedManifestResourcesLoggingPrefix:"Extended Manifest Resources",ActionIdMaxLength:32,ActionNameMaxLength:125},function(e){var t=null,n=function(){function n(){}return n.versionLessThan=function(e,t){return c.OsfManifestManager.versionLessThan(e,t)},n.ParseManifest=function(e,n,r){try{return new c.Manifest.Manifest(e,n)}catch(e){return s.RuntimeTelemetryHelper.LogExceptionTag("Invalid manifest:",e,r,20306078),t}},n.constructAddInId=function(t,n,r,o){return e.MsAjaxString.format("{0}|{1}|{2}|{3}|{4}|||","2",t,n,this.GetStoreTypeId(r).toString(),o)},n.GetStoreTypeId=function(e){return e==c.StoreType.OMEX?c.StoreTypeEnum.MarketPlace:e==c.StoreType.SPCatalog?c.StoreTypeEnum.Catalog:e==c.StoreType.SPApp?c.StoreTypeEnum.SPApp:e==c.StoreType.Exchange?c.StoreTypeEnum.Exchange:e==c.StoreType.FileSystem?c.StoreTypeEnum.FileSystem:e==c.StoreType.Registry?c.StoreTypeEnum.Registry:e==c.StoreType.OneDrive?c.StoreTypeEnum.OneDrive:e==c.StoreType.PrivateCatalog?c.StoreTypeEnum.PrivateCatalog:e==c.StoreType.HardCodedPreinstall?c.StoreTypeEnum.HardCodedPreinstall:e==c.StoreType.FirstParty?c.StoreTypeEnum.FirstParty:e==c.StoreType.UploadFileDevCatalog?c.StoreTypeEnum.UploadFileDevCatalog:e==c.StoreType.WopiCatalog?c.StoreTypeEnum.WopiCatalog:-1},n.GetStoreTypeName=function(e){var n=parseInt(e);return n==c.StoreTypeEnum.MarketPlace?c.StoreType.OMEX:n==c.StoreTypeEnum.Catalog?c.StoreType.SPCatalog:n==c.StoreTypeEnum.SPApp?c.StoreType.SPApp:n==c.StoreTypeEnum.Exchange?c.StoreType.Exchange:n==c.StoreTypeEnum.FileSystem?c.StoreType.FileSystem:n==c.StoreTypeEnum.Registry?c.StoreType.Registry:n==c.StoreTypeEnum.OneDrive?c.StoreType.OneDrive:n==c.StoreTypeEnum.PrivateCatalog?c.StoreType.PrivateCatalog:n==c.StoreTypeEnum.HardCodedPreinstall?c.StoreType.HardCodedPreinstall:n==c.StoreTypeEnum.FirstParty?c.StoreType.FirstParty:n==c.StoreTypeEnum.UploadFileDevCatalog?c.StoreType.UploadFileDevCatalog:n==c.StoreTypeEnum.WopiCatalog?c.StoreType.WopiCatalog:t},n}();e.ManifestUtil=n;var r=function(){function n(){}return n.failed=function(n,r,o){if(n.status!=e.DataServiceResultCode.Succeeded){var i={status:n.status,httpStatus:n.httpStatus};return o!=t&&(i.value=o),r(i),!0}return!1},n.retry=function(e,t){void 0===t&&(t={});var n=t.retries,r=void 0===n?3:n,o=t.factor,i=void 0===o?2:o,a=t.minTimeout,s=void 0===a?300:a,l=t.maxTimeout,c=void 0===l?1/0:l;return new Promise((function(t,n){var o=function(a){e().then(t,(function(e){a>=r?n(e):setTimeout((function(){return o(a+1)}),Math.min(s*Math.pow(i,a),c))}))};o(0)}))},n.limitRate=function(e,t){var n=[],r=-1/0,o=function(){var i=n.shift();n.length>0&&setTimeout(o,t),r=performance.now(),e.apply(void 0,i)};return function(){for(var e=[],i=0;i<arguments.length;i++)e[i]=arguments[i];0===n.length&&setTimeout(o,Math.max(0,t-(performance.now()-r))),n.push(e)}},n.withCache=function(e,r,o){var i="localStorage",a="__OSF_AsyncCache_",l=r.forceUpdateCache,d=void 0!==l&&l,u=r.maxAgeInSecs,p=void 0===u?259200:u,f=r.useStaleCache,m=void 0!==f&&f;if(!d&&n.Cache.hasOwnProperty(e))return Promise.resolve({cacheType:"memory",value:n.Cache[e]});var g=a+e,v=a+e+"_stale",h="__OSF_AsyncCacheExpiry",y=Date.now();if(c.OUtil.getLocalStorage().isLocalStorageAvailable())try{if(y>=n.NextCheckExpiry){var C=JSON.parse(localStorage.getItem(h))||{},_=!1;for(var S in n.NextCheckExpiry=1/0,C)y>C[S]?(localStorage.removeItem(a+S),delete C[S],_=!0):n.NextCheckExpiry=Math.min(n.NextCheckExpiry,C[S]);_&&localStorage.setItem(h,JSON.stringify(C))}if(!d&&localStorage.hasOwnProperty(g))return Promise.resolve({cacheType:i,value:localStorage.getItem(g)})}catch(e){s.RuntimeTelemetryHelper.LogExceptionTag("failed to get key "+g,e,t,544617492)}return o().then((function(t){n.Cache[e]=t;try{var r=JSON.parse(localStorage.getItem(h))||{};r[e]=y+1e3*p,n.NextCheckExpiry=Math.min(n.NextCheckExpiry,r[e]),localStorage.setItem(h,JSON.stringify(r)),localStorage.setItem(g,t),localStorage.setItem(v,t)}catch(e){}return{cacheType:"none",value:t}}),(function(e){if(m&&c.OUtil.getLocalStorage().isLocalStorageAvailable()&&localStorage.hasOwnProperty(v))return s.RuntimeTelemetryHelper.LogCommonMessageTag("stale cache used for "+v,t,556066976),Promise.resolve({cacheType:i,value:localStorage.getItem(v)});throw e}))},n.fetch=function(e,n){return void 0===n&&(n={}),new Promise((function(r,o){var i=new XMLHttpRequest,a=n.method,s=void 0===a?"GET":a,l=n.headers,c=void 0===l?{}:l,d=n.body,u=void 0===d?t:d;for(var p in i.onreadystatechange=function(){4==i.readyState&&r({ok:i.status>=200&&i.status<=299,status:i.status,statusText:i.statusText,text:function(){return Promise.resolve(i.responseText)},json:function(){return Promise.resolve(JSON.parse(i.responseText))}})},i.onerror=o,i.open(s,e,!0),c)i.setRequestHeader(p,c[p]);i.send(u)}))},n.Cache={},n.NextCheckExpiry=0,n}();e.AsyncUtil=r;var o=function(){function e(){}return e.register=function(e,t){this._registry[e]=t},e.resolve=function(e,n){var r=this,o=r._resolved[e];if(o!=t)return o;if((n=n||r._hostInfo)!=t){var i=r._registry[e];if(i==t)return t;r._resolved[e]=o=i(n)}return o},e.setHostContext=function(e){this._hostInfo=e},e.getHostContext=function(){return this._hostInfo},e._registry={},e._resolved={},e}();e.CatalogFactory=o}(p||(p={})),function(e){var t=function(){function t(e){this._initParams=e}return t.prototype.getEntitlementAsync=function(t,n,r){r({status:e.DataServiceResultCode.Failed,httpStatus:403})},t.prototype.getAndCacheManifest=function(t,n,r,o){o({status:e.DataServiceResultCode.Failed,httpStatus:404})},t.prototype.activateAsync=function(t,n){var r=this;r._initParams&&r._initParams.loaderParams?r._initParams.controlStatus===c.OsfControlStatus.ActivationFailed?n.fail(r._initParams.loaderParams,r._initParams.controlStatus):n.notifyUser(r._initParams.loaderParams):n.fail(e.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveActivationError_ERR,errorCode:c.ErrorStatusCodes.WAC_AgaveActivationError}),c.OsfControlStatus.ActivationFailed)},t.prototype.removeAsync=function(t,n,r){r({status:e.DataServiceResultCode.Failed,httpStatus:403})},t.prototype.getAppDetails=function(t,n,r,o){o({status:e.DataServiceResultCode.Failed,httpStatus:403})},t}();e.ForbiddenCatalog=t}(p||(p={})),function(e){var t=function(){var e=null;function t(){}return t.defaultTitle=function(e){switch(e){case c.InfoType.Information:return Strings.OsfRuntime.L_AgaveInformationTitle_TXT;case c.InfoType.Error:return Strings.OsfRuntime.L_AgaveErrorTile_TXT;case c.InfoType.Warning:return Strings.OsfRuntime.L_AgaveWarningTitle_TXT}return Strings.OsfRuntime.L_AgaveInformationTitle_TXT},t.fillMissing=function(n){return n.infoType=t.isNullOrUndefined(n.infoType)?c.InfoType.Information:n.infoType,n.title=n.title||t.defaultTitle(n.infoType),n.buttonTxt=n.buttonTxt||Strings.OsfRuntime.L_OkButton_TXT,n.buttonCallback=n.buttonCallback||e,n.url=n.url||e,n.urlButtonTxt=n.urlButtonTxt||e,n.dismissCallback=n.dismissCallback||e,n.reDisplay=!n.dismissCallback,n.displayDeactive=n.displayDeactive==e||n.displayDeactive,n.detailView=n.detailView||!1,n.logAsError=n.logAsError||!1,n.highPriority=n.highPriority||!1,n.retryAll=n.retryAll||!1,n.errorCode=n.errorCode?n.errorCode:0,n},t.error=function(n){return n.infoType=t.isNullOrUndefined(n.infoType)?c.InfoType.Error:n.infoType,n.logAsError=n.logAsError==e||n.logAsError,t.fillMissing(n)},t.warning=function(n){return n.infoType=t.isNullOrUndefined(n.infoType)?c.InfoType.Warning:n.infoType,n.logAsError=n.logAsError==e||n.logAsError,t.fillMissing(n)},t.showNotification=function(e,n){e.notifyUser(t.fillMissing(n))},t.showError=function(e,n){e.notifyUser(t.error(n))},t.showWarning=function(e,n){e.notifyUser(t.warning(n))},t.failWithWarning=function(e,n,r){r=t.isNullOrUndefined(r)?c.OsfControlStatus.ActivationFailed:r,e.fail(t.warning(n),r)},t.failWithError=function(e,n,r){r=t.isNullOrUndefined(r)?c.OsfControlStatus.ActivationFailed:r,e.fail(t.error(n),r)},t.isNullOrUndefined=function(t){return t===e||void 0===t},t}();e.LoaderUtil=t}(p||(p={})),function(e){var t=function(){function t(e,t){this.osfControl=e,this.trusted=t}return t.prototype.getRequirementsChecker=function(){return this.osfControl._contextActivationMgr.getRequirementsChecker()},t.prototype.load=function(t,n){var r=null,o=this,i=o,a=performance.now();o.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted&&(o.osfControl._retryActivate=r,o.osfControl._contextActivationMgr.retryAll(t.entitlement.assetId)),o.osfControl._status!==c.OsfControlStatus.NotActivated&&o.osfControl.deActivate();var s=t.manifest,l=o.osfControl;if(l._etoken=t.eToken,l._manifest=s,l._sourceLocationOverrideUrl?l._iframeUrl=l._sourceLocationOverrideUrl:l._sourceLocationOverrideResourceId?l._iframeUrl=s.getSourceLocationOverrideByResourceId(l._sourceLocationOverrideResourceId):l._iframeUrl=s.getDefaultSourceLocation(l._contextActivationMgr.getFormFactor()),l._iframeUrl&&l.updateUrlsForSdx(t.manifestUrl),c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)&&t.entitlement!=r&&t.entitlement.storeType===c.StoreType.PrivateCatalog){var d=t.entitlement.addInStoreInfo;d&&(l._assetId=d.AssetId,l._assetStoreId=d.ContentMarket)}if(l._permission=s.getPermission(),l._appDomains=s.getAppDomains(),l.processManifestForCustomFunctions(s),s.getExtendedOverrides()){var u=o.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted;l.processManifestForExtendedOverrides(s,u)}if(n!=r&&(l._iframeUrl=n.decorateUrl(l._iframeUrl)),l.hostInfoFlags()&c.HostInfoFlags.ProtectedDocDisable&&!l.isFirstParty())e.LoaderUtil.failWithError(o,{description:Strings.OsfRuntime.L_AgaveProtectedDocError_ERR,detailView:!0,errorCode:c.ErrorStatusCodes.WAC_AgaveIRMBlockError});else if(l._contextActivationMgr._doesUrlHaveSupportedProtocol(l._iframeUrl)){n!=r&&n.preLoad(l,l._contextActivationMgr);var p=s.getDefaultDisplayName();l._isAddinCommands((function(e){e?(l._isvirtualOsfControl=!0,l.invokeVirtualOsfControlActivationCallback(s)):(i.osfControl._sdxTelemetryContext.iframeCreateStart=performance.now(),l._createIframeAndActivateOsfControl(p),i.osfControl._sdxTelemetryContext.iframeCreateEnd=performance.now())})),t.entitlement!=r&&t.entitlement.storeType===c.StoreType.Sdx&&e.SDXCatalog.recordActivity("IframeCreate",a,!0,[{name:"OsfControlId",string:l._id},{name:"AssetId",string:t.entitlement.assetId}]),n!=r&&n.postLoad(l,l._contextActivationMgr)}else e.LoaderUtil.failWithError(o,{description:Strings.OsfRuntime.L_AgaveManifestError_ERR,detailView:!0,errorCode:c.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT})},t.prototype.skipTrust=function(){var e=this;return e.osfControl._contextActivationMgr._autoTrusted||e.osfControl.getTrustNoPrompt()||e.osfControl._isOsfControlInEmbeddingMode(e.osfControl)},t.prototype.hasConsent=function(){return this.trusted||this.isInsertion()},t.prototype.isInsertion=function(){return this.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted},t.prototype.setRetryCall=function(e){this.osfControl._retryActivate=e},t.prototype.askForTrust=function(e,t){var n=this;this.osfControl._showTrustError(e.clientName,e.displayName,e.providerName,e.iconUrl,e.entitlement.storeType,(function(){n.restartActivation(),t()}),e.url,e.isSSOAddin)},t.prototype.askForUpgrade=function(e,t){var n=this;e.buttonCallback=function(){n.restartActivation(),t()},this.notifyUser(e)},t.prototype.fail=function(e,t){var n=this.osfControl;n._status=t,this.notifyUser(e),n._contextActivationMgr.raiseOsfControlStatusChange(n)},t.prototype.notifyUser=function(e){var t=this.osfControl;e.id=t._id,t._contextActivationMgr.displayNotification(e)},t.prototype.restartActivation=function(){this.osfControl._restartActivate()},t.prototype.isForCustomFunctionSandbox=function(){return this.osfControl.isCustomFunctionSandbox()},t.prototype.setIsUpgrading=function(e){this.osfControl.setIsUpgrading(e)},t.prototype.getIsUpgrading=function(){return this.osfControl.getIsUpgrading()},t.prototype.setUpgradingFailed=function(e){this.osfControl.setUpgradingFailed(e)},t}();e.OsfControlLoader=t}(p||(p={})),function(e){var t=function(){function e(e){this._requirementsChecker=e}return e.prototype.getRequirementsChecker=function(){return this._requirementsChecker},e.prototype.load=function(){},e.prototype.skipTrust=function(){return!1},e.prototype.hasConsent=function(){return!1},e.prototype.setRetryCall=function(){},e.prototype.askForTrust=function(){},e.prototype.askForUpgrade=function(){},e.prototype.fail=function(){},e.prototype.notifyUser=function(){},e.prototype.restartActivation=function(){},e.prototype.isForCustomFunctionSandbox=function(){return!1},e.prototype.setIsUpgrading=function(){},e.prototype.getIsUpgrading=function(){return!1},e.prototype.setUpgradingFailed=function(){},e}();e.PreCacher=t}(p||(p={})),function(e){var t=function(){var t=null;function n(){var e=this;e.isReady=!1,e.clientEndPoint=t,e.pendingCallbacks=[],e.iframe=t,e._pendingRequests={},e.conversationId=c.OUtil.generateConversationId()}return n.prototype.invokeProxyCommandAsync=function(n,r,o){var i=this,a=r||r.correlationId||"";this.prepareProxy((function(l){l.value!=t?i.invokeProxyMethodAsync(n,o,r):(s.RuntimeTelemetryHelper.LogExceptionTag("clientendpoint is invalid",t,a,18940552),o({status:e.DataServiceResultCode.ProxyNotReady}))}),(function(){s.RuntimeTelemetryHelper.LogExceptionTag("proxysetup failure",t,a,18940553),o({status:e.DataServiceResultCode.ProxyNotReady})}))},n.prototype.prepareProxy=function(){},n.prototype.doesUrlHaveSupportedProtocol=function(e){var n=!1;e&&(n=decodeURIComponent(e).match(/^https?:\/\/.+$/gi)!=t);return n},n.prototype.invokeProxyMethodAsync=function(n,r,o){var i,a=o||o.correlationId||"",l=[this.clientEndPoint._targetUrl,n];for(var d in o)("string"===(i=typeof o[d])||"number"===i||"boolean"===i)&&l.push(o[d]);var u=l.join("."),p=this._pendingRequests,f={onCompleted:r,methodName:n,correlationId:a},m=p[u];if(m)m.push(f);else{p[u]=[f];o||(o={}),o.officeVersion=c.Constants.ThreePartsFileVersion,this.clientEndPoint.invoke(n,(function(n,r){var o=t,i=0,a=e.DataServiceResultCode.Failed;0===n&&r.status&&(o=r.result,a=e.DataServiceResultCode.Succeeded);var l=p[u];delete p[u];for(var c=l.length,d=0;d<c;d++){var f=l.shift();try{r&&r.failureInfo&&(i=r.failureInfo.statusCode||t,r.failureInfo.result=r.result,s.RuntimeTelemetryHelper.LogProxyFailure(f.correlationId,f.methodName,r.failureInfo)),f.onCompleted({status:a,httpStatus:i,value:o})}catch(t){var m="invokeProxyMethodAsync failed";e.WACUtils.logExceptionToBrowserConsole(m,t),s.RuntimeTelemetryHelper.LogExceptionTag(m,t,f.correlationId,19015124)}}}),o)}},n}();e.ProxyBase=t}(p||(p={})),function(e){var t,n;!function(e){var t="ManifestRequest",n="KilledAppsCheck",r="AppStateCheck",o="EntitlementCheck",i="Authentication",a="ServerCall",s="Activation";e[e[s]=0]=s,e[e[a]=1]=a,e[e[i]=2]=i,e[e[o]=3]=o,e[e[r]=4]=r,e[e[n]=5]=n,e[e[t]=6]=t}(t=e.Activity||(e.Activity={})),function(e){var t="DmsRequestCachedFlag",n="ManifestRequestType",r="ActivationRuntimeType",o="AppStateDataInvalidFlag",i="AppStateDataCachedFlag",a="ManifestDataInvalidFlag",s="OmexHasEntitlementFlag",l="ManifestDataCachedFlag",c="ManifestTrustCachedFlag",d="RetryCount",u="AnonymousFlag";e[e[u]=0]=u,e[e[d]=1]=d,e[e[c]=2]=c,e[e[l]=3]=l,e[e[s]=4]=s,e[e[a]=5]=a,e[e[i]=6]=i,e[e[o]=7]=o,e[e[r]=8]=r,e[e[n]=9]=n,e[e[t]=10]=t}(n=e.FlagName||(e.FlagName={}));var r=function(){function r(e,t,n,r,o){var i=this;i.correlationId=e,i.perfContext=t,i.appInfo=n,i.assetId=r,i.instanceId=o}return r.prototype.startActivity=function(o){var i=this;switch(o){case t.Activation:var a=c.ActivationTypes.V2Enabled;return 0==(15&i.appInfo)&&e.S2SOmexCatalogService._requestHandler&&(a=c.ActivationTypes.V2S2SEnabled),s.AppLoadTimeHelper.ActivationStart(i.perfContext,i.appInfo,i.assetId,i.correlationId,i.instanceId,a),void i.setBits(n.ActivationRuntimeType,a)}s.AppLoadTimeHelper.StartStopwatch(i.perfContext,r.StopWatchName[o])},r.prototype.stopActivity=function(e){s.AppLoadTimeHelper.StopStopwatch(this.perfContext,r.StopWatchName[e])},r.prototype.setFlag=function(e,t){var n=t?2:1;this.setBits(e,n)},r.prototype.setBits=function(e,t){s.AppLoadTimeHelper.SetBit(this.perfContext,t,r.FlagOffsetMap[e],2)},r.FlagOffsetMap=[0,2,5,7,9,11,13,15,17,19,21],r.StopWatchName=["Stage1Time","Stage4Time","Stage5Time","Stage7Time","Stage9Time","Stage8Time","Stage10Time"],r}();e.ActivationTelemetryContext=r;var o=function(){function e(e){this.correlationId=e}return e.prototype.startActivity=function(){},e.prototype.stopActivity=function(){},e.prototype.setFlag=function(){},e.prototype.setBits=function(){},e}();e.AddinCommandsTelemetryContext=o;var i=function(){function e(e){this.correlationId=e}return e.prototype.startActivity=function(){},e.prototype.stopActivity=function(){},e.prototype.setFlag=function(){},e.prototype.setBits=function(){},e}();e.InsertDialogTelemetryContext=i;var a=function(){function e(){}return e.prototype.startActivity=function(){},e.prototype.stopActivity=function(){},e.prototype.setFlag=function(){},e.prototype.setBits=function(){},e}();e.SimpleTelemetryContext=a}(p||(p={})),function(e){var t=null,n=function(){var n=".";function r(n,r){void 0===r&&(r=t),this._initParam=n,this._cacheManager=r||new e.AppsDataCacheManager(c.OUtil.getLocalStorage(),new e.SafeSerializer)}return r.prototype.getEntitlementAsync=function(n,r,o){var i=this,a=i,s=[],l=[],d=n?i.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey():i.getUploadFileDevCatalogAddinsCacheKey(),u=i._cacheManager.GetCacheItem(d);u!=t&&(u.forEach((function(n){var r=a._cacheManager.GetCacheItem(a.getUploadFileDevCatalogManifestCacheKey(n));if(r!=t){var o=e.ManifestUtil.ParseManifest(r,a._initParam.appUILocale);if(o==t)return;var i={assetId:n,appVersion:o.getMarketplaceVersion(),storeId:"developer",storeType:c.StoreType.UploadFileDevCatalog,targetType:o.getTarget()};l.push(i),s.push(n)}})),s.length!=u.length&&(s.length>0?i._cacheManager.SetCacheItem(d,s):i._cacheManager.RemoveCacheItem(d))),o({status:e.DataServiceResultCode.Succeeded,value:l})},r.prototype.getAndCacheManifest=function(n,o,i,a){var s=this,l=c.OsfManifestManager.getCachedManifest(n.assetId,n.appVersion);if(l==t){var d=function(e,r,o){var i=s._cacheManager.GetCacheItem(s.getUploadFileDevCatalogManifestCacheKey(n.assetId));i==t&&e>=1?setTimeout((function(){return d(e-1,2*r,o)}),r):o(i)};d(r.GetManifestRetryLimit,r.GetManifestRetryWaitMs,(function(r){var o;r!=t&&(o=e.ManifestUtil.ParseManifest(r,s._initParam.appUILocale))!=t&&c.OsfManifestManager.cacheManifest(n.assetId,n.appVersion,o),a({status:o!=t?e.DataServiceResultCode.Succeeded:e.DataServiceResultCode.Failed,value:o})}))}else a({status:e.DataServiceResultCode.Succeeded,value:l})},r.prototype.activateAsync=function(n,r,o){var i=this;this.getAndCacheManifest(n,n.storeId,o,(function(a){if(a.status!=e.DataServiceResultCode.Succeeded)e.LoaderUtil.failWithError(r,{description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){r.restartActivation(),i.activateAsync(n,r,o)},errorCode:c.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE});else{var s=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();if(s&&s.enableSingleSignOnForAddin&&!r.isForCustomFunctionSandbox())a.value;r.load({entitlement:n,eToken:"",manifest:a.value},t)}}))},r.prototype.removeAsync=function(t,n,r){r({status:e.DataServiceResultCode.Failed})},r.prototype.getAppDetails=function(t,n,r,o){o({status:e.DataServiceResultCode.Failed})},r.prototype.validateAndCacheNewManifest=function(e,t,n,r){return!!this.validateAddinIdAndVersion(e,t)&&(this.cacheManifest(e,t,n,r),!0)},r.prototype.localCacheAddinCommands=function(e){this.cacheMyAddins(this.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey(),e)},r.prototype.validateAddinIdAndVersion=function(e,t){return r.idRegExp.test(e)&&r.versionRegExp.test(t)},r.prototype.cacheManifest=function(e,t,n,r){var o=this;c.OsfManifestManager.cacheManifest(e,t,r),o.cacheMyAddins(o.getUploadFileDevCatalogAddinsCacheKey(),e),o._cacheManager.SetCacheItem(o.getUploadFileDevCatalogManifestCacheKey(e),n)},r.prototype.cacheMyAddins=function(e,n){var r=this._cacheManager.GetCacheItem(e);r==t&&(r=[]),r.lastIndexOf(n)<0&&(r.push(n),this._cacheManager.SetCacheItem(e,r))},r.prototype.getUploadFileDevCatalogAddinsCacheKey=function(){return r.UploadFileCatalogCacheKey.myAddins+n+this._initParam.appName+n+this._initParam.userNameHashCode},r.prototype.getUploadFileDevCatalogAddinCommandsMyAddinsCacheKey=function(){return r.UploadFileCatalogCacheKey.addinCommandsMyAddins+n+this._initParam.appName+n+this._initParam.userNameHashCode},r.prototype.getUploadFileDevCatalogManifestCacheKey=function(e){return r.UploadFileCatalogCacheKey.manifest+n+this._initParam.appName+n+e},r.UploadFileCatalogCacheKeyPrefix="__OSF_UPLOADFILE.",r.UploadFileCatalogCacheKey={myAddins:r.UploadFileCatalogCacheKeyPrefix+"MyAddins",addinCommandsMyAddins:r.UploadFileCatalogCacheKeyPrefix+"AddinCommandsMyAddins",manifest:r.UploadFileCatalogCacheKeyPrefix+"Manifest"},r.idRegExp=new RegExp("[\\w-]+"),r.versionRegExp=new RegExp("(\\d{1,2}.)*\\d{1,2}"),r.GetManifestRetryLimit=4,r.GetManifestRetryWaitMs=500,r}();e.CatalogFactory.register(c.StoreType.UploadFileDevCatalog,(function(r){return r.enableUploadFileDevCatalog?new n({appName:r.appName,appUILocale:r.appUILocale,userNameHashCode:r.userNameHashCode}):new e.ForbiddenCatalog(t)}));var r=function(){var t="Should never here";function n(e,t){this._catalog=e,this._storeType=t}return n.prototype.validateAndCacheNewManifest=function(){throw t},n.prototype.getEntitlementsAsync=function(t,n,r,o){this._catalog.getEntitlementAsync(n,new e.AddinCommandsTelemetryContext(c.OUtil.Guid.generateNewGuid()),(function(e){o(e.value)}),!1,r)},n.prototype.getManifestAsync=function(){throw t},n.prototype.localCacheAddinCommands=function(e,t,n,r){this._storeType==c.StoreType.UploadFileDevCatalog&&this._catalog.localCacheAddinCommands(t,n,r)},n}(),o=function(){function n(){}return n.createAddinDataProvider=function(n){var o=e.CatalogFactory.resolve(n);return o==t?t:new r(o,n)},n}();e.AddinDataProviderFactory=o}(p||(p={})),function(e){var t=null,n=function(){var n=!0,r=!1;function o(n,o){var i=this;void 0===o&&(o=t),i._omex=t,i._addinListReady=r,i._entitlements=[],i._appDetails={},i._getEntitlementCallback=t,i._approvedAddIns=t,i._hostInfo=n,i._appUILocale=n.appUILocale,i._cacheManager=o||new e.AppsDataCacheManager(c.OUtil.getLocalStorage(),new e.SafeSerializer);try{i._approvedAddIns=JSON.parse(n.approvedAddinList)}catch(n){e.WACUtils.logExceptionToBrowserConsole("Fail to parse the JSON string of specified Approved Addins for Host",n),i._approvedAddIns=t}i.updateAddinList(n.wopiHostAddinList)}return o.prototype.getOmexCatalog=function(){var t=this;if(t._omex)return t._omex;var r,o=t._hostInfo.osfOmexBaseUrl.indexOf(c.Constants.ProtocolSeparator);r=o>=0?t._hostInfo.osfOmexBaseUrl.substr(o):c.Constants.ProtocolSeparator+t._hostInfo.osfOmexBaseUrl;var i=c.Constants.Https+r;return t._omex=new e.OmexCatalog({appName:t._hostInfo.appName,appUILocale:t._hostInfo.appUILocale,AppVersion:t._hostInfo.appVersion,clientMode:t._hostInfo.clientMode,docUrl:t._hostInfo.docUrl,omexBaseUrl:i,omexForceAnonymous:n}),t._omex},o.prototype.isAddinTrusted=function(e){return this._approvedAddIns&&e?-1==this._approvedAddIns.indexOf(e.toUpperCase())?r:n:r},o.prototype.updateAddinList=function(o){var i=this,a=i;i._entitlements=[];var s=t,l=r,d=r,u=r,p=r,f=r;try{s=JSON.parse(o)}catch(r){e.WACUtils.logExceptionToBrowserConsole("Fail to parse JSON string of Host Install Addins.",r),l=n,s=t}if(s)if(Array.isArray(s))for(var m=0,g=s;m<g.length;m++){var v=g[m];if(v.addinId){var h=void 0;if(v.type)try{h=c.OUtil.parseEnum(v.type,c.OfficeAppType)}catch(t){e.WACUtils.logExceptionToBrowserConsole("Incorrect targetType.",v.type),p=n;continue}else h=1;var y=c.OUtil.formatString(c.Constants.ConsentedCacheKey,v.addinId.toLowerCase(),c.StoreType.WopiCatalog,i._appUILocale),C=i.isAddinTrusted(v.addinId)||i._cacheManager.GetCacheItem(y,n)||r,_={assetId:v.addinId,storeType:c.StoreType.WopiCatalog,appVersion:"0.0.0.0",storeId:i._appUILocale,contentMarket:i._appUILocale,targetType:h,requireConsent:!C};i._entitlements.push(_)}else e.WACUtils.logExceptionToBrowserConsole("Required field missing: addinId.",v),u=n}else e.WACUtils.logExceptionToBrowserConsole("Received add-in list is not an array.",s),d=n;var S=i._entitlements.map((function(e){return e.assetId}));i.getOmexCatalog().getAppDetails(S,i._appUILocale,new e.SimpleTelemetryContext,(function(r){if(r.status!==e.DataServiceResultCode.Succeeded){var o=r.value.map((function(e){return e.assetId.toUpperCase()})),i=a._entitlements;a._entitlements=[];for(var s=0,c=i;s<c.length;s++){var m=c[s];-1==o.indexOf(m.assetId.toUpperCase())?(e.WACUtils.logExceptionToBrowserConsole("Can't find Office Add-in from Microsoft AppSource given addin ID.",m.assetId),f=n):a._entitlements.push(m)}}a._appDetails={};for(var g=0,v=r.value;g<v.length;g++)for(var h=v[g],y=0,C=a._entitlements;y<C.length;y++){m=C[y];if(h.assetId.toUpperCase()===m.assetId.toUpperCase()){h.storeType=m.storeType,a._appDetails[h.assetId.toUpperCase()]=h;break}}if(e.SDXCatalog.recordActivity("WopiCatalogUpdateAddinList",performance.now(),n,[{name:"JSONParseError",boolean:l},{name:"AddinListNotAnArray",boolean:d},{name:"RequiredFieldMissing",boolean:u},{name:"IncorrectTargetType:",boolean:p},{name:"AddinNoFound",boolean:f},{name:"AddinListNonEmpty",boolean:a._entitlements.length>0}]),a._addinListReady=n,a._getEntitlementCallback!=t){var _=a._getEntitlementCallback;a._getEntitlementCallback=t,_({status:e.DataServiceResultCode.Succeeded,value:a._entitlements})}}),r)},o.prototype.getEntitlementAsync=function(n,r,o){var i=this;if(i._addinListReady)o({status:e.DataServiceResultCode.Succeeded,value:i._entitlements});else if(r.startActivity(e.Activity.EntitlementCheck),i._getEntitlementCallback!=t){var a=i._getEntitlementCallback;i._getEntitlementCallback=function(t){r.stopActivity(e.Activity.EntitlementCheck),a(t),o(t)}}else i._getEntitlementCallback=function(t){r.stopActivity(e.Activity.EntitlementCheck),o(t)}},o.prototype.getAndCacheManifest=function(e,t,n,o,i){this.getOmexCatalog().getAndCacheManifest(e,t,n,o,i||r)},o.prototype.activateAsync=function(r,i,a){var s=this;a.startActivity(e.Activity.Activation);var l=this;this.isAddinEntitledAsync(r.assetId,(function(d){if(d.value){var u=c.OUtil.formatString(c.Constants.ConsentedCacheKey,r.assetId.toLowerCase(),r.storeType,r.storeId);s._cacheManager.SetCacheItem(u,n,o.ConsentedCacheRefreshRateInDays),l.getAndCacheManifest(r,s._appUILocale,a,(function(n){n.status===e.DataServiceResultCode.Succeeded?(a.stopActivity(e.Activity.Activation),i.load({entitlement:r,manifest:n.value,eToken:""},t)):(a.stopActivity(e.Activity.Activation),e.LoaderUtil.failWithError(i,{description:Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message,url:"",errorCode:c.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),l.activateAsync(r,i,a)}}))}))}else a.stopActivity(e.Activity.Activation),e.LoaderUtil.showWarning(i,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){i.restartActivation(),l.activateAsync(r,i,a)},detailView:n,retryAll:n,errorCode:c.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})}))},o.prototype.removeAsync=function(t,n,r){r({status:e.DataServiceResultCode.Failed})},o.prototype.getAppDetails=function(t,n,o,i){var a=this;this.getEntitlementAsync(r,new e.SimpleTelemetryContext,(function(){for(var n=[],r=e.DataServiceResultCode.Succeeded,o=0,s=t;o<s.length;o++){var l=s[o].toUpperCase();a._appDetails[l]?n.push(a._appDetails[l]):r=e.DataServiceResultCode.Failed}i({status:r,value:n})}))},o.prototype.isAddinEntitledAsync=function(t,o){this.getEntitlementAsync(r,new e.SimpleTelemetryContext,(function(i){if(i.status===e.DataServiceResultCode.Succeeded)for(var a=t.toUpperCase(),s=0,l=i.value;s<l.length;s++){if(l[s].assetId.toUpperCase()===a)return void o({status:e.DataServiceResultCode.Succeeded,value:n})}o({status:e.DataServiceResultCode.Succeeded,value:r})}))},o.ConsentedCacheRefreshRateInDays=180,o}();e.WOPICatalog=n,e.CatalogFactory.register(c.StoreType.WopiCatalog,(function(r){var o="TRUSTCENTER_CATALOG_UNTRUSTED";if(r.allowExternalMarketplace&&r.osfOmexBaseUrl&&r.enableWopiCatalog)return e.WACUtils.logExceptionToBrowserConsole("Registered WOPICatalog",t),new n(r);e.WACUtils.logExceptionToBrowserConsole("Cannot register WOPICatalog allowExternalMarketplace is: ",r.allowExternalMarketplace),e.WACUtils.logExceptionToBrowserConsole("Cannot register WOPICatalog osfOmexBaseUrl is: ",r.osfOmexBaseUrl),e.WACUtils.logExceptionToBrowserConsole("Cannot register WOPICatalog enableWopiCatalog is: ",r.enableWopiCatalog);var i=!("undefined"==typeof Strings||Strings===t);return new e.ForbiddenCatalog({loaderParams:e.LoaderUtil.error({title:i?Strings.OsfRuntime.L_AgaveErrorTile_TXT:o,buttonTxt:i?Strings.OsfRuntime.L_OkButton_TXT:"OK",description:i?Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR:o,errorCode:c.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED}),controlStatus:c.OsfControlStatus.ActivationFailed})}))}(p||(p={})),function(e){!function(e){var t="Unauthenticated",n="UnknownUserType",r="PrxoyUrlEmpty",o="ProxyNotReady",i="Succeeded";e[e[i]=1]=i,e[e.Failed=0]="Failed",e[e[o]=-1]=o,e[e[r]=-2]=r,e[e[n]=2]=n,e[e[t]=3]=t}(e.DataServiceResultCode||(e.DataServiceResultCode={}))}(p||(p={})),function(e){var t=function(){var t=null;function n(n,r){void 0===r&&(r=t),this._initParam=n,this._cacheManager=r||new e.AppsDataCacheManager(c.OUtil.getLocalStorage(),new e.SafeSerializer)}return n.LogFirstPartyCatalogMonitoringError=function(e,n){s.RuntimeTelemetryHelper.LogExceptionTag("First Party Catalog Error AssetId: "+n+" Message: "+e,t,t,39068e3)},n.prototype.getEntitlementAsync=function(){throw new Error("in firstParty get Entitlementasync")},n.prototype.getAndCacheManifest=function(){throw new Error("in firstParty getAndCacheManifest")},n.prototype.removeAsync=function(){throw new Error("in firstParty removeAsync")},n.prototype.getAppDetails=function(){throw new Error("in firstParty getappDetails")},n.prototype.TryFallBackFirstPartyAddInList=function(r,o,i){var a=this._cacheManager.GetCacheItem(e.CacheConsts.firstPartyAddinListCacheKey,!1);a?(n.LogFirstPartyCatalogMonitoringError("Falling back to stale 1st party add-ins list.",o),i({status:e.DataServiceResultCode.Succeeded,value:a})):i({status:e.DataServiceResultCode.Failed,value:t})},n.prototype.GetFirstyPartyAddInsInfo=function(n,r,o,i){var a=this,l=this._cacheManager.GetCacheItem(e.CacheConsts.firstPartyAddinListCacheKey,!0,t,t,!1);if(l){var c={addInList:l,refreshRate:t};i({status:e.DataServiceResultCode.Succeeded,value:c})}else n.getFirstPartyAddInList((function(n){if(n.status==e.DataServiceResultCode.Succeeded){var l=t;try{l=e.OmexXmlProcessor.ProcessFirstPartyAddInList(n.value)}catch(e){return s.RuntimeTelemetryHelper.LogExceptionTag("Problem parsing first party list.",e,r.correlationId,34366472),void a.TryFallBackFirstPartyAddInList(r,o,i)}a._cacheManager.SetCacheItem(e.CacheConsts.firstPartyAddinListCacheKey,l.addInList,l.refreshRate/e.CacheConsts.hourToDayConversionFactor),i({status:e.DataServiceResultCode.Succeeded,value:l})}else a.TryFallBackFirstPartyAddInList(r,o,i)}))},n.prototype.TryFallBackFirstPartyManifest=function(r,o,i){var a=this.ReadFirstPartyManifestFromLocalStorage(o,r);a?(n.LogFirstPartyCatalogMonitoringError("Falling back to stale manifest.",r),i({status:e.DataServiceResultCode.Succeeded,value:a})):i({status:e.DataServiceResultCode.Failed,value:t})},n.prototype.ReadFirstPartyManifestFromLocalStorage=function(n,r){var o=c.OUtil.formatString(e.CacheConsts.firstPartyManifestCacheKey,r),i=this._cacheManager.GetCacheItem(o,!1);return i?e.ManifestUtil.ParseManifest(i,this._initParam.appUILocale,n.correlationId):t},n.prototype.GetCachedManifest=function(e,t){var n=c.OsfManifestManager.getCachedManifest(t,"");return n||(n=this.ReadFirstPartyManifestFromLocalStorage(e,t))&&c.OsfManifestManager.cacheManifest(t,"",n),n},n.prototype.GetFirstPartyManifest=function(t,n,r,o){var i=this,a=this.GetCachedManifest(n,r.assetId);if(!a||c.OsfManifestManager.versionLessThan(a.getMarketplaceVersion(),r.version)){var s=c.OUtil.formatString("{0}/{1}",this._initParam.firstPartyManifestCDNUrl,r.path);t.getFirstPartyManifest(s,(function(t){if(t.status==e.DataServiceResultCode.Succeeded){var a=e.ManifestUtil.ParseManifest(t.value,i._initParam.appUILocale,n.correlationId);if(a){c.OsfManifestManager.cacheManifest(r.assetId,"",a);var s=c.OUtil.formatString(e.CacheConsts.firstPartyManifestCacheKey,r.assetId);i._cacheManager.SetCacheItem(s,t.value),o({status:e.DataServiceResultCode.Succeeded,value:a})}else i.TryFallBackFirstPartyManifest(r.assetId,n,o)}else i.TryFallBackFirstPartyManifest(r.assetId,n,o)}))}else o({status:e.DataServiceResultCode.Succeeded,value:a})},n.prototype.getDataService=function(n,r){var o=this,i=o;if(o._dataService==t){var a={status:e.DataServiceResultCode.Failed,value:t},s=function(t,n){t.status==e.DataServiceResultCode.Succeeded?(i._dataService=n,a.value=n,a.status=e.DataServiceResultCode.Succeeded,r(a)):(a.httpStatus=t.httpStatus,r(a))},l=e.ProxyBasedCatalogService.getFirstPartyInstance(o._initParam);l.prepareProxy(n.correlationId,(function(e){s(e,l)}))}else r({status:e.DataServiceResultCode.Succeeded,value:o._dataService})},n.prototype.createActivityScope=function(t,n){var r=this;this.getDataService(t,(function(o){if(!e.AsyncUtil.failed(o,n)){var i=o.value,a={cacheManager:r._cacheManager,cachePrefix:e.CacheConsts.anonymousCacheKeyPrefix,cid:i.getCID(),anonymous:!0,telemetryContext:t},s=i.createScope(a);n({status:e.DataServiceResultCode.Succeeded,value:s})}}))},n.prototype.activateAsync=function(r,o,i){var a=this,s=a;i.startActivity(e.Activity.Activation),i.startActivity(e.Activity.ServerCall);var l=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),d=l&&l.enableFirstPartySDXErrorMessages;if(a._cacheManager.GetCacheItem(e.CacheConsts.firstPartyAddinListCacheKey,!0,t,t,!1)){var u=a.GetCachedManifest(i,r.assetId);if(u)return i.stopActivity(e.Activity.ServerCall),void o.load({entitlement:r,manifest:u,eToken:""},t)}a.createActivityScope(i,(function(a){if(a.status!=e.DataServiceResultCode.Succeeded)return n.LogFirstPartyCatalogMonitoringError("Failed to create 1st party activity scope.",r.assetId),void e.LoaderUtil.failWithError(o,{title:d?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:d?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){o.restartActivation(),s.activateAsync(r,o,i)},errorCode:c.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError});var l=a.value;s.GetFirstyPartyAddInsInfo(l,i,r.assetId,(function(a){if(a.status!=e.DataServiceResultCode.Succeeded)return n.LogFirstPartyCatalogMonitoringError("Failed get list of 1st party addIns.",r.assetId),void e.LoaderUtil.failWithError(o,{title:d?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:d?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){o.restartActivation(),s.activateAsync(r,o,i)},errorCode:c.ErrorStatusCodes.WAC_FirstPartyAddInListRequestFailure});var u=a.value.addInList[r.assetId];if(!u)return n.LogFirstPartyCatalogMonitoringError("Could not find 1st party addin assetId in list.",r.assetId),void e.LoaderUtil.failWithError(o,{title:d?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:d?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){o.restartActivation(),s.activateAsync(r,o,i)},errorCode:c.ErrorStatusCodes.WAC_FirstPartyAddInListRequestFailure});i.startActivity(e.Activity.ManifestRequest),s.GetFirstPartyManifest(l,i,u,(function(a){if(a.status!=e.DataServiceResultCode.Succeeded)return n.LogFirstPartyCatalogMonitoringError("Could not get 1st party manifest.",r.assetId),void e.LoaderUtil.failWithError(o,{title:d?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:d?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){o.restartActivation(),s.activateAsync(r,o,i)},errorCode:c.ErrorStatusCodes.WAC_AgaveManifestRequestFailure});i.stopActivity(e.Activity.ManifestRequest),i.stopActivity(e.Activity.ServerCall);var l=a.value;o.load({entitlement:r,manifest:l,eToken:""},t)}))}))}))},n}();e.FirstPartyCatalog=t,e.CatalogFactory.register(c.StoreType.FirstParty,(function(n){if(n.osfOmexBaseUrl&&n.firstPartyManifestCDNUrl){var r,o=n.osfOmexBaseUrl.indexOf(c.Constants.ProtocolSeparator);r=o>=0?n.osfOmexBaseUrl.substr(o):c.Constants.ProtocolSeparator+n.osfOmexBaseUrl;var i=c.Constants.Https+r;return new t({appName:n.appName,appUILocale:n.appUILocale,AppVersion:n.appVersion,clientMode:n.clientMode,docUrl:n.docUrl,omexBaseUrl:i,omexForceAnonymous:!0,firstPartyManifestCDNUrl:n.firstPartyManifestCDNUrl})}return new e.ForbiddenCatalog({loaderParams:e.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR,errorCode:c.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED}),controlStatus:c.OsfControlStatus.ActivationFailed})}))}(p||(p={})),function(e){var t=function(){var e="OMEX_clearCacheAsync",t="OMEX_removeCacheAsync",n="OMEX_getAppStateAsync",r="OMEX_getKilledAppsAsync",o="OMEX_getManifestAndETokenAsync";function i(){}return i.CheckProxyIsReady="OMEX_isProxyReady",i.Gated_GetManifestAndEToken=o,i.Gated_GetKilledApps=r,i.Gated_GetEntitlementSummary="OMEX_getEntitlementSummaryAsync",i.Gated_GetAppState=n,i.Gated_RemoveApp="OMEX_removeAppAsync",i.Gated_RemoveCache=t,i.Gated_ClearCache=e,i.UnGated_GetAppDetails="OMEX_getAppDetailsAsync",i.UnGated_GetRecommendations="OMEX_getRecommendationsAsync",i.UnGated_ClearCache=e,i.Anonymous_GetManifestAndEToken=o,i.Anonymous_GetKilledApps=r,i.Anonymous_GetAppState=n,i.Anonymous_RemoveCache=t,i.Anonymous_ClearCache=e,i.Anonymous_GetAuthNStatus="OMEX_getAuthNStatus",i.Anonymous_GetFirstPartyAddInList="OMEX_getFirstPartyAddInListAsync",i.Anonymous_GetFirstPartyManifest="OMEX_getFirstPartyManifestAsync",i}();e.OmexProxyMethods=t;var n=function(n){var r=null;function o(e){var t=n.call(this)||this;return t.osfOmexBaseUrl=e,t}return i(o,n),o.prototype.prepareProxy=function(e,t,n){var i=this;n&&(i.isReady=!1,o.resetProxy(i)),i.isReady?e({status:r,value:{clientEndpoint:i.clientEndPoint}}):i.clientEndPoint?i.pendingCallbacks.push([e,t]):i.createProxy(e,t)},o.resetProxy=function(e){Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(e.conversationId)&&Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(e.conversationId),e.iframe&&(c.OUtil.removeEventListener(e.iframe,"load",e.iframeOnload),e.iframe.parentNode.removeChild(e.iframe),e.iframe=r),e.clientEndPoint=r},o.prototype.createProxy=function(n,i){var a=this;try{!a.doesUrlHaveSupportedProtocol(a.proxyUrl)&&i({status:r,value:{errorMessage:"Protocal of proxyUrl is not supported."}});var l=document.createElement("iframe");l.setAttribute("id",a.proxyName),l.setAttribute("name",a.proxyName);var d=a.proxyUrl+"?"+a.conversationId,u=window.location.origin;d=c.OUtil.addXdmInfoAsHash(d,a.conversationId+"|"+a.proxyName+"|"+u),d=c.OUtil.addSerializerVersionAsHash(d,c.SerializerVersion.Browser),d=c.OUtil.addFlightsAsHash(d,JSON.stringify(c.Flights)),l.setAttribute("src",d),l.setAttribute("scrolling","auto"),l.setAttribute("border","0"),l.setAttribute("width","0"),l.setAttribute("height","0"),l.setAttribute("style","position: absolute; left: -100px; top:0px;");var p=500;a.proxyName===c.Constants.OmexAnonymousServiceName&&c.OUtil.checkFlight(c.FlightNames.FirstPartyAnonymousProxyReadyCheckTimeout)&&(p=5e3),document.body.appendChild(l);var f=a,m=function(){if(f.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(f.conversationId,l.contentWindow,f.proxyUrl),f.clientEndPoint)f.clientEndPoint.invoke(t.CheckProxyIsReady,(function(e,t){var n=f.pendingCallbacks.length;if(0!=n){var i=r;0===e&&t.status?(f.isReady=!0,i={status:r,value:{clientEndpoint:f.clientEndPoint}}):(o.resetProxy(f),i={status:r,value:{errorMessage:"OmexProxyBase::onIframeLoad::isProxyReadyCallback failed, error code "+e}});for(var a=0;a<n;a++){var s=f.pendingCallbacks.shift();f.isReady?s[0](i):s[1](i)}}}),{__timeout__:p});else{var e="Unexpected error, iframe loaded again after failing OMEX_isProxyReady";s.RuntimeTelemetryHelper.LogExceptionTag(e,r,r,18121820),i({status:r,value:{errorMessage:e}})}c.OUtil.set_entropy((new Date).getTime())};c.OUtil.addEventListener(l,"load",m),a.iframeOnload=m,a.pendingCallbacks.push([n,i]),a.iframe=l}catch(t){var g="Error creating client endpoint with proxyUrl = ["+a.proxyUrl+"], msg:"+e.WACUtils.serializeObjectToString(t);i({status:r,value:{errorMessage:g}})}},o}(e.ProxyBase);e.OmexProxyBase=n}(p||(p={})),function(e){var t=function(t){function n(e){var n=t.call(this,e)||this;return n.proxyName=c.Constants.OmexAnonymousServiceName,n.proxyUrl=n.osfOmexBaseUrl+c.Constants.OmexAnonymousServiceExtension,n}return i(n,t),n.prototype.getManifestAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetManifestAndEToken,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertClientAppInstallInfo(t.value)),n(t)}))},n.prototype.getFirstPartyAddInListAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetFirstPartyAddInList,t,(function(e){n(e)}))},n.prototype.getFirstPartyManifestAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetFirstPartyManifest,t,(function(e){n(e)}))},n.prototype.getAppStateAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetAppState,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertAppState(t.value)),n(t)}))},n.prototype.getKilledAppAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetKilledApps,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertKilledAppsInfo(t.value)),n(t)}))},n.prototype.getAuthNStatusAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.Anonymous_GetAuthNStatus,t,n)},n}(e.OmexProxyBase);e.AnonymousOmexProxy=t}(p||(p={})),function(e){var t=function(t){var n=null;function r(e){var n=t.call(this,e)||this;return n.proxyName=c.Constants.OmexGatedServiceName,n.proxyUrl=n.osfOmexBaseUrl+c.Constants.OmexGatedServiceExtension,n}return i(r,t),r.prototype.getOmexEntitlementsAsync=function(t,r){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_GetEntitlementSummary,t,(function(t){t.value!=n&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertEntitlementInfo(t.value)),r(t)}))},r.prototype.getManifestAndETokenAsync=function(t,r){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_GetManifestAndEToken,t,(function(t){t.value!=n&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertClientAppInstallInfo(t.value)),r(t)}))},r.prototype.getAppStateAsync=function(t,r){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_GetAppState,t,(function(t){t.value!=n&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertAppState(t.value)),r(t)}))},r.prototype.getKilledAppAsync=function(t,r){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_GetKilledApps,t,(function(t){t.value!=n&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertKilledAppsInfo(t.value)),r(t)}))},r.prototype.removeApps=function(t,r){this.invokeProxyCommandAsync(e.OmexProxyMethods.Gated_RemoveApp,t,(function(t){t.value!=n&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertRemoveAppResponse(t.value)),r(t)}))},r}(e.OmexProxyBase);e.GatedOmexProxy=t}(p||(p={})),function(e){var t,n="",r=null;!function(e){var t="AnonymousUser",n="AuthedUser",r="NotDetected";e[e[r]=0]=r,e[e[n]=1]=n,e[e[t]=2]=t}(t||(t={}));var o=function(){function o(n){var r=this;r.currentUserType=t.NotDetected,r.omexAuthNStatus=c.OmexAuthNStatus.NotAttempted,r.omexAuthConnectTries=1,r.initParams=n,r.gatedProxy=new e.GatedOmexProxy(n.omexBaseUrl),r.ungatedProxy=new e.UnGatedOmexProxy(n.omexBaseUrl),r.anonymousProxy=new e.AnonymousOmexProxy(n.omexBaseUrl)}return o.getInstance=function(e){return o._instance==r&&(o._instance=new o(e)),o._instance},o.getFirstPartyInstance=function(e){if(o._firstPartyInstance==r){var t=new o(e);t._isFirstParty=!0,t.omexAuthNStatus=c.OmexAuthNStatus.Anonymous,this._firstPartyInstance=t}return o._firstPartyInstance},o.prototype.prepareProxy=function(o,i){var a=this;o=o||n;this.ensureOmexProxySetUp(o,(function(n){var o;n&&n.status!=r?n.status:e.DataServiceResultCode.ProxyNotReady;n&&n.value&&(a._isFirstParty?o=!0:n.value.currentUserType&&(n.value.currentUserType==t.AuthedUser?o=!1:n.value.currentUserType==t.AnonymousUser&&(o=!0))),i({status:n.status,value:{anonymous:o}})}))},o.prototype.createScope=function(e){return new a(e,this)},o.prototype.getCID=function(){switch(this.currentUserType){case t.AuthedUser:return this._cid;case t.AnonymousUser:return n}throw"not initialized"},o.prototype.ensureOmexProxySetUp=function(o,i){var a=this;if(a.currentUserType==t.NotDetected||!a.anonymousProxy.isReady&&!a.gatedProxy.isReady){var l=a,d=function(){l.currentUserType=t.AuthedUser,i({status:e.DataServiceResultCode.Succeeded,value:l})},u=function(){l.omexAuthConnectTries<c.Constants.AuthenticatedConnectMaxTries?(l.omexAuthConnectTries++,l.omexAuthNStatus!==c.OmexAuthNStatus.CheckFailed?l.anonymousProxy.prepareProxy(p,m):l.gatedProxy.prepareProxy(d,u)):(s.RuntimeTelemetryHelper.LogExceptionTag("exceed maximum tries and fail",r,o,18657693),l.anonymousProxy.prepareProxy(f,m))},p=function(e){if(e&&e.value){l.anonymousProxy.getAuthNStatusAsync({correlationId:o},(function(e){if(e.status===c.ProxyCallStatusCode.Succeeded){var t=e.value;t==c.OmexAuthNStatus.Authenticated?(l.omexAuthNStatus=c.OmexAuthNStatus.Authenticated,l.gatedProxy.prepareProxy(d,u)):t!=c.OmexAuthNStatus.Anonymous&&t!=c.OmexAuthNStatus.Unknown||(l.omexAuthNStatus=c.OmexAuthNStatus.Anonymous,l.anonymousProxy.prepareProxy(f,m))}else s.RuntimeTelemetryHelper.LogExceptionTag("auth check failure.",r,o,18657694),l.omexAuthNStatus=c.OmexAuthNStatus.CheckFailed,l.initParams.omexForceAnonymous?l.anonymousProxy.prepareProxy(f,m):l.gatedProxy.prepareProxy(d,u)}))}else s.RuntimeTelemetryHelper.LogExceptionTag("GetAuthNStatus callback param invalid",r,o,18657695)},f=function(n){l.omexAuthNStatus==c.OmexAuthNStatus.NotAttempted?p(n):(l.currentUserType=t.AnonymousUser,i({status:e.DataServiceResultCode.Succeeded,value:l}))},m=function(t){var a=n;void 0!==t&&t.value&&t.value.errorMessage&&(a=t.value.errorMessage),s.RuntimeTelemetryHelper.LogExceptionTag("create anonymous proxy failure: "+a,r,o,18657696),i({status:e.DataServiceResultCode.ProxyNotReady})};l.initParams.omexForceAnonymous?l.anonymousProxy.prepareProxy(f,m):l.gatedProxy.prepareProxy(d,u)}else i({status:e.DataServiceResultCode.Succeeded,value:a})},o}();e.ProxyBasedCatalogService=o;var i=function(){function e(){}return e.dummyApplicationName="unused",e}(),a=function(){var o="contentMarket",a="assetID",d="applicationName",u="errors";function p(e,t){var r=this;r._build=c.Constants.FileVersion,r._catalogService=t,r._appVersion=c.OmexAppVersions[r._catalogService.initParams.appName],r._clientName=c.OmexClientNames[r._catalogService.initParams.appName],r._clientVersion=l.getClientVersionFromWACAppVersion(r._catalogService.initParams.AppVersion),r._correlationId=e.telemetryContext.correlationId||n}return p.prototype.getFirstPartyAddInList=function(e){var t=this.buildOmexRequestParameters();t[u]={},this._catalogService.anonymousProxy.getFirstPartyAddInListAsync(t,e)},p.prototype.getFirstPartyManifest=function(e,t){var n=this.buildOmexRequestParameters();n[u]={},n.manifestUrl=e,this._catalogService.anonymousProxy.getFirstPartyManifestAsync(n,t)},p.prototype.tryFail=function(t,n,r){return t!=e.DataServiceResultCode.Succeeded&&(r({status:t}),!0)},p.prototype.isUserTypeValid=function(e){return e!==t.NotDetected||(s.RuntimeTelemetryHelper.LogExceptionTag("userType is invalid.",r,this._correlationId,18657698),!1)},p.prototype.getEntitlementAsync=function(n,r,o){var a=this,s=a,l=a.buildOmexRequestParameters();l[d]=i.dummyApplicationName,l.appVersion=a._appVersion,l.clearEntitlement=o||!1;var c=a._catalogService.currentUserType;a.isUserTypeValid(c)?c===t.AuthedUser?a._catalogService.gatedProxy.getOmexEntitlementsAsync(l,(function(e){s.tryFail(e.status,e.httpStatus,r)||(s._catalogService._cid=e.value.cid,r(e))})):c===t.AnonymousUser&&r({status:e.DataServiceResultCode.Succeeded,value:{refreshRate2:0,entitlements:[]}}):r({status:e.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,entitlements:[]}})},p.prototype.getLastStoreUpdate=function(){},p.prototype.isStoreDisabled=function(t){t({status:e.DataServiceResultCode.Succeeded,value:!1})},p.prototype.getManifest=function(t,r,o){this.getETokenAndManifestInternal(t,r,c.ClientAppInfoReturnType.urlOnly,(function(t){var r=t&&t.value&&t.value.manifest?t.value.manifest:n,i=t&&t.value&&t.value.status2?t.value.status2:c.OmexClientAppStatus.ServerError,a=t?t.status:e.DataServiceResultCode.Failed;o({status:a,value:{status2:i,manifest:r}})}))},p.prototype.getEToken=function(e,t,n){this.getETokenAndManifestInternal(e,t,c.ClientAppInfoReturnType.etokenOnly,n)},p.prototype.getETokenAndManifest=function(e,t,n){this.getETokenAndManifestInternal(e,t,c.ClientAppInfoReturnType.both,n)},p.prototype.getAppState=function(r,i){var s=this,l=s,c=s.buildOmexRequestParameters();c[a]=r.assetId,c[o]=r.storeId,c[u]={};var d=s._catalogService.currentUserType;s.isUserTypeValid(d)?d===t.AuthedUser?s._catalogService.gatedProxy.getAppStateAsync(c,(function(e){l.tryFail(e.status,e.httpStatus,i)?l.logServiceCallResponseError("appstate",e.httpStatus):i(e)})):d===t.AnonymousUser&&s._catalogService.anonymousProxy.getAppStateAsync(c,i):i({status:e.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,assetId:n,productId:n,version:n,state2:-1}})},p.prototype.getKilledApps=function(n){var o=this,i=o,a=o.buildOmexRequestParameters(),s=o._catalogService.currentUserType;o.isUserTypeValid(s)?s===t.AuthedUser?o._catalogService.gatedProxy.getKilledAppAsync(a,(function(e){i.tryFail(e.status,e.httpStatus,n)?i.logServiceCallResponseError("killedapps",e.httpStatus):n(e)})):s===t.AnonymousUser&&o._catalogService.anonymousProxy.getKilledAppAsync(a,n):n({status:e.DataServiceResultCode.UnknownUserType,value:{refreshRate2:0,killedApps:r}})},p.prototype.getAppDetails=function(e,t,r){var i=this,s=this.buildOmexRequestParameters();s.assetid=n,s[a]=e.join(","),s[o]=t,this._catalogService.ungatedProxy.getAppDetailsAsync(s,(function(e){i.tryFail(e.status,e.httpStatus,r)?i.logServiceCallResponseError("appdetails",e.httpStatus):r(e)}))},p.prototype.removeApps=function(r,o){var i=this,s=i,l=i.buildOmexRequestParameters();l.assetid=n,l[a]=r.join(",");var c=i._catalogService.currentUserType;i.isUserTypeValid(c)?c===t.AuthedUser?i._catalogService.gatedProxy.removeApps(l,(function(e){s.tryFail(e.status,e.httpStatus,o)?s.logServiceCallResponseError("removeapps",e.httpStatus):o(e)})):c===t.AnonymousUser&&o({status:e.DataServiceResultCode.Succeeded,value:{removedApps:[]}}):o({status:e.DataServiceResultCode.UnknownUserType,value:{removedApps:[]}})},p.prototype.getETokenAndManifestInternal=function(s,l,u,p){var f=this,m=f,g=f.buildOmexRequestParameters();g[d]=i.dummyApplicationName,g[a]=s.assetId,g.clientAppInfoReturnType=u;var v=f._catalogService.currentUserType;f.isUserTypeValid(v)?v===t.AuthedUser&&u!=c.ClientAppInfoReturnType.urlOnly?(g.assetContentMarket=l,g.userContentMarket=s.storeId,g.expectedVersion=s.appVersion,f._catalogService.gatedProxy.getManifestAndETokenAsync(g,(function(e){m.tryFail(e.status,e.httpStatus,p)?m.logServiceCallResponseError("manifestandetoken",e.httpStatus):p(e)}))):(g[o]=s.storeId,g.clientAppInfoReturnType==c.ClientAppInfoReturnType.etokenOnly?p({status:e.DataServiceResultCode.Succeeded,value:{status2:c.OmexClientAppStatus.OK,etoken:n,manifest:r}}):f._catalogService.anonymousProxy.getManifestAsync(g,(function(e){m.tryFail(e.status,e.httpStatus,p)?m.logServiceCallResponseError("manifest",e.httpStatus):p(e)}))):p({status:e.DataServiceResultCode.UnknownUserType,value:{etoken:n,manifest:r}})},p.prototype.buildOmexRequestParameters=function(){var e=this;return{clientName:e._clientName,clientVersion:e._clientVersion,correlationId:e._correlationId,build:e._build}},p.prototype.logServiceCallResponseError=function(e,t){var n="proxybased request "+e+" failed";t&&(n+=":"+t),s.RuntimeTelemetryHelper.LogExceptionTag(n,r,this._correlationId,18657697)},p}();e.ProxyBasedCatalogServiceScope=a;var l=function(){function e(){}return e.getClientVersionFromWACAppVersion=function(e){if(e){var t=e.split("."),n=parseInt(t[0],10),r=parseInt(t[1],10)||0;if(!(n<=15&&r<=0)){var o=c.Constants.FileVersion.split(".");return n+"."+r+"."+o[2]+"."+o[3]}}},e.getOmexEndPointPageUrl=function(e,t,n){return c.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",e,n,t)},e}();e.OmexUtils=l}(p||(p={})),function(e){var t=function(t){function n(e){var n=t.call(this,e)||this;return n.proxyName=c.Constants.OmexUnGatedServiceName,n.proxyUrl=n.osfOmexBaseUrl+c.Constants.OmexUnGatedServiceExtension,n}return i(n,t),n.prototype.getAppDetailsAsync=function(t,n){this.invokeProxyCommandAsync(e.OmexProxyMethods.UnGated_GetAppDetails,t,(function(t){null!=t.value&&t.status==e.DataServiceResultCode.Succeeded&&(t.value=e.OmexXmlProcessor.ConvertAppDetails(t.value)),n(t)}))},n}(e.OmexProxyBase);e.UnGatedOmexProxy=t}(p||(p={})),function(e){var t=!1,n=null,r=!0,o=function(){var o="cacheExpired";function i(e,t){var n=this;n._initParam=t,n._cacheManager=e.cacheManager,n._cachePrefix=e.cachePrefix,n._cid=e.cid,n._anonymous=e.anonymous,n._telemetryContext=e.telemetryContext}return i.prototype.GetCacheKeyPrefix=function(){return this._cachePrefix},i.prototype.getOmexEndPointPageUrl=function(t,n){return e.OmexUtils.getOmexEndPointPageUrl(this._initParam.omexBaseUrl,t,n)},i.prototype.getKilledApps=function(t,o,i){var a=this,s=a;a._telemetryContext.startActivity(e.Activity.KilledAppsCheck);var l=c.OUtil.formatString(e.CacheConsts.killedAppsCacheKey,a.GetCacheKeyPrefix());if(i)a._cacheManager.RemoveCacheItem(l);else{var d=a._cacheManager.GetCacheItem(l,r);if(d&&d.refreshRate2!=n)return a._telemetryContext.stopActivity(e.Activity.KilledAppsCheck),void o({status:e.DataServiceResultCode.Succeeded,value:d})}t.getKilledApps((function(t){t.status==e.DataServiceResultCode.Succeeded?(s._telemetryContext.stopActivity(e.Activity.KilledAppsCheck),d=t.value,s._cacheManager.SetCacheItem(l,d,d.refreshRate/e.CacheConsts.hourToDayConversionFactor),o(t)):o(t)}))},i.prototype.getAppState=function(i,a,s,l){var d=this,u=d;d._telemetryContext.startActivity(e.Activity.AppStateCheck);var p,f=c.OUtil.formatString(e.CacheConsts.appStateCacheKey,d.GetCacheKeyPrefix(),a.storeId,a.assetId);if(l)d._cacheManager.RemoveCacheItem(f);else{var m={};if(p=d._cacheManager.GetCacheItem(f,r,m),d._telemetryContext.setFlag(e.FlagName.AppStateDataInvalidFlag,m[o]||t),p&&p.state2!=n)return d._telemetryContext.stopActivity(e.Activity.AppStateCheck),d._telemetryContext.setFlag(e.FlagName.AppStateDataCachedFlag,r),void s({status:e.DataServiceResultCode.Succeeded,value:p})}i.getAppState(a,(function(n){n.status==e.DataServiceResultCode.Succeeded?(u._telemetryContext.stopActivity(e.Activity.AppStateCheck),u._telemetryContext.setFlag(e.FlagName.AppStateDataCachedFlag,t),p=n.value,u._cacheManager.SetCacheItem(f,p,p.refreshRate2/e.CacheConsts.hourToDayConversionFactor),s(n)):s(n)}))},i.prototype.getManifest=function(i,a,s,l,d){var u=this,p=u;u._telemetryContext.startActivity(e.Activity.ManifestRequest);var f,m=c.OUtil.formatString(e.CacheConsts.anonymousAppInstallInfoCacheKey,a.assetId,a.storeId);if(d)u._cacheManager.RemoveCacheItem(m);else{var g={};if(f=u._cacheManager.GetCacheItem(m,r,g),u._telemetryContext.setFlag(e.FlagName.ManifestDataInvalidFlag,g[o]||t),f&&f.status2!=n)return u._telemetryContext.stopActivity(e.Activity.ManifestRequest),u._telemetryContext.stopActivity(e.Activity.ServerCall),u._telemetryContext.setFlag(e.FlagName.ManifestDataCachedFlag,r),void l({status:e.DataServiceResultCode.Succeeded,value:{status2:f.status2,manifest:f.manifest}})}i.getManifest(a,s,(function(n){n.status==e.DataServiceResultCode.Succeeded&&n.value.status2==c.OmexClientAppStatus.OK?(p._telemetryContext.stopActivity(e.Activity.ManifestRequest),p._telemetryContext.stopActivity(e.Activity.ServerCall),p._telemetryContext.setFlag(e.FlagName.ManifestDataCachedFlag,t),p._telemetryContext.setBits(e.FlagName.ManifestRequestType,c.ManifestRequestTypes.Manifest),f={etoken:"",status2:n.value.status2,manifest:n.value.manifest},p._cacheManager.SetCacheItem(m,f,e.CacheConsts.manifestRefreshRate),l(n)):l(n)}))},i.prototype.removeApps=function(n,o,i){var a=this;n.removeApps(o,(function(n){if(n.status==e.DataServiceResultCode.Succeeded){for(var o=".*",s=t,l=[],d=n.value.removedApps,u=0;u<d.length;++u)d[u].result2==c.OmexRemoveAppStatus.Success&&(l.push(new RegExp(c.OUtil.formatString(e.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,o,d[u].assetId,o,o),"i")),s=r);s&&a._cacheManager.RemoveMatches(l),i(n)}else i(n)}))},i.prototype.getCachedETokenAndManifest=function(i){var a={},s=this._cacheManager.GetCacheItem(i,r,a);if(this._telemetryContext.setFlag(e.FlagName.ManifestDataInvalidFlag,a[o]||t),s){if(s.status2&&s.tokenExpirationDate2&&s.tokenExpirationDate2>(new Date).getTime())return s;s.etoken=n,s.tokenExpirationDate2=n,s.entitlementType=n}return s},i.prototype.getETokenAndManifest=function(o,i,a,l,d){var u=this,p=u;if(u._anonymous)u.getManifest(o,i,a,(function(t){e.AsyncUtil.failed(t,l)||l({status:t.status,value:{etoken:"",status2:t.value.status2,manifest:t.value.manifest}})}),d);else{u._telemetryContext.startActivity(e.Activity.ManifestRequest);var f,m=function(t,n){p._telemetryContext.stopActivity(e.Activity.ManifestRequest),p._telemetryContext.stopActivity(e.Activity.ServerCall),p._telemetryContext.setFlag(e.FlagName.ManifestDataCachedFlag,t),n&&p._telemetryContext.setBits(e.FlagName.ManifestRequestType,n)},g=c.OUtil.formatString(e.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,u._cid,i.assetId,i.storeId,a);if(d)u._cacheManager.RemoveCacheItem(g);else{if((f=u.getCachedETokenAndManifest(g))&&f.etoken&&f.manifest)return m(r),void l({status:e.DataServiceResultCode.Succeeded,value:f});var v=f?f.manifest:n;if(v==n||""==v){var h=c.OUtil.formatString(e.CacheConsts.anonymousAppInstallInfoCacheKey,i.assetId,i.storeId),y=u._cacheManager.GetCacheItem(h,r);y&&(v=y.manifest)}if(v)return void(f&&f.etoken?(m(r),f.manifest=v,l({status:e.DataServiceResultCode.Succeeded,value:f})):o.getEToken(i,a,(function(i){i.status===e.DataServiceResultCode.Succeeded&&i.value?c.OUtil.checkFlight(c.FlightTreatmentNames.AddinCommandRibbonCacheFixEnabled)?o.getEntitlementAsync(t,(function(r){if(r.status!==e.DataServiceResultCode.Succeeded)return s.RuntimeTelemetryHelper.LogExceptionTag("getEntitlementAsync() failed after getEToken() succeeded",n,p._telemetryContext.correlationId,545009887),void l({status:e.DataServiceResultCode.Failed});m(t,c.ManifestRequestTypes.Etoken),(f=i.value).status2===c.OmexClientAppStatus.OK&&(p._cacheManager.SetCacheItem(g,f,e.CacheConsts.manifestRefreshRate),f.manifest=v),l(i)}),r):(m(t,c.ManifestRequestTypes.Etoken),(f=i.value).status2===c.OmexClientAppStatus.OK&&(p._cacheManager.SetCacheItem(g,f,e.CacheConsts.manifestRefreshRate),f.manifest=v),l(i)):l(i)})))}o.getETokenAndManifest(i,a,(function(i){i.status===e.DataServiceResultCode.Succeeded?c.OUtil.checkFlight(c.FlightTreatmentNames.AddinCommandRibbonCacheFixEnabled)?o.getEntitlementAsync(t,(function(r){if(r.status!==e.DataServiceResultCode.Succeeded)return s.RuntimeTelemetryHelper.LogExceptionTag("getEntitlementAsync() failed after getETokenAndManifest() succeeded",n,p._telemetryContext.correlationId,545009886),void l({status:e.DataServiceResultCode.Failed});m(t,c.ManifestRequestTypes.Both),i.value.status2===c.OmexClientAppStatus.OK&&p._cacheManager.SetCacheItem(g,i.value,e.CacheConsts.manifestRefreshRate),l(i)}),r):(m(t,c.ManifestRequestTypes.Both),i.value.status2===c.OmexClientAppStatus.OK&&p._cacheManager.SetCacheItem(g,i.value,e.CacheConsts.manifestRefreshRate),l(i)):l(i)}))}},i.prototype.getEntitlements=function(t,r,o,i){var a=this,s=a;a._telemetryContext.startActivity(e.Activity.EntitlementCheck);var l,c,d=function(){c!=n&&l!=n&&(l=l.filter((function(e){return c.every((function(t){return t.assetId!=e.assetId}))})),o({status:e.DataServiceResultCode.Succeeded,value:{entitlements:l,killed:c}}))};a._anonymous?(l=[],a._telemetryContext.stopActivity(e.Activity.EntitlementCheck),d()):t.getEntitlementAsync(r,(function(t){s._telemetryContext.stopActivity(e.Activity.EntitlementCheck),o!=n&&(e.AsyncUtil.failed(t,o)?o=n:(s._cid||(s._cid=t.value.cid),l=t.value.entitlements,d()))}),i),a.getKilledApps(t,(function(t){o!=n&&(c=t.status==e.DataServiceResultCode.Succeeded?t.value.killedApps:[],d())}))},i.prototype.activate=function(o,i,a){var l,d,u=this,p={assetId:i.assetId,appVersion:i.appVersion,storeId:i.storeId,storeType:i.storeType,targetType:i.targetType},f=t,m=this.getOmexEndPointPageUrl(p.assetId,p.storeId),g=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),v=function(d,f){switch(d.status2){case c.OmexClientAppStatus.OK:if(d.tokenExpirationDate2&&d.tokenExpirationDate2<=(new Date).getTime())return void e.LoaderUtil.failWithWarning(a,e.LoaderUtil.warning({description:Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){return h()},errorCode:c.ErrorStatusCodes.E_TOKEN_EXPIRED}));var v=e.ManifestUtil.ParseManifest(d.manifest,u._initParam.appUILocale,u._telemetryContext.correlationId);if(v==n)return void e.LoaderUtil.failWithError(a,{infoType:c.InfoType.Error,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),h()},description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,errorCode:c.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT});var C=v.getMarketplaceVersion();if(c.OsfManifestManager.cacheManifest(p.assetId,i.appVersion,v),v.requirementsSupported===t||void 0===v.requirementsSupported&&!a.getRequirementsChecker().isManifestSupported(v)){v.requirementsSupported=t;var S;return S=Strings.OsfRuntime.L_AgaveManifestRequirementsErrorOmex_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR,void e.LoaderUtil.failWithError(a,{description:S,url:m,detailView:r,errorCode:c.ErrorStatusCodes.WAC_AgaveRequirementsErrorOmex})}v.requirementsSupported=r,u._telemetryContext.setFlag(e.FlagName.ManifestTrustCachedFlag,!f);var A=c.OUtil.formatString(c.Constants.ActivatedCacheKey,i.assetId.toLowerCase(),i.storeType,i.storeId);if(f&&!a.skipTrust(i)){var I=c.OmexClientNames[u._initParam.appName];if(!(u._anonymous&&u._cacheManager.GetCacheItem(A,t))&&!a.hasConsent(i)&&!a.isForCustomFunctionSandbox())return void a.askForTrust({anonymous:t,clientName:I,entitlement:p,displayName:v.getDefaultDisplayName(),providerName:v.getProviderName(),iconUrl:v.getDefaultIconUrl(),url:m,isSSOAddin:v.isSSOAddin()},(function(){u.restartActivationTelemetry(),u._cacheManager.SetCacheItem(A,r),u._anonymous?a.load({entitlement:p,manifest:v,eToken:d.etoken},n):u.getETokenAndManifest(o,p,p.storeId,(function(o){o.status==e.DataServiceResultCode.Succeeded&&o.value.status2==c.OmexClientAppStatus.OK?(o.value.version!=n&&e.ManifestUtil.versionLessThan(p.appVersion,o.value.version)&&(p.appVersion=o.value.version),c.OUtil.checkFlight(c.FlightTreatmentNames.AddinCommandRibbonCacheFixEnabled)?_(t):_(r)):e.LoaderUtil.failWithError(a,{infoType:c.InfoType.Error,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),h()},description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),errorCode:c.ErrorStatusCodes.WAC_AgaveManifestAndEtokenRequestFailure})}))}))}a.hasConsent(i)&&u._cacheManager.SetCacheItem(A,r);var T=l.version;e.ManifestUtil.versionLessThan(T,i.appVersion)&&(T=i.appVersion),e.ManifestUtil.versionLessThan(C,T)?(p.appVersion=T,e.LoaderUtil.showWarning(a,{description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),a.setIsUpgrading(r),a.setUpgradingFailed(t),h(r),y()},url:m,highPriority:r,displayDeactive:t,errorCode:c.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE})):l.state2===c.OmexState.DeveloperWithdrawn?e.LoaderUtil.showWarning(a,{description:Strings.OsfRuntime.L_AgaveRetiring_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,url:m,displayDeactive:t,errorCode:c.ErrorStatusCodes.S_OEM_EXTENSION_DEVELOPER_WITHDRAWN_FROM_SALE}):l.state2===c.OmexState.Flagged?e.LoaderUtil.showWarning(a,{description:Strings.OsfRuntime.L_AgaveSoftKilled_ERR,buttonTxt:Strings.OsfRuntime.L_OkButton_TXT,url:m,displayDeactive:t,errorCode:c.ErrorStatusCodes.S_OEM_EXTENSION_FLAGGED}):!u._anonymous&&d.entitlementType&&d.entitlementType.toLowerCase()===c.OmexEntitlementType.Trial&&(e.LoaderUtil.showNotification(a,{description:Strings.OsfRuntime.L_AgaveTrial_ERR,buttonTxt:Strings.OsfRuntime.L_BuyButton_TXT,buttonCallback:function(){return window.open(m)},reDisplay:r,highPriority:r,displayDeactive:t,errorCode:c.ErrorStatusCodes.S_OEM_EXTENSION_TRIAL_MODE}),e.LoaderUtil.showNotification(a,{description:Strings.OsfRuntime.L_AgaveTrialRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),h(r)},detailView:r,reDisplay:r,highPriority:r,displayDeactive:t,errorCode:c.ErrorStatusCodes.S_USER_CLICKED_BUY})),a.load({entitlement:p,manifest:v,eToken:d.etoken},n);break;case c.OmexClientAppStatus.KilledAsset:e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:m,errorCode:c.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});break;case c.OmexClientAppStatus.NoEntitlement:case c.OmexClientAppStatus.TrialNotSupported:case c.OmexClientAppStatus.LimitedTrial:case c.OmexClientAppStatus.EntitlementDeactivated:if(u._anonymous){e.LoaderUtil.failWithError(a,{title:Strings.OsfRuntime.L_AgaveSigninRequiredTitle_TXT,description:Strings.OsfRuntime.L_AgaveNotViewableAnonymous_ERR,buttonTxt:Strings.OsfRuntime.L_SignInButton_TXT,buttonCallback:function(){var e=window.location.href,t=u._initParam.omexBaseUrl+c.Constants.SignInRedirectUrl+encodeURIComponent(e);window.open(t)},errorCode:c.ErrorStatusCodes.E_USER_NOT_SIGNED_IN})}else{a.setRetryCall((function(){u.restartActivationTelemetry(),h(r)})),e.LoaderUtil.failWithWarning(a,{description:Strings.OsfRuntime.L_AgaveLicenseNotAquired_ERR,buttonTxt:Strings.OsfRuntime.L_BuyButton_TXT,buttonCallback:function(){window.open(m),e.LoaderUtil.showWarning(a,{description:Strings.OsfRuntime.L_AgaveLicenseNotAquiredRefresh_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),h(r)},detailView:r,retryAll:r,errorCode:c.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})},errorCode:c.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})}break;case c.OmexClientAppStatus.UnknownAssetId:e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,errorCode:c.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST});break;case c.OmexClientAppStatus.Expired:case c.OmexClientAppStatus.Invalid:e.LoaderUtil.failWithWarning(a,{description:Strings.OsfRuntime.L_AgaveLicenseExpired_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),h()},errorCode:c.ErrorStatusCodes.E_TOKEN_EXPIRED});break;case c.OmexClientAppStatus.Revoked:e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveRetired_ERR,url:m,errorCode:c.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE});break;case c.OmexClientAppStatus.VersionMismatch:p.appVersion=d.version,a.askForUpgrade(e.LoaderUtil.warning({description:Strings.OsfRuntime.L_AgaveNewerVersion_ERR,buttonTxt:Strings.OsfRuntime.L_UpdateButton_TXT,url:m,highPriority:r,logAsError:r,errorCode:c.ErrorStatusCodes.E_MANIFEST_UPDATE_AVAILABLE}),(function(){u.restartActivationTelemetry(),a.setIsUpgrading(r),a.setUpgradingFailed(t),h(r)}));break;case c.OmexClientAppStatus.VersionNotSupported:e.LoaderUtil.failWithWarning(a,{description:Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,errorCode:c.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType},c.OsfControlStatus.UnsupportedStore);break;case c.OmexClientAppStatus.UserIsMinor:g&&g.enableDisplayBlockedMinorError&&e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:c.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR});break;default:s.RuntimeTelemetryHelper.LogExceptionTag("unknown clientAppStatus in manifestAndEtoken: "+d.status2,n,u._telemetryContext.correlationId,20030238),e.LoaderUtil.failWithError(a,{description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),h(r)},errorCode:c.ErrorStatusCodes.WAC_AgaveUnknownClientAppStatus})}},h=function(i){var s=d?d.contentMarket:p.storeId,m=function(n,o){return n.status!=e.DataServiceResultCode.Succeeded?g&&g.enableDisplayBlockedMinorError&&451===n.httpStatus?(e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:c.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR}),r):(e.LoaderUtil.failWithError(a,{description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),h(i)},errorCode:o}),r):t};a.skipTrust(p)?u.getManifest(o,p,s,(function(e){if(m(e,c.ErrorStatusCodes.WAC_AgaveManifestRequestFailure))a.getIsUpgrading()&&(a.setUpgradingFailed(r),a.setIsUpgrading(t));else{if(i)return l=n,void S(r);a.getIsUpgrading()&&a.setIsUpgrading(t),v({etoken:"",status2:e.value.status2,manifest:e.value.manifest})}}),i):u.getETokenAndManifest(o,p,s,(function(e){if(m(e,c.ErrorStatusCodes.WAC_AgaveManifestAndEtokenRequestFailure))a.getIsUpgrading()&&(a.setUpgradingFailed(r),a.setIsUpgrading(t));else{if(i)return l=n,f=t,c.OUtil.checkFlight(c.FlightTreatmentNames.AddinCommandRibbonCacheFixEnabled)?_(t):_(r),void S(r);a.getIsUpgrading()&&a.setIsUpgrading(t),v(e.value)}}),i)},y=function(){var t=c.OUtil.formatString(e.CacheConsts.anonymousAppInstallInfoCacheKey,p.assetId,p.storeId);u._cacheManager.RemoveCacheItem(t)},C=function(){if(l!=n&&f){if(d!=n)return p.appVersion=d.version,void h();var t,s,g;if(l.state2===c.OmexState.Flagged?t=r:l.state2===c.OmexState.DeveloperWithdrawn?s=r:l.state2===c.OmexState.Withdrawn&&(g=r),!(t||s||g)||(e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveRetired_ERR,url:m,errorCode:c.ErrorStatusCodes.E_OEM_EXTENSION_WITHDRAWN_FROM_SALE}),!t))if(a.hasConsent(i))h();else{var y=d?d.contentMarket:p.storeId;u.getManifest(o,p,y,(function(t){t.status==e.DataServiceResultCode.Succeeded?v({etoken:"",status2:t.value.status2,manifest:t.value.manifest},r):e.LoaderUtil.failWithError(a,{description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),u.restartActivationTelemetry(),C()},errorCode:c.ErrorStatusCodes.WAC_AgaveManifestRequestFailure})}))}}},_=function(i){d=n,f=t,u.getEntitlements(o,t,(function(o){if(o.status!=e.DataServiceResultCode.Succeeded)return g&&g.enableDisplayBlockedMinorError&&451===o.httpStatus?void e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveDisabledForMinor_ERR,errorCode:c.ErrorStatusCodes.E_TRUSTCENTER_APP_BLOCKED_FOR_MINOR}):void e.LoaderUtil.failWithError(a,{description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),_(t)},errorCode:c.ErrorStatusCodes.WAC_AgaveEntitlementRequestFailure});o.value.killed.some((function(e){return e.assetId==p.assetId}))?e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:m,errorCode:c.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED}):(o.value.entitlements.some((function(e){return e.assetId.toLowerCase()==p.assetId.toLowerCase()?(d=e,m=u.getOmexEndPointPageUrl(e.assetId,e.contentMarket),r):t})),u._telemetryContext.setFlag(e.FlagName.OmexHasEntitlementFlag,d!=n),f=r,C())}),i)},S=function(t){l=n,u.getAppState(o,p,(function(t){if(t.status!=e.DataServiceResultCode.Succeeded)return l={state2:c.OmexState.OK,productId:n,assetId:p.assetId,version:p.appVersion,refreshRate2:0},void C();t.value.state2!==c.OmexState.Killed?(l=t.value,C()):e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveDisabledByOmex_ERR,url:m,errorCode:c.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED})}),t)};S(),_(t)},i.prototype.restartActivationTelemetry=function(){var t=this;t._telemetryContext.startActivity(e.Activity.Activation),t._telemetryContext.startActivity(e.Activity.ServerCall),t._telemetryContext.setFlag(e.FlagName.AnonymousFlag,t._anonymous)},i}(),i=function(){function i(t,o){void 0===o&&(o=n),this._anonymous=r,this._initParam=t,this._cacheManager=o||new e.AppsDataCacheManager(c.OUtil.getLocalStorage(),new e.SafeSerializer)}return i.prototype.GetCacheKeyPrefix=function(){return this._anonymous?e.CacheConsts.anonymousCacheKeyPrefix:e.WACUtils.CacheConstants.GatedCacheKeyPrefix},i.prototype.getOmexEndPointPageUrl=function(e,t){return c.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",this._initParam.omexBaseUrl,t,e)},i.prototype.getDataService=function(t,r){var o=this,i=o;if(o._dataService==n)if(o._dataServiceReady==n){o._dataServiceReady=r;var a={status:e.DataServiceResultCode.Failed,value:n},s=function(t,r){var o=i._dataServiceReady;i._dataServiceReady=n,t.status==e.DataServiceResultCode.Succeeded?(i._anonymous=t.value.anonymous,i._dataService=r,a.value=r,a.status=e.DataServiceResultCode.Succeeded,o(a)):(a.httpStatus=t.httpStatus,o(a))};t.startActivity(e.Activity.Authentication);var l=new e.S2SOmexCatalogService(o._initParam);l.initialize(t.correlationId,(function(n){if(n.status==e.DataServiceResultCode.Succeeded){var r=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();if(!r||!r.enableAnonymousUseLegacyCatalogService||!n.value.anonymous)return t.stopActivity(e.Activity.Authentication),void s(n,l)}t.setBits(e.FlagName.ActivationRuntimeType,c.ActivationTypes.V2Enabled);var o=e.ProxyBasedCatalogService.getInstance(i._initParam);o.prepareProxy(t.correlationId,(function(n){t.stopActivity(e.Activity.Authentication),t.setBits(e.FlagName.RetryCount,o.omexAuthConnectTries),s(n,o)}))}))}else{t.startActivity(e.Activity.Authentication);var d=o._dataServiceReady;o._dataServiceReady=function(n){t.stopActivity(e.Activity.Authentication),d(n),r(n)}}else r({status:e.DataServiceResultCode.Succeeded,value:o._dataService})},i.prototype.createActivityScope=function(t,r){var i=this;this.getDataService(t,(function(a){if(e.AsyncUtil.failed(a,r))s.RuntimeTelemetryHelper.LogExceptionTag("failed to get data service.",n,t.correlationId,18657692);else{t.setFlag(e.FlagName.AnonymousFlag,i._anonymous);var l=a.value,c={cacheManager:i._cacheManager,cachePrefix:i.GetCacheKeyPrefix(),cid:l.getCID(),anonymous:i._anonymous,telemetryContext:t},d=l.createScope(c),u=new o(c,i._initParam);r({status:e.DataServiceResultCode.Succeeded,value:{serviceScope:d,activityScope:u}})}}))},i.prototype.getEntitlementAsync=function(t,n,r,o,i){var a=this;this.createActivityScope(n,(function(n){e.AsyncUtil.failed(n,r,[])||(a._anonymous?r({status:e.DataServiceResultCode.Failed,httpStatus:403}):n.value.serviceScope.getEntitlementAsync(t,(function(t){if(!e.AsyncUtil.failed(t,r,[])){for(var n=t.value.entitlements,o=0;o<n.length;o++){var i=n[o],a=i;a.appVersion=i.version,a.storeId=i.contentMarket,a.storeType=c.StoreType.OMEX,a.targetType=c.OUtil.getTargetType(i.appSubType)}r({status:t.status,value:n})}}),o,i))}))},i.prototype.getAndCacheManifest=function(r,o,i,a,s){var l=this;s=s||t;var d=c.OsfManifestManager.getCachedManifest(r.assetId,r.appVersion);s||d==n?this.createActivityScope(i,(function(t){if(!e.AsyncUtil.failed(t,a)){var d=t.value.serviceScope;t.value.activityScope.getManifest(d,r,o,(function(t){if(!e.AsyncUtil.failed(t,a))if(t.value.status2==c.OmexClientAppStatus.OK){var o=e.ManifestUtil.ParseManifest(t.value.manifest,l._initParam.appUILocale,i.correlationId);o!=n?(c.OsfManifestManager.cacheManifest(r.assetId,r.appVersion,o),a({status:e.DataServiceResultCode.Succeeded,value:o})):a({status:e.DataServiceResultCode.Failed,value:o})}else a({status:e.DataServiceResultCode.Failed})}),s)}})):a({status:e.DataServiceResultCode.Succeeded,value:d})},i.prototype.activateAsync=function(t,n,o){var i=this;o.startActivity(e.Activity.Activation),o.startActivity(e.Activity.ServerCall),this.createActivityScope(o,(function(a){i.isStoreDisabled(o,(function(s){if(s.value===r)e.LoaderUtil.failWithError(n,{description:Strings.OsfRuntime.L_OmexStoreDisabledByAdmin,errorCode:c.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED});else if(a.status!=e.DataServiceResultCode.Succeeded)return void e.LoaderUtil.failWithError(n,{description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveOmexCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){n.restartActivation(),i.activateAsync(t,n,o)},errorCode:c.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError})}));var s=a.value.serviceScope;a.value.activityScope.activate(s,t,n)}))},i.prototype.removeAsync=function(t,n,r){this.createActivityScope(n,(function(n){if(!e.AsyncUtil.failed(n,r)){var o=n.value.serviceScope;n.value.activityScope.removeApps(o,t,r)}}))},i.prototype.getAppDetails=function(t,o,i,a,s){var l=this,d=l,u=[];if(s)l._cacheManager.RemoveAll(e.CacheConsts.ungatedCacheKeyPrefix);else{for(var p=t,f=[],m=0;m<p.length;++m){var g=c.OUtil.formatString(e.CacheConsts.appDetailKey,p[m]),v=l._cacheManager.GetCacheItem(g,r);v&&v.state2!=n?u.push(v):f.push(p[m])}if(0===f.length)return void a({status:e.DataServiceResultCode.Succeeded,value:u});t=f}l.createActivityScope(i,(function(n){e.AsyncUtil.failed(n,a,u)||n.value.serviceScope.getAppDetails(t,o,(function(t){if(!e.AsyncUtil.failed(t,a,u)){for(var n=t.value,r=0;r<n.length;++r){var o=n[r],i=c.OUtil.formatString(e.CacheConsts.appDetailKey,o.assetId);d._cacheManager.SetCacheItem(i,o),u.push(o)}t.value=u,a(t)}}))}))},i.prototype.isStoreDisabled=function(n,r){this.createActivityScope(n,(function(n){e.AsyncUtil.failed(n,r,t)||n.value.serviceScope.isStoreDisabled(r)}))},i}();e.OmexCatalog=i,e.CatalogFactory.register(c.StoreType.OMEX,(function(t){if(t.allowExternalMarketplace&&t.osfOmexBaseUrl){var n,o=t.osfOmexBaseUrl.indexOf(c.Constants.ProtocolSeparator);n=o>=0?t.osfOmexBaseUrl.substr(o):c.Constants.ProtocolSeparator+t.osfOmexBaseUrl;var a=c.Constants.Https+n;return c.OUtil.getQueryStringParamValue(window.location.search,c.Constants.OmexForceAnonymousParamName).toLowerCase()==c.Constants.OmexForceAnonymousParamValue.toLowerCase()&&(t.omexForceAnonymous=r),new i({appName:t.appName,appUILocale:t.appUILocale,AppVersion:t.appVersion,clientMode:t.clientMode,docUrl:t.docUrl,omexBaseUrl:a,omexForceAnonymous:t.omexForceAnonymous})}return new e.ForbiddenCatalog({loaderParams:e.LoaderUtil.error({description:Strings.OsfRuntime.L_AgaveOmexNotConfigured_ERR,errorCode:c.ErrorStatusCodes.E_TRUSTCENTER_CATALOG_UNTRUSTED_ADMIN_CONTROLLED}),controlStatus:c.OsfControlStatus.ActivationFailed})}))}(p||(p={})),function(e){var t=function(){function e(){}return e.anonymousCacheKeyPrefix="__OSF_ANONYMOUS_OMEX.",e.ungatedCacheKeyPrefix="__OSF_OMEX.",e.manifestRefreshRate=1825,e.hourToDayConversionFactor=24,e.anonymousAppInstallInfoCacheKey=e.anonymousCacheKeyPrefix+"appInstallInfo.{0}.{1}",e.firstPartyAddinListCacheKey=e.anonymousCacheKeyPrefix+"firstPartyAddInList",e.firstPartyManifestCacheKey=e.anonymousCacheKeyPrefix+"firstPartyManifest.{0}",e.killedAppsCacheKey="{0}killedApps",e.appStateCacheKey="{0}appState.{1}.{2}",e.appDetailKey="__OSF_OMEX.appDetails.{0}",e}();e.CacheConsts=t}(p||(p={})),function(e){var t=null,n=function(){function n(e,t,n){var r=this;r._handler=e,r._initParam=t,r._cacheManager=n.cacheManager,r._cachePrefix=n.cachePrefix,r._cid=n.cid,r._correlationId=n.telemetryContext.correlationId}return n.prototype.tryFail=function(t,n){return 200!=t&&(n({httpStatus:t,status:e.DataServiceResultCode.Failed}),!0)},n.prototype.getLastStoreUpdate=function(t){var n=this,r=n,o=n._initParam.appUILocale;n._handler.getLastStoreUpdate(o,n._correlationId,(function(n,o){r.tryFail(n,t)?r.logServiceCallResponseError("laststoreupdate",n):t({status:e.DataServiceResultCode.Succeeded,value:e.OmexXmlProcessor.ProcessLastStoreUpdate(o)})}))},n.prototype.getEntitlementAsync=function(n,r,o,i){var a=this,s=a,l=c.OmexAppVersions[a._initParam.appName],d=c.OUtil.formatString(a._cachePrefix+e.WACUtils.CacheConstants.EntitlementsKey,l,a._cid);if(o)a._cacheManager.RemoveCacheItem(d);else{var u=a._cacheManager.GetCacheItem(d,!0,t,i);if(u!=t)return void r({status:e.DataServiceResultCode.Succeeded,value:u})}a._handler.getEntitlement(n,l,a._correlationId,(function(t,n){if(s.tryFail(t,r))s.logServiceCallResponseError("entitlement",t);else{var o=e.OmexXmlProcessor.ProcessEntitlement(n);o.cid=s._cid,s._cacheManager.SetCacheItem(d,o,o.refreshRate2/e.CacheConsts.hourToDayConversionFactor),r({status:e.DataServiceResultCode.Succeeded,value:o})}}))},n.prototype.getEToken=function(t,n,r){var o=this,i=n,a=t.storeId,s=t.assetId,l=t.appVersion;this._handler.getEToken(a,i,s,l,this._correlationId,(function(t,n){o.tryFail(t,r)?o.logServiceCallResponseError("etoken",t):r({status:e.DataServiceResultCode.Succeeded,value:e.OmexXmlProcessor.ProcessClientAppInstallInfo(n,c.ClientAppInfoReturnType.etokenOnly)})}))},n.prototype.getETokenAndManifest=function(t,n,r){var o=this;this.getEToken(t,n,(function(i){i.status==e.DataServiceResultCode.Succeeded?o.getManifest(t,n,(function(t){if(t.status!=e.DataServiceResultCode.Succeeded)return i.status=t.status,i.httpStatus=t.httpStatus,void r(i);i.value.manifest=t.value.manifest,r(i)})):r(i)}))},n.prototype.getManifest=function(t,n,r){var o=n;this._handler.getManifest(o,t.assetId,this._correlationId,(function(t,n){r({status:e.DataServiceResultCode.Succeeded,value:e.OmexXmlProcessor.ConvertAnonymousManifest(t,n)})}))},n.prototype.getAppState=function(t,n){var r=this,o=t.storeId+":"+t.assetId;this._handler.getAppState(o,this._correlationId,(function(t,o){r.tryFail(t,n)?r.logServiceCallResponseError("appstate",t):n({status:e.DataServiceResultCode.Succeeded,value:e.OmexXmlProcessor.ProcessAppState(o)})}))},n.prototype.getKilledApps=function(t){var n=this;this._handler.getKilledApps(this._correlationId,(function(r,o){n.tryFail(r,t)?n.logServiceCallResponseError("killedapps",r):t({status:e.DataServiceResultCode.Succeeded,value:e.OmexXmlProcessor.ProcessKilledApps(o)})}))},n.prototype.getAppDetails=function(t,n,r){var o=this;this._handler.getAppDetails(n,t.join(","),this._correlationId,(function(t,n){o.tryFail(t,r)?o.logServiceCallResponseError("appdetails",t):r({status:e.DataServiceResultCode.Succeeded,value:e.OmexXmlProcessor.ProcessAppDetails(n)})}))},n.prototype.removeApps=function(t,n){var r=this;this._handler.removeApps(t.join(","),this._correlationId,(function(t,o){if(r.tryFail(t,n))r.logServiceCallResponseError("removeapps",t);else{var i=e.OmexXmlProcessor.ProcessRemoveAppResponse(o);i.removedApps.some((function(e){return e.result2==c.OmexRemoveAppStatus.Success}))&&r.clearEntitlementCache(),n({status:e.DataServiceResultCode.Succeeded,value:i})}}))},n.prototype.clearEntitlementCache=function(){var t=new RegExp(c.OUtil.formatString(e.WACUtils.CacheConstants.EntitlementsKey,".*",".*"),"i");this._cacheManager.RemoveMatches([t])},n.prototype.isStoreDisabled=function(t){var n=this;this._handler.isStoreDisabled(this._correlationId,(function(r){if(200!=r&&403!=r&&401!=r)return n.logServiceCallResponseError("isStoreDisabled",r),void t({status:e.DataServiceResultCode.Failed,value:!1});t({status:e.DataServiceResultCode.Succeeded,value:401==r})}))},n.prototype.logServiceCallResponseError=function(e,n){var r="s2s request "+e+" failed";n&&(r+=":"+n),s.RuntimeTelemetryHelper.LogExceptionTag(r,t,this._correlationId,18657699)},n}();e.OmexCatalogServiceS2SScope=n;var r=function(){function r(e){this._cid="",this._initParam=e}return r.initRequestHandler=function(e){r._requestHandler==t&&(r._requestHandler=e)},r.prototype.getCID=function(){return this._cid},r.prototype.initialize=function(n,o){var i=this;r._requestHandler!=t?this._initParam.omexForceAnonymous?o({status:e.DataServiceResultCode.Succeeded,value:{anonymous:!0}}):r._requestHandler.getUserId(n,(function(r,a){200==r?(i._cid=a.trim(),o({status:e.DataServiceResultCode.Succeeded,value:{anonymous:!1}})):403==r?o({status:e.DataServiceResultCode.Succeeded,value:{anonymous:!0}}):(s.RuntimeTelemetryHelper.LogExceptionTag("s2s getuserId request failed "+r,t,n,18657728),o({status:e.DataServiceResultCode.Failed,httpStatus:r}))})):o({status:e.DataServiceResultCode.Failed,httpStatus:404})},r.prototype.createScope=function(e){return new n(r._requestHandler,this._initParam,e)},r}();e.S2SOmexCatalogService=r}(p||(p={})),function(e){var t=function(){var e="description",t="provider",n="o:assets",r="contentMarket",o="appSubType",i="expirationDate",a="state",s="version",l="productId",u="assetId",p="o:asset",f="o:results",m="refreshRate",g=null;function v(){}return v.ProcessLastStoreUpdate=function(e){var t=new c.XmlProcessor(e,d).getDocumentElement().selectSingleNode("o:update");return t.firstChild!=g?Date.parse(t.firstChild.nodeValue):g},v.ProcessAppState=function(e){var t={},n=new c.XmlProcessor(e,d),r=n.getDocumentElement();n.readAttributes(r,{rr:m},t);var o=n.selectSingleNode(f),g=n.selectSingleNode("o:lang",o),h=n.selectSingleNode(p,g);return n.readAttributes(h,{assetid:u,prodid:l,ver:s,state:a,tdurl:"takeDownUrl",upv:"unsafePreviousVersion",expiry:i},t),v.ConvertAppState(t)},v.ProcessFirstPartyAddInList=function(e){var t={addInList:{},refreshRate:g},n=new c.XmlProcessor(e,d),r=n.getDocumentElement(),o=n.selectSingleNode("o:Apps",r),i=o.getAttribute("d1p1:rr");t.refreshRate=i?parseInt(i):0;for(var a=n.selectNodes("o:App",o),s=0;s<a.length;s++){var l=a[s],p={assetId:g,path:g,version:g};n.readAttributes(l,{assetid:u},p);var f=n.selectSingleNode("o:Path",l);p.path=f.text!=g?f.text:f.textContent!=g?f.textContent:f.nodeTypedValue;var m=n.selectSingleNode("o:Version",l);p.version=m.text!=g?m.text:m.textContent!=g?m.textContent:m.nodeTypedValue,t.addInList[p.assetId]=p}return t},v.ConvertAppState=function(e){return e.refreshRate2=e.refreshRate?parseInt(e.refreshRate):0,e.state2=e.state?parseInt(e.state):0,e.expirationDate2=v.GetTickByDate(e.expirationDate),e},v.ProcessEntitlement=function(e){var t={},n=new c.XmlProcessor(e,d),a=n.selectSingleNode("o:entitlementlist"),p=n.selectSingleNode("o:hdr",a);n.readAttributes(p,{pm:"billingMarket",pagesize:"pageSize",rr:m},t);for(var f,g,h=n.selectNodes("o:entitlement",n.selectSingleNode("o:entitlements",a)),y=[],C=0;C<h.length;++C)g={},f=h[C],n.readAttributes(f,{assetid:u,pid:l,ver:s,appst:o,cm:r,trlt:"licenseType",acqdate:"acquireDate",expiry2:i,attreq:"attentionRequired"},g),y.push(g);return t.entitlements=y,v.ConvertEntitlementInfo(t)},v.ConvertEntitlementInfo=function(e){for(var t=e.entitlements,n=0;n<t.length;++n){var r=t[n];r.appSubType2=r.appSubType?parseInt(r.appSubType):0,r.acquireDate2=v.GetTickByDate(r.acquireDate),r.expirationDate2=v.GetTickByDate(r.expirationDate),r.attentionRequired2="true"===r.attentionRequired}return e.refreshRate2=e.refreshRate?parseInt(e.refreshRate):0,e},v.ProcessKilledApps=function(e){var t={},r=new c.XmlProcessor(e,d),o=r.getDocumentElement();r.readAttributes(o,{rr:m},t);for(var i=[],a=r.selectSingleNode(n),s=r.selectNodes(p,a),f=0;f<s.length;++f){var g=s[f],h={};r.readAttributes(g,{assetid:u,pid:l},h),i.push({assetId:h.assetId,productId:h.productId})}return t.killedApps=i,v.ConvertKilledAppsInfo(t)},v.ConvertKilledAppsInfo=function(e){return e.refreshRate2=e.refreshRate?parseInt(e.refreshRate):0,e},v.ProcessClientAppInstallInfo=function(e,t){var o=new c.XmlProcessor(e,d),i=o.selectSingleNode(n),a=o.selectSingleNode(p,i),l={etoken:g,manifest:g};if(t===c.ClientAppInfoReturnType.urlOnly?o.readAttributes(a,{url:"url"},l):t===c.ClientAppInfoReturnType.etokenOnly?o.readAttributes(a,{etok:"etoken"},l):o.readAttributes(a,{url:"url",etok:"etoken"},l),o.readAttributes(a,{status:"status",cm:r,assetid:u,ver:s},l),t!=c.ClientAppInfoReturnType.urlOnly&&l.etoken){var f=new c.XmlProcessor(l.etoken,""),m=f.selectSingleNode("t",f.selectSingleNode("r"));f.readAttributes(m,{te:"tokenExpirationDate",et:"entitlementType",cid:"cid"},l)}return v.ConvertClientAppInstallInfo(l)},v.ConvertClientAppInstallInfo=function(e){return e.status2=e.status?parseInt(e.status):0,e.tokenExpirationDate2=v.GetTickByDate(e.tokenExpirationDate),e},v.ProcessManifest=function(e){return{manifest:e}},v.ProcessRemoveAppResponse=function(e){for(var t,n,r={removedApps:[]},o=new c.XmlProcessor(e,d),i=(o.getDocumentElement(),o.selectSingleNode("o:apps",o.selectSingleNode("o:removedApps"))),a=o.selectNodes("o:app",i),s=0;s<a.length;++s)t=a[s],n={},o.readAttributes(t,{assetid:u,result:"result"},n),r.removedApps.push(n);return v.ConvertRemoveAppResponse(r)},v.ConvertRemoveAppResponse=function(e){for(var t=e.removedApps,n=0;n<t.length;++n){var r=t[n];r.result2=r.result?parseInt(r.result):0}return e},v.ProcessAppDetails=function(n){for(var r,i,l=new c.XmlProcessor(n,d),p=l.selectSingleNode(f),m=l.selectNodes("o:wainfo",p),g=[],h=0;h<m.length;++h)r=m[h],i={},l.readAttributes(r,{assetid:u,appid:"webApplicationId",defhei:"defaultHeight",defwid:"defaultWidth",title:"name",prov:t,desc:e,icon:"iconUrl",ver:s,state:a,appst:o,appvers:"appVersions",req:"requirements",hosts:"hosts",highresicon:"highResolutionIconUrl"},i),g.push(i);return v.ConvertAppDetails(g)},v.ConvertAppDetails=function(e){for(var t=0;t<e.length;++t){var n=e[t];n.defaultHeight2=n.defaultHeight?parseInt(n.defaultHeight):0,n.defaultWidth2=n.defaultWidth?parseInt(n.defaultWidth):0,n.state2=n.state?parseInt(n.state):0,n.appSubType2=n.appSubType?parseInt(n.appSubType):0}return e},v.ProcessRecommendations=function(n){for(var r,o,i,l=new c.XmlProcessor(n,d),p=l.selectSingleNode(f),m=l.selectNodes("o:wa",p),g=[],v=0;v<m.length;++v)r=m[v],i={},l.readAttributes(r,{assetid:u,title:"name",desc:e,icon:"iconUrl",ver:s,state:a,rat:"rating",dls:"downloads",prov:t},i),o=l.selectSingleNode("o:price",r),l.readAttributes(o,{fop:"originalPrice",opt:"originalPriceTier",fpp:"promotionalPrice",ppt:"promotionalPriceTier",cmod:"priceModel"},i),g.push(i);return g},v.ConvertAnonymousManifest=function(e,t){var n,r="";switch(e){case 200:n=c.OmexClientAppStatus.OK,r=t;break;case 204:case 1223:n=c.OmexClientAppStatus.NoEntitlement;break;case 400:n=c.OmexClientAppStatus.BadRequest;break;case 410:n=c.OmexClientAppStatus.KilledAsset;break;case 404:n=c.OmexClientAppStatus.UnknownAssetId;break;case 412:n=c.OmexClientAppStatus.VersionNotSupported;break;case 451:n=c.OmexClientAppStatus.UserIsMinor;break;default:n=c.OmexClientAppStatus.ServerError}return{status2:n,manifest:r}},v.GetTickByDate=function(e){return e?new Date(e).getTime():g},v}();e.OmexXmlProcessor=t}(p||(p={})),function(e){var t=function(){var t=null;function n(n,r,o,i){void 0===i&&(i=t),this._cacheManager=i||new e.AppsDataCacheManager(c.OUtil.getLocalStorage(),new e.SafeSerializer),this._privateCatalogService=new e.PrivateCatalogService(c.OmexClientNames[n],c.OUtil.normalizeAppVersion(r)),this._uiLocale=o}return n.prototype.getEntitlementAsync=function(t,r,o,i){r.startActivity(e.Activity.EntitlementCheck),i&&(this._cacheManager.RemoveAll(n._addInsCacheKey),this._cacheManager.RemoveCacheItem(n._lastCatalogUpdateKey)),this.GetAddInList(t,r,(function(t){for(var i=[],a=0,s=t;a<s.length;a++){var l=s[a];l.addInState===n._addInOkState&&i.push(l)}r.stopActivity(e.Activity.EntitlementCheck),o({status:e.DataServiceResultCode.Succeeded,value:i})}),(function(e){o({status:e})}))},n.prototype.getAppDetails=function(r,o,i,a,s){var l=this,c=l;s&&l._cacheManager.RemoveAll(n._addInDetailsCacheKeyPrefix);for(var d=[],u=[],p=0;p<r.length;p++){var f=n.GetAppDetailsCacheKey(r[p].ProductId),m=l._cacheManager.GetCacheItem(f);m?d.push(m):u.push(r[p])}0!==u.length?l._privateCatalogService.GetManifests(u,t,t,i,(function(t){for(var r=0;r<t.length;r++){var o=c.ParseAndCacheManifest(t[r],i);if(o){var s=n.CreateAddInDetails(o);d.push(s);var l=n.GetAppDetailsCacheKey(s.assetId);c._cacheManager.SetCacheItem(l,s,n._addInDetailsRefreshRateDays)}}a({status:e.DataServiceResultCode.Succeeded,value:d})}),(function(e){a({status:e})})):a({status:e.DataServiceResultCode.Succeeded,value:d})},n.prototype.getAndCacheManifest=function(t,r,o,i){var a={ProductId:t.assetId,Version:t.appVersion,AddInState:n._addInOkState,StoreInfo:{AssetId:t.storeId,ContentMarket:r}};this.GetManifest(a,o,(function(t){i({status:e.DataServiceResultCode.Succeeded,value:t})}),(function(e){i({status:e})}))},n.prototype.activateAsync=function(r,o,i){var a=this;i.startActivity(e.Activity.Activation);var s=this;this.GetAddInList(!1,i,(function(l){for(var d,u=/[{}]/g,p=0,f=l;p<f.length;p++){var m=f[p];if(r.assetId.replace(u,"").toLowerCase()===m.assetId.replace(u,"").toLowerCase()){d=m;break}}if(d)if(d.addInState===n._addInOkState){r.appVersion=d.appVersion,c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)&&(r.addInStoreInfo=d.addInStoreInfo);var g={ProductId:d.assetId,Version:d.appVersion,AddInState:n._addInOkState,StoreInfo:{AssetId:d.storeId,ContentMarket:""}};a.GetManifest(g,i,(function(e){o.load({entitlement:r,manifest:e,eToken:""},t)}),(function(){e.LoaderUtil.failWithError(o,{description:Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message,url:"",errorCode:c.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){o.restartActivation(),s.activateAsync(r,o,i)}})}))}else e.LoaderUtil.failWithError(o,{description:Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,url:"",errorCode:c.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED});else e.LoaderUtil.showWarning(o,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){o.restartActivation(),s._cacheManager.RemoveAll(n._addInsCacheKey),s._cacheManager.RemoveCacheItem(n._lastCatalogUpdateKey),s.activateAsync(r,o,i)},detailView:!0,retryAll:!0,errorCode:c.ErrorStatusCodes.E_OEM_EXTENSION_NOT_ENTITLED})}),(function(){e.LoaderUtil.showWarning(o,{description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveAdminManagedCatalogName),buttonTxt:Strings.OsfRuntime.L_RefreshButton_TXT,buttonCallback:function(){o.restartActivation(),s._cacheManager.RemoveAll(n._addInsCacheKey),s._cacheManager.RemoveCacheItem(n._lastCatalogUpdateKey),s.activateAsync(r,o,i)},detailView:!0,retryAll:!0,errorCode:c.ErrorStatusCodes.WAC_AgaveActivationError}),i.stopActivity(e.Activity.Activation)}))},n.prototype.removeAsync=function(t,n,r){r({status:e.DataServiceResultCode.Failed})},n.GetAppDetailsCacheKey=function(e){return n._addInDetailsCacheKeyPrefix+c.OUtil.formatString(n._addInDetailsCacheKeySufix,e)},n.GetManifestCacheKey=function(e,t){return n._manifestCacheKeyPrefix+c.OUtil.formatString(n._manifestCacheKeySufix,e,t)},n.CreateAddInDetails=function(e){return{assetId:e.getMarketplaceID(),webApplicationId:e.getWebApplicationId(),defaultHeight2:e.getDefaultHeight()||0,defaultHeight:String(e.getDefaultHeight()||0),defaultWidth2:e.getDefaultWidth()||0,defaultWidth:String(e.getDefaultWidth()||0),name:e.getDefaultDisplayName(),provider:e.getProviderName(),description:e.getDefaultDescription(),iconUrl:e.getDefaultIconUrl(),version:e.getMarketplaceVersion(),state2:1,state:"1",appSubType2:e.getOmexTargetCode(),appSubType:String(e.getOmexTargetCode()),appVersions:void 0,requirements:e.getRequirementsXml(),hosts:e.getHostsXml(),highResolutionIconUrl:e.getDefaultHighResolutionIconUrl()}},n.prototype.GetAddInList=function(e,r,o,i){var a,s=this;e||!(a=this._cacheManager.GetCacheItem(n._addInsCacheKey))?this._privateCatalogService.GetAddInList(t,t,r,(function(e){for(var t=0,r=e;t<r.length;t++){var i=r[t],a=n.GetAppDetailsCacheKey(i.assetId),l=s._cacheManager.GetCacheItem(a);l&&l.version!==i.appVersion&&s._cacheManager.RemoveCacheItem(a)}s._cacheManager.SetCacheItem(n._addInsCacheKey,e,n._addInListRefreshRateDays),o(e)}),i):o(a)},n.prototype.GetManifest=function(r,o,i,a){var s=this,l=s;o.startActivity(e.Activity.ManifestRequest);var d=c.OsfManifestManager.getCachedManifest(r.ProductId,r.Version);if(d)return o.stopActivity(e.Activity.ManifestRequest),void i(d);var u=n.GetManifestCacheKey(r.ProductId,r.Version),p=s._cacheManager.GetCacheItem(u);if(p)return(d=new c.Manifest.Manifest(p,s._uiLocale))?(c.OsfManifestManager.cacheManifest(r.ProductId,r.Version,d),o.stopActivity(e.Activity.ManifestRequest),void i(d)):void a(e.DataServiceResultCode.Failed);s._privateCatalogService.GetManifests([r],t,t,o,(function(t){(d=l.ParseAndCacheManifest(t[0],o))?(c.OsfManifestManager.cacheManifest(r.ProductId,r.Version,d),o.stopActivity(e.Activity.ManifestRequest),i(d)):a(e.DataServiceResultCode.Failed)}),(function(e){a(e)}))},n.prototype.ParseAndCacheManifest=function(e,r){try{var o=new c.Manifest.Manifest(e,this._uiLocale),i=n.GetManifestCacheKey(o.getMarketplaceID(),o.getMarketplaceVersion());return this._cacheManager.SetCacheItem(i,e,n._addInManifestRefreshRateDays),o}catch(e){s.RuntimeTelemetryHelper.LogExceptionTag("Invalid manifest retrieved from Private Catalog.",e,r.correlationId,19965729)}return t},n._addInsCacheKey="__OSF_PRIVATECATALOG_ADDINS",n._addInDetailsCacheKeyPrefix="__OSF_PRIVATECATALOG_ADDINDETAILS",n._addInDetailsCacheKeySufix="_{0}",n._manifestCacheKeyPrefix="__OSF_PRIVATECATALOG_MANIFEST",n._manifestCacheKeySufix="_{0}_{1}",n._lastCatalogUpdateKey="_OSF_PRIVATECATALOG_LASTUPDATE",n._addInListRefreshRateDays=1/24,n._addInDetailsRefreshRateDays=365,n._addInManifestRefreshRateDays=365,n._addInOkState="Ok",n}();e.PrivateCatalog=t,e.CatalogFactory.register(c.StoreType.PrivateCatalog,(function(n){return n.enablePrivateCatalog?new t(n.appName,n.appVersion,n.appUILocale):new e.ForbiddenCatalog({loaderParams:e.LoaderUtil.error({description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveCatalogNotEnabled_ERR,Strings.OsfRuntime.L_AgaveAdminManagedCatalogName),errorCode:c.ErrorStatusCodes.E_EXCHANGE_PRIVATE_CATALOG_DISABLED}),controlStatus:c.OsfControlStatus.ActivationFailed})}))}(p||(p={})),function(e){var t=function(){var t="Failed to parse response into PrivateCatalogServiceResponse object.",n=200,r=!0,o=null,i=!1;function a(e,t){this._clientCode=e,this._clientVersion=t}return a.initRequestHandler=function(t,n,s,l){void 0===l&&(l=i),a._requestHandler==o&&(a._requestHandler=t),a.authenticationProxy==o&&(a.authenticationProxy=n),a._isThirdPartyHostEnabled=s,a._resultCodeIsEnabled=l&&l===r,a._tokenCacheManager=new e.TokenCacheManager(c.OUtil.getLocalStorage(),new e.SafeSerializer),a._cacheManager=new e.AppsDataCacheManager(c.OUtil.getLocalStorage(),new e.SafeSerializer)},a.ParseAddInList=function(e,t){var n,r=[];try{n=JSON.parse(e)}catch(e){return s.RuntimeTelemetryHelper.LogExceptionTag("Could not parse GetAddIns reponse.",e,t.correlationId,19965730),o}if(!n||!n.AddIns)return s.RuntimeTelemetryHelper.LogCommonMessageTag("GetPrivateCatalogAddIns response could not be parsed.",t.correlationId,20194262),r;for(var i=0,l=n.AddIns;i<l.length;i++){var d=l[i];d.AddInState&&d.ProductId&&d.Version?(c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?r.push({assetId:d.ProductId,storeId:d.StoreInfo?d.StoreInfo.AssetId:"none",appVersion:d.Version,storeType:c.StoreType.PrivateCatalog,targetType:c.OsfControlTarget.Undefined,addInState:d.AddInState,contentMarket:d.StoreInfo?d.StoreInfo.ContentMarket:"",productId:d.ProductId,addInStoreInfo:d.StoreInfo}):r.push({assetId:d.ProductId,storeId:d.StoreInfo?d.StoreInfo.AssetId:"none",appVersion:d.Version,storeType:c.StoreType.PrivateCatalog,targetType:c.OsfControlTarget.Undefined,addInState:d.AddInState,contentMarket:d.StoreInfo?d.StoreInfo.ContentMarket:""}),a.StoreAuthenticationData(n)):s.RuntimeTelemetryHelper.LogCommonMessageTag(c.OUtil.formatString('Add-In metadata was missing some data. ID: "{0}", Version: "{1}", State: "{2}".',d.ProductId||"",d.Version||"",d.AddInState||""),t.correlationId,20194263)}return r},a.ParseAndCacheManifestList=function(e,t){var n,r=[];try{n=JSON.parse(e)}catch(e){return s.RuntimeTelemetryHelper.LogExceptionTag("Could not parse GetManifests reponse.",e,t.correlationId,19965731),o}if(!n||!n.Manifests)return s.RuntimeTelemetryHelper.LogCommonMessageTag("GetAddInManifests response could not be parsed.",t.correlationId,20194264),r;for(var i=0,l=n.Manifests;i<l.length;i++){var c=l[i];r.push(c)}return a.StoreAuthenticationData(n),r},a.StoreAuthenticationData=function(e){a._tokenCacheManager.AddRefreshToken(e.RefreshToken,e.UserId,e.TenantId),a._userId=e.UserId,a._tenantId=e.TenantId},a.prototype.GetLastPrivateCatalogUpdate=function(t,l,c,d,u){var p=this,f=0;a._requestHandler.getLastPrivateCatalogUpdate(this._clientCode,this._clientVersion,t,l,c.correlationId,(function(m,g){var v="GetLastPrivateCatalogUpdate response could not be parsed.",h="Could not parse GetLastPrivateCatalogUpdate reponse.";if(f++,a._resultCodeIsEnabled){if(m===n){var y=a.ParsePrivateCatalogServiceResponse(g,c);if(!y)return void u(e.DataServiceResultCode.Failed);if(1===y.ResponseCode){try{_=JSON.parse(g)}catch(t){return s.RuntimeTelemetryHelper.LogExceptionTag(h,t,c.correlationId,42284249),void u(e.DataServiceResultCode.Failed)}return _&&_.LastUpdate?(a.StoreAuthenticationData(_),void d(_.LastUpdate)):(s.RuntimeTelemetryHelper.LogCommonMessageTag(v,c.correlationId,42284250),void u(e.DataServiceResultCode.Failed))}if(2===y.ResponseCode)if(S=a.TryGetRefreshToken(g,c))return void p.GetLastPrivateCatalogUpdate(o,S,c,d,u);if(2===y.ResponseCode||3===y.ResponseCode){var C=r;return setTimeout((function(){a.authenticationProxy.tryAuthorize((function(e){C&&(C=i,p.GetLastPrivateCatalogUpdate(e,o,c,d,u))}),(function(){if(C){C=i;var t=a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed;u(t)}}))}),0),void setTimeout((function(){if(C){C=i;var t=a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed;u(t)}}),a._authenticationTimeout)}return void a.HandleLogging(y,c,u)}}else{if(m===n){var _;try{_=JSON.parse(g)}catch(t){return s.RuntimeTelemetryHelper.LogExceptionTag(h,t,c.correlationId,22823177),void u(e.DataServiceResultCode.Failed)}return _&&_.LastUpdate?(a.StoreAuthenticationData(_),void d(_.LastUpdate)):(s.RuntimeTelemetryHelper.LogCommonMessageTag(v,c.correlationId,22823178),void u(e.DataServiceResultCode.Failed))}if(403===m){var S;if(1==f)if(f++,(S=a.TryGetRefreshToken(g,c))!=o)return void p.GetLastPrivateCatalogUpdate(t,S,c,d,u);if(f>a._maxAuthenticationAttempts||t!=o)return s.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetLastPrivateCatalogUpdate authentication loop occured.",o,c.correlationId,22823179),void u(e.DataServiceResultCode.Unauthenticated);f++;C=r;return setTimeout((function(){a.authenticationProxy.tryAuthorize((function(e){C&&(C=i,p.GetLastPrivateCatalogUpdate(e,l,c,d,u))}),(function(){C&&(C=i,u(e.DataServiceResultCode.Unauthenticated))}))}),0),void setTimeout((function(){C&&(C=i,u(e.DataServiceResultCode.Unauthenticated))}),5e3)}}s.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetLastPrivateCatalogUpdate request failed with status code "+m,o,c.correlationId,22823180),u(e.DataServiceResultCode.Failed)}))},a.prototype.GetAddInList=function(t,l,c,d,u){var p=this,f=0;a._requestHandler.getPrivateCatalogAddIns(this._clientCode,this._clientVersion,t,l,c.correlationId,(function(m,g){if(f++,a._resultCodeIsEnabled){if(m===n){var v=a.ParsePrivateCatalogServiceResponse(g,c);if(!v)return void u(e.DataServiceResultCode.Failed);if(1===v.ResponseCode)return(y=a.ParseAddInList(g,c))?void d(y):void u(e.DataServiceResultCode.Failed);if(2===v.ResponseCode)if(C=a._tokenCacheManager.GetRefreshToken(v.UserId,v.TenantId))return void p.GetAddInList(o,C,c,d,u);if(2===v.ResponseCode||3===v.ResponseCode){var h=r;return setTimeout((function(){a.authenticationProxy.tryAuthorize((function(e){h&&(h=i,p.GetAddInList(e,o,c,d,u))}),(function(){if(h){h=i;var t=a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed;u(t)}}))}),0),void setTimeout((function(){if(h){h=i;var t=a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed;u(t)}}),a._authenticationTimeout)}return void a.HandleLogging(v,c,u)}}else{var y;if(m===n)return(y=a.ParseAddInList(g,c))?void d(y):void u(e.DataServiceResultCode.Failed);if(403===m){var C;if(1==f)if(f++,(C=a.TryGetRefreshToken(g,c))!=o)return void p.GetAddInList(t,C,c,d,u);if(f>a._maxAuthenticationAttempts||t!=o)return s.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetAddInList authentication loop occured. Either authentication attempts count is greater than 2, or authorizationCode is not null. attemptsCount: "+f,o,c.correlationId,20497158),void u(e.DataServiceResultCode.Unauthenticated);f++;h=r;return setTimeout((function(){a.authenticationProxy.tryAuthorize((function(e){h&&(h=i,p.GetAddInList(e,l,c,d,u))}),(function(){if(h){h=i;var t=a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed;u(t)}}))}),0),void setTimeout((function(){if(h){h=i;var t=a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed;u(t)}}),5e3)}}s.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetAddInList request failed with status code "+m,o,c.correlationId,20497159),u(e.DataServiceResultCode.Failed)}))},a.prototype.GetManifests=function(t,l,c,d,u,p){var f=this,m=0,g={AddIns:t,RefreshToken:c,ResponseCode:1,UserId:"",TenantId:""};a._requestHandler.getPrivateCatalogManifests(e.WACUtils.serializeObjectToString(g),l,c,d.correlationId,(function(g,v){if(m++,a._resultCodeIsEnabled){if(g===n){var h=a.ParsePrivateCatalogServiceResponse(v,d);if(!h)return void p(e.DataServiceResultCode.Failed);if(1===h.ResponseCode)return(C=a.ParseAndCacheManifestList(v,d))?void u(C):void p(e.DataServiceResultCode.Failed);if(2===h.ResponseCode)if(_=a.TryGetRefreshToken(v,d))return void f.GetManifests(t,o,_,d,u,p);if(2===h.ResponseCode||3===h.ResponseCode){var y=r;return setTimeout((function(){a.authenticationProxy.tryAuthorize((function(e){y&&(y=i,f.GetManifests(t,e,o,d,u,p))}),(function(){if(y){y=i;var t=a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed;p(t)}}))}),0),void setTimeout((function(){if(y){y=i;var t=a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed;p(t)}}),a._authenticationTimeout)}return void a.HandleLogging(h,d,p)}}else{var C;if(g===n)return(C=a.ParseAndCacheManifestList(v,d))?void u(C):void p(e.DataServiceResultCode.Failed);if(403===g){var _;if(1==m)if(m++,(_=a.TryGetRefreshToken(v,d))!=o)return void f.GetManifests(t,l,_,d,u,p);return m>a._maxAuthenticationAttempts||l!=o?(s.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetManifests authentication loop occured.",o,d.correlationId,20497160),void p(e.DataServiceResultCode.Unauthenticated)):(m++,void a.authenticationProxy.tryAuthorize((function(e){f.GetManifests(t,e,c,d,u,p)}),(function(){p(e.DataServiceResultCode.Unauthenticated)})))}}s.RuntimeTelemetryHelper.LogExceptionTag("Private Catalog: GetManifests request failed with status code "+g,o,d.correlationId,20497161),p(e.DataServiceResultCode.Failed)}))},a.TryGetRefreshToken=function(e,n){var r;try{r=JSON.parse(e)}catch(e){s.RuntimeTelemetryHelper.LogCommonMessageTag(t,n.correlationId,40748691)}return r?a._tokenCacheManager.GetRefreshToken(r.UserId,r.TenantId):o},a.HandleLogging=function(t,n,r){return t?4===t.ResponseCode||5===t.ResponseCode?(5===t.ResponseCode?s.RuntimeTelemetryHelper.LogCommonMessageTag("PrivateCatalogService: User not authenticated.",o,42768075):s.RuntimeTelemetryHelper.LogExceptionTag("PrivateCatalogService: All authentication attempts failed. ResponseCode: "+t.ResponseCode,o,n.correlationId,42284252),void r(a._isThirdPartyHostEnabled?e.DataServiceResultCode.Unauthenticated:e.DataServiceResultCode.Failed)):((0===t.ResponseCode||7===t.ResponseCode)&&s.RuntimeTelemetryHelper.LogExceptionTag("Call to AddinServiceHandler failed. ResponseCode: "+t.ResponseCode,o,n.correlationId,42284253),6===t.ResponseCode&&s.RuntimeTelemetryHelper.LogCommonMessageTag("PrivateCatalogService: User not supported.",o,42284254),void r(e.DataServiceResultCode.Failed)):(s.RuntimeTelemetryHelper.LogExceptionTag("PrivateCatalogService.HandleLogging: parsedResponse object is null.",o,n.correlationId,42284251),void r(e.DataServiceResultCode.Failed))},a.ParsePrivateCatalogServiceResponse=function(e,n){var r;try{r=JSON.parse(e)}catch(e){s.RuntimeTelemetryHelper.LogCommonMessageTag(t,n.correlationId,42284255)}return r},a.SignOutUser=function(){s.RuntimeTelemetryHelper.LogCommonMessageTag(c.OUtil.formatString("PrivateCatalogService.SignOutUser: userId = {0}, tenantId = {1}",a._userId,a._tenantId),o,21616005),a._tokenCacheManager.RemoveRefreshToken(a._userId,a._tenantId),a.authenticationProxy.signOut((function(){a._cacheManager.RemoveAll(e.PrivateCatalog._addInsCacheKey),a._cacheManager.RemoveAll(e.PrivateCatalog._addInDetailsCacheKeyPrefix)}),(function(){s.RuntimeTelemetryHelper.LogCommonMessageTag("Private Catalog: Failed to sign out ",o,22316866)}))},a._maxAuthenticationAttempts=3,a._authenticationTimeout=3e3,a}();e.PrivateCatalogService=t}(p||(p={})),function(e){var t=function(){var t="requestIdleCallback",n="SDX Catalog Error AssetId: ",r=null,o="fetch",i=!1,a="",l="sdxPreloadStart",d=!0,u="errorMessage",p="manifestParseEnd",f="manifestParseStart",m="manifestRetrievalEnd",g="manifestRetrievalStart",v="packageListParseEnd",h="packageListParseStart",y="packageListRetrievalEnd",C="packageListRetrievalStart",_="activateAsyncStart",S="cachedUrls",A="Version",I="FFN",T="AssetId",O="OsfControlId",x="performanceTimestampOrigin";function E(){}return E.recordActivity=function(e,t,n,r){otel&&otel.sendActivityEvent&&otel.sendActivityEvent({name:"Office.Online.Sdx."+e,durationMs:performance.now()-t,succeeded:n,dataFields:r})},E.recordActivationActivity=function(e,t){var n="activationStart";E.recordActivity("Activation",t[n],e,[{name:"PerformanceTimestampOrigin",double:t[x]},{name:O,string:t.osfControlId},{name:T,string:t.assetId},{name:I,string:t.ffn},{name:A,string:t.version},{name:"SourceLocationOverrideResourceId",string:t.sourceLocationOverrideResourceId},{name:"IframeUrl",string:t.iframeUrl},{name:"CachedUrls",string:t[S]},{name:"ActivationStart",double:t[n]},{name:"ActivateAsyncStart",double:t[_]},{name:"PackageListRetrievalStart",double:t[C]},{name:"PackageListRetrievalEnd",double:t[y]},{name:"PackageListParseStart",double:t[h]},{name:"PackageListParseEnd",double:t[v]},{name:"ManifestRetrievalStart",double:t[g]},{name:"ManifestRetrievalEnd",double:t[m]},{name:"ManifestParseStart",double:t[f]},{name:"ManifestParseEnd",double:t[p]},{name:"IframeCreateStart",double:t.iframeCreateStart},{name:"IframeCreateEnd",double:t.iframeCreateEnd},{name:"GetAppContextStart",double:t.getAppContextStart},{name:"GetAppContextEnd",double:t.getAppContextEnd},{name:"IframeOnLoadReceived",double:t.iframeOnLoadReceived},{name:"ErrorMessage",string:t[u]},{name:"OfficeJsReadyDate",double:t.officeJsReadyDate},{name:"IsPreload",boolean:t.isPreload===d},{name:"SdxPreloadStart",string:t[l]}])},E.InitializeSdx=function(t){var n="Application",r=c.OUtil.getValue(t.flightingTreatmentVariables,{}),o=c.OUtil.getValue(t.generalParameters,{});if(E.appName=c.OUtil.getValue(o[n],"Unknown"),E.wacCdnRssUrl=c.OUtil.getValue(o.wacCdnRssUrl,a),"true"===r["Microsoft.Office.WordOnline.SdxAssetPrefetchWithOfficeNetIframe"]){var i=o.StaticContentUrl+"sdxprefetcher.htm";E.PrefetcherIframeOrigin=e.WACUtils.getDomainForUrl(i),E.PrefetcherIframeContentWindow=new Promise((function(e){var t=document.createElement("iframe");t.src=i,t.style.display="none",t.onload=function(){return e(t.contentWindow)},t.setAttribute("sandbox","allow-same-origin allow-scripts"),document.getElementsByTagName("body")[0].appendChild(t)}))}E.InitializeSdxList(o.SdxDmsUrl,o.SdxCdnUrl,o.UICulture,o[n],o.LoggableUserId,o.SessionStartInfoJson)},E.MarkSdxPreloadStart=function(e){var t=e.toLowerCase();E.SdxPreloadStart[t]=performance.now()},E.IsSdxPreloaded=function(e){var t=e.toLowerCase();return E.SdxPreloadStart.hasOwnProperty(t)},E.GetPackageList=function(t,n,a,l,d,u){var p="prefetchedDmsResponse";void 0===u&&(u=i);var f=window[o]||e.AsyncUtil.fetch,m={automation:"Dogfood",microsoft:"Microsoft",dogfood:"Dogfood"}[JSON.parse(d).AudienceGroup.toLowerCase()]||"Production",g="SDXPackageList_"+a+"_"+n.toLowerCase(),v=0;return e.AsyncUtil.Cache.hasOwnProperty(g)||void 0===window[p]||(e.AsyncUtil.Cache[g]=window[p],delete window[p]),e.AsyncUtil.withCache(g,{forceUpdateCache:u,maxAgeInSecs:3600,useStaleCache:!0},(function(){return e.AsyncUtil.retry((function(){++v;var e=c.OUtil.Guid.generateNewGuid();return s.RuntimeTelemetryHelper.LogCommonMessageTag("Making network call to DMS. DMSActivityId="+e,r,594629387),f(t,{method:"POST",body:JSON.stringify({Context:{Hosts:[a],ReactNativeVersion:"0.0.0.0",Channel:"DevMain",Capabilities:c.AppSpecificSetup.BuildRequirementsChecker()._getSupportedSetAsDmsCapabilities(),Ring:m,Platform:"Web",Locales:[n],ClientId:l},SyncId:0}),headers:{"Content-Type":"application/json",DMSActivityId:e}}).then((function(e){if(!e.ok)throw new Error(e.status+" - "+e.statusText);return e.text()}),(function(t){throw new Error("GetPackageList : dmsActivityId:"+e+" : "+t.message+" : fetch attempts "+v)}))}))}))},E.GetManifest=function(t,n,a,l){void 0===l&&(l=i);var d=window[o]||e.AsyncUtil.fetch,u=E.GetManifestCdnUrl(t,n),p=c.OUtil.hashCode(u);return e.AsyncUtil.withCache("SDXManifest_"+n.AssetId+"_"+n.FFN+"_"+n.Version+"_"+p,{forceUpdateCache:l,maxAgeInSecs:259200,useStaleCache:!0},(function(){return e.AsyncUtil.retry((function(){return s.RuntimeTelemetryHelper.LogCommonMessageTag("Making network call to CDN. Url="+u,r,594629386),d(u).then((function(e){if(!e.ok)throw new Error(e.status+" - "+e.statusText);return e.text()}),(function(e){throw new Error("GetManifest error: "+e.message)}))}))}))},E.GetManifestCdnUrl=function(e,t){return c.OUtil.formatString(e,t.AssetId,t.FFN,t.Version,"en-us")},E.IsAbsoluteUrl=function(e){return/^(?:[a-z]+:)?\/\//i.test(e)},E.ResolveUrl=function(e,t){if(E.IsAbsoluteUrl(t))return t;var n=e.lastIndexOf("/");return e.substr(0,n)+("/"===t.charAt(0)?a:"/")+t},E.UpdateManifestIconUrl=function(e,t,n){for(var r="en-US",o=0,i=["_iconUrls","_highResolutionIconUrls"];o<i.length;o++){var a=i[o];if(e[a])if(e[a][n])e[a][n]=E.ResolveUrl(t,e[a][n]);else if(e[a][r])e[a][n]=E.ResolveUrl(t,e[a][r]);else for(var s in e[a])if(e[a].hasOwnProperty(s)&&r.toLowerCase()==s.toLowerCase()){e[a][s]=E.ResolveUrl(t,e[a][s]);break}}},E.InitializeSdxList=function(e,t,n,o,i,a){var l=E.GetPackageList(e,n,c.getManifestHostType(o),i,a,d).then((function(e){var t=e.value;return JSON.parse(t).Packages}));l.then((function(e){return e.forEach((function(e){return E.requestIdleCallback(function(e){return function(){return E.GetManifest(t,e,n,d).catch((function(){}))}}(e))})),e}),(function(e){var t=c.OUtil.getLocalStorage().isLocalStorageAvailable();s.RuntimeTelemetryHelper.LogExceptionTag("Error in getting SDX package list:InitializeSdxList localStorage:"+t,e,r,594629385)})),E.SdxCdnManifestUrlByAssetId=l.then((function(e){var n={};return e.forEach((function(e){n[e.AssetId.toLowerCase()]=E.GetManifestCdnUrl(t,e)})),n}))},E.PrefetchUrl=function(t,n){var r="prefetch";if(void 0===n&&(n=i),!E.PrefetchedAssetSet.hasOwnProperty(t)){var a={start:performance.now()};if(E.PrefetchedAssetSet[t]=a,E.PrefetcherIframeContentWindow)E.PrefetcherIframeContentWindow.then((function(e){e.postMessage({action:r,type:"link",urls:[t]},E.PrefetcherIframeOrigin)}));else if(n){var s=document.createElement("link");s.rel=r,s.href=t,s.onload=function(){a.end=performance.now()},document.head.appendChild(s)}else{var l=window[o]||e.AsyncUtil.fetch;E.requestIdleCallback((function(){l(t,{mode:"no-cors"}).then((function(){a.end=performance.now()}))}))}}},E.ResolveRelativeUrl=function(e,t){return E.SdxCdnManifestUrlByAssetId.then((function(n){var o=n[t.toLowerCase()];if(o==r)throw new Error("Unable to find manifestUrl");return E.ResolveUrl(o,e)}))},E.PrefetchAsset=function(e,t,n,o){var s=e.match(E.OfficeJsEntryRegex);if(s===r){var l=i;"iframeUrl:"===e.slice(0,10)&&(e=e.slice(10),l=d),E.IsAbsoluteUrl(e)?E.PrefetchUrl(e,l):l?E.ResolveRelativeUrl(e,o).then((function(e){return E.PrefetchUrl(e,d)}),(function(){})):E.ResolveRelativeUrl(e,o).then((function(e){return E.PrefetchUrl(e,i)}),(function(){}))}else{var u=s[1],p=s[2],f="https://appsforoffice.microsoft.com/lib/"+s[3]+"/hosted/",m=n.toLowerCase(),g=c.HostSpecificFileVersionMap[m].web||c.HostSpecificFileVersionDefault;E.PrefetchUrl(a+f+u),E.PrefetchUrl(a+f+m+"-web-"+g+(p||a)+".js"),E.PrefetchUrl(f+"en-us/office_strings.js"),E.PrefetchUrl(f+"telemetry/oteljs_agave.js"),E.PrefetchUrl(f+"webauth/webauth.implicit.js")}},E.PrefetchSdxAssets=function(e,t,n,o){var l="Microsoft.Office.OEP.",c=e.SdxAssetsToPrefetchMapping;if(c!=r&&!E.IsSdxPreloaded(o)){var u=[],p=[];try{u=JSON.parse(t[l+o.toUpperCase()+".SdxPrefetchAssetsToAdd"]||"[]"),p=JSON.parse(t[l+o.toUpperCase()+".SdxPrefetchAssetsToRemove"]||"[]")}catch(e){s.RuntimeTelemetryHelper.LogExceptionTag("Error in parsing the sdx prefetch override flighting treatment variables.",e,r,593052824)}if("Word"===n){var f;try{f=JSON.parse(c)[o.toLowerCase()]}catch(e){return void E.LogSDXCatalogMonitoringError("Parsing SdxAssetsToPrefetchMapping failed.",o)}if(Array.isArray(f))for(var m=0,g=f;m<g.length;m++){var v=g[m];-1===p.indexOf(v)&&E.PrefetchAsset(v,e,n,o)}else for(var h=0,y=Object.keys(f);h<y.length;h++){var C=y[h],_=i;if(C===a)_=d;else{var S=C.split("=="),A=S[0],I=S[1];e[A]==I?_=d:t["Microsoft.Office."+A]==I&&(_=d)}if(_)for(var T=0,O=f[C];T<O.length;T++){v=O[T];-1===p.indexOf(v)&&E.PrefetchAsset(v,e,n,o)}}for(var x=0,b=u;x<b.length;x++){v=b[x];E.PrefetchAsset(v,e,n,o)}}}},E.AddWacSettingParametersToIframeUrl=function(e,t){var n=document.createElement("a");n.href=e;var r=Object.keys(t).map((function(e){return"wacSetting"+e+"="+encodeURIComponent(t[e].toString())})).join("&"),o=n.search.length>1?n.search.substr(1)+"&":a;return n.search=o+r,n.href},E.activateAsync=function(t,o,b,M,R,P){var N="WasCachedInMemory",U="PackageListRetrieval";b.startActivity(e.Activity.Activation),P[_]=performance.now(),P.assetId=t.assetId.toUpperCase();var F=e.CatalogFactory.getHostContext();s.RuntimeTelemetryHelper.LogCommonMessageTag("Start activating SDX with assetId: "+t.assetId+".",b.correlationId,37291606),b.startActivity(e.Activity.ServerCall);var w=r,D=performance.now();P[C]=performance.now(),E.GetPackageList(F.sdxDmsUrl,F.appUILocale,c.getManifestHostType(F.hostType),R.clientId,R.sessionStartInfoJson).then((function(e){var t=e.cacheType,n=e.value;P[y]=performance.now(),P[h]=performance.now();var r={cacheType:t,packages:JSON.parse(n).Packages};return P[v]=performance.now(),r})).then((function(e){var t=e.cacheType,n=e.packages;return E.recordActivity(U,D,d,[{name:O,string:b.instanceId},{name:N,bool:"memory"==t}]),n}),(function(e){throw s.RuntimeTelemetryHelper.LogExceptionTag("Error in getting SDX package list:activateAsync",e,r,556066975),P[y]=performance.now(),E.recordActivity(U,D,i,[{name:O,string:b.instanceId},{name:N,bool:i}]),e.sdxErrorCode=c.ErrorStatusCodes.WAC_SDX_DMSRequestFailed,e})).then((function(e){if((w=e.filter((function(e){return e.AssetId.toLowerCase()==t.assetId.toLowerCase()}))[0])==r){var n=new Error('Unable to find SDX "'+t.assetId+'" in the package list.');throw n.sdxErrorCode=c.ErrorStatusCodes.WAC_SDX_AssetIdNotInDMSResponse,n}return w})).then((function(t){var n="ManifestRetrieval";b.startActivity(e.Activity.ManifestRequest);var o=performance.now();return P[g]=performance.now(),P.ffn=t.FFN,P.version=t.Version,E.GetManifest(F.sdxCdnUrl,t,F.appUILocale).then((function(e){var r=e.cacheType,i=e.value;return P[m]=performance.now(),E.recordActivity(n,o,d,[{name:O,string:b.instanceId},{name:T,string:t.AssetId},{name:I,string:t.FFN},{name:A,string:t.Version},{name:N,bool:"memory"==r}]),i}),(function(e){throw s.RuntimeTelemetryHelper.LogExceptionTag("Error in getting Manifest:activateAsync",e,r,554235264),P[m]=performance.now(),E.recordActivity(n,o,i,[{name:O,string:b.instanceId},{name:T,string:t.AssetId},{name:I,string:t.FFN},{name:A,string:t.Version},{name:N,bool:i}]),e.sdxErrorCode=c.ErrorStatusCodes.WAC_AgaveManifestRequestFailure,e}))})).then((function(t){P[f]=performance.now();var n=e.ManifestUtil.ParseManifest(t,F.appUILocale,b.correlationId);if(P[p]=performance.now(),E.recordActivity("ManifestParse",P[f],n!=r,[{name:O,string:b.instanceId},{name:T,string:w.AssetId},{name:I,string:w.FFN},{name:A,string:w.Version}]),n==r){var o=new Error("Unable to parse manifest.");throw o.sdxErrorCode=c.ErrorStatusCodes.WAC_AgaveManifestRequestFailure,o}return c.OsfManifestManager.cacheManifest(w.AssetId,a,n),n})).then((function(n){b.stopActivity(e.Activity.ServerCall),b.stopActivity(e.Activity.ManifestRequest);var i=E.GetManifestCdnUrl(F.sdxCdnUrl,w);E.UpdateManifestIconUrl(n,i,F.appUILocale),P[S]=JSON.stringify(E.PrefetchedAssetSet),P[l]=JSON.stringify(E.SdxPreloadStart),P[x]=Date.now()-performance.now(),o.load({entitlement:t,manifest:n,eToken:a,manifestUrl:i},r)}),(function(a){if(P[u]=a.toString(),P[S]=JSON.stringify(E.PrefetchedAssetSet),P[l]=JSON.stringify(E.SdxPreloadStart),P[x]=Date.now()-performance.now(),e.SDXCatalog.recordActivationActivity(i,P),s.RuntimeTelemetryHelper.LogExceptionTag(n+t.assetId,a,r,39068003),a.sdxErrorCode!=r){var c=e.HostFeatureEnabledInfo.getHostFeatureEnabledInfo(),d=c&&c.enableFirstPartySDXErrorMessages;e.LoaderUtil.failWithError(o,{title:d?Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty:Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:d?Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty:Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){o.restartActivation(),E.activateAsync(t,o,b,M,R,P)},errorCode:a.sdxErrorCode})}}))},E.LogSDXCatalogMonitoringError=function(e,t){s.RuntimeTelemetryHelper.LogExceptionTag(n+t+" Message: "+e,r,r,594350788)},E.appName="Unknown",E.wacCdnRssUrl=a,E.PrefetchedAssetSet={},E.OfficeJsEntryRegex=/^(office(\.debug)?\.js)@(1|1\.0|1\.1|beta)$/i,E.SdxPreloadStart={},E.PrefetcherIframeContentWindow=r,E.PrefetcherIframeOrigin=r,E.requestIdleCallback=window[t]?window[t].bind(window):e.AsyncUtil.limitRate((function(e){return e()}),50),E}();e.SDXCatalog=t}(p||(p={})),function(e){var t=!1,n=null,r=!0,o=function(){function o(e,t){this._initParam=t,this._cacheManager=e.cacheManager,this._telemetryContext=e.telemetryContext}return o.prototype.getManifest=function(o,i,a,s){var l=this,d=l;l._telemetryContext.startActivity(e.Activity.ManifestRequest);var u=c.OsfManifestManager.getCachedManifest(i.OfficeExtensionID,i.OfficeExtensionVersion);if(u)return l._telemetryContext.stopActivity(e.Activity.ManifestRequest),l._telemetryContext.stopActivity(e.Activity.ServerCall),void a({status:e.DataServiceResultCode.Succeeded,value:{manifest:u,cached:r}});i.EncodedAbsUrl?o.getManifest(i.EncodedAbsUrl,i.OfficeExtensionID,i.OfficeExtensionVersion,(function(r){if(d._telemetryContext.stopActivity(e.Activity.ManifestRequest),d._telemetryContext.stopActivity(e.Activity.ServerCall),r.status==e.DataServiceResultCode.Succeeded){var o=e.ManifestUtil.ParseManifest(r.value.manifest,d._initParam.appUILocale,d._telemetryContext.correlationId);o==n&&(r.status=e.DataServiceResultCode.Failed),a({status:r.status,value:{manifest:o,cached:t}})}else a({status:r.status,value:{manifest:n,cached:t}})}),s):a({status:e.DataServiceResultCode.Failed,value:{manifest:n,cached:t}})},o.prototype.activate=function(o,i,a){var s,l=this,d={assetId:i.assetId,appVersion:i.appVersion,storeId:i.storeId,storeType:i.storeType,targetType:i.targetType},u=function(o,s){var u=o.manifest,p=u.getMarketplaceVersion();if(c.OsfManifestManager.cacheManifest(i.assetId,i.appVersion,u),o.cached&&e.ManifestUtil.versionLessThan(p,i.appVersion))m(r);else{if(u.requirementsSupported===t||void 0===u.requirementsSupported&&!a.getRequirementsChecker().isManifestSupported(u)){u.requirementsSupported=t;var f;return f=Strings.OsfRuntime.L_AgaveManifestRequirementsError_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR,void e.LoaderUtil.failWithError(a,{description:f,detailView:r,errorCode:c.ErrorStatusCodes.WAC_AgaveRequirementsError})}if(u.requirementsSupported=r,s&&!a.skipTrust(i)){var g=c.OUtil.formatString(c.Constants.ActivatedCacheKey,i.assetId.toLowerCase(),i.storeType,i.storeId),v=c.OmexClientNames[l._initParam.applicationName];if(!l._cacheManager.GetCacheItem(g,t)&&!a.hasConsent(i)&&!a.isForCustomFunctionSandbox())return void a.askForTrust({anonymous:n,clientName:v,entitlement:d,displayName:u.getDefaultDisplayName(),providerName:u.getProviderName(),iconUrl:u.getDefaultIconUrl(),isSSOAddin:u.isSSOAddin()},(function(){l._cacheManager.SetCacheItem(g,r),a.load({entitlement:d,manifest:u,eToken:n},n)}))}a.hasConsent(i)&&l._cacheManager.SetCacheItem(g,r),a.load({entitlement:d,manifest:u,eToken:n},n)}},p=function(t){l.getManifest(o,s,(function(n){n.status===e.DataServiceResultCode.Succeeded&&n.value.manifest?u(n.value,r):e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),p(t)},errorCode:c.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE})}),t)},f=function(t){s?s.OfficeExtensionKillbit?e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,errorCode:c.ErrorStatusCodes.E_OEM_EXTENSION_KILLED}):p(t):e.LoaderUtil.failWithError(a,{description:Strings.OsfRuntime.L_AgaveNotExist_ERR,buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),l._telemetryContext.startActivity(e.Activity.Activation),l._telemetryContext.startActivity(e.Activity.ServerCall),m(r)},errorCode:c.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST})},m=function(r){s=n,l._telemetryContext.startActivity(e.Activity.EntitlementCheck),o.getEntitlementAsync(t,i.targetType,(function(t){if(t.status==e.DataServiceResultCode.Succeeded){l._telemetryContext.stopActivity(e.Activity.EntitlementCheck);for(var o,i=n,u=t.value.entitlements,p=0;p<u.length;p++)(o=u[p]).OfficeExtensionID&&d.assetId&&o.OfficeExtensionID.toLowerCase()==d.assetId.toLowerCase()&&(i&&!e.ManifestUtil.versionLessThan(i.OfficeExtensionVersion,o.OfficeExtensionVersion)||(i=o));s=i,f(r)}else e.LoaderUtil.failWithError(a,{description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveMyOrganizationCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){a.restartActivation(),l._telemetryContext.startActivity(e.Activity.Activation),l._telemetryContext.startActivity(e.Activity.ServerCall),m()},errorCode:c.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE})}),r)};m()},o}(),i=function(){function i(t,r){var o=this;void 0===r&&(r=n),o._appDataService={},o._catalogUrlDataService={},o._initParam=t,o._cacheManager=r||new e.AppsDataCacheManager(c.OUtil.getLocalStorage(),new e.SafeSerializer)}return i.prototype.getDataService=function(e,t,n){this.getDataServiceInternal(this._appDataService,e,t,n)},i.prototype.getCatalogUrlDataService=function(e,t,n){this.getDataServiceInternal(this._catalogUrlDataService,e,t,n)},i.prototype.getDataServiceInternal=function(t,r,o,i){if(t[r]==n&&(t[r]={spCatalogService:n,spCatalogServiceReady:n}),t[r].spCatalogService==n)if(t[r].spCatalogServiceReady==n){t[r].spCatalogServiceReady=i;var a={status:e.DataServiceResultCode.Failed,value:n},s=function(o,i){var s=t[r].spCatalogServiceReady;t[r].spCatalogServiceReady=n,o.status==e.DataServiceResultCode.Succeeded?(t[r].spCatalogService=i,a.value=i,a.status=e.DataServiceResultCode.Succeeded,s(a)):(a.httpStatus=o.httpStatus,s(a))};o.startActivity(e.Activity.Authentication);var l=e.SPCatalogProxyBasedCatalogService.getInstance(this._initParam);l.prepareProxy(r,o.correlationId,(function(t){o.stopActivity(e.Activity.Authentication),s(t,l)}))}else{var c=t[r].spCatalogServiceReady;t[r].spCatalogServiceReady=function(e){c(e),i(e)}}else i({status:e.DataServiceResultCode.Succeeded,value:t[r].spCatalogService})},i.prototype.createActivityScope=function(t,n,r){var i=this;this.getDataService(t,n,(function(a){if(!e.AsyncUtil.failed(a,r)){var s=a.value,l={cacheManager:i._cacheManager,storeId:t,telemetryContext:n},c=s.createScope(l),d=new o(l,i._initParam);r({status:e.DataServiceResultCode.Succeeded,value:{serviceScope:c,activityScope:d}})}}))},i.prototype.getEntitlementAsync=function(t,r,o,i,a,s){var l=this,d=function(a){a.status===e.DataServiceResultCode.Succeeded?(l.myOrgCatalogUrl=a.value,l.createActivityScope(a.value,r,(function(r){e.AsyncUtil.failed(r,o,[])||r.value.serviceScope.getEntitlementAsync(t,n,(function(t){if(!e.AsyncUtil.failed(t,o,[])){for(var n=t.value.entitlements,r=0;r<n.length;r++){var i=n[r];i.assetId=i.OfficeExtensionID,i.appVersion=i.OfficeExtensionVersion,i.storeId=l.myOrgCatalogUrl,i.storeType=c.StoreType.SPCatalog,i.targetType=c.OfficeAppType[i.OEType]}o({status:t.status,value:n})}}),i)}))):o({status:a.status,value:n})};(s=s||this.myOrgCatalogUrl||n)?d({status:e.DataServiceResultCode.Succeeded,value:s}):this.getSPCatalogUrl(r,d)},i.prototype.getAndCacheManifest=function(o,i,a,s){var l=this;this.getEntitlementAsync(r,a,(function(t){if(c.OUtil.writeProfilerMark(c.OsfOfficeExtensionManagerPerfMarker.GetEntitlementEnd),t.status===e.DataServiceResultCode.Succeeded&&t.value){for(var r=t.value,i=r.length,d=n,u=0;u<i;u++){var p=r[u];p.OfficeExtensionID&&o.assetId&&p.OfficeExtensionID.toLowerCase()===o.assetId.toLowerCase()&&(d&&!c.OsfManifestManager.versionLessThan(d.OfficeExtensionVersion,p.OfficeExtensionVersion)||(d=p))}d!=n?l.createActivityScope(l.myOrgCatalogUrl,a,(function(t){e.AsyncUtil.failed(t,s)||t.value.activityScope.getManifest(t.value.serviceScope,d,(function(e){s({status:e.status,value:e.value.manifest})}))})):s({status:e.DataServiceResultCode.Failed,value:n})}else s({status:e.DataServiceResultCode.Failed,value:n})}),t,0,o.storeId)},i.prototype.isUpnMatchAsync=function(t,n,r){var o=this;this.getCatalogUrlDataService(this._initParam.spBaseUrl,n,(function(){e.SPCatalogProxyBasedCatalogService.getInstance(o._initParam).isUpnMatchAsync(t,o._initParam.spBaseUrl,n.correlationId,r)}))},i.prototype.activateAsync=function(t,n,r){var o=this;r.startActivity(e.Activity.Activation),r.startActivity(e.Activity.ServerCall),this.createActivityScope(t.storeId,r,(function(i){if(i.status==e.DataServiceResultCode.Succeeded){var a=i.value.serviceScope;i.value.activityScope.activate(a,t,n)}else e.LoaderUtil.failWithError(n,{description:c.OUtil.formatString(Strings.OsfRuntime.L_AgaveServerConnectionToCatalogFailed_ERR,Strings.OsfRuntime.L_AgaveMyOrganizationCatalogName),buttonTxt:Strings.OsfRuntime.L_RetryButton_TXT,buttonCallback:function(){n.restartActivation(),o.activateAsync(t,n,r)},errorCode:c.ErrorStatusCodes.WAC_AgaveAnonymousProxyCreationError})}))},i.prototype.removeAsync=function(t,n,r){r({status:e.DataServiceResultCode.Failed})},i.prototype.getAppDetails=function(t,n,r,o){o({status:e.DataServiceResultCode.Failed})},i.prototype.getSPCatalogUrl=function(t,n){var r=this;this.getCatalogUrlDataService(this._initParam.spBaseUrl,t,(function(){e.SPCatalogProxyBasedCatalogService.getInstance(r._initParam).getSPCatalogUrl(r._initParam.spBaseUrl,t.correlationId,n)}))},i}();e.CatalogFactory.register(c.StoreType.SPCatalog,(function(e){return new i({applicationName:c.HostCapability[e.hostType],AppVersion:e.appVersion,clientMode:e.clientMode,appUILocale:e.appUILocale,spBaseUrl:e.spBaseUrl,docUrl:e.docUrl})}))}(p||(p={})),function(e){var t=function(){function e(){}return e.CheckProxyIsReady="OEM_isProxyReady",e.GetEntitlementSummary="OEM_getEntitlementSummaryAsync",e.GetManifest="OEM_getManifestAsync",e.GetSPCatalogUrl="OEM_getSPCatalogUrlAsync",e.IsUpnMatch="OEM_isUpnMatchAsync",e}();e.SPCatalogProxyMethods=t;var n=function(){function e(){this.iframeProxies={},this.iframeProxyCount=0}return e.iframeNamePrefix="__officeExtensionProxy",e}();e.IframeProxyGroup=n;var r=function(r){var o=null;function a(e,t){var n=r.call(this)||this;return n.proxyUrl=e,n.iframeProxyGroup=t,n}return i(a,r),a.prototype.getEntitlementsAsync=function(e,n){this.invokeProxyCommandAsync(t.GetEntitlementSummary,e,n)},a.prototype.getManifestAsync=function(e,n){this.invokeProxyCommandAsync(t.GetManifest,e,n)},a.prototype.getSPCatalogUrlAsync=function(e,n){this.invokeProxyCommandAsync(t.GetSPCatalogUrl,e,n)},a.prototype.isUpnMatchAsync=function(e,n){this.invokeProxyCommandAsync(t.IsUpnMatch,e,n)},a.prototype.prepareProxy=function(e,t){var n=this;n.isReady?e({status:o,value:{clientEndpoint:n.clientEndPoint}}):n.clientEndPoint?n.pendingCallbacks.push([e,t]):n.createProxy(e,t)},a.resetProxy=function(e){delete e.iframeProxyGroup.iframeProxies[e.proxyUrl],e.iframeProxyGroup.iframeProxyCount=e.iframeProxyGroup.iframeProxyCount-1,Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(e.conversationId)&&Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(e.conversationId),e.iframe&&(c.OUtil.removeEventListener(e.iframe,"load",e.iframeOnload),e.iframe.parentNode.removeChild(e.iframe),e.iframe=o),e.clientEndPoint=o},a.prototype.createProxy=function(r,i){var l=this;try{if(!l.doesUrlHaveSupportedProtocol(l.proxyUrl))return void i({status:o,value:{errorMessage:"Protocal of proxyUrl is not supported."}});l.iframeProxyGroup.iframeProxies[l.proxyUrl]=l,l.iframeProxyGroup.iframeProxyCount=l.iframeProxyGroup.iframeProxyCount+1;var d=l.proxyUrl,u=d.length;"/"===d.charAt(u-1)&&(d=d.substr(0,u-1));var p=document.createElement("iframe"),f=n.iframeNamePrefix+l.iframeProxyGroup.iframeProxyCount;p.setAttribute("id",f),p.setAttribute("name",f);var m=d+"/_layouts/15/OfficeExtensionManager.aspx?"+l.conversationId,g=window.location.origin;m=c.OUtil.addXdmInfoAsHash(m,l.conversationId+"|"+f+"|"+g),m=c.OUtil.addSerializerVersionAsHash(m,c.SerializerVersion.Browser),m=c.OUtil.addFlightsAsHash(m,JSON.stringify(c.Flights)),p.setAttribute("scrolling","auto"),p.setAttribute("border","0"),p.setAttribute("width","0"),p.setAttribute("height","0"),p.setAttribute("style","position: absolute; left: -100px; top:0px;");var v=l;document.body.appendChild(p);var h=function(){if(v.clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(v.conversationId,p.contentWindow,v.proxyUrl),v.clientEndPoint)v.clientEndPoint.invoke(t.CheckProxyIsReady,(function(e,t){var n=o;0===e&&t.status?(v.isReady=!0,n={status:o,value:{clientEndpoint:v.clientEndPoint}}):(a.resetProxy(v),n={status:o,value:{errorMessage:"isProxyReadyCallback failed, error code "+e}});for(var r=v.pendingCallbacks.length,i=0;i<r;i++){var s=v.pendingCallbacks.shift();v.isReady?s[0](n):s[1](n)}}),{__timeout__:2e3});else{var e="Unexpected error, iframe loaded again after failing OEM_isProxyReady";s.RuntimeTelemetryHelper.LogExceptionTag(e,o,o,18657365),i({status:o,value:{errorMessage:e}})}};c.OUtil.addEventListener(p,"load",h),p.setAttribute("src",m),l.iframeOnload=h,l.pendingCallbacks.push([r,i]),l.iframe=p}catch(t){var y="Error creating client endpoint with proxyUrl = ["+l.proxyUrl+"], msg:"+e.WACUtils.serializeObjectToString(t);i({status:o,value:{errorMessage:y}})}},a}(e.ProxyBase);e.SPCatalogProxy=r}(p||(p={})),function(e){var t="webUrl",n=null,r=function(){function r(t){this.proxyRetries={},this.initParams=t,this.iframeProxyGroup=new e.IframeProxyGroup}return r.getInstance=function(e){return r._instance==n&&(r._instance=new r(e)),r._instance},r.prototype.prepareProxy=function(t,r,o){r=r||"";this.proxyRetries[t]=1,this.ensureSPCatalogProxySetUp(t,r,(function(t){t&&t.status!=n?t.status:e.DataServiceResultCode.ProxyNotReady;o({status:t.status})}))},r.prototype.createScope=function(e){return new o(e,this)},r.prototype.getSPCatalogUrl=function(r,o,i){var a=this;this.prepareProxy(r,o,(function(){var d;if(r)if(d=a.iframeProxyGroup.iframeProxies[r]){var u={};u[t]=r,d.getSPCatalogUrlAsync(u,(function(t){var r="getspcatalogurl failed";t.status!==e.DataServiceResultCode.Succeeded&&(s.RuntimeTelemetryHelper.LogExceptionTag(r,n,o,19015125),l.msAjaxDebug.trace(r)),i(t)}))}else s.RuntimeTelemetryHelper.LogExceptionTag(c.OUtil.formatString("getspcatalogurl proxy not found, webUrl: {0}",r),n,o,19969545),i({status:e.DataServiceResultCode.ProxyNotReady});else s.RuntimeTelemetryHelper.LogExceptionTag("getspcatalogurl proxy URL empty",n,o,595190872),i({status:e.DataServiceResultCode.PrxoyUrlEmpty})}))},r.prototype.isUpnMatchAsync=function(r,o,i,a){var d=this;this.prepareProxy(o,i,(function(){var u;if(o)if(u=d.iframeProxyGroup.iframeProxies[o]){var p={};p.upn=r,p[t]=o,u.isUpnMatchAsync(p,(function(t){var r="isUpnMatchAsync failed";t.status!==e.DataServiceResultCode.Succeeded&&(s.RuntimeTelemetryHelper.LogExceptionTag(r,n,i,588814302),l.msAjaxDebug.trace(r)),a(t)}))}else s.RuntimeTelemetryHelper.LogExceptionTag(c.OUtil.formatString("isUpnMatchAsync proxy not found, webUrl: {0}",o),n,i,588814303),a({status:e.DataServiceResultCode.ProxyNotReady});else s.RuntimeTelemetryHelper.LogExceptionTag("isUpnMatchAsync proxy URL empty",n,i,588814301),a({status:e.DataServiceResultCode.PrxoyUrlEmpty})}))},r.prototype.ensureSPCatalogProxySetUp=function(t,r,o){if(!t)return s.RuntimeTelemetryHelper.LogExceptionTag("proxyUrl is null",n,r,19969546),void o({status:e.DataServiceResultCode.Failed});var i=this.iframeProxyGroup.iframeProxies[t];if(i||(i=new e.SPCatalogProxy(t,this.iframeProxyGroup)),i.isReady)o({status:e.DataServiceResultCode.Succeeded});else{var a=this,l=function(){o({status:e.DataServiceResultCode.Succeeded})},d=function(){a.proxyRetries[t]<c.Constants.AuthenticatedConnectMaxTries?(a.proxyRetries[t]++,i.prepareProxy(l,d)):(s.RuntimeTelemetryHelper.LogExceptionTag("sp exceed maximum tries and fail",n,r,18940555),o({status:e.DataServiceResultCode.ProxyNotReady}))};i.prepareProxy(l,d)}},r}();e.SPCatalogProxyBasedCatalogService=r;var o=function(){var r="clearCache";function o(e,t){this._catalogService=t,this.proxyUrl=e.storeId,this._correlationId=e.telemetryContext.correlationId||""}return o.prototype.tryFail=function(t,n,r){return t!=e.DataServiceResultCode.Succeeded&&(r({status:t}),!0)},o.prototype.getEntitlementAsync=function(e,n,o,i){var a=this,s=a,l=a._catalogService.iframeProxyGroup.iframeProxies[a.proxyUrl],c={};c[t]=a.proxyUrl,c.applicationName=a._catalogService.initParams.applicationName,c.officeExtentionTarget=n,c[r]=i||!1,c.supportedManifestVersions={"1.0":!0,1.1:!0},l.getEntitlementsAsync(c,(function(e){s.tryFail(e.status,e.httpStatus,o)?s.logServiceCallResponseError("entitlement",e.httpStatus):o(e)}))},o.prototype.getLastStoreUpdate=function(){},o.prototype.getManifest=function(e,t,n,o,i){var a=this,s=this._catalogService.iframeProxyGroup.iframeProxies[this.proxyUrl],l={};l.manifestUrl=e,l.id=t,l.version=n,l[r]=i,s.getManifestAsync(l,(function(e){a.tryFail(e.status,e.httpStatus,o)?a.logServiceCallResponseError("manifest",e.httpStatus):o(e)}))},o.prototype.isUpnMatchAsync=function(e,n){var r=this,o=r,i=r._catalogService.iframeProxyGroup.iframeProxies[r.proxyUrl],a={};a.upn=e,a[t]=r.proxyUrl,i.isUpnMatchAsync(a,(function(e){o.tryFail(e.status,e.httpStatus,n)?o.logServiceCallResponseError("isUpnMatch",e.httpStatus):n(e)}))},o.prototype.logServiceCallResponseError=function(e,t){var r="spproxy request "+e+" failed";t&&(r+=":"+t),s.RuntimeTelemetryHelper.LogExceptionTag(r,n,this._correlationId,18940556)},o}();e.SPCatalogProxyBasedCatalogServiceScope=o}(p||(p={})),c.InfoType={Error:0,Warning:1,Information:2,SecurityInfo:3},c.NotificationType={TrustYellowBar:0,TrustPromptTaskpane:3,TrustPromptContent:4},c.OmexMessageType={TabExit:1,ButtonClick:2,PageLoad:3},c._ErrorUXHelper=function(e){var t="progress_",n="input,a,button",r="moe-infobar-button2_",o=!0,i="moe-infobar-button_",a="moe-infobar-button",l=!1,d="button",u="moe-infobar-dismiss_",f="moe-infobar-dismiss",m="moe-infobar-message",g="moe-infobar-message_",v="moe-infobar-title",h="span",y="moe-infobar-message-div",C="moe-infobar-secinfo",_="moe-infobar-info",S="moe-infobar-warning",A="moe-infobar-error",I="moe-infobar-button-cell",T="moe-infobar-top-right-cell",O="moe-infobar-message-cell",x="moe-infobar-top-left-cell",E="presentation",b="role",M="moe-infobar-infotable",R="table",P="moe-infobar-body",N="alt",U=null,F="100%",w="center",D="no-repeat",k="alpha(opacity=100)",L="1",B="white",H="url(",W="onclick",V="tabindex",j="image",G="type",X="input",K="id",q="moe-background",z="class",J="div",Q="moe-trust-prompt-table_",$="notificationbackground_",Z="moe-infobar-body_",Y="agavedefaulticon96x96.png",ee="moe_status_icons.png",te="progress.gif",ne="img",re=e,oe=re.getOsfOmexBaseUrl(),ie="omexNotificationIframeClassName";c.OUtil.loadCSS(re.getLocalizedCSSFilePath("moeerrorux.css")),document.createElement(ne).src=re.getLocalizedImageFilePath(te),document.createElement(ne).src=re.getLocalizedImageFilePath(ee),document.createElement(ne).src=re.getLocalizedImageFilePath(Y);var ae={},se=0,le=function(e){for(var t,n=e.childNodes.length,r=0;r<n;)"iframe"===(t=e.childNodes.item(r)).tagName.toLowerCase()?r++:(e.removeChild(t),n--)},ce=function(e){var t=document.getElementById(e);t&&t.parentNode.removeChild(t)},de=function(e,t){var n;c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RemoveStage2Start),n=t?Z+e:$+e;var r=Me(e);r&&ae[e][0].highPriority&&se--,ce(n),r&&ae[e].shift(),c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RemoveStage2End)},ue=function(e){c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RemoveStage2Start);var t=Q+e.id,n=Me(e.id);n&&ae[e.id][0].highPriority&&se--,ce(t),n&&ae[e.id].shift(),c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RemoveStage2End)},pe=function(e){c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderStage1Start),le(e.div);var t=document.createElement(J);t.setAttribute(z,q),t.setAttribute(K,"icon_"+e.id);var n=document.createElement(X);n.setAttribute(K,"iconImg_"+e.id),n.setAttribute(G,j),n.setAttribute(V,"0"),n.src=re.getLocalizedImageFilePath(ee);var r,o,i;n.setAttribute(W,"getIntoStage2(params)"),c.OUtil.attachClickHandler(n,(function(){!function(e){e.sqmDWords[1]|=2,Ie(e.id);var t=p.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();t&&t.enableSingleSignOnForAddin?me(e):fe(e)}(e)})),t.appendChild(n),e.displayDeactive&&(t.style.backgroundImage=H+re.getLocalizedImageFilePath(Y)+")",t.style.backgroundColor=B,t.style.opacity=L,t.style.filter=k,t.style.backgroundRepeat=D,t.style.backgroundPosition=w,t.style.height=F),e.infoType===c.InfoType.Error?(r="moe-status-error-icon",o="iconImg_error_"+e.id,i=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT):e.infoType===c.InfoType.Warning?(r="moe-status-warning-icon",o="iconImg_warning_"+e.id,i=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT):e.infoType===c.InfoType.Information?(r="moe-status-info-icon",o="iconImg_info_"+e.id,i=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT):(r="moe-status-secinfo-icon",o="iconImg_secinfo_"+e.id,i=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT),new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent)!=U&&9==parseFloat(RegExp.$1)&&(r+="_ie"),n.setAttribute(z,r),n.setAttribute(K,o),n.setAttribute(N,i),0!=e.div.childNodes.length?e.div.insertBefore(t,e.div.childNodes[0]):e.div.appendChild(t),Oe(e.id,c.AgaveHostAction.TabIn),c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderStage1End)},fe=function(e){c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderStage2Start),le(e.div);var t=e.description;e.title.length>100&&(e.title=e.title.substring(0,99)),e.description.length>255&&(e.description=e.description.substring(0,254));var n=Z+e.id,p=document.getElementById(n);null==p&&((p=document.createElement(J)).setAttribute(z,P),p.setAttribute(K,n));var Q=document.createElement(J);Q.innerHTML=t,p.setAttribute("title",Q.textContent),Q=U;var te=document.createElement(R);te.setAttribute(z,M),te.setAttribute(b,E);for(var oe=0;oe<3;oe++)te.insertRow(oe).setAttribute(b,E);var ie=te.rows;ie[0].insertCell(0),ie[0].insertCell(1),ie[0].insertCell(2),ie[0].cells[1].setAttribute("rowSpan","2"),ie[1].insertCell(0),ie[1].insertCell(1),ie[2].insertCell(0),ie[2].insertCell(1),ie[2].insertCell(2),ie[0].cells[0].setAttribute(z,x),ie[0].cells[1].setAttribute(z,O),ie[0].cells[2].setAttribute(z,T),ie[2].cells[1].setAttribute(z,I);var ae,se,ce=document.createElement(ne);ce.src=re.getLocalizedImageFilePath(ee),e.infoType===c.InfoType.Error?(ae=A,se=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT):e.infoType===c.InfoType.Warning?(ae=S,se=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT):e.infoType===c.InfoType.Information?(ae=_,se=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT):(ae=C,se=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT),ce.setAttribute(z,ae),ce.setAttribute(N,se),ie[0].cells[0].appendChild(ce);var ue=document.createElement("a");ue.setAttribute(z,y),ue.setAttribute(V,L);var pe=document.createElement(h);pe.setAttribute(z,v),pe.innerHTML=e.title;var fe=g+e.id,me=document.getElementById(fe);null==me&&((me=document.createElement(h)).setAttribute(z,m),me.setAttribute(K,fe)),me.innerHTML=e.description,ue.appendChild(pe),ue.appendChild(me),ie[0].cells[1].appendChild(ue);var ge=function(e){var t=re.getOsfControl(e.id);s.AppNotificationHelper.LogNotification(t._appCorrelationId,e.sqmDWords[0],e.sqmDWords[1])},ve=function(){e.sqmDWords[1]|=8,ge(e),!e.reDisplay&&de(e.id,e.displayDeactive),Ie(e.id),e.reDisplay?Ee(e):be(e.id),e.dismissCallback&&e.dismissCallback()},he=document.createElement(X);he.setAttribute(G,j),he.setAttribute("src",re.getLocalizedImageFilePath(ee)),he.setAttribute(z,f),he.setAttribute(K,u+e.id),he.setAttribute(V,"0"),he.setAttribute(N,Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT),he.setAttribute(b,d),he.setAttribute(W,"handleDismiss();"),c.OUtil.attachClickHandler(he,ve),ie[0].cells[2].appendChild(he),e.detailView=l;var ye=document.createElement(d);if(ye.setAttribute(z,a),ye.innerHTML=e.buttonTxt,ye.setAttribute(K,i+e.id),ye.setAttribute(V,L),ye.setAttribute(G,d),e.buttonCallback){ye.setAttribute(W,"handleButtonClick()"),c.OUtil.attachClickHandler(ye,(function(){if(e.sqmDWords[1]|=4,ge(e),de(e.id,l),Ie(e.id),be(e.id),e.retryAll===o){var t=re.getOsfControl(e.id);t._retryActivate=U,re.retryAll(t._marketplaceID)}e.buttonCallback()}))}else ye.setAttribute(W,"handleDismiss()"),c.OUtil.attachClickHandler(ye,ve);if(ie[2].cells[1].appendChild(ye),e.url){var Ce=document.createElement(d);Ce.setAttribute(z,a),Ce.innerHTML=e.urlButtonTxt?e.urlButtonTxt:Strings.OsfRuntime.L_MoreInfoButton_TXT,Ce.setAttribute(K,r+e.id),Ce.setAttribute(W,"moreInfoButtonClick()"),c.OUtil.attachClickHandler(Ce,(function(){e.sqmDWords[1]|=4,ge(e),e.sqmDWords[1]=1,window.open(e.url)})),Ce.setAttribute(V,L),Ce.setAttribute(G,d),ie[2].cells[1].appendChild(Ce)}p.appendChild(te);var _e=document.createElement(J);_e.setAttribute(z,q),_e.setAttribute(K,$+e.id),e.displayDeactive&&(_e.style.backgroundImage=H+re.getLocalizedImageFilePath(Y)+")",_e.style.backgroundColor=B,_e.style.opacity=L,_e.style.filter=k,_e.style.backgroundRepeat=D,_e.style.backgroundPosition=w,_e.style.height=F),_e.appendChild(p),0!=e.div.childNodes.length?e.div.insertBefore(_e,e.div.childNodes[0]):e.div.appendChild(_e),Oe(e.id,c.AgaveHostAction.TabIn),c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderStage2End)},me=function(e){c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderStage2Start);try{le(e.div);var t=e.description;e.title.length>100&&(e.title=e.title.substring(0,99)),e.description.length>255&&(e.description=e.description.substring(0,254));var n=Z+e.id,r=document.getElementById(n);null==r&&((r=document.createElement(J)).className=P,r.id=n),r.title=t,e.iframeNotificationUrl?r.appendChild(he(e,r)):r.appendChild(ve(e));var o=document.createElement(J);o.className=q,o.id=$+e.id,e.displayDeactive&&(o.style.backgroundImage=H+re.getLocalizedImageFilePath(Y)+")",o.style.backgroundColor=B,o.style.opacity=L,o.style.filter=k,o.style.backgroundRepeat=D,o.style.backgroundPosition=w,o.style.height=F),o.appendChild(r),0!=e.div.childNodes.length?e.div.insertBefore(o,e.div.childNodes[0]):e.div.appendChild(o),Oe(e.id,c.AgaveHostAction.TabIn)}catch(e){s.RuntimeTelemetryHelper.LogExceptionTag("Failed to show infobar, error message: ",e,U,23455900)}c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderStage2End)},ge=function(e){var t="moe-trust-prompt-description-id";c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderStage2Start);try{le(e.div);var n=function(e){function t(e,t){var n=e.insertRow(-1);n.className="moe-trust-prompt-row "+t,n.setAttribute(b,E),n.insertCell(-1).className="moe-trust-prompt-cell"}e.id;var n=Q+e.id,r=document.getElementById(n);r===U&&((r=document.createElement(R)).id=n,r.className="moe-trust-prompt-table",r.setAttribute(b,E)),t(r.createTHead(),"moe-trust-prompt-header");var o=r.createTBody();return t(o,"moe-trust-prompt-preview"),t(o,"moe-trust-prompt-description"),t(r.createTFoot(),"moe-trust-prompt-footer"),r}(e),r=n.rows,i=function(e){var t=document.createElement("p");return t.innerHTML=e.notificationType===c.NotificationType.TrustPromptContent?e.name:e.title,t.className="moe-trust-prompt-header-title",t}(e);r[0].cells[0].appendChild(i);var a=function(e){var t=document.createElement(ne);return t.src=e.icon,t.className="moe-trust-prompt-preview-img",t.setAttribute(N,e.iconTitle),t}(e),l=function(e){var t=document.createElement("p");return t.innerHTML=e.name,t.className="moe-trust-prompt-preview-title",t}(e),u=function(e){var t=document.createElement("p");return t.innerHTML=e.provider,t.className="moe-trust-prompt-preview-sub",t}(e);r[1].cells[0].appendChild(a),r[1].cells[0].appendChild(l),r[1].cells[0].appendChild(u);var p=function(e){var n=document.createElement("p");return n.innerHTML=e.description,n.className="moe-trust-prompt-description-text",n.id=t,n}(e);r[2].cells[0].appendChild(p);var f=function(){var n,r=document.createElement(d);return r.textContent=e.buttonTxt,r.className="moe-trust-prompt-button moe-trust-prompt-button-primary moe-trust-prompt-buttons-action",r.id="moe-trust-prompt-buttons-action_"+e.id,r.tabIndex=0,r.type=d,r.setAttribute("aria-describedby",t),n=e.buttonCallback?function(){if(e.sqmDWords[1]|=4,_e(e),ue(e),Ie(e.id),be(e.id),e.retryAll===o){var t=re.getOsfControl(e.id);t._retryActivate=U,re.retryAll(t._marketplaceID)}e.buttonCallback()}:function(){e.sqmDWords[1]|=8,_e(e),!e.reDisplay&&ue(e),Ie(e.id),e.reDisplay?Ee(e):be(e.id),e.dismissCallback&&e.dismissCallback()},c.OUtil.attachClickHandler(r,n),r}();if(r[3].cells[0].appendChild(f),e.url!==U){var m=function(e){var t=document.createElement(d);return t.textContent=e.urlButtonTxt||Strings.OsfRuntime.L_MoreInfoButton_TXT,t.className="moe-trust-prompt-button moe-trust-prompt-buttons-url",t.id="moe-trust-prompt-buttons-url_"+e.id,t.tabIndex=0,t.type=d,c.OUtil.attachClickHandler(t,(function(){e.sqmDWords[1]|=4,_e(e),window.open(e.url)})),t}(e);r[3].cells[0].appendChild(m)}var g=function(e){var t=document.createElement(J);t.className="moe-trust-prompt-collapse cui-ctl-iconContainer cui-img-cont-float cui-img-16by16";var n=document.createElement(ne);switch(e.clientName){case"WAC_Powerpoint":n.src=re.getLocalizedImageFilePath("per.png"),n.className="per_UpChevron_16x16x32";break;case"WAC_Word":n.src=re.getLocalizedImageFilePath("we.png"),n.className="we_UpChevron_16x16x32";break;case"WAC_Excel":n.src=re.getLocalizedImageFilePath("EwaEdit.png"),n.className="ewaboot_UpChevron16"}return n.alt=Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT,t.appendChild(n),c.OUtil.attachClickHandler(t,(function(){var t="collapsed";e.collapsed===o?e.div.classList.remove(t):e.div.classList.add(t),e.collapsed=!e.collapsed})),t}(e);0!=e.div.childNodes.length?e.div.insertBefore(n,e.div.childNodes[0]):e.div.appendChild(n),e.div.appendChild(g),e.div.style.overflowY="auto",e.div.classList.add("moe-trust-prompt"),e.div.classList.add(e.clientName),e.div.classList.add(e.notificationType===c.NotificationType.TrustPromptContent?"content-add-in":"taskpane-add-in"),Oe(e.id,c.AgaveHostAction.TabIn)}catch(e){s.RuntimeTelemetryHelper.LogExceptionTag("Failed to show trust prompt, error message: ",e,U,38592974)}c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderStage2End)},ve=function(e){var t=ye(e),n=t.rows;n[0].cells[0].appendChild(Ce(e));var s=document.createElement("a");s.className=y,s.tabIndex=1;var u=document.createElement(h);u.className=v,u.textContent=e.title;var p=g+e.id,f=document.getElementById(p);null==f&&((f=document.createElement(h)).className=m,f.id=p),f.textContent=e.description,s.appendChild(u),s.appendChild(f),n[0].cells[1].appendChild(s);var C=function(){Se(e)},_=Ae(e);c.OUtil.attachClickHandler(_,C),n[0].cells[2].appendChild(_),e.detailView=l;var S=document.createElement(d);if(S.className=a,S.textContent=e.buttonTxt,S.id=i+e.id,S.tabIndex=1,S.type=d,e.buttonCallback){c.OUtil.attachClickHandler(S,(function(){if(e.sqmDWords[1]|=4,_e(e),de(e.id,l),Ie(e.id),be(e.id),e.retryAll===o){var t=re.getOsfControl(e.id);t._retryActivate=U,re.retryAll(t._marketplaceID)}e.buttonCallback()}))}else c.OUtil.attachClickHandler(S,C);if(n[2].cells[1].appendChild(S),e.url){var A=document.createElement(d);A.className=a,A.textContent=e.urlButtonTxt?e.urlButtonTxt:Strings.OsfRuntime.L_MoreInfoButton_TXT,A.id=r+e.id,c.OUtil.attachClickHandler(A,(function(){e.sqmDWords[1]|=4,_e(e),e.sqmDWords[1]=1,window.open(e.url)})),A.tabIndex=1,A.type=d,n[2].cells[1].appendChild(A)}return t},he=function(e,t){var n="message",r=ye(e),i=r.rows,a=document.createElement("iframe");window.getComputedStyle(e.div,U);a.width=F,a.frameBorder="0",a.className=ie,a.src=e.iframeNotificationUrl,i[0].cells[1].appendChild(a);var d="moe-hovered";t.addEventListener("mouseenter",(function(){c.OUtil.addClass(t,d),a.contentWindow.postMessage(c.AgaveHostAction.MouseEnter,oe)})),t.addEventListener("mouseleave",(function(){c.OUtil.removeClass(t,d),a.contentWindow.postMessage(c.AgaveHostAction.MouseLeave,oe)})),e.detailView=l;var u=U,p=Ae(e);return c.OUtil.attachClickHandler(p,(function(){Se(e),window.removeEventListener(n,u)})),i[0].cells[2].appendChild(p),p.addEventListener("keydown",(function(e){9==e.keyCode&&e.shiftKey&&(e.preventDefault(),e.stopPropagation(),a.contentWindow.postMessage(c.AgaveHostAction.TabInShift,oe))})),e.buttonCallback&&(u=function(t){try{if(t.source==a.contentWindow){var r=JSON.parse(t.data),i=parseInt(r[c.OmexMessageKeys.MessageType]),d=parseInt(r[c.OmexMessageKeys.MessageValue]);if(i==c.OmexMessageType.ConsentResult){if(de(e.id,l),Ie(e.id),be(e.id),e.retryAll===o&&(e.notificationType==c.NotificationType.TrustYellowBar||e.notificationType==c.NotificationType.ConsentYellowBar&&d==c.ConsentResultCode.Success)){var f=re.getOsfControl(e.id);f._retryActivate=U,re.retryAll(f._marketplaceID)}window.removeEventListener(n,u),e.buttonCallback(d)}else i==c.OmexMessageType.TabExit&&(d==c.AgaveHostAction.TabExitShift&&re._notifyHost?re._notifyHost(e.id,c.AgaveHostAction.TabExitShift):d==c.AgaveHostAction.TabExit&&(window.focus(),p.focus()))}}catch(e){s.RuntimeTelemetryHelper.LogExceptionTag("Exception in receivedMessageHandler: ",e,U,23455901)}},window.addEventListener(n,u)),r},ye=function(e){var t=document.createElement(R);t.className=M,t.setAttribute(b,E);for(var n=e.iframeNotificationUrl?1:3,r=0;r<n;r++){t.insertRow(r).setAttribute(b,E)}var o=t.rows;return o[0].insertCell(0),o[0].insertCell(1),o[0].insertCell(2),o[0].cells[1].setAttribute("rowSpan","2"),o[0].cells[0].setAttribute(z,x),o[0].cells[1].setAttribute(z,O),o[0].cells[2].setAttribute(z,T),e.iframeNotificationUrl==U&&(o[1].insertCell(0),o[1].insertCell(1),o[2].insertCell(0),o[2].insertCell(1),o[2].insertCell(2),o[2].cells[1].setAttribute(z,I)),o[0].cells[0].appendChild(Ce(e)),t},Ce=function(e){var t,n,r=document.createElement(ne);return r.src=re.getLocalizedImageFilePath(ee),e.infoType===c.InfoType.Error?(t=A,n=Strings.OsfRuntime.L_InfobarIconErrorAccessibleName_TXT):e.infoType===c.InfoType.Warning?(t=S,n=Strings.OsfRuntime.L_InfobarIconWarningAccessibleName_TXT):e.infoType===c.InfoType.Information?(t=_,n=Strings.OsfRuntime.L_InfobarIconInfoAccessibleName_TXT):(t=C,n=Strings.OsfRuntime.L_InfobarIconSecInfoAccessibleName_TXT),r.className=t,r.alt=n,r},_e=function(e){var t=re.getOsfControl(e.id);s.AppNotificationHelper.LogNotification(t._appCorrelationId,e.sqmDWords[0],e.sqmDWords[1])},Se=function(e){e.sqmDWords[1]|=8,_e(e),!e.reDisplay&&de(e.id,e.displayDeactive),Ie(e.id),e.reDisplay?Ee(e):be(e.id),e.dismissCallback&&e.dismissCallback()},Ae=function(e){var t=document.createElement(X);return t.type=j,t.src=re.getLocalizedImageFilePath(ee),t.className=f,t.id=u+e.id,t.tabIndex=0,t.alt=Strings.OsfRuntime.L_InfobarIconCloseButtonAccessibleName_TXT,t.setAttribute(b,d),t},Ie=function(e){var t=re.getOsfControl(e);t&&(t._controlFocus=o)},Te=function(e){var t=re.getOsfControl(e);if(t&&!Me(e))if(t.getStatus()===c.OsfControlStatus.Activated&&t.getPageStatus()===c.OsfControlPageStatus.Ready)t.notifyAgave(c.AgaveHostAction.TabIn);else{var n="_trySetFocusInAppContent$newCallback";if(t._notifyHostIFrameOnLoaded&&t._notifyHostIFrameOnLoaded.newCallbackIdentity&&t._notifyHostIFrameOnLoaded.newCallbackIdentity===n)return;var r=function(e){return function(){if(e)try{e()}catch(e){}t.getStatus()===c.OsfControlStatus.Activated&&t.getPageStatus()===c.OsfControlPageStatus.Ready&&t.notifyAgave(c.AgaveHostAction.TabIn),t._notifyHostIFrameOnLoaded=e}}(t._notifyHostIFrameOnLoaded);r.newCallbackIdentity=n,t._notifyHostIFrameOnLoaded=r}},Oe=function(e,t){var r=re.getOsfControl(e);if(r&&r._controlFocus)if(Me(e)){var o=ae[e][0];if(o&&o.div)if(o.iframeNotificationUrl!=U){var i=o.div.getElementsByClassName(ie)[0];i&&(i.contentWindow.postMessage(c.AgaveHostAction.TabIn,oe),re._notifyHost&&re._notifyHost(e,c.AgaveHostAction.SelectWithError))}else{var a=o.div.querySelectorAll(n);if(a&&a.length>0){var s=a[0];s instanceof HTMLElement&&(window.focus(),s.focus(),re._notifyHost&&re._notifyHost(e,c.AgaveHostAction.SelectWithError))}}}else r.notifyAgave(t)},xe=function(e,t){var r=re.getOsfControl(e);if(r&&r._controlFocus)if(Me(e)){var o=ae[e][0];if(o&&o.div){var i=o.div.querySelectorAll(n);if(i&&i.length>0){var a=i.length>1?i[1]:i[0];a instanceof HTMLElement&&(window.focus(),a.focus(),re._notifyHost&&re._notifyHost(e,c.AgaveHostAction.SelectWithError))}}}else r._controlFocus=l,re._notifyHost(e,t)},Ee=function(e){if(e.notificationType!==c.NotificationType.TrustPromptContent&&e.notificationType!==c.NotificationType.TrustPromptTaskpane)if(null==e.detailView||e.detailView===l)e.sqmDWords[1]=0,pe(e);else{e.sqmDWords[1]=1;var t=p.HostFeatureEnabledInfo.getHostFeatureEnabledInfo();t&&t.enableSingleSignOnForAddin?me(e):fe(e)}else ge(e)},be=function(e){if(Me(e)){var t=ae[e][0];Ee(t)}else Te(e)},Me=function(e){return ae[e]&&ae[e].length>0};return{showProgress:function(e,n){try{if(c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderLoadingAnimationStart),!document.getElementById(t+n)){ae[n]=[];var r=document.createElement(J);r.setAttribute(z,q),r.setAttribute(K,t+n),r.style.backgroundColor="rgba(255, 255, 255, 0.5)",r.style.opacity=L,r.style.filter=k,r.style.height=F;var o=document.createElement(J);o.style.width=F,o.style.height=F,o.style.backgroundImage=H+re.getLocalizedImageFilePath(te)+")",o.style.backgroundRepeat=D,o.style.backgroundPosition=w,r.appendChild(o),e.appendChild(r)}c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RenderLoadingAnimationEnd)}catch(e){}},showNotification:function(e){e.sqmDWords=[e.errorCode,0],delete e.errorCode,null==e.highPriority&&(e.highPriority=e.infoType===c.InfoType.Error?o:l),null==e.reDisplay&&(e.reDisplay=e.infoType===c.InfoType.Error?o:l);var t=ae[e.id];void 0===t&&(t=[],ae[e.id]=t),e.highPriority===l?t.push(e):(t.splice(se,0,e),se++),(1===ae[e.id].length||e.highPriority)&&Ee(t[0])},showICon:function(e){pe(e)},removeDOMElement:function(e){ce(e)},removeProgressDiv:function(e,n){c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RemoveLoadingAnimationStart),e.ownerDocument.getElementById(t+n)&&le(e),c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RemoveLoadingAnimationEnd)},removeIConDiv:function(e){!function(e){c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RemoveStage1Start),ce("icon_"+e),c.OUtil.writeProfilerMark(c.NotificationUxPerfMarker.RemoveStage1End)}(e)},removeInfoBarDiv:function(e,t){de(e,t)},dismissMessages:function(e){!function(e){if(ae[e]){if(ae[e].length>0){var t=ae[e][0].div;le(t)}delete ae[e]}}(e)},getHTMLEncodedString:function(e){return function(e){var t=document.createElement(J),n=document.createTextNode(e);return t.appendChild(n),t.innerHTML}(e)},purgeOsfControlNotification:function(e){var t=ae[e],n=re.getOsfControl(e);t&&t.length>0&&n&&s.AppNotificationHelper.LogNotification(e,t[0].sqmDWords[0],t[0].sqmDWords[1])},focusOnNotificationUx:function(e,t){Ie(e),Oe(e,t)},focusOnNotificationUxShiftIn:function(e,t){Ie(e),xe(e,t)},appHasNotifications:function(e){return Me(e)}}},function(e){var t,n="web",r="default";!function(e){e[e[r]=0]=r,e[e[n]=1]=n,e[e.windows=2]="windows",e[e.mac=3]="mac"}(t||(t={}));var o=function(){var o="resources.default",i="resources",a="string",l=null;function d(){}return d.ensureFinalExtendedOverridesUrls=function(t,n){var r=t.getExtendedOverrides();r.hasFinalUrls||(r.url=e.ExtendedManifestUtility.ensureFinalExtendedOverridesUrl(t.getExtendedOverrides().url,t,n),t.getExtendedOverrides().resourcesUrl&&(r.resourcesUrl=e.ExtendedManifestUtility.ensureFinalExtendedOverridesUrl(t.getExtendedOverrides().resourcesUrl,t,n)),r.hasFinalUrls=r.url&&(r.resourcesUrl||!t.getExtendedOverrides().resourcesUrl))},d.ensureFinalExtendedOverridesUrl=function(e,t,n){var r=d.computeUrlTokens(t,n),o=d.substituteUrlTokens(e,r),i=c.OUtil.parseUrl(o);return i.protocol&&i.hostname&&i.host&&i.pathname?o:(s.RuntimeTelemetryHelper.LogCommonMessageTag("Invalid ExtendedOverrides Url",l,570828176),l)},d.computeUrlTokens=function(e,t){for(var n=e.getExtendedOverridesTokens(),r={},o=0;o<n.length;++o)n[o].type==c.ExtendedManifestSupportTokens.Requirements?r[n[o].name]=d.computeRequirementsToken(n[o],t):n[o].type==c.ExtendedManifestSupportTokens.Locale?r[n[o].name]=d.computeLocaleToken(n[o],t):r[n[o].name]=n[o].defaultValue;return r},d.computeRequirementsToken=function(e,t){for(var n=e.defaultValue,r=e.overrides,o=0;o<r.length;++o)t._requirementsChecker._checkSets(r[o].data.sets)&&t._requirementsChecker._checkMethods(r[o].data.methods)&&(n=r[o].value);return n},d.computeLocaleToken=function(e,t){for(var n=e.defaultValue.toLowerCase(),r=t.getAppUILocale().toLowerCase(),o=r.replace(/-.+/,"-*"),i=e.overrides,a=0;a<i.length;++a){var s=i[a];if(r==s.data){n=s.value;break}o==s.data&&(n=s.value)}return n},d.substituteUrlTokens=function(e,t){return e.replace(new RegExp(c.ExtendedManifestSupportTokens.TokenReplaceRegex,"g"),(function(e,n,r,o){return d.substituteMatchWithTokenValue(e,n,r,o,t)}))},d.downloadContent=function(t){return new Promise((function(n,r){c.OUtil.xhrGet(t,(function(o){o?n(o):r(new e.OsfRuntimeError(e.OsfRuntimeErrorCode.downloadError,"No content downloaded from "+t))}),(function(e){r(e)}))}))},d.substituteMatchWithResourceValue=function(t,n,r,o){if(r&&"object"==typeof r[n])return r[n].value;if(o&&"object"==typeof o[n])return o[n].value;throw s.RuntimeTelemetryHelper.LogExceptionTag("Missing Extended Manifest Resource Token value",l,l,573125021),new e.OsfRuntimeError(e.OsfRuntimeErrorCode.tokenError,"Missing Extended Manifest Resource token value")},d.replaceResourceTokens=function(e,t,n){var r=new RegExp(c.ExtendedManifestSupportTokens.ResourceTokenRegEx);return e.replace(r,(function(e,r){return d.substituteMatchWithResourceValue(e,r,t,n)}))},d.constructExtendedManifest=function(e,t){var o=void 0;e.resources&&(o=e.resources[r]);var i=e.shortcuts,a=e.actions;if(i)for(var c=0;c<i.length;c++)i[c].key[n]&&(i[c].key[n]=d.replaceResourceTokens(i[c].key[n],t,o)),i[c].key[r]&&(i[c].key[r]=d.replaceResourceTokens(i[c].key[r],t,o)),!i[c].key[r]&&!i[c].key[n]&&s.RuntimeTelemetryHelper.LogExceptionTag("Error: No valid platform for shortcut",l,l,l);if(a)for(c=0;c<a.length;c++)a[c].name=d.replaceResourceTokens(a[c].name,t,o);return{shortcuts:i,actions:a}},d.substituteMatchWithTokenValue=function(t,n,r,o,i){var c="Missing ExtendedOverrides Token value";if(typeof i[n]===a)return i[n];throw s.RuntimeTelemetryHelper.LogExceptionTag(c,l,l,573125020),new e.OsfRuntimeError(e.OsfRuntimeErrorCode.tokenError,c)},d.validateExtendedOverrides=function(t){var n,a=[],d=t.resources,u=t.shortcuts,p=t.actions,f=new RegExp(c.ExtendedManifestSupportTokens.ResourceTokenRegEx),m=new RegExp(".*\\$\\{resource\\.([A-Za-z0-9_-]+)\\}.*"),g=e.ExtendedManifestUtility.validateShortcuts(u,f,m),v=e.ExtendedManifestUtility.validateActions(p,f,m,g.neededActionIds);if(a=g.errors.concat(v.errors),n=g.tokens.concat(g.tokens),g.needsResources&&v.needsResources)if(d)if(Object.keys(d).length>1&&a.push(e.ExtendedManifestValidationErrorMessages.invalidProperty(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,i,"1 locale",Object.keys(d).length+" locales")),d[r]){var h=e.ExtendedManifestUtility.validateExtendedOverridesResources(d[r],n,!1);a=a.concat(h)}else a.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,o));else a.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,i));return a.length>0&&s.RuntimeTelemetryHelper.LogExceptionTag("Invalid extended manifest",l,l,573125019),{errors:a,tokens:n,needsResources:!1}},d.validateShortcuts=function(n,r,o){var i="shortcuts[",s=[],l=!1,d=[],u={};if(n)for(var p=0;p<n.length;++p)if(n[p].action?u[n[p].action]=!0:s.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,i+p+"].action")),n[p].key)for(var f in n[p].key)f in t?r.test(n[p].key[f])?(d.push(n[p].key[f]),l=!0):o.test(n[p].key[f])?s.push(e.ExtendedManifestValidationErrorMessages.invalidValue(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,i+p+"].key."+f,n[p].key[f])):typeof n[p].key[f]!==a&&s.push(e.ExtendedManifestValidationErrorMessages.invalidType(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,i+p+"].key.",a,typeof n[p].key[f])):s.push(e.ExtendedManifestValidationErrorMessages.invalidValue(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,i+p+"].key",f));else s.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,i+p+"].key"));return{errors:s,tokens:d,needsResources:l,neededActionIds:u}},d.validateActions=function(t,n,r,o){var i="].name",s="Extended Manifest",l="].id",d="actions[",u=[],p=[],f=!1,m={};if(t)for(var g=0;g<t.length;++g)t[g].id?((t[g].id.length>c.ExtendedManifestSupportTokens.ActionIdMaxLength||t[g].id.length<1)&&u.push(e.ExtendedManifestValidationErrorMessages.invalidLength(s,d+g+l,c.ExtendedManifestSupportTokens.ActionIdMaxLength)),o[t[g].id]&&delete o[t[g].id],m[t[g].id]?u.push(e.ExtendedManifestValidationErrorMessages.duplicateValue(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,d+g+l,t[g].id)):m[t[g].id]=!0):u.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,d+g+l)),t[g].type||(t[g].type="ExecuteFunction"),t[g].name?t[g].name.length>c.ExtendedManifestSupportTokens.ActionNameMaxLength||t[g].name.length<1?u.push(e.ExtendedManifestValidationErrorMessages.invalidLength(s,d+g+i,c.ExtendedManifestSupportTokens.ActionNameMaxLength)):n.test(t[g].name)?(p.push(t[g].name),f=!0):r.test(t[g].name)?u.push(e.ExtendedManifestValidationErrorMessages.invalidValue(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,d+g+i,t[g].name)):typeof t[g].name!==a&&u.push(e.ExtendedManifestValidationErrorMessages.invalidType(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,d+g+i,a,typeof t[g].name)):u.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,d+g+i));for(var v=Object.keys(o),h=0;h<v.length;h++)u.push(e.ExtendedManifestValidationErrorMessages.actionNotFound(v[h]));return{errors:u,tokens:p,needsResources:f}},d.validateExtendedOverridesResources=function(t,n,r){var a=[];if(!t)return a;for(var d=Object.keys(t),u=new RegExp(c.ExtendedManifestSupportTokens.ResourceTokenRegEx),p=0,f=n;p<f.length;p++){var m=f[p],g=u.exec(m)[1],v=t[g];v?v.value||(r?a.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c.ExtendedManifestSupportTokens.ExtendedManifestResourcesLoggingPrefix,"resources["+d.indexOf(g)+"].value")):a.push(e.ExtendedManifestValidationErrorMessages.missingRequiredProperty(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,"resources.default["+d.indexOf(g)+"].value"))):r?a.push(e.ExtendedManifestValidationErrorMessages.missingRequiredValue(c.ExtendedManifestSupportTokens.ExtendedManifestResourcesLoggingPrefix,i,m)):a.push(e.ExtendedManifestValidationErrorMessages.missingRequiredValue(c.ExtendedManifestSupportTokens.ExtendedManifestLoggingPrefix,o,m))}return a.length>0&&s.RuntimeTelemetryHelper.LogExceptionTag("Invalid extended manifest resources",l,l,573125018),a},d.validateAndSubstituteExtendedManifestTokens=function(t,n){var r=e.ExtendedManifestUtility.validateExtendedOverrides(t),o=e.ExtendedManifestUtility.validateExtendedOverridesResources(n,r.tokens,!0),i=r.errors.concat(o);if(0==i.length)return e.ExtendedManifestUtility.constructExtendedManifest(t,n);throw new e.OsfMultiError(e.OsfRuntimeErrorCode.invalidExtendedOverride,i)},d.getPlatformName=function(){var t=navigator.userAgent;return t.indexOf("Windows")>=0||t.indexOf("CrOS")>=0||t.indexOf("SunOS")>=0||t.indexOf("Linux")>=0?e.ShortcutsMappingTableManager.s_shortcutPlatformWin32:t.indexOf("Macintosh")>=0||t.indexOf("Mac OS X")>=0?e.ShortcutsMappingTableManager.s_shortcutPlatformMac:(s.RuntimeTelemetryHelper.LogCommonMessageTag("Unknown platform or operating system, the userAgent info is: "+t,l,572610773),l)},d}();e.ExtendedManifestUtility=o}(p||(p={})),function(e){var t=function(){var e=", expected = ",t=", value = ",n="[";function r(){}return r.missingRequiredProperty=function(e,t){return n+e+"] [Parsing] [Missing Required Property] property = "+t},r.invalidValue=function(e,r,o){return n+e+"] [Parsing] [Invalid Value] property = "+r+t+o},r.invalidType=function(r,o,i,a){return n+r+"] [Parsing] [Invalid Type] property = "+o+e+i+t+a},r.invalidProperty=function(r,o,i,a){return n+r+"] [Parsing] [Invalid Property] property = "+o+e+i+t+a},r.missingRequiredValue=function(t,r,o){return n+t+"] [Parsing] [Missing Required Value] property = "+r+e+o},r.actionNotFound=function(e){return"[Extended Manifest] [Parsing] [Action Not Found] Unable to find the action with id: "+e},r.duplicateValue=function(e,r,o){return n+e+"] [Parsing] [Duplicate Value] property = "+r+t+o},r.invalidLength=function(e,t,r){return n+e+"] [Parsing] [Invalid Length] "+t+" must be between 1 and "+r+" characters long"},r}();e.ExtendedManifestValidationErrorMessages=t}(p||(p={})),function(e){var t=function(){function e(){}return e.setHostFeatureEnabledInfo=function(e){this._hostFeatureEnabledInfo=e},e.getHostFeatureEnabledInfo=function(){return this._hostFeatureEnabledInfo},e}();e.HostFeatureEnabledInfo=t}(p||(p={})),function(e){var t=null,n="catch",r=function(){function e(){}return e.prototype.get=function(e,r){return this.openTransaction(e).then((function(t){return new Promise((function(n,o){var i=t.objectStore(e).get(r);i.onsuccess=function(e){var t=e.target.result;n(t)},i.onerror=function(e){o(e)}}))}))[n]((function(e){throw s.RuntimeTelemetryHelper.LogExceptionTag("failed to get data from indexedDB",e,t,554256611),e}))},e.prototype.set=function(e,r,o){return this.openTransaction(e).then((function(t){return new Promise((function(n,i){var a=t.objectStore(e).put(o,r);a.onsuccess=function(){n()},a.onerror=function(e){i(e)}}))}))[n]((function(e){throw s.RuntimeTelemetryHelper.LogExceptionTag("failed to set data into indexedDB",e,t,554256610),e}))},e.prototype.remove=function(e,r){return this.openTransaction(e).then((function(t){return new Promise((function(n,o){var i=t.objectStore(e).delete(r);i.onsuccess=function(){n()},i.onerror=function(e){o(e)}}))}))[n]((function(e){throw s.RuntimeTelemetryHelper.LogExceptionTag("failed to remove data from indexedDB",e,t,554256609),e}))},e.prototype.openDB=function(e){var r=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.indexedDB;return new Promise((function(t,n){var o=r.open(e);o.onupgradeneeded=function(){var t=o.result;!t.objectStoreNames.contains(e)&&t.createObjectStore(e)},o.onsuccess=function(){var e=o.result;t(e)},o.onerror=function(e){n(e)}}))[n]((function(e){throw s.RuntimeTelemetryHelper.LogExceptionTag("failed to open indexedDB",e,t,554256608),e}))},e.prototype.openTransaction=function(e){return this.openDB(e).then((function(t){return t.transaction(e,"readwrite")}))[n]((function(e){throw s.RuntimeTelemetryHelper.LogExceptionTag("failed to open transaction",e,t,554256607),e}))},e}(),o=function(){function e(){}return e.prototype.get=function(e,t){var n=localStorage.getItem(e.concat("_",t));return Promise.resolve(n)},e.prototype.set=function(e,t,n){return localStorage.setItem(e.concat("_",t),n),Promise.resolve()},e.prototype.remove=function(e,t){return localStorage.removeItem(e.concat("_",t)),Promise.resolve()},e}(),i=function(){var e="undefined",i="The browser does not support Web Storage";function a(){this.indexedDB=window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB||window.indexedDB}return a.get=function(e,r){var o=this.getOrCreateOsfCache();return o?o.get(e,r)[n]((function(e){return s.RuntimeTelemetryHelper.LogExceptionTag("failed to get data from osfCache",e,t,554256606),Promise.resolve(t)})):(s.RuntimeTelemetryHelper.LogCommonMessageTag(i,t,573125017),Promise.resolve(t))},a.set=function(e,r,o){var a=this.getOrCreateOsfCache();return a?a.set(e,r,o)[n]((function(e){return s.RuntimeTelemetryHelper.LogExceptionTag("failed to set data into osfCache",e,t,554256605),Promise.resolve(t)})):(s.RuntimeTelemetryHelper.LogCommonMessageTag(i,t,573125016),Promise.resolve(t))},a.remove=function(e,r){var o=this.getOrCreateOsfCache();return o?o.remove(e,r)[n]((function(e){return s.RuntimeTelemetryHelper.LogExceptionTag("failed to remove data frome osfCache",e,t,554256604),Promise.resolve(t)})):(s.RuntimeTelemetryHelper.LogCommonMessageTag(i,t,572926163),Promise.resolve(t))},a.isIndexedDBSupported=function(){return!c.OUtil.getBooleanSetting("IsSafariWithIndexedDBDisabled")&&(typeof indexedDB!=e&&"function"==typeof indexedDB.open)},a.getOrCreateOsfCache=function(){return a.instance==t&&(a.isIndexedDBSupported()?a.instance=new r:typeof localStorage!=e&&(a.instance=new o)),a.instance},a.c_osfCacheTableName="OSF.Cache",a.c_extendedManifestTableName="OSF.ExtendedManifest",a.c_extendedManifestResourcesTableName="OSF.ExtendedManifestResources",a}();e.OsfCache=i}(p||(p={})),c.OUtil.setNamespace("AppSpecificSetup",c),c.ContextActivationManager=function(e){var t="0",n="osfControl for the given ID doesn't exist.",r="object",o="DevConsoleEnabled",i="IsReactMLR",a="string",d=null,u=!0,f=!1,m=this,g=m;if(c.OUtil.validateParamObject(e,{appName:{type:Number,mayBeNull:f},appVersion:{type:String,mayBeNull:f},clientMode:{type:Number,mayBeNull:f},appUILocale:{type:String,mayBeNull:f},dataLocale:{type:String,mayBeNull:f},osfOmexBaseUrl:{type:String,mayBeNull:u},devCatalogUrl:{type:String,mayBeNull:u},oneDriveCatalogBaseApiUrl:{type:String,mayBeNull:u},sdxCdnUrl:{type:String,mayBeNull:u},sdxDmsUrl:{type:String,mayBeNull:u},spBaseUrl:{type:String,mayBeNull:u},docUrl:{type:String,mayBeNull:u},hostControl:{type:Object,mayBeNull:u},pageBaseUrl:{type:String,mayBeNull:u},lcid:{type:String,mayBeNull:u},formFactor:{type:String,mayBeNull:u},controlStatusChanged:{type:Object,mayBeNull:u},notifyHost:{type:Object,mayBeNull:u},allowExternalMarketplace:{type:Boolean,mayBeNull:u},localizedScriptsUrl:{type:String,mayBeNull:u},localizedImagesUrl:{type:String,mayBeNull:u},localizedStylesUrl:{type:String,mayBeNull:u},localizedResourcesUrl:{type:String,mayBeNull:u},trustAgaves:{type:Boolean,mayBeNull:u},enableAddinCommands:{type:Boolean,mayBeNull:u},enableBlackForestRedirect:{type:Boolean,mayBeNull:u},enableMyOrg:{type:Boolean,mayBeNull:u},enableMyApps:{type:Boolean,mayBeNull:u},enableDevCatalog:{type:Boolean,mayBeNull:u},enableOneDriveCatalog:{type:Boolean,mayBeNull:u},enablePrivateCatalog:{type:Boolean,mayBeNull:u},enableTaskpaneUpgradeToAppCommand:{type:Boolean,mayBeNull:u},enableUploadFileDevCatalog:{type:Boolean,mayBeNull:u},enableV1RedirectApis:{type:Boolean,mayBeNull:u},omexForceAnonymous:{type:Boolean,mayBeNull:u},userNameHashCode:{type:Number,mayBeNull:u},hostFullVersion:{type:String,mayBeNull:u},envCode:{type:String,mayBeNull:u},showSignOutFromPrivateCatalogMessage:{type:Boolean,mayBeNull:u},enableSingleSignOnForAddin:{type:Boolean,mayBeNull:u},firstPartySingleSignOnWhitelist:{type:String,mayBeNull:u},enableServiceDeliveredExperience:{type:Boolean,mayBeNull:u},hideAppsExtensionUrl:{type:String,mayBeNull:u},enableInsertDialogAccessibilityFix:{type:Boolean,mayBeNull:u},disableLogging:{type:Boolean,mayBeNull:u},enableDisplayBlockedMinorError:{type:Boolean,mayBeNull:u},enableFirstPartySSO:{type:Boolean,mayBeNull:u},disableAppsForOfficeThirdParty:{type:Boolean,mayBeNull:u},wacSessionId:{type:String,mayBeNull:u},enableFirstPartySDXErrorMessages:{type:Boolean,mayBeNull:u},isHostDocumentDomain:{type:Boolean,mayBeNull:u},enableRichApiCellEditDelay:{type:Boolean,mayBeNull:u},wopiHostOriginFromPostMessage:{type:String,mayBeNull:u},wopiHostOriginFromWacPropBag:{type:String,mayBeNull:u},"wacIsEmbedded ":{type:Boolean,mayBeNull:u},"accessibilityAllowFocusAddinTaskpane ":{type:Boolean,mayBeNull:u},disableMicrophonePermission:{type:Boolean,mayBeNull:u},agaveAddinUploadEnabled:{type:Boolean,mayBeNull:u},featureGateFlag:{type:Number,mayBeNull:u},isReactRibbonEnabled:{type:Boolean,mayBeNull:u},enableDisplayUILocaleQueryString:{type:Boolean,mayBeNull:u},isSafariWithIndexedDBDisabled:{type:Boolean,mayBeNull:u},enableCustomShortcuts:{type:Boolean,mayBeNull:u}},d),m._osfOmexBaseUrl=e.osfOmexBaseUrl,m._devCatalogUrl=e.devCatalogUrl,m._sdxCdnUrl=e.sdxCdnUrl,m._sdxDmsUrl=e.sdxDmsUrl,m._firstPartyManifestCDNUrl=e.firstPartyManifestCDNUrl,m._oneDriveCatalogBaseApiUrl=e.oneDriveCatalogBaseApiUrl,m._spBaseUrl=e.spBaseUrl,m._myOrgCatalogUrl=d,m._enableAddinCommands=e.enableAddinCommands||f,m._enableBlackForestRedirect=e.enableBlackForestRedirect||f,m._enableInsertDialogAccessibilityFix=e.enableInsertDialogAccessibilityFix||f,m._enableFirstPartySDXErrorMessages=e.enableFirstPartySDXErrorMessages||f,m._enableMyOrg=e.enableMyOrg||f,m._enableMyApps=e.enableMyApps||f,m._enableDevCatalog=e.enableDevCatalog||f,m._enableOneDriveCatalog=e.enableOneDriveCatalog||f,m._enablePrivateCatalog=e.enablePrivateCatalog||f,m._showSignOutFromPrivateCatalogMessage=e.showSignOutFromPrivateCatalogMessage||f,m._enableTaskpaneUpgradeToAppCommand=e.enableTaskpaneUpgradeToAppCommand||f,m._enableUploadFileDevCatalog=e.enableUploadFileDevCatalog||f,m._enableV1RedirectApis=e.enableV1RedirectApis||f,m._appName=e.appName,m._appVersion=e.appVersion,m._clientMode=e.clientMode,m._appUILocale=e.appUILocale,m._dataLocale=e.dataLocale,m._docUrl=e.docUrl,m._hostControl=e.hostControl,m._formFactor=e.formFactor||c.FormFactor.Default,m._pageBaseUrl=e.pageBaseUrl,m._lcid=e.lcid,m._controlStatusChanged=e.controlStatusChanged,m._notifyHost=e.notifyHost||function(){},m._allowExternalMarketplace=e.allowExternalMarketplace,m._localizedScriptsUrl=e.localizedScriptsUrl,m._localizedImagesUrl=e.localizedImagesUrl,m._localizedStylesUrl=e.localizedStylesUrl,m._localizedResourcesUrl=e.localizedResourcesUrl,m._autoTrusted=e.trustAgaves,m._omexForceAnonymous=e.omexForceAnonymous||f,m._userNameHashCode=e.userNameHashCode||0,m._hostFullVersion=e.hostFullVersion,m._wacHostEnvironment=e.envCode,m._enableSingleSignOnForAddin=e.enableSingleSignOnForAddin||f,m._enableFirstPartySSO=e.enableFirstPartySSO||f,m._enableServiceDeliveredExperience=e.enableServiceDeliveredExperience||u,m._hideAppsExtensionUrl=m._osfOmexBaseUrl+e.hideAppsExtensionUrl,m._disableLogging=e.disableLogging||f,m._enableDisplayBlockedMinorError=e.enableDisplayBlockedMinorError||f,m._disableAppsForOfficeThirdParty=e.disableAppsForOfficeThirdParty||f,m._isHostDocumentDomain=e.isHostDocumentDomain||f,m._enableRichApiCellEditDelay=e.enableRichApiCellEditDelay||f,m._loggableUserId=e.loggableUserId,m._sessionStartInfoJson=e.sessionStartInfoJson,m._firstPartySingleSignOnWhitelist=e.firstPartySingleSignOnWhitelist,m._wopiHostOriginFromPostMessage=e.wopiHostOriginFromPostMessage,m._wopiHostOriginFromWacPropBag=e.wopiHostOriginFromWacPropBag,m._wacIsEmbedded=e.wacIsEmbedded,m._enableWopiHostCheck=e.isHostFrameTrustCheckEnabledForAddIns||f,m._enableUpnCheck=e.isUpnCheckEnabled||f,m._wacUpn=e.wacUpn,m._hostInstallAddInsIsEnabled=e.hostInstallAddInsIsEnabled||f,m._approvedAddIns=e.approvedAddIns,m._hostInstallAddIns=e.hostInstallAddIns,m._accessibilityAllowFocusAddinTaskpane=e.accessibilityAllowFocusAddinTaskpane,m._disableMicrophonePermission=e.disableMicrophonePermission||f,m._oAuthManager=d,m._agaveAddinUploadEnabled=e.agaveAddinUploadEnabled||f,m._isHostFrameTrusted=e.isHostFrameTrusted||c.HostFrameTrustState.NotInitialized,m._hostFeatureGateFlag=e.hostFeatureGateFlag||c.HostFeatureGateFlags.None,m._isReactRibbonEnabled=e.isReactRibbonEnabled||f,m._enableDisplayUILocaleQueryString=e.enableDisplayUILocaleQueryString||f,m._enableSetFocusOnTaskpaneOnUserAction=e.enableSetFocusOnTaskpaneOnUserAction||f,m._isSafariWithIndexedDBDisabled=e.isSafariWithIndexedDBDisabled,m._enableCustomShortcuts=e.enableCustomShortcuts,m._enable3rdPartySetAppContextInIframeName=m._hostFeatureGateFlag&c.HostFeatureGateFlags.Enable3rdPartySetAppContextInIFrameName,m._appSettings=e.appSettings||{},m._singleSignOnSettings=e.singleSignOnSettings||{},m._flightingTreatmentVariables=e.flightingTreatmentVariables||{},m.getBooleanAppSetting=function(e,t){var n=e&&t&&void 0!==e[t]&&e[t]&&(typeof e[t]===a&&"TRUE"===e[t].toUpperCase()||"boolean"==typeof e[t]&&e[t]);return void 0!==n?n:f},m.addAppSettingAsFlights=function(e,t,n){this.getBooleanAppSetting(e,t)&&c.OUtil.pushFlight(n)},m._enableWopiHostCheck=m._enableWopiHostCheck||m.getBooleanAppSetting(m._appSettings,"WopiHostCheckForAddinsIsEnabled"),m._hostAllowedSdxEmbedding=e.hostAllowedSdxEmbedding||f,m._hostAllowedOfficeStore=e.hostAllowedOfficeStore||f,m._enableWopiHostCheck||(m._hostAllowedSdxEmbedding=u,m._hostAllowedOfficeStore=u),m._upnCheckResult=c.UpnCheckCode.NotSet,p.HostFeatureEnabledInfo.setHostFeatureEnabledInfo(e),m._pageBaseUrl&&"/"!==m._pageBaseUrl.charAt(m._pageBaseUrl.length-1)&&(m._pageBaseUrl=m._pageBaseUrl+"/"),m._localizedResourcesUrl&&"/"!==m._localizedResourcesUrl.charAt(m._localizedResourcesUrl.length-1)&&(m._localizedResourcesUrl=m._localizedResourcesUrl+"/"),m._clientId=c.OUtil.getUniqueId(),m._cachedOsfControls={},m._notReadyOsfControls={},m._notReadyOsfControlsIndex=0,m._iframeAttributeBag={},m._serviceEndPoint=d,m._serviceEndPointInternal=d,m._internalConversationId=d,m._iframeProxies={},m._iframeProxyCount=0,m._iframeNamePrefix="__officeExtensionProxy",m._webUrl=d,m._wsa=d,m._insertDialogDiv=d,m._hasPreloadedOfficeJs=f,m._contextMgrCorrelationId=e.wacSessionId||c.OUtil.Guid.generateNewGuid(),s.RuntimeTelemetryHelper.LogCommonMessageTag("_contextMgrCorrelationId :"+m._contextMgrCorrelationId,d,20194265),s.RuntimeTelemetryHelper.LogCommonMessageTag("ContextActivationManager Constructor isHostFrameTrusted param:"+e.isHostFrameTrusted,m._contextMgrCorrelationId,572926162),s.RuntimeTelemetryHelper.LogCommonMessageTag("Host is enabled to install AddIns provided by host:"+m._hostInstallAddInsIsEnabled,m._contextMgrCorrelationId,572926161),s.RuntimeTelemetryHelper.LogCommonMessageTag("Host is enabled to use AddIns:"+m._hostAllowedSdxEmbedding,m._contextMgrCorrelationId,571736203),s.RuntimeTelemetryHelper.LogCommonMessageTag("Host is enabled to install AddIns provided by Office Store:"+m._hostAllowedOfficeStore,m._contextMgrCorrelationId,571736202),m._hostType=d,m._hostPlatform=d,m._hostSpecificFileVersion=d,m._requirementsChecker=new c.RequirementsChecker,m._onClickInstallOsfControl=d,m._osfOmexBaseUrl){var v,h=m._osfOmexBaseUrl.indexOf(c.Constants.ProtocolSeparator);v=h>=0?m._osfOmexBaseUrl.substr(h):c.Constants.ProtocolSeparator+m._osfOmexBaseUrl;var y=c.Constants.Https+v,C=c.Constants.Https+v;c.OUtil.getQueryStringParamValue(window.location.search,c.Constants.OmexForceAnonymousParamName).toLowerCase()==c.Constants.OmexForceAnonymousParamValue.toLowerCase()?(m._omexAuthNStatus=c.OmexAuthNStatus.Anonymous,m._omexForceAnonymous=u):m._omexAuthNStatus=c.OmexAuthNStatus.NotAttempted,m._omexGatedWSProxy={proxyUrl:y+c.Constants.OmexGatedServiceExtension,proxyName:c.Constants.OmexGatedServiceName,isReady:f,clientEndPoint:d,pendingCallbacks:[]},m._omexWSProxy={proxyUrl:C+c.Constants.OmexUnGatedServiceExtension,proxyName:c.Constants.OmexUnGatedServiceName,isReady:f,clientEndPoint:d,pendingCallbacks:[]},m._omexAnonymousWSProxy={proxyUrl:y+c.Constants.OmexAnonymousServiceExtension,proxyName:c.Constants.OmexAnonymousServiceName,isReady:f,clientEndPoint:d,pendingCallbacks:[]},m._omexBillingMarket=d,m._omexEndPointBaseUrl=C}function _(e,t){try{return JSON.parse(e)[t].toLowerCase()}catch(e){return}}var S=_(e.sessionStartInfoJson,"AudienceGroup"),A=parseInt(_(e.sessionStartInfoJson,"Ring")),I=_(e.sessionStartInfoJson,"SessionOrigin");"automation"!==S&&"bluechicken"!==I&&("number"!=typeof A||A>=-2)&&c.OUtil.pushFlight(c.FlightNames.AddinEnforceHttps),m._enableSetFocusOnTaskpaneOnUserAction&&c.OUtil.pushFlight(c.FlightNames.SetFocusToTaskpaneIsEnabled),m._enableDisplayUILocaleQueryString=m._enableDisplayUILocaleQueryString||m.getBooleanAppSetting(m._appSettings,"DisplayUILocaleQueryStringIsEnabled"),m._agaveAddinUploadEnabled=m._agaveAddinUploadEnabled||m.getBooleanAppSetting(m._appSettings,"AgaveAddinUploadEnabled"),m._uiHostSupportsAuthTokenAddinList=m._singleSignOnSettings?m._singleSignOnSettings.UiHostSupportsAuthTokenAddinList:d,m.addAppSettingAsFlights(m._appSettings,"AddinRibbonIdAllowUnknown",c.FlightNames.AddinRibbonIdAllowUnknown),m.addAppSettingAsFlights(m._appSettings,"AddinActionDefinitionHybridMode",c.FlightNames.AddinActionDefinitionHybridMode),m.addAppSettingAsFlights(m._appSettings,"ManifestParserDevConsoleEnabled",c.FlightNames.ManifestParserDevConsoleLog),m.addAppSettingAsFlights(m._appSettings,"UseActionIdForUILessCommand",c.FlightNames.UseActionIdForUILessCommand),m.addAppSettingAsFlights(m._appSettings,"RequirementSetRibbonApiOnePointTwo",c.FlightNames.RequirementSetRibbonApiOnePointTwo),m.addAppSettingAsFlights(m._appSettings,"ShortcutInfoArrayInUserPreferenceData",c.FlightNames.ShortcutInfoArrayInUserPreferenceData);for(var T=c.TestFlightStart;T<=c.TestFlightEnd;T++){var O="OSFTestFlight"+T;m.addAppSettingAsFlights(m._appSettings,O,T)}var x=m._appSettings.FlightingTreatmentVariables;if(x){if(typeof x==a)try{x=JSON.parse(x)}catch(e){x={};s.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error parsing flightTreatmentsAppSettings JSON.",e,m._appCorrelationId,19203548)}}else x=m._appSettings.flightingTreatmentVariables||{};for(var E in c.FlightTreatmentNames){var b=c.FlightTreatmentNames[E];c.OUtil.getBooleanFromDictionary(x,b)&&c.OUtil.pushFlight(b)}if(c.OUtil.getValue(m._flightingTreatmentVariables["Microsoft.Office.OEP.FirstPartyAnonymousProxyReadyCheckTimeoutEnabled"],f)&&c.OUtil.pushFlight(c.FlightNames.FirstPartyAnonymousProxyReadyCheckTimeout),c.Settings.IsReactRibbonEnabled=m._isReactRibbonEnabled,c.Settings[i]=m.getBooleanAppSetting(m._appSettings,i),c.Settings.IsSafariWithIndexedDBDisabled=m._isSafariWithIndexedDBDisabled,c.Settings.EnableCustomShortcuts=m._enableCustomShortcuts,c.OUtil.checkFlight(c.FlightNames.ManifestParserDevConsoleLog)&&(c.Settings[o]=m.getBooleanAppSetting(m._appSettings,o)),"RibbonGroupIdMap"in c&&"RibbonGroupIdMapCommonMLR"in c)for(var M in c.RibbonGroupIdMap)c.RibbonGroupIdMapCommonMLR[M]=c.RibbonGroupIdMap[M];m._isFromWacAutomation=function(){if(void 0!==this._isFromWacAutomation&&this._isFromWacAutomation!==d)return this._isFromWacAutomation;try{for(var e=window,t=void 0;e!==t;){if(!e.location||!e.location.search)return f;if(e.location.search.toLowerCase().indexOf("automation=1")>=0)return u;t=e,e=e.parent}}catch(e){return f}return f}(),c.OsfManifestManager._setUILocale(m._appUILocale);var R=m;if(R.getContextForEmbeddingPage=function(){var e=0;if(R._hostSpecificFileVersion&&-1!=R._hostSpecificFileVersion.indexOf(".")){var t=R._hostSpecificFileVersion.split("."),n=t[1];isNaN(n)||(e=parseInt(t[1]))}var r=R._requirementsChecker._getSupportedSet();return{appName:R._appName,appVersion:R._appVersion,appUILocal:R._appUILocale,dataLocale:R._dataLocale,docUrl:R._docUrl||window.location.href,clientMode:R._clientMode,minorVersion:e,requirements:r}},m._enableServiceDeliveredExperience)var P=function(e){var t=e&&e.contextId?R.getOsfControl(e.contextId):d;switch(e.id){case c.MessageIDs.FetchBundleUrl:if(!t._agaveEndPoint){var n=t._conversationId+c.SharedConstants.NotificationConversationIdSuffix;t._agaveEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(n,t._frame.contentWindow,t._iframeUrl)}if(t._bundleUrl){var r={id:c.MessageIDs.LoadReactBundle,bundleUrl:t._bundleUrl};t.sendMessageToSdx(r)}break;case c.MessageIDs.LoadBundleSuccess:t._pageStatus=c.OsfControlPageStatus.Ready,t._contextActivationMgr._ErrorUXHelper&&t._contextActivationMgr._ErrorUXHelper.removeProgressDiv(t._div,t._id);break;case c.MessageIDs.LoadBundleError:break;default:l.msAjaxDebug.trace("MessageID: "+e.id+" onMessageFromSdx got wrong message.")}};var N=function(e){if(e.strUrl){var t=c.OUtil.parseUrl(e.strUrl);if(t&&("http:"==t.protocol||"https:"==t.protocol))return void window.open(e.strUrl,"",e.strWindowFeatures)}s.RuntimeTelemetryHelper.LogCommonMessageTag("Silent fail for window.open.",this._contextMgrCorrelationId,572926160)},U=function(e,t){e.hasOwnProperty("fromInsertDialog")&&!e.fromInsertDialog||R._insertDialogDiv!=d&&2==R._insertDialogDiv.childNodes.length&&R._insertDialogDiv.removeChild(R._insertDialogDiv.lastChild);var n,r=c.OUtil.Guid.generateNewGuid(),o=new p.InsertDialogTelemetryContext(r);c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?e.storeType==c.StoreTypeEnum.MarketPlace?n={storeType:c.StoreType.OMEX,storeId:R._osfOmexBaseUrl}:e.storeType==c.StoreTypeEnum.Catalog?n={storeType:c.StoreType.SPCatalog,storeId:R._myOrgCatalogUrl}:e.storeType==c.StoreTypeEnum.OneDrive&&(n={storeType:c.StoreType.OneDrive,storeId:R._oneDriveCatalogBaseApiUrl}):e.storeType==c.StoreTypeEnum.MarketPlace?n={storeType:c.StoreType.OMEX,storeLocator:R._osfOmexBaseUrl}:e.storeType==c.StoreTypeEnum.Catalog?n={storeType:c.StoreType.SPCatalog,storeLocator:R._myOrgCatalogUrl}:e.storeType==c.StoreTypeEnum.OneDrive&&(n={storeType:c.StoreType.OneDrive,storeLocator:R._oneDriveCatalogBaseApiUrl});var i=e.refresh,a={assetId:"",contentMarket:"",anonymous:f,clientEndPoint:d,clearCache:i,clearKilledApps:f,referenceInUse:n,hostType:R._hostType};if(e&&e.storeType==c.StoreTypeEnum.MarketPlace){a.clientVersion=R._getClientVersionForOmex(),a.clientVersion&&(a.clientName=R._getClientNameForOmex(),a.appVersion=R._getAppVersionForOmex());(u=p.CatalogFactory.resolve(c.StoreType.OMEX)).getEntitlementAsync(f,o,Function.createDelegate(R,(function(e){if(e.status==p.DataServiceResultCode.Succeeded&&e.value){for(var n,r=e.value,a=r.length,s={},l=[],f=0;f<a;f++)s[(n=r[f]).contentMarket]?s[n.contentMarket].push(n.assetId):s[n.contentMarket]=[n.assetId];i&&W(r),0===a&&t({errorCode:c.InvokeResultCode.S_OK});var m=0,g=function(e,n){if(e.status==p.DataServiceResultCode.Succeeded&&e.value&&e.value.length&&e.value.length>0)for(var r=e.value,o=R.getRequirementsChecker(),i=0;i<r.length;i++){if(o.isEntitlementFromOmexSupported(r[i])){var s=[];s.push(r[i].name),s.push(r[i].assetId),s.push(r[i].description),s.push(c.OUtil.getTargetType(r[i].appSubType)),s.push(c.OUtil.normalizeAppVersion(r[i].version)),s.push(r[i].assetId),s.push(c.StoreType.OMEX),s.push(parseInt(r[i].defaultWidth)),s.push(parseInt(r[i].defaultHeight)),s.push(r[i].iconUrl),s.push(r[i].provider),s.push(n),s.push(c.StoreType.OMEX),s.push(r[i].webApplicationId),l.push(s)}m++}if(m===a){var d={value:l,errorCode:c.InvokeResultCode.S_OK};t(d)}},v=function(e,t){u.getAppDetails(e,t,o,(function(e){Function.createDelegate(R,g)(e,t)}),i)};for(var h in s)v(s[h],h)}else{var y={value:d,errorCode:c.InvokeResultCode.E_USER_NOT_SIGNED_IN};t(y)}})),i)}else if(e&&e.storeType==c.StoreTypeEnum.Catalog){var s=p.CatalogFactory.resolve(c.StoreType.SPCatalog);s.myOrgCatalogUrl=R._myOrgCatalogUrl;s.getEntitlementAsync(f,o,Function.createDelegate(R,(function(e){var r;if(c.OUtil.writeProfilerMark(c.OsfOfficeExtensionManagerPerfMarker.GetEntitlementEnd),e.status==p.DataServiceResultCode.Succeeded&&e.value){for(var o,i=e.value,a=i.length,s=[],l=0,u=R.getRequirementsChecker(),f=0;f<a;f++)if(o=i[f],u.isEntitlementFromCorpCatalogSupported(o)){var m=[];m.push(o.Title),m.push(o.OfficeExtensionID),m.push(o.OfficeExtensionDescription),m.push(c.OfficeAppType[o.OEType]),m.push(c.OUtil.normalizeAppVersion(o.OfficeExtensionVersion)),m.push(o.OfficeExtensionID),m.push(c.StoreType.SPCatalog),m.push(parseInt(o.OfficeExtensionDefaultWidth.toString())),m.push(parseInt(o.OfficeExtensionDefaultHeight.toString())),m.push(o.OfficeExtensionIcon),m.push(o.OEProviderName),c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?m.push(n.storeId):m.push(n.storeLocator),m.push(c.StoreType.SPCatalog),s.push(m),l++}r=l>0?{value:s,errorCode:c.InvokeResultCode.S_OK}:{value:d,errorCode:c.InvokeResultCode.E_CATALOG_NO_APPS}}else r=!c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)&&!n.storeLocator||c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)&&!n.storeId?{value:d,errorCode:c.InvokeResultCode.E_CATALOG_NO_APPS}:{value:d,errorCode:c.InvokeResultCode.E_GENERIC_ERROR};t(r)})),i)}else if(e&&e.storeType==c.StoreTypeEnum.OneDrive){c.OsfManifestManager.getOneDriveEntitlementsAsync(a,(function(e){var n;e.statusCode===c.ProxyCallStatusCode.Succeeded&&e.value&&(n={value:e.value.entitlements,errorCode:c.InvokeResultCode.S_OK},t(n))}))}else if(e&&e.storeType==c.StoreTypeEnum.PrivateCatalog){var u;(u=p.CatalogFactory.resolve(c.StoreType.PrivateCatalog)).getEntitlementAsync(f,o,Function.createDelegate(R,(function(e){if(e.status!=p.DataServiceResultCode.Unauthenticated)if(e.status===p.DataServiceResultCode.Succeeded&&e.value){var n=e.value;if(0!==n.length){var r;r=n.map((function(e){return{ProductId:e.assetId,AddInState:e.addInState,Version:e.appVersion}}));var a=[];u.getAppDetails(r,"",o,Function.createDelegate(R,(function(e){if(e.status===p.DataServiceResultCode.Succeeded&&e.value&&e.value.length&&0!==e.value.length){for(var n=e.value,r=R.getRequirementsChecker(),o=0;o<n.length;o++)if(r.isEntitlementFromOmexSupported(n[o])){var i=[];i.push(n[o].name),i.push(n[o].assetId),i.push(n[o].description),i.push(c.OUtil.getTargetType(n[o].appSubType)),i.push(c.OUtil.normalizeAppVersion(n[o].version)),i.push(n[o].assetId),i.push(c.StoreType.PrivateCatalog),i.push(parseInt(n[o].defaultWidth)),i.push(parseInt(n[o].defaultHeight)),i.push(n[o].iconUrl),i.push(n[o].provider),i.push(c.StoreType.PrivateCatalog),i.push(c.StoreType.PrivateCatalog),a.push(i)}t({value:a,errorCode:c.InvokeResultCode.S_OK})}else t({value:d,errorCode:c.InvokeResultCode.E_CATALOG_REQUEST_FAILED})})),i)}else t({errorCode:c.InvokeResultCode.E_CATALOG_NO_APPS})}else t({value:d,errorCode:c.InvokeResultCode.E_CATALOG_REQUEST_FAILED});else t({value:d,errorCode:c.InvokeResultCode.E_USER_NOT_SIGNED_IN})})),i)}else l.msAjaxDebug.trace("Unknown store type.")};m._onClickInstallOsfControl=function(e){if(R._enableUploadFileDevCatalog){l.msAjaxDebug.trace("onClickInstallOsfControl!");try{c.OUtil.validateParamObject(e,{manifest:{type:String,mayBeNull:f}},d);var n=new c.Manifest.Manifest(e.manifest,R.getAppUILocale()),r=n.getMarketplaceID(),o=n.getMarketplaceVersion();if(p.CatalogFactory.resolve(c.StoreType.UploadFileDevCatalog).validateAndCacheNewManifest(r,o,e.manifest,n)){var i={id:r,targetType:n.getTarget(),appVersion:o,currentStoreType:c.StoreType.UploadFileDevCatalog,storeId:"developer",assetId:r,assetStoreId:c.StoreType.UploadFileDevCatalog,width:parseInt(n.getDefaultWidth()||t),height:parseInt(n.getDefaultHeight()||t),isAddinCommands:n._isAddinCommandsManifest(c.getManifestHostType(R._hostType))};c.OUtil.validateParamObject(i,{id:{type:String,mayBeNull:f},targetType:{type:Number,mayBeNull:f},appVersion:{type:String,mayBeNull:f},width:{type:Number,mayBeNull:u},height:{type:Number,mayBeNull:u}},d),s.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,i.currentStoreType,i.assetId,i.appVersion,i.targetType,i.isAddinCommands,i.width,i.height),R._notifyHost(t,c.AgaveHostAction.InsertAgave,i)}else R._notifyHost(t,c.AgaveHostAction.NotifyHostError,d)}catch(e){var a="Invalid manifest from addincommands dev catalog.";return p.WACUtils.logExceptionToBrowserConsole(a,e),s.RuntimeTelemetryHelper.LogExceptionTag(a,e,this._appCorrelationId,554235235),void R._notifyHost(t,c.AgaveHostAction.NotifyHostError,d)}}};var F=function(e){l.msAjaxDebug.trace("onClickRefreshfAddinCommands!"),R._notifyHost(t,c.AgaveHostAction.RefreshAddinCommands,e)},w=function(e){var t=c.OUtil.Guid.generateNewGuid(),n=new p.InsertDialogTelemetryContext(t),r=p.CatalogFactory.resolve(c.StoreType.OMEX),o=new p.PreCacher(R.getRequirementsChecker()),i={assetId:e.assetId,storeType:c.StoreType.OMEX,storeId:e.storeId,appVersion:"",targetType:d};r.activateAsync(i,o,n)},D=function(e,t){if(R._enableSingleSignOnForAddin&&e.webApplicationId)B(e,t);else{var n={assetId:e.id,clientVersion:R._getClientVersionForOmex(),clientName:R._getClientNameForOmex(),clientEndPoint:R._omexGatedWSProxy.clientEndPoint},r=R._insertDialogDiv,o={errorCode:c.InvokeResultCode.E_OEM_REMOVED_FAILED,forceRefreshEntitlements:f},i=c.OUtil.Guid.generateNewGuid(),a=new p.InsertDialogTelemetryContext(i);p.CatalogFactory.resolve(c.StoreType.OMEX).removeAsync([n.assetId],a,(function(i){var a=0;if(i.status==p.DataServiceResultCode.Succeeded&&i.value&&i.value.removedApps&&i.value.removedApps.length>0){for(var l=i.value.removedApps,d=c.InvokeResultCode.E_OEM_REMOVED_FAILED,m=0;m<l.length;m++)if(l[m].assetId==n.assetId){l[m].result==c.OmexRemoveAppStatus.Success&&(d=c.InvokeResultCode.S_OK);break}d==c.InvokeResultCode.S_OK&&(a=R.untrustOsfControls(e),k(n.assetId),L(n.assetId)),o.errorCode=d}var g=!document.documentElement.contains(r);s.AppManagementMenuHelper.LogAppManagementMenuAction(n.assetId,c.AppManagementAction.Remove,a,g,f,o.errorCode),o.forceRefreshEntitlements=u,t(o)}))}},k=function(e){var n={solutionId:e};R._appName==c.AppName.ExcelWebApp&&R._notifyHost(t,c.AgaveHostAction.UninstallCustomFunctions,n)},L=function(e){var t=d;for(var n in R._cachedOsfControls){var r=R._cachedOsfControls[n];if(r._marketplaceID.toLowerCase()==e.toLowerCase()){t=r;break}}if(!c.OUtil.isNullOrUndefined(t)&&!c.OUtil.isNullOrUndefined(t._manifest)&&c.OsfManifestManager.manifestContainsExtendedOverrides(t._manifest)){var o=p.ManifestUtil.constructAddInId(t._marketplaceID,t._marketplaceVersion,t._storeType,t._storeLocator);p.OsfExtendedManifestCache.clear(o),Common.App.AppsForOffice.AddinShortcutsPreferenceSettingHelper.instance().clearSettingByAddinId(o)}},B=function(e,n){var r=R._hideAppsExtensionUrl+"&"+c.OmexPageParameterKeys.AppName+"="+c.getModernAppVerCode(R._appName)+"&"+c.OmexPageParameterKeys.AssetId+"="+e.id+"&"+c.OmexPageParameterKeys.AppCorrelationId+"="+R._contextMgrCorrelationId,o=document.createElement("iframe");o.setAttribute("id","serviceExtensionIframe"),o.setAttribute("src",r),o.setAttribute("scrolling","auto"),o.setAttribute("border",t),o.setAttribute("width",t),o.setAttribute("height",t),o.setAttribute("style","position: absolute; left: -100px; top:0px;"),document.body.appendChild(o);var i=R._insertDialogDiv,a=function(t){if(t.source==o.contentWindow){var r={errorCode:c.InvokeResultCode.E_OEM_REMOVED_FAILED,forceRefreshEntitlements:f};document.body.removeChild(o),window.removeEventListener("message",a);var l=0,d=JSON.parse(t.data),p=parseInt(d[c.OmexRemoveAddinMessageKeys.RemoveAddinResultCode]),m=c.InvokeResultCode.E_OEM_REMOVED_FAILED;if(p===c.OmexRemoveAddinResultCode.Success){for(var g=d[c.OmexRemoveAddinMessageKeys.RemoveAddinResultValue],v=0;v<g.length;v++)if(g[v]==e.id){m=c.InvokeResultCode.S_OK;break}m==c.InvokeResultCode.S_OK&&(l=R.untrustOsfControls(e),H(e.id),k(e.id)),r.errorCode=m}var h=!document.documentElement.contains(i);s.AppManagementMenuHelper.LogAppManagementMenuAction(e.id,c.AppManagementAction.Remove,l,h,f,r.errorCode),r.forceRefreshEntitlements=u,n(r)}};window.addEventListener("message",a)},H=function(e){var t=".*",n=[];n.push(new RegExp(c.OUtil.formatString(p.WACUtils.CacheConstants.EntitlementsKey,t,t),"i")),n.push(new RegExp(c.OUtil.formatString(p.WACUtils.CacheConstants.AuthenticatedAppInstallInfoCacheKey,t,e,t,t),"i")),p.WACUtils.removeMatchesFromLocalStorage(n)},W=function(e){for(var t,n=[],r=e.length,o=0;o<r;o++){t=e[o];var i=c.OUtil.formatString(p.WACUtils.CacheConstants.AppStateCacheKey,p.WACUtils.CacheConstants.GatedCacheKeyPrefix,t.contentMarket,t.assetId),a=c.OUtil.formatString(p.WACUtils.CacheConstants.AppInstallInfoKey,p.WACUtils.CacheConstants.AnonymousCacheKeyPrefix,t.assetId,t.contentMarket),s=c.OUtil.formatString(p.WACUtils.CacheConstants.AppDetailKey,p.WACUtils.CacheConstants.UngatedCacheKeyPrefix,t.assetId),l=c.OUtil.formatString(p.WACUtils.CacheConstants.ActivatedCacheKey,t.assetId.toLowerCase(),c.StoreType.OMEX,t.contentMarket),d=c.OUtil.formatString("{0}.{1}.{2}",t.assetId,t.storeId,t.contentMarket);n[i]=u,n[a]=u,n[s]=u,n[l]=u,n[d]=u}for(var f=c.OUtil.getLocalStorage(),m=f.getKeysWithPrefix("__OSF_"),g=(o=0,m.length);o<g;o++){var v=m[o];if(0==v.indexOf(p.WACUtils.CacheConstants.GatedCacheKeyPrefix+p.WACUtils.CacheConstants.AppState)||0==v.indexOf(p.WACUtils.CacheConstants.AnonymousCacheKeyPrefix+p.WACUtils.CacheConstants.AppInstallInfo)||0==v.indexOf(p.WACUtils.CacheConstants.UngatedCacheKeyPrefix+p.WACUtils.CacheConstants.AppDetails)||0==v.indexOf(p.WACUtils.CacheConstants.ActivatedCacheKeyPrefix))n[v]!=u&&f.removeItem(v);else if(0==v.indexOf(p.WACUtils.CacheConstants.GatedCacheKeyPrefix+p.WACUtils.CacheConstants.AppinstallAuthenticated)){var h=v.replace(p.WACUtils.CacheConstants.GatedCacheKeyPrefix+p.WACUtils.CacheConstants.AppinstallAuthenticated,"");n[h=h.substring(h.indexOf(".")+1)]!=u&&f.removeItem(v)}}};if(m._serviceEndPoint=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(m._clientId),m._serviceEndPoint._onHandleRequestError=function(e,t){var n,o,i,l="DdaMethod";e&&(n=e._data)&&((o=typeof(o=typeof n===r&&typeof n[l]===r?n[l].ControlId:typeof n===r?n[0]:n)===a?o:d)&&(i=R.getOsfControl(o))&&(i._pageStatus="Failed origin check"===t?c.OsfControlPageStatus.FailedOriginCheck:"Access Denied"===t?c.OsfControlPageStatus.FailedPermissionCheck:c.OsfControlPageStatus.FailedHandleRequest,s.RuntimeTelemetryHelper.LogExceptionTag(t,d,i.getCorrelationId(),19203549)))},m._serviceEndPoint.registerMethod("ContextActivationManager_getAppContextAsync",(function(e,t){var o=typeof e===a?e:typeof e===r&&e.length>0?e[0]:d;(!o||!t)&&s.RuntimeTelemetryHelper.LogExceptionTag("Parameter validation error in getAppContextAsync.",d,d,19203545);var i=R.getOsfControl(o);if(!i)throw l.msAjaxDebug.trace(n),s.RuntimeTelemetryHelper.LogExceptionTag("Cannot get osfControl with given ID.",d,d,19203546),l.msAjaxError.argument("contextId");i._sdxTelemetryContext.getAppContextStart=performance.now(),i._iframeOnGetAppContextDelegate&&i._iframeOnGetAppContextDelegate(),s.AppLoadTimeHelper.OfficeJSLoaded(i._telemetryContext),t(i.getAppContext()),i._pageStatus=c.OsfControlPageStatus.Ready,i._pageIsReadyTimerExpired&&s.RuntimeTelemetryHelper.LogExceptionTag("App attempted to retrieve context after app activation error has occured.",d,i.getCorrelationId(),19203547),i._contextActivationMgr._ErrorUXHelper&&i._contextActivationMgr._ErrorUXHelper.removeProgressDiv(i._div,i._id),i.ensureAgaveEndPoint(),R._enableSetFocusOnTaskpaneOnUserAction?(i._focusOnIframeWhenLoaded||i.getStatus()===c.OsfControlStatus.Activated&&i.getPageStatus()===c.OsfControlPageStatus.Ready&&i.getInitializationReason()===Microsoft.Office.WebExtension.InitializationReason.Inserted)&&i._frame.contentWindow.focus():i._focusOnIframeWhenLoaded&&i._frame.contentWindow.focus(),s.AppLoadTimeHelper.ActivationEnd(i._telemetryContext),i._sdxTelemetryContext.getAppContextEnd=performance.now(),i._timer&&(window.clearTimeout(i._timer),i._timer=d),i._iframeIsLoaded&&i._notifyHostIFrameOnLoaded()}),Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPoint.registerMethod("ContextActivationManager_notifyHost",(function(e){e&&2==e.length||!(e&&3==e.length&&(e[1]===c.AgaveHostAction.UpdateTargetUrl||e[1]===c.AgaveHostAction.SendTelemetryEvent||e[1]===c.AgaveHostAction.SendCustomerContent||e[1]===c.AgaveHostAction.SendMessage||e[1]===c.AgaveHostAction.LaunchExtensionComponent||e[1]===c.AgaveHostAction.StopExtensionComponent||e[1]===c.AgaveHostAction.RestartExtensionComponent||e[1]===c.AgaveHostAction.EnableTaskPaneHeaderButton||e[1]===c.AgaveHostAction.DisableTaskPaneHeaderButton||e[1]===c.AgaveHostAction.RefreshRibbonGallery||e[1]===c.AgaveHostAction.OfficeJsReady||e[1]===c.AgaveHostAction.KeyboardShortcuts))&&l.msAjaxDebug.trace("ContextActivationManager_notifyHost params is wrong.");var t=e[0],r=e[1],o=R.getOsfControl(t);if(o)if(r===c.AgaveHostAction.TabExitShift||r===c.AgaveHostAction.ExitNoFocusableShift)R._ErrorUXHelper.focusOnNotificationUxShiftIn(t,r);else if(r===c.AgaveHostAction.UpdateTargetUrl){var i=e[2];o.checkAppDomains(i)&&o.updateAgaveEndPointTargetUrl(i)}else if(r===c.AgaveHostAction.SendTelemetryEvent||r===c.AgaveHostAction.SendCustomerContent){var a=e[2];o._contextActivationMgr._notifyHost(t,r,a)}else if(r===c.AgaveHostAction.LaunchExtensionComponent){var s=e[2];o._contextActivationMgr._notifyHost(t,r,s)}else if(r===c.AgaveHostAction.RestartExtensionComponent){var u=e[2];if(u.InstanceToken){var p=o._contextActivationMgr._cachedOsfControls[u.InstanceToken];if(p)p.refresh();else if(u.LaunchProperties&&u.LaunchProperties.OptionalProperties){var f=u.Id.Id,m=u.LaunchProperties.OptionalProperties.SourceLocationOverrideResourceId;o._contextActivationMgr.refreshOsfControl(f,m)}}}else if(r===c.AgaveHostAction.StopExtensionComponent){var g=e[2];o._contextActivationMgr._notifyHost(t,r,g)}else if(r==c.AgaveHostAction.SendMessage){for(var v in o._contextActivationMgr._cachedOsfControls)if(v!=o.getID()){var h=o._contextActivationMgr._cachedOsfControls[v];if(h.getStoreLocator()==o.getStoreLocator()&&h.getStoreType()==o.getStoreType()){var y=e[2];h.getOwnerAddinAssetId()!=d&&h.getOwnerAddinAssetId()==o.getOwnerAddinAssetId()?h.notifyAgave(c.AgaveHostAction.SendMessage,y):h.getMarketplaceID()==o.getMarketplaceID()&&h.notifyAgave(c.AgaveHostAction.SendMessage,y)}}}else if(r==c.AgaveHostAction.EnableTaskPaneHeaderButton){var C=e[2];o._contextActivationMgr._notifyHost(t,r,C)}else if(r==c.AgaveHostAction.RefreshRibbonGallery){var _=e[2];o._contextActivationMgr._notifyHost(t,r,_)}else if(r==c.AgaveHostAction.OfficeJsReady){var S=e[2];o._sdxTelemetryContext.officeJsReadyDate=S,o._iframeOnGetAppContextDelegate&&o._iframeOnGetAppContextDelegate()}else if(r==c.AgaveHostAction.KeyboardShortcuts){var A=e[2];o._contextActivationMgr._notifyHost(t,r,A)}else o._contextActivationMgr._notifyHost?o._contextActivationMgr._notifyHost(t,r):l.msAjaxDebug.trace("No notifyHost provided by the host.");else l.msAjaxDebug.trace(n)}),Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPoint.registerMethod("ContextActivationManager_openWindowInHost",N,Microsoft.Office.Common.InvokeType.async,f),m._enableServiceDeliveredExperience&&m._serviceEndPoint.registerMethod("Office_sendMessageToHost",P,Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal=Microsoft.Office.Common.XdmCommunicationManager.createServiceEndPoint(m._clientId+c.Constants.EndPointInternalSuffix),m._serviceEndPointInternal.registerMethod("ContextActivationManager_getEntitlementsForInsertDialog",U,Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeSignIn",(function(e){if(e&&e.storeType!=c.StoreTypeEnum.PrivateCatalog){var n=window.location.href,r=R._osfOmexBaseUrl+c.Constants.SignInRedirectUrl+encodeURIComponent(n);window.location.assign(r)}else p.PrivateCatalogService.authenticationProxy.getSignInUrl((function(e){window.top.location.replace(e)}),(function(){R._notifyHost(t,c.AgaveHostAction.NotifyHostError,d)}))}),Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeSignOut",(function(e){e&&e.storeType==c.StoreTypeEnum.PrivateCatalog&&p.PrivateCatalogService.SignOutUser(),F(e,d)}),Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_invokeWindowOpen",(function(e){if(e.pageUrl){var t={strUrl:e.pageUrl,strWindowName:d,strWindowFeatures:d};N(t)}}),Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickInsertOsfControl",(function(e){l.msAjaxDebug.trace("onClickInsertOsfControl!"),R._notifyHost(t,c.AgaveHostAction.InsertAgave,e)}),Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickInstallOsfControl",m._onClickInstallOsfControl,Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickRefreshAddinCommands",F,Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_onClickCancelDialog",(function(){l.msAjaxDebug.trace("onClickCancelDialog!"),R._notifyHost(t,c.AgaveHostAction.CancelDialog),R._internalConversationId&&(R._serviceEndPointInternal.unregisterConversation(R._internalConversationId),R._internalConversationId=d)}),Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_removeAppForInsertDialog",D,Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_logTelemetryDataForInsertDialog",(function(e){switch(e.datapointName){case c.DataPointNames.AppManagementMenu:c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?(e.id=e.id||e.assetId,c.OUtil.validateParamObject(e,{id:{type:String,mayBeNull:f},operationMetadata:{type:Number,mayBeNull:f},hrStatus:{type:Number,mayBeNull:f}},d),s.AppManagementMenuHelper.LogAppManagementMenuAction(e.id,e.operationMetadata,0,f,f,e.hrStatus)):(c.OUtil.validateParamObject(e,{assetId:{type:String,mayBeNull:f},operationMetadata:{type:Number,mayBeNull:f},hrStatus:{type:Number,mayBeNull:f}},d),s.AppManagementMenuHelper.LogAppManagementMenuAction(e.assetId,e.operationMetadata,0,f,f,e.hrStatus));break;case c.DataPointNames.InsertionDialogSession:c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?(e.id=e.id||e.assetId,c.OUtil.validateParamObject(e,{id:{type:String,mayBeNull:f},totalSessionTime:{type:Number,mayBeNull:f},trustPageSessionTime:{type:Number,mayBeNull:f},appInserted:{type:Boolean,mayBeNull:f},lastActiveTab:{type:Number,mayBeNull:f},lastActiveTabCount:{type:Number,mayBeNull:f}},d),s.InsertionDialogSessionHelper.LogInsertionDialogSession(e.id,e.totalSessionTime,e.trustPageSessionTime,e.appInserted,e.lastActiveTab,e.lastActiveTabCount)):(c.OUtil.validateParamObject(e,{assetId:{type:String,mayBeNull:f},totalSessionTime:{type:Number,mayBeNull:f},trustPageSessionTime:{type:Number,mayBeNull:f},appInserted:{type:Boolean,mayBeNull:f},lastActiveTab:{type:Number,mayBeNull:f},lastActiveTabCount:{type:Number,mayBeNull:f}},d),s.InsertionDialogSessionHelper.LogInsertionDialogSession(e.assetId,e.totalSessionTime,e.trustPageSessionTime,e.appInserted,e.lastActiveTab,e.lastActiveTabCount));break;case c.DataPointNames.UploadFileDevCatelog:c.OUtil.validateParamObject(e,{operationMetadata:{type:Number,mayBeNull:f},hrStatus:{type:Number,mayBeNull:f}},d),s.UploadFileDevCatelogHelper.LogUploadFileDevCatelogAction(this._appCorrelationId,e.operationMetadata,0,f,f,e.hrStatus);break;case c.DataPointNames.UploadFileDevCatalogUsage:c.OUtil.validateParamObject(e,{currentStoreType:{type:String,mayBeNull:f},id:{type:String,mayBeNull:u},appVersion:{type:String,mayBeNull:u},appTargetType:{type:Number,mayBeNull:f},isAppCommand:{type:String,mayBeNull:f},appSizeWidth:{type:Number,mayBeNull:u},appSizeHeight:{type:Number,mayBeNull:u}},d),s.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,e.currentStoreType,e.Id,e.appVersion,e.appTargetType,e.isAppCommand,e.appSizeWidth,e.appSizeHeight)}}),Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_getOmexData",w,Microsoft.Office.Common.InvokeType.async,f),m._serviceEndPointInternal.registerMethod("ContextActivationManager_removeAppCommandsAddin",(function(e){var n=R.getOsfControl(e.id);n?n._isAddinCommands((function(n){n&&R._notifyHost(t,c.AgaveHostAction.RemoveAppCommandsAddin,{assetId:e.id})})):l.msAjaxDebug.trace("osfControl for the given ID doesn't exist:"+e.id)}),Microsoft.Office.Common.InvokeType.async,f),c.AppSpecificSetup._setupFacade(m._hostControl,m,m._serviceEndPoint,m._serviceEndPointInternal),e.hostType=m._hostType,e.spBaseUrl=m._spBaseUrl,e.wopiHostAddinList=m._hostInstallAddIns,e.approvedAddinList=m._approvedAddIns,e.enableWopiCatalog=m._hostInstallAddInsIsEnabled,p.CatalogFactory.setHostContext(e),m._localeStringLoadingPendingCallbacks=[],m._localizedScriptsUrl&&"null/"!=m._localizedScriptsUrl){m._loadLocaleString(Function.createDelegate(m,(function(){this._ErrorUXHelper=new c._ErrorUXHelper(this)})))}m.queryEntitlementDetails=function(e){U(e,e.callbackFunc)},m._getOmexData=function(e){w(e)},m._removeAppForInsertDialog=function(e){D(e,e.callbackFunc)};m._enableUpnCheck&&m._enableMyOrg&&m._spBaseUrl!=d&&!p.WACUtils.isTeamsWebView()&&function(e,t){var n="wacUpn is null.",r=function(e){var n=u;p.WACUtils.logExceptionToBrowserConsole("Check UPN result: "+e.value,d),e.status===p.DataServiceResultCode.Succeeded?n=e.value:s.RuntimeTelemetryHelper.LogCommonMessageTag("Upn Check failed.",d,572926159),t(n)},o=p.CatalogFactory.resolve(c.StoreType.SPCatalog);o!=d&&e!=d?o.isUpnMatchAsync(e,new p.SimpleTelemetryContext,r):(e==d&&(p.WACUtils.logExceptionToBrowserConsole(n,d),s.RuntimeTelemetryHelper.LogCommonMessageTag(n,d,572926158)),e==d&&s.RuntimeTelemetryHelper.LogCommonMessageTag("spcatalog is null.",d,572926157),r({status:p.DataServiceResultCode.Failed,value:f}))}(m._wacUpn,(function(e){g._upnCheckResult=e?c.UpnCheckCode.Match:c.UpnCheckCode.NotMatch}))},c.ContextActivationManager.prototype={insertOsfControl:function(e){var t=!0,n=!1,r=this;c.OUtil.validateParamObject(e,{div:{type:Object,mayBeNull:n},id:{type:String,mayBeNull:n},marketplaceID:{type:String,mayBeNull:n},marketplaceVersion:{type:String,mayBeNull:n},store:{type:String,mayBeNull:n},storeType:{type:String,mayBeNull:n},alternateReference:{type:Object,mayBeNull:t},settings:{type:Object,mayBeNull:t},reason:{type:String,mayBeNull:t},osfControlType:{type:Number,mayBeNull:t},snapshotUrl:{type:String,mayBeNull:t},preactivationCallback:{type:Object,mayBeNull:t},virtualOsfControlActivationCallback:{type:Object,mayBeNull:t},isvirtualOsfControl:{type:Boolean,mayBeNull:t},isDialog:{type:Boolean,mayBeNull:t},hostCustomMessage:{type:String,mayBeNull:t},isForUILessAction:{type:Boolean,mayBeNull:t},ownerAddinAssetId:{type:String,mayBeNull:t},ownerAddinStoreType:{type:String,mayBeNull:t},sourceLocationOverrideUrl:{type:String,mayBeNull:t},focusOnIframeWhenLoaded:{type:Boolean,mayBeNull:t},featureGates:{type:Object,mayBeNull:t},activationStart:{type:Number,mayBeNull:t},hostInfoFlags:{type:Number,mayBeNull:t},sharedRuntimeId:{type:String,mayBeNull:t},initialDisplayMode:{type:Number,mayBeNull:t},containsShortcuts:{type:String,mayBeNull:t},exchangeExtensionProviderName:{type:String,mayBeNull:t},exchangeExtensionType:{type:String,mayBeNull:t}},null);var o=c.OsfControl.isFirstPartyStoreString(e.storeType);if(!r._disableAppsForOfficeThirdParty||o){var i={div:e.div,id:e.id,marketplaceID:e.marketplaceID,marketplaceVersion:e.marketplaceVersion,store:e.store,storeType:e.storeType,alternateReference:e.alternateReference,settings:e.settings,reason:e.reason,osfControlType:e.osfControlType,snapshotUrl:e.snapshotUrl,contextActivationMgr:r,preactivationCallback:e.preactivationCallback,virtualOsfControlActivationCallback:e.virtualOsfControlActivationCallback,isvirtualOsfControl:e.isvirtualOsfControl,isDialog:e.isDialog,hostCustomMessage:e.hostCustomMessage,isForUILessAction:e.isForUILessAction,ownerAddinAssetId:e.ownerAddinAssetId,sourceLocationOverrideResourceId:e.sourceLocationOverrideResourceId,sourceLocationOverrideUrl:e.sourceLocationOverrideUrl,ownerAddinStoreType:e.ownerAddinStoreType,focusOnIframeWhenLoaded:e.focusOnIframeWhenLoaded,featureGates:e.featureGates,activationStart:e.activationStart,hostInfoFlags:e.hostInfoFlags,sharedRuntimeId:e.sharedRuntimeId,initialDisplayMode:e.initialDisplayMode,containsShortcuts:e.containsShortcuts,exchangeExtensionProviderName:e.exchangeExtensionProviderName,exchangeExtensionType:e.exchangeExtensionType},a=r.getSQMAgaveUsage(i.storeType,i.osfControlType,i.reason,e.marketplaceID),l=new c.OsfControl(i);l._sqmDWords[0]=a[0],l._sqmDWords[1]=a[1],l._contextActivationMgr._ErrorUXHelper&&l._contextActivationMgr._ErrorUXHelper.showProgress(l._div,l._id);return r._loadLocaleString(Function.createDelegate(r,(function(){var e="OsfControl activation lifecycle: OsfControl active got called for controlId: ";l.activate({isInsertOsfControl:t}),c.OUtil.checkFlight("Microsoft.Office.SharedOnline.IsPrivateAddin")?s.RuntimeTelemetryHelper.LogCommonMessageTag(e+s.PrivacyRules.GetAssetId(i.ownerAddinStoreType||i.storeType,i.store,i.id),this._contextMgrCorrelationId,594356321):s.RuntimeTelemetryHelper.LogCommonMessageTag(e+l._id,this._contextMgrCorrelationId,562442708)}))),l}},insertDialogControl:function(e){var t=!1;c.OUtil.validateParamObject(e,{div:{type:Object,mayBeNull:t},id:{type:String,mayBeNull:t},dialogUrl:{type:String,mayBeNull:t},marketplaceID:{type:String,mayBeNull:t},marketplaceVersion:{type:String,mayBeNull:t},appDomains:{type:Array,mayBeNull:t},store:{type:String,mayBeNull:t},storeType:{type:String,mayBeNull:t},ownerAddinAssetId:{type:String,mayBeNull:!0},ownerAddinStoreType:{type:String,mayBeNull:!0},agaveName:{type:String,mayBeNull:!0}},null);var n={div:e.div,id:e.id,marketplaceID:e.marketplaceID,marketplaceVersion:e.marketplaceVersion,store:e.store,storeType:e.storeType,ownerAddinAssetId:e.ownerAddinAssetId,ownerAddinStoreType:e.ownerAddinStoreType,isDialog:!0,contextActivationMgr:this};new c.OsfControl(n).createIframeForDialogControl(e.agaveName,e.dialogUrl,e.appDomains)},insertBlankControlWithErrorUX:function(e,t){var n=!1,r=this;c.OUtil.validateParamObject(e,{div:{type:Object,mayBeNull:n},id:{type:String,mayBeNull:n},marketplaceID:{type:String,mayBeNull:n},marketplaceVersion:{type:String,mayBeNull:n},store:{type:String,mayBeNull:n},osfControlType:{type:Number,mayBeNull:!0},storeType:{type:String,mayBeNull:n}},null);var o={div:e.div,id:e.id,marketplaceID:e.marketplaceID,marketplaceVersion:e.marketplaceVersion,store:e.store,storeType:e.storeType,osfControlType:e.osfControlType,contextActivationMgr:r,isvirtualOsfControl:n},i=new c.OsfControl(o);i._contextActivationMgr.registerOsfControl(i);var a=function(e,t){var r,o="",i="",a="",s=n;e.status===p.DataServiceResultCode.Succeeded&&e.value&&(o=(r=e.value).getDefaultDisplayName(),i=r.getProviderName(),a=r.getDefaultIconUrl(),s=r.isSSOAddin()),t(o,i,a,s)},s=p.OmexUtils.getOmexEndPointPageUrl(r.getOsfOmexBaseUrl(),e.marketplaceID,e.store),l=p.CatalogFactory.resolve(e.storeType.toLowerCase());if(null!=l){var d={assetId:e.marketplaceID,appVersion:e.marketplaceVersion,storeType:e.storeType,storeId:e.store,targetType:null},u=c.OmexClientNames[r._appName];l.getAndCacheManifest(d,r._storeLocator,new p.AddinCommandsTelemetryContext(i.getCorrelationId()),(function(n){a(n,(function(n,r,o,a){i._showTrustError(u,n,r,o,e.storeType,t,s,a)}))}))}},purgeDialogControl:function(e){var t=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1}]);if(t)throw t;var n=this._cachedOsfControls[e];void 0!==n&&(n._conversationId&&this._getServiceEndPoint().unregisterConversation(n._conversationId),this.unregisterOsfControl(n))},dispose:function(){var e=this;e._serviceEndPoint&&(e._serviceEndPoint.dispose(),Microsoft.Office.Common.XdmCommunicationManager.deleteServiceEndPoint(e._clientId),e._serviceEndPoint=null),e._serviceEndPointInternal&&(e._serviceEndPointInternal.dispose(),Microsoft.Office.Common.XdmCommunicationManager.deleteServiceEndPoint(e._clientId+c.Constants.EndPointInternalSuffix),e._serviceEndPointInternal=null)},setLocalizedUrl:function(e,t,n){var r=this,o=Function._validateParams(arguments,[{name:"scriptUrl",type:String,mayBeNull:!1},{name:"imageUrl",type:String,mayBeNull:!1},{name:"styleUrl",type:String,mayBeNull:!1}]);if(o)throw o;if(r._localizedScriptsUrl=e,r._localizedImagesUrl=t,r._localizedStylesUrl=n,r._localizedScriptsUrl&&"null/"!=r._localizedScriptsUrl){var i=function(){this._ErrorUXHelper||(this._ErrorUXHelper=new c._ErrorUXHelper(this))};r._loadLocaleString(Function.createDelegate(r,i))}},getOsfControlStatus:function(e){var t=this._cachedOsfControls[e];return t?t.getStatus():c.OsfControlStatus.InvalidOsfControl},hostCheckReadyHandler:function(e,t){var n=this;if(null!=n._isHostFrameTrusted&&null!=n._notReadyOsfControlsIndex){null!=t&&(n._isHostFrameTrusted=t),s.RuntimeTelemetryHelper.LogCommonMessageTag("Host frame check set :"+JSON.stringify(t),n._contextMgrCorrelationId,595354008);for(var r=0;r<n._notReadyOsfControlsIndex;r++){var o=n._notReadyOsfControls[r];o&&o.refresh()}}},activateOsfControl:function(e){var t=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1}]);if(t)throw t;var n=this._cachedOsfControls[e];void 0!==n&&n.activate()},deActivateOsfControl:function(e){var t=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1}]);if(t)throw t;var n=this._cachedOsfControls[e];void 0!==n&&n.deActivate()},purgeOsfControl:function(e,t){var n=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1},{name:"purgeManifest",type:Boolean,mayBeNull:!1}]);if(n)throw n;var r=this._cachedOsfControls[e];void 0!==r&&(s.RuntimeTelemetryHelper.LogCommonMessageTag("OsfControl activation lifecycle: purgeOsfControl for controlId: "+e,this._contextMgrCorrelationId,594356320),r.purge(t))},purgeOsfControlNotifications:function(){for(var e in this._cachedOsfControls)this._ErrorUXHelper.purgeOsfControlNotification(e)},untrustOsfControls:function(e){var t=this,n=0,r=function(e){return function(){e.activate({hasConsent:!0})}},o=c.OUtil.formatString(c.Constants.ActivatedCacheKey,e.id.toLowerCase(),e.currentStoreType,e.storeId);for(var i in t._deleteCachedFlag(o),t._cachedOsfControls){var a=t._cachedOsfControls[i];if(a._marketplaceID.toLowerCase()==e.id.toLowerCase()){t._ErrorUXHelper.purgeOsfControlNotification(a._id),a.deActivate();var s=p.OmexUtils.getOmexEndPointPageUrl(t.getOsfOmexBaseUrl(),a._marketplaceID,e.storeId),l=c.OmexClientNames[t._appName];a._showTrustError(l,e.displayName,e.providerName,e.iconUrl,e.currentStoreType,r(a),s),n++}}return n},retryAll:function(e){var t=this;for(var n in t._cachedOsfControls){var r=t._cachedOsfControls[n];r._marketplaceID.toLowerCase()==e.toLowerCase()&&r._retryActivate&&(t._ErrorUXHelper.purgeOsfControlNotification(r._id),t._ErrorUXHelper.removeInfoBarDiv(n,!1),r._retryActivate(),r._retryActivate=null)}},validateAndCacheNewDevAddinManifest:function(e){var t=this;t._getDevAddinManifestContent(e,t._validateAndCacheNewDevAddinManifest.bind(t),t._notifyHost.bind(t))},_getDevAddinManifestContent:function(e,t,n){var r;try{(r=new XMLHttpRequest).onreadystatechange=function(){return 4==r.readyState&&200==r.status?t(r.responseText):4==r.readyState&&0==r.status?n("0",c.AgaveHostAction.InsertDevManifestError,{manifestUrl:e}):void 0},r.open("GET",e,!0),r.send()}catch(t){var o="Cannot access developer manifest url.";return p.WACUtils.logExceptionToBrowserConsole(o,t),s.RuntimeTelemetryHelper.LogExceptionTag(o,t,this._appCorrelationId,572926156),n("0",c.AgaveHostAction.InsertDevManifestError,{manifestUrl:e})}},_validateAndCacheNewDevAddinManifest:function(e){var t="developer",n=this;try{var r=new c.Manifest.Manifest(e,n.getAppUILocale()),o=r.getMarketplaceID(),i=r.getMarketplaceVersion(),a=p.CatalogFactory.resolve(c.StoreType.UploadFileDevCatalog);if(a.validateAndCacheNewManifest(o,i,e,r)){var l={id:o,targetType:r.getTarget(),appVersion:i,currentStoreType:c.StoreType.UploadFileDevCatalog,storeId:t,assetId:o,assetStoreId:c.StoreType.UploadFileDevCatalog,width:parseInt(r.getDefaultWidth()||"0"),height:parseInt(r.getDefaultHeight()||"0"),isAddinCommands:r._isAddinCommandsManifest(c.getManifestHostType(n._hostType))};return c.OUtil.validateParamObject(l,{id:{type:String,mayBeNull:!1},targetType:{type:Number,mayBeNull:!1},appVersion:{type:String,mayBeNull:!1},width:{type:Number,mayBeNull:!0},height:{type:Number,mayBeNull:!0}},null),a.localCacheAddinCommands(o,i,t),c.OUtil.getLocalStorage().setItem(o,"true"),n._notifyHost("0",c.AgaveHostAction.InsertDevManifest,l)}return n._notifyHost("0",c.AgaveHostAction.NotifyHostError,null)}catch(e){var d="Invalid developer addin manifest.";return p.WACUtils.logExceptionToBrowserConsole(d,e),s.RuntimeTelemetryHelper.LogExceptionTag(d,e,n._appCorrelationId,572926155),n._notifyHost("0",c.AgaveHostAction.NotifyHostError,null)}},getOsfControl:function(e){var t=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1}]);if(t)throw t;return this._cachedOsfControls[e]},getOsfControls:function(){var e=[];for(var t in this._cachedOsfControls)e.push(this._cachedOsfControls[t]);return e},getOsfOmexBaseUrl:function(){return this._osfOmexBaseUrl},getAppName:function(){return this._appName},getClientMode:function(){return this._clientMode},getClientId:function(){return this._clientId},getFormFactor:function(){return this._formFactor},getDocUrl:function(){return this._docUrl},getAppUILocale:function(){return this._appUILocale},getDataLocale:function(){return this._dataLocale},getPageBaseUrl:function(){return this._pageBaseUrl},getLcid:function(){return this._lcid},isExternalMarketplaceAllowed:function(){return this._allowExternalMarketplace},isStoreDisabled:function(e){this._loadLocaleString(Function.createDelegate(this,(function(){var t=p.CatalogFactory.resolve(c.StoreType.OMEX),n=c.OUtil.Guid.generateNewGuid(),r=new p.InsertDialogTelemetryContext(n);if(t instanceof p.OmexCatalog)t.isStoreDisabled(r,e);else{e({value:!1,status:200})}})))},getLocalizedScriptsUrl:function(){return this._localizedScriptsUrl?this._localizedScriptsUrl:""},getLocalizedImagesUrl:function(){return this._localizedImagesUrl?this._localizedImagesUrl:""},getLocalizedStylesUrl:function(){return this._localizedStylesUrl?this._localizedStylesUrl:""},raiseOsfControlStatusChange:function(e){this._controlStatusChanged&&this._controlStatusChanged(e)},registerOsfControl:function(e){var t=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:!1}]);if(t)throw t;this._cachedOsfControls[e.getID()]=e},registerNotReadyOsfControl:function(e){var t=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:!1}]);if(t)throw t;this._notReadyOsfControls[this._notReadyOsfControlsIndex]=e,this._notReadyOsfControlsIndex++},unregisterOsfControl:function(e){var t=Function._validateParams(arguments,[{name:"osfControl",type:Object,mayBeNull:!1}]);if(t)throw t;delete this._cachedOsfControls[e.getID()]},setIframeAttributeBag:function(e){this._iframeAttributeBag=e},displayNotification:function(e){var t=null,n=!0,r=!1,o=this;c.OUtil.validateParamObject(e,{infoType:{type:Number,mayBeNull:r},id:{type:String,mayBeNull:r},title:{type:String,mayBeNull:r},description:{type:String,mayBeNull:r},url:{type:String,mayBeNull:n},icon:{type:String,mayBeNull:n},buttonTxt:{type:String,mayBeNull:n},buttonCallback:{type:Function,mayBeNull:n},dismissCallback:{type:Function,mayBeNull:n},"displayDeactive ":{type:Boolean,mayBeNull:n},highPriority:{type:Boolean,mayBeNull:n},detailView:{type:Boolean,mayBeNull:n},reDisplay:{type:Boolean,mayBeNull:n},logAsError:{type:Boolean,mayBeNull:n},errorCode:{type:Number,mayBeNull:n},retryAll:{type:Boolean,mayBeNull:n},iframeNotificationUrl:{type:String,mayBeNull:n},notificationType:{type:Number,mayBeNull:n}},t),e.errorCode||(e.errorCode=0);var i=o._cachedOsfControls[e.id];if(i)if(i._isvirtualOsfControl){if(e.errorCode==c.ErrorStatusCodes.E_OEM_OMEX_EXTENSION_KILLED||e.errorCode==c.ErrorStatusCodes.E_OEM_EXTENSION_KILLED)return void o.purgeOsfControl(e.id,n);if(null==e.highPriority&&(e.highPriority=e.infoType===c.InfoType.Error?n:r),e.highPriority===r)i._notificationParams.push(e);else{for(var a=i._notificationParams,l=0;l<a.length;l++)if(!a[l].highPriority){a.splice(l,0,e),a=t;break}a!=t&&a.push(e)}!i._isvirtualOsfControlCallbackInvoked&&i.ensureToGetVirtualOsfControlManifest((function(e){i.invokeVirtualOsfControlActivationCallback(e)})),!i._isManifestProcessedForCustomFunctions&&i.ensureToGetVirtualOsfControlManifest((function(e){i.processManifestForCustomFunctions(e)}))}else{if(e.logAsError&&(s.AppLoadTimeHelper.SetErrorResult(i._telemetryContext,e.errorCode),o._notifyHostError)){var d={errorCode:e.errorCode};o._notifyHostError(e.id,c.AgaveHostAction.NotifyHostError,d)}(e.displayDeactive||e.iframeNotificationUrl!=t)&&(e.detailView=n),e.div=i._div,o._ErrorUXHelper&&o._ErrorUXHelper.showNotification(e)}},dismissMessages:function(e){this._ErrorUXHelper&&this._ErrorUXHelper.dismissMessages(e)},notifyAgave:function(e,t){var n=Function._validateParams(arguments,[{name:"id",type:String,mayBeNull:!1},{name:"actionId",type:Number,mayBeNull:!1}]);if(n)throw n;var r=this._cachedOsfControls[e];void 0!==r&&(t===c.AgaveHostAction.CtrlF6In||t===c.AgaveHostAction.TabIn||t===c.AgaveHostAction.Select?this._ErrorUXHelper.focusOnNotificationUx(e,t):t===c.AgaveHostAction.TabInShift&&r._pageStatus!==c.OsfControlPageStatus.Ready?this._ErrorUXHelper.focusOnNotificationUxShiftIn(e,t):r.notifyAgave(t))},setWSA:function(e){var t=this;t._wsa=e,t._wsa&&(t._wsa.createStreamUnobfuscated(c.SQMDataPoints.DATAID_APPSFOROFFICEUSAGE,c.BWsaStreamTypes.Static,2,c.BWsaConfig.defaultMaxStreamRows),t._wsa.createStreamUnobfuscated(c.SQMDataPoints.DATAID_APPSFOROFFICENOTIFICATIONS,c.BWsaStreamTypes.Static,4,c.BWsaConfig.defaultMaxStreamRows))},getWSA:function(){return this._wsa},getSQMAgaveUsage:function(e,t,n,r){var o,i;switch(e.toLowerCase()){case c.StoreType.OMEX:o=0;break;case c.StoreType.SPCatalog:o=1;break;case c.StoreType.FileSystem:o=2;break;case c.StoreType.Registry:o=3;break;case c.StoreType.Exchange:o=4;break;case c.StoreType.SPApp:o=5;break;case c.StoreType.FirstParty:o=6;break;case c.StoreType.Sdx:o=7;break;case c.StoreType.InMemory:o=8;break;case c.StoreType.OneDrive:o=9;break;case c.StoreType.PrivateCatalog:o=10;break;case c.StoreType.HardCodedPreinstall:o=11;break;case c.StoreType.UploadFileDevCatalog:o=12;break;case c.StoreType.WopiCatalog:o=13;break;default:o=15}switch(t){case c.OsfControlType.DocumentLevel:i=1;break;case c.OsfControlType.ContainerLevel:i=0;break;default:i=2}var a=7;if(n&&n.toLowerCase)switch(n.toLowerCase()){case Microsoft.Office.WebExtension.InitializationReason.Inserted.toLowerCase():a=0;break;case Microsoft.Office.WebExtension.InitializationReason.DocumentOpened.toLowerCase():a=1}var s=0;0!==r.toLowerCase().indexOf("wa")&&0!==r.toLowerCase().indexOf("fa")||(s=r&&r.length>2?parseInt(r.substring(2),10):0,isNaN(s)&&(s=0));return[a<<8|i<<4|o,s]},isMyOrgReady:function(e){var t=this;if(t._enableMyOrg)if(t._spBaseUrl&&t._iframeProxies&&t._iframeProxies[t._spBaseUrl]&&t._iframeProxies[t._spBaseUrl].clientEndPoint)e({isReady:!0,clientEndPoint:t._iframeProxies[t._spBaseUrl].clientEndPoint});else{t._createSharePointIFrameProxy(t._spBaseUrl,(function(t){e(t?{isReady:!0,clientEndPoint:t}:{isReady:!1})}))}else e({isReady:!1})},openInputUrlDialog:function(e){var t="style",n=document.createElement("p"),r="title-p";n.setAttribute("id",r),"ltr"==document.documentElement.getAttribute("dir")?n.setAttribute(t,"padding: 26px 0px 10px 26px;"):n.setAttribute(t,"padding: 26px 26px 10px 0px;"),n.textContent="DevCatalog server Url is configured in settings.xml - Enter manifest file name only (AppId.xml):",e.appendChild(n);var o=document.createElement("div"),i=document.createElement("input");i.setAttribute("type","url"),i.setAttribute("id","url-input"),i.setAttribute("aria-labelledby",r),i.setAttribute("data-lpignore","true"),"ltr"==document.documentElement.getAttribute("dir")?i.setAttribute(t,"margin-left: 26px; height: 18px; width: calc(100% - 141px); vertical-align: middle;"):i.setAttribute(t,"margin-right: 26px; height: 18px; width: calc(100% - 141px); vertical-align: middle;"),o.appendChild(i);var a=this,l=function(e){var t=new c.Manifest.Manifest(e,a.getAppUILocale());!c.OsfManifestManager.hasManifest(t.getMarketplaceID(),t.getMarketplaceVersion())&&c.OsfManifestManager.cacheManifest(t.getMarketplaceID(),t.getMarketplaceVersion(),t);var n={id:t.getMarketplaceID(),targetType:t.getTarget(),appVersion:t.getMarketplaceVersion(),currentStoreType:c.StoreType.Registry,storeId:"developer",assetId:t.getMarketplaceID(),assetStoreId:c.StoreType.Registry,width:t.getDefaultWidth()||0,height:t.getDefaultHeight()||0,isAddinCommands:t._isAddinCommandsManifest(c.getManifestHostType(a._hostType))};s.UploadFileDevCatalogUsageHelper.LogUploadFileDevCatalogUsageAction(this._appCorrelationId,n.currentStoreType,n.id,n.appVersion,n.targetType,n.isAddinCommands,n.width,n.height),a._notifyHost("0",c.AgaveHostAction.InsertAgave,n)},d=function(e){alert("Error when requesting manifest file: "+e)},u=document.createElement("input");u.setAttribute("type","button"),u.setAttribute("id","devcat-insert-button"),u.setAttribute("value","Insert"),u.setAttribute("class","WACButton WACDialogButtonNormal"),c.OUtil.addEventListener(u,"click",(function(){c.OUtil.xhrGet(a._devCatalogUrl+"/"+i.value,l,d)})),o.appendChild(u),e.appendChild(o)},launchInsertDialog:function(e,t,n){var r=null,o="100%";0!=e.childNodes.length&&e.removeChild(e.childNodes.item(0));var i,a=c.OUtil.Guid.generateNewGuid(),l=new p.InsertDialogTelemetryContext(a);if(this._enableDevCatalog){(i=document.createElement("div")).style.width=o,i.style.height="80%",e.appendChild(i);var d=document.createElement("div");d.style.width=o,d.style.height="20%",e.appendChild(d),this.openInputUrlDialog(d)}else i=e;var u=this;u._insertDialogDiv=i;var f=document.createElement("div");f.style.width=o,f.style.height=o,f.style.backgroundImage="url("+u.getLocalizedImageFilePath("progress.gif")+")",f.style.backgroundRepeat="no-repeat",f.style.backgroundPosition="center",i.appendChild(f);!function(e,t){if(u._enableMyOrg)try{c.OUtil.validateParamObject(e,{webUrl:{type:String,mayBeNull:!1}},t);u.isMyOrgReady((function(n){n.isReady?(e.clientEndPoint=n.clientEndPoint,p.CatalogFactory.resolve(c.StoreType.SPCatalog).getSPCatalogUrl(l,(function(n){t({statusCode:n.status,value:n.value,context:e})}))):t({statusCode:c.InvokeResultCode.E_GENERIC_ERROR,value:r,context:e})}))}catch(n){return s.RuntimeTelemetryHelper.LogExceptionTag("Error when getting corporate catalog url:",n,this._appCorrelationId,34719254),void t({statusCode:c.InvokeResultCode.E_GENERIC_ERROR,value:r,context:e})}else t({statusCode:c.InvokeResultCode.E_CATALOG_NO_APPS,value:r,context:e})}({webUrl:u._spBaseUrl},(function(e){var a=document.createElement("iframe");a.setAttribute("id","InsertDialog"),a.setAttribute("src","about:blank"),a.setAttribute("width",o),a.setAttribute("height",o),a.setAttribute("marginHeight","0"),a.setAttribute("marginWidth","0"),a.setAttribute("frameBorder","0"),a.setAttribute("sandbox","allow-scripts allow-forms allow-same-origin ms-allow-popups allow-popups"),"undefined"!=typeof Strings&&Strings&&Strings.OsfRuntime&&a.setAttribute("title",Strings.OsfRuntime.L_InsertionDialogTile_TXT);var l=r,d=[];u.isStoreDisabled((function(o){var p="WFEVersion",f='"}',m='], "url":"',g=",";u._hostAllowedOfficeStore||(o.value=!0);var v='{ "IsUploadFileDevCatalogEnabled":'+u._enableUploadFileDevCatalog+g+'"isStoreDisabled":'+o.value+g+'"showSignOutFromPrivateCatalogMessage":'+u._showSignOutFromPrivateCatalogMessage+g+'"enableInsertDialogAccessibilityFix":'+u._enableInsertDialogAccessibilityFix+g+'"isBlackForestRedirectEnabled":'+u._enableBlackForestRedirect+g+'"isHostDocumentDomain":'+u._isHostDocumentDomain+g+'"agaveAddinUploadEnabled":'+u._agaveAddinUploadEnabled+" }";if(u.isExternalMarketplaceAllowed()){var h='{ "provValues":[0,0,0,'+(u._enableMyApps?c.InvokeResultCode.S_OK.toString():c.InvokeResultCode.S_HIDE_PROVIDER.toString())+m+u._osfOmexBaseUrl+'", "client":"'+u._getClientNameForOmex()+'", "'+c.OmexPageParameterKeys.AuthType+'":'+u._getAuthTypeForHideAppsExtensionUrl()+"}";d.push('"myApp":'+h),s.RuntimeTelemetryHelper.LogCommonMessageTag("isExternalMarketplaceAllowed is true, myApp tab show firstly.",u._contextMgrCorrelationId,20194266)}if(e&&e.value!=r){if(u._enableMyOrg){u._myOrgCatalogUrl=e.value;var y='{ "provValues":[1,1,0,'+e.statusCode+m+e.value+f;d.push('"myOrg":'+y)}if(u._enableOneDriveCatalog&&-1!=document.cookie.indexOf("OneDriveCatalog=true")){u._myOneDriveCatalogUrl=e.value;var C='{ "provValues":[9,9,0,0], "url":"'+e.value+f;d.push('"myOneDrive":'+C)}}if(u._enablePrivateCatalog){var _='{"provValues":[10,10,0,0], "client":"'+u._getClientNameForOmex()+f;d.push('"privateCatalog":'+_)}d.length>0&&(l="{"+d.join(", ")+"}"),u._internalConversationId&&u._serviceEndPointInternal.unregisterConversation(u._internalConversationId);var S=u.getClientId()+"_"+u.getDocUrl(),A=c.OUtil.getFrameName(S),I=c.OUtil.generateConversationId();u._internalConversationId=c.OUtil.generateConversationId(),a.setAttribute("name",A);var T=r;n!=r&&(T='{ "navigationMode":'+n.navigationMode+', "navigationModeParameter": "'+n.assetId+'", "category":"'+n.category+f);var O=window.location.origin,x="",E=[I,encodeURIComponent(O),u._appVersion,c.getAppVerCode(u._appName),u.getLcid(),c.Constants.FileVersion,encodeURIComponent(l),t,encodeURIComponent(v),encodeURIComponent(T),u._contextMgrCorrelationId],b=c.Constants.FileVersion;try{var M=JSON.parse(u._sessionStartInfoJson);if("string"!=typeof M[p])throw new Error("WFEVersion is unavailable in session start info.");b=M[p]}catch(e){s.RuntimeTelemetryHelper.LogExceptionTag("Could not get the web frontend version.",e,u._contextMgrCorrelationId,570770309)}x=u._localizedResourcesUrl?u._localizedResourcesUrl+"WefGallery.htm?b="+encodeURIComponent(b):u._pageBaseUrl+u.getLcid()+"/WefGallery.htm?b="+encodeURIComponent(b);var R=c.OUtil.addXdmInfoAsHash(x,E.join("|"));R=c.OUtil.addFlightsAsHash(R,JSON.stringify(c.Flights)),u._serviceEndPointInternal.registerConversation(I,R),a.setAttribute("src",R),u._insertDialogDiv?(0!=i.childNodes.length&&i.removeChild(i.childNodes.item(0)),i.appendChild(a)):(i.insertBefore(a,i.firstChild),u._insertDialogDiv=i)}))}))},activateAgavesBlockedBySandboxNotSupport:function(){for(var e in this._cachedOsfControls){var t=this._cachedOsfControls[e];t._status===c.OsfControlStatus.NotSandBoxSupported&&t.activate()}},setRequirementsChecker:function(e){this._requirementsChecker=e},getRequirementsChecker:function(){return this._requirementsChecker},appHasNotifications:function(e){return!!this._ErrorUXHelper&&this._ErrorUXHelper.appHasNotifications(e)},refreshOsfControl:function(e,t){var n=this;for(var r in n._cachedOsfControls)if(n._cachedOsfControls[r]&&e==n._cachedOsfControls[r]._marketplaceID&&t==n._cachedOsfControls[r]._sourceLocationOverrideResourceId){n._cachedOsfControls[r].refresh();break}},isAddinActivated:function(e){for(var t in this._cachedOsfControls)if(this._cachedOsfControls[t]&&e==this._cachedOsfControls[t]._marketplaceID)return!0;return!1},_doesUrlHaveSupportedProtocol:function(e){var t=!1;e&&(t=null!=decodeURIComponent(e).match(/^https?:\/\/.+$/gi));return t},_loadLocaleString:function(e){var t=this;if("undefined"!=typeof Strings&&Strings&&Strings.OsfRuntime){for(var n=t._localeStringLoadingPendingCallbacks.length,r=0;r<n;r++){t._localeStringLoadingPendingCallbacks.shift()()}e()}else{t._localeStringLoadingPendingCallbacks.push(e);var o=t._localeStringLoadingPendingCallbacks;if(1===o.length){t._loadStringScript((function(){for(var e=o.length,t=0;t<e;t++){var n=o.shift();"function"==typeof n&&n()}}))}}},_loadStringScript:function(e){var t=this,n=this.getLocalizedScriptsUrl();n+=c.Constants.StringResourceFile;var r=0,o=function(){var i=null;if("undefined"!=typeof Strings&&Strings&&Strings.OsfRuntime){if(r>0){a=c.OUtil.formatString("osfruntime_strings loaded after {0} retries.",r);s.RuntimeTelemetryHelper.LogExceptionTag(a,i,i,20306077)}e()}else{if(++r<3)return void setTimeout((function(){c.OUtil.loadScript(n,o)}),750*r);t._localeStringLoadingPendingCallbacks.length=0;var a=c.OUtil.formatString("The locale, {0}, provided by the host app is not supported. Url: {1}",t.getLcid(),n);s.RuntimeTelemetryHelper.LogExceptionTag(a,i,i,20306076)}};c.OUtil.loadScript(n,o)},_getServiceEndPoint:function(){return this._serviceEndPoint},_getOmexEndPointPageUrl:function(e,t){return c.OUtil.formatString("{0}/{1}/downloads/{2}.aspx",this._omexEndPointBaseUrl,t,e)},_getManifestAndTargetByConversationId:function(e){for(var t in this._cachedOsfControls){var n=this._cachedOsfControls[t];if(e===n._getConversationId()){var r=n.getStoreType()==c.StoreType.FirstParty?"":n.getMarketplaceVersion();return{manifest:n.getManifest()||c.OsfManifestManager.getCachedManifest(n.getMarketplaceID()),version:r,target:n.getOsfControlType()}}}return null},_createSharePointIFrameProxy:function(e,t){var n=null,r=this;if(r._doesUrlHaveSupportedProtocol(e)){var o=e.length;"/"===e.charAt(o-1)&&(e=e.substr(0,o-1));var i=r._iframeProxies[e];if(i)i.isReady?t(i.clientEndPoint):i.pendingCallbacks.push(t);else{var a=c.OUtil.generateConversationId(),l=document.createElement("iframe");r._iframeProxyCount=r._iframeProxyCount+1;var d=r._iframeNamePrefix+r._iframeProxyCount;l.setAttribute("id",d),l.setAttribute("name",d);var u=e+"/_layouts/15/OfficeExtensionManager.aspx?"+a,p=window.location.origin;u=c.OUtil.addXdmInfoAsHash(u,a+"|"+d+"|"+p),u=c.OUtil.addSerializerVersionAsHash(u,c.SerializerVersion.Browser),u=c.OUtil.addFlightsAsHash(u,JSON.stringify(c.XdmFlights)),l.setAttribute("scrolling","auto"),l.setAttribute("border","0"),l.setAttribute("width","0"),l.setAttribute("height","0"),l.setAttribute("style","position: absolute; left: -100px; top:0px;"),l.setAttribute("title",Strings.OsfRuntime.L_AddinsCatalogIframeTitle_TXT);var f=r,m=function(t,r){var o,i=f._iframeProxies[e];if(i&&0===t&&r.status?(i.isReady=!0,o=i.clientEndPoint):(delete f._iframeProxies[e],Microsoft.Office.Common.XdmCommunicationManager.getClientEndPoint(a)?(Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(a),c.OUtil.removeEventListener(l,"load",g),l.parentNode.removeChild(l)):s.RuntimeTelemetryHelper.LogExceptionTag("Unexpected error occured with SharePoint proxy.",n,n,19203550),o=n),i)for(var d=i.pendingCallbacks.length,u=0;u<d;u++){i.pendingCallbacks.shift()(o)}},g=function(){f._iframeProxies[e]&&(f._iframeProxies[e].clientEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(a,l.contentWindow,e),f._iframeProxies[e].clientEndPoint.invoke("OEM_isProxyReady",m,{__timeout__:2e3}))};document.body.appendChild(l),c.OUtil.addEventListener(l,"load",g),l.setAttribute("src",u),r._iframeProxies[e]={clientEndPoint:n,isReady:!1,pendingCallbacks:[t]}}}else t(n)},_getClientVersionForOmex:function(){if(this._appVersion){var e=this._appVersion.split("."),t=parseInt(e[0],10),n=parseInt(e[1],10)||0;if(!(t<=15&&n<=0)){var r=c.Constants.FileVersion.split(".");return t+"."+n+"."+r[2]+"."+r[3]}}},_getClientNameForOmex:function(){return c.OmexClientNames[this._appName]},_getAppVersionForOmex:function(){return c.OmexAppVersions[this._appName]},_setCachedFlag:function(e){var t=c.OUtil.getLocalStorage();t&&t.setItem(e,"true")},_getCachedFlag:function(e){var t=c.OUtil.getLocalStorage();if(t)return!!t.getItem(e)},_deleteCachedFlag:function(e){var t=c.OUtil.getLocalStorage();t&&t.removeItem(e)},_getAuthTypeForHideAppsExtensionUrl:function(){var e=c.OUtil.getQueryStringParamValue(this._hideAppsExtensionUrl,c.OmexPageParameterKeys.AuthType);return e||c.AuthType.Anonymous},isAddinCommandsAsync:function(e,t){var n=null,r=!1;c.OUtil.validateParamObject(e,{marketplaceId:{type:String,mayBeNull:r},marketplaceVersion:{type:String,mayBeNull:r},storeType:{type:String,mayBeNull:r},storeId:{type:String,mayBeNull:r},targetData:{type:Object,mayBeNull:r},clearCache:{type:Boolean,mayBeNull:!0}},n);var o=e.storeType.toLowerCase(),i={contextActivationMgr:n,referenceInUse:n},a=e.clearCache||r;try{c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?i.referenceInUse={solutionId:e.marketplaceId,version:e.marketplaceVersion,storeType:e.storeType,storeId:e.storeId}:i.referenceInUse={id:e.marketplaceId,version:e.marketplaceVersion,storeType:e.storeType,storeLocator:e.storeId},i.contextActivationMgr=this;var l=function(o){o!=n&&o.statusCode==p.DataServiceResultCode.Succeeded&&o.value!=n?t(!0,o.value._isAddinCommandsManifest(c.getManifestHostType(i.contextActivationMgr._hostType)),e):t(r,r,e)};if(c.StoreType.OMEX===o||c.StoreType.UploadFileDevCatalog===o||c.StoreType.SPCatalog===o||c.StoreType.PrivateCatalog===o||c.StoreType.WopiCatalog===o){var d,u=p.CatalogFactory.resolve(o);d=c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?{assetId:i.referenceInUse.solutionId,storeType:o,storeId:i.referenceInUse.storeId,appVersion:i.referenceInUse.version,targetType:n}:{assetId:i.referenceInUse.id,storeType:o,storeId:i.referenceInUse.storeLocator,appVersion:i.referenceInUse.version,targetType:n};var f=c.OUtil.Guid.generateNewGuid(),m=new p.AddinCommandsTelemetryContext(f);u.getAndCacheManifest(d,d.storeId,m,(function(e){l({statusCode:e.status,value:e.value})}),a)}else t(!0,r,e)}catch(o){s.RuntimeTelemetryHelper.LogExceptionTag("Error for checking is addincommands or not",o,n,19203552),t(r,r,e)}},setOAuthManager:function(e){this._oAuthManager=e},getManifestInvaildErrorString:function(){return Strings.OsfRuntime.L_AddinCommands_AddinNotSupported_Message},getDevManifestInvalidUrlErrorString:function(e){return c.OUtil.formatString(Strings.OsfRuntime.L_DeveloperAddinManifestInvalidUrl_Message,e)},getUserNameHashCode:function(){return this._userNameHashCode},ownerAddinControlRecreated:function(e,t){for(var n in this._cachedOsfControls){var r=this._cachedOsfControls[n];r._ownerAddinAssetId&&r._ownerAddinStoreType&&r._ownerAddinAssetId==e&&r._ownerAddinStoreType==t&&r.setOwnerAddinControlRecreated(!0)}}},c.OsfControl=function(e){var t=null,n=!0,r=!1,o=this;e.solutionId=e.solutionId||e.marketplaceID,e.version=e.version||e.marketplaceVersion,e.storeId=e.storeId||e.store,e.ownerAddinSolutionId=e.ownerAddinSolutionId||e.ownerAddinAssetId,c.OUtil.validateParamObject(e,{div:{type:Object,mayBeNull:r},contextActivationMgr:{type:Object,mayBeNull:r},id:{type:String,mayBeNull:r},solutionId:{type:String,mayBeNull:r},version:{type:String,mayBeNull:r},storeType:{type:String,mayBeNull:r},storeId:{type:String,mayBeNull:r},assetId:{type:String,mayBeNull:n},assetStoreId:{type:String,mayBeNull:n},ownerAddinSolutionId:{type:String,mayBeNull:n},ownerAddinStoreType:{type:String,mayBeNull:n},settings:{type:Object,mayBeNull:n},reason:{type:String,mayBeNull:n},osfControlType:{type:Number,mayBeNull:n},snapshotUrl:{type:String,mayBeNull:n},preactivationCallback:{type:Object,mayBeNull:n},virtualOsfControlActivationCallback:{type:Object,mayBeNull:n},isvirtualOsfControl:{type:Boolean,mayBeNull:n},isDialog:{type:Boolean,mayBeNull:n},hostCustomMessage:{type:String,mayBeNull:n},isForUILessAction:{type:Boolean,mayBeNull:n},sourceLocationOverrideResourceId:{type:String,mayBeNull:n},sourceLocationOverrideUrl:{type:String,mayBeNull:n},focusOnIframeWhenLoaded:{type:Boolean,mayBeNull:n},featureGates:{type:Object,mayBeNull:n},hostInfoFlags:{type:Number,mayBeNull:n},sharedRuntimeId:{type:String,mayBeNull:n},initialDisplayMode:{type:Number,mayBeNull:n},exchangeExtensionProviderName:{type:String,mayBeNull:n},exchangeExtensionType:{type:String,mayBeNull:n},marketplaceID:{type:String,mayBeNull:n},marketplaceVersion:{type:String,mayBeNull:n},store:{type:String,mayBeNull:n},alternateReference:{type:Object,mayBeNull:n},ownerAddinAssetId:{type:String,mayBeNull:n}},t),o._div=e.div,o._sourceLocationOverrideResourceId=e.sourceLocationOverrideResourceId,o._sourceLocationOverrideUrl=e.sourceLocationOverrideUrl,o._contextActivationMgr=e.contextActivationMgr,o._id=e.id,o._solutionId=e.solutionId,o._version=e.version,o._storeId=e.storeId,o._storeType=e.storeType.toLowerCase(),o._assetId=e.assetId,o._assetStoreId=e.assetStoreId,o._ownerAddinSolutionId=e.ownerAddinSolutionId||t,o._ownerAddinStoreType=e.ownerAddinStoreType||t,o._marketplaceID=o._solutionId,o._marketplaceVersion=o._version,o._storeLocator=o._storeId,o._alternateReference=e.alternateReference,o._ownerAddinAssetId=o._ownerAddinSolutionId,o._settings=e.settings||{},o._reason=null==e.reason?Microsoft.Office.WebExtension.InitializationReason.DocumentOpened:e.reason,o._osfControlType=null==e.osfControlType?c.OsfControlType.DocumentLevel:e.osfControlType,o._snapshotUrl=e.snapshotUrl,o._status=c.OsfControlStatus.NotActivated,o._iframeIsLoaded=r,o._iframeLoadedNotified=r,o._notificationParams=[],o._iframeUrl=t,o._permission=t,o._conversationId=t,o._manifestUrl=t,o._pageStatus=c.OsfControlPageStatus.NotStarted,o._pageIsReadyTimerExpired=r,o._timer=t,o._retryLoadingNum=2,o._timer1=t,o._retryCheckingNum=2,o._autoRetryCheckingNum=2,o._frame=t,o._agaveEndPoint=t,o._etoken="",o._sqmDWords=[0,0],o._preactivationCallback=e.preactivationCallback,o._telemetryContext={},o._controlFocus=r,o._agavePageUrl=t,o._agaveWindowName=t,o._manifest=t,o._virtualOsfControlActivationCallback=e.virtualOsfControlActivationCallback,o._isvirtualOsfControl=null==e.isvirtualOsfControl?r:e.isvirtualOsfControl,o._isvirtualOsfControlCallbackInvoked=r,o._isManifestProcessedForCustomFunctions=r,o._processManifestForExtendedOverridesPromise=t,o._isDialog=null==e.isDialog?r:e.isDialog,o._hostCustomMessage=e.hostCustomMessage,o._isUpgrading=r,o._isUpgradingFailed=r,o._focusOnIframeWhenLoaded=null==e.focusOnIframeWhenLoaded?r:e.focusOnIframeWhenLoaded,o._featureGates=e.featureGates||{},o._hostInfoFlags="number"==typeof e.hostInfoFlags?e.hostInfoFlags:0,o._sharedRuntimeId=null==e.sharedRuntimeId?t:e.sharedRuntimeId,o._initialDisplayMode=null==e.initialDisplayMode?0:e.initialDisplayMode,o._appContextIsSetToIframeName=r,o._sdxTelemetryContext={},o._contextActivationMgr._enableServiceDeliveredExperience&&(o._bundleUrl=t,o._sdxIframeTemplateUrl="https://osf-agave/rtm/sdx/index.html"),o._isUILessAddInCommands=!!e.isForUILessAction,c.OUtil.isiOS()&&(o._div.style.webkitOverflowScrolling="touch",o._div.style.overflow="auto"),o._appCorrelationId=o._contextActivationMgr._contextMgrCorrelationId||c.OUtil.Guid.generateNewGuid(),o._iframeOnLoadDelegate=Function.createDelegate(o,o._iframeOnLoad),o._retryActivate=t,o._onKeyDownEventDelegate=Function.createDelegate(o,o._onKeydownEvent),o._ownerAddinControlRecreated=r,o._exchangeExtensionProviderName=e.exchangeExtensionProviderName,o._exchangeExtensionType=e.exchangeExtensionType},c.OsfControl.isFirstPartyStoreString=function(e){if(e){var t=e.toLowerCase();return t===c.StoreType.FirstParty||t===c.StoreType.Sdx}return!1},c.OsfControl.isFirstPartyStoreEnum=function(e){return!!e&&(e==c.StoreTypeEnum.FirstParty||e==c.StoreTypeEnum.Sdx)},c.OsfControl.prototype={activate:function(e){var t=null,n=this;if(n._status!==c.OsfControlStatus.Activated)if(n._contextActivationMgr.registerOsfControl(n),c.OUtil.addEventListener(n._div,"keydown",n._onKeyDownEventDelegate),(e=e||{}).hostType=n._contextActivationMgr._hostType,e.osfControl=e.osfControl||n,c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?e.referenceInUse=e.referenceInUse||{solutionId:n._solutionId,version:n._version,storeType:n._storeType,storeId:n._storeId}:e.referenceInUse=e.referenceInUse||{id:n._solutionId,version:n._version,storeType:n._storeType,storeLocator:n._storeId},e.correlationId=e.osfControl._appCorrelationId,e.isInsertOsfControl=!!e.isInsertOsfControl&&e.isInsertOsfControl,1==e.isInsertOsfControl){if(!n._contextActivationMgr._hostAllowedSdxEmbedding||n._checkWopiHost(n._contextActivationMgr._enableWopiHostCheck))return void n.invokePreactivationCompletedCallback();var r=p.ManifestUtil.constructAddInId(n._solutionId,n._version,n._storeType,n._storeId),o=new c.AddinIdInfo(r);n._contextActivationMgr._enableMyOrg&&n._contextActivationMgr._spBaseUrl!=t&&n._contextActivationMgr._wacUpn==t&&s.RuntimeTelemetryHelper.LogCommonMessageTag("WAC UPN in Sharepoint is null, assetID:"+o.getPrivacyCompliantSolutionId(),n._contextActivationMgr._contextMgrCorrelationId,592852928),n._contextActivationMgr._enableUpnCheck&&n._contextActivationMgr._enableMyOrg&&n._contextActivationMgr._spBaseUrl!=t?(n._contextActivationMgr._wacUpn==t&&(s.RuntimeTelemetryHelper.LogCommonMessageTag("CheckUpnInSPO failed because WAC UPN is null, assetId: "+o.getPrivacyCompliantSolutionId(),n._contextActivationMgr._contextMgrCorrelationId,572926154),n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_SPO_NotSignIn_Error_ERR,t,t,t,t,t,t,c.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted)),n._contextActivationMgr._upnCheckResult===c.UpnCheckCode.NotMatch?(s.RuntimeTelemetryHelper.LogCommonMessageTag("CheckUpnInSPO failed, assetId: "+o.getPrivacyCompliantSolutionId(),n._contextActivationMgr._contextMgrCorrelationId,572926153),n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UntrustedHost_Error_ERR,t,t,t,t,t,t,c.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted)):n.activateInternal(e)):n.activateInternal(e)}else n.activateInternal(e);else n.invokePreactivationCompletedCallback()},activateInternal:function(e){var t=":/content?access_token=",n="/root:/Manifests/",r="ONO_Onboarding_CorrelationId :",o="isPreload",i="sourceLocationOverrideResourceId",a="Microsoft.Office.OEP.FA000000059.SourceLocationOverrideResourceId",l=!0,d=null,u=this,f=u;try{if(!u._doesBrowserSupportRequiredFeatures())return u._contextActivationMgr._enableFirstPartySDXErrorMessages&&u.isFirstParty()?u._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnsupportedBroswer_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(u,u._refresh),d,d,d,l,c.ErrorStatusCodes.E_BROWSER_VERSION):u._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveUnsupportedBroswer_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(u,u._refresh),d,d,d,l,c.ErrorStatusCodes.E_BROWSER_VERSION),void u.invokePreactivationCompletedCallback();var m=document.createElement("iframe"),g="sandbox"in m;m=d;var v=!1,h=c.OUtil.getLocalStorage();if(h&&(v=h.getItem(c.Constants.IgnoreSandBoxSupport)),u._contextActivationMgr._autoTrusted&&!g&&!v)return u._contextActivationMgr._ErrorUXHelper.removeProgressDiv(u._div,u._id),u._status=c.OsfControlStatus.NotSandBoxSupported,u._contextActivationMgr._enableFirstPartySDXErrorMessages&&u.isFirstParty()?u._contextActivationMgr.displayNotification({id:u._id,infoType:c.InfoType.Warning,title:Strings.OsfRuntime.L_AppsDisabled_WRN_FirstParty,description:Strings.OsfRuntime.L_NotSandBoxSupported_ERR_FirstParty,icon:d,buttonTxt:Strings.OsfRuntime.L_EnableAppsButton_TXT_FirstParty,buttonCallback:Function.createCallback(u._activateAgavesBlockedBySandboxNotSupport,u._contextActivationMgr),url:c.Constants.IEUpgradeUrl,urlButtonTxt:Strings.OsfRuntime.L_UpgradeBrowserButton_TXT,dismissCallback:d,reDisplay:l,displayDeactive:l,errorCode:c.ErrorStatusCodes.WAC_HTML5IframeSandboxNotSupport,highPriority:l}):u._contextActivationMgr.displayNotification({id:u._id,infoType:c.InfoType.Warning,title:Strings.OsfRuntime.L_AppsDisabled_WRN,description:Strings.OsfRuntime.L_NotSandBoxSupported_ERR,icon:d,buttonTxt:Strings.OsfRuntime.L_EnableAppsButton_TXT,buttonCallback:Function.createCallback(u._activateAgavesBlockedBySandboxNotSupport,u._contextActivationMgr),url:c.Constants.IEUpgradeUrl,urlButtonTxt:Strings.OsfRuntime.L_UpgradeBrowserButton_TXT,dismissCallback:d,reDisplay:l,displayDeactive:l,errorCode:c.ErrorStatusCodes.WAC_HTML5IframeSandboxNotSupport,highPriority:l}),void u.invokePreactivationCompletedCallback();u.startActivate();var y=u,C=e.referenceInUse,_="1B4CD97F-DBFE-4C1A-B4C4-FC163B4F9693";if(C.storeType===c.StoreType.OMEX||C.storeType===c.StoreType.UploadFileDevCatalog||C.storeType===c.StoreType.SPCatalog||C.storeType===c.StoreType.PrivateCatalog||C.storeType===c.StoreType.FirstParty||C.storeType===c.StoreType.Sdx||C.storeType===c.StoreType.WopiCatalog){var S=new p.OsfControlLoader(u,e.hasConsent),A=new p.ActivationTelemetryContext(u.getCorrelationId(),u._telemetryContext,u._sqmDWords[0],u._sqmDWords[1],u._id);if(C.storeType===c.StoreType.Sdx)if(c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)){if(C.solutionId.toLowerCase()===c.SdxAssetIds.ExperimentationSdx)(I=u._contextActivationMgr._flightingTreatmentVariables[a])!=d&&(u._sourceLocationOverrideResourceId=I),u._sdxTelemetryContext[i]=u._sourceLocationOverrideResourceId;1==u._initialDisplayMode&&(u._sdxTelemetryContext[o]=l),p.SDXCatalog.activateAsync({assetId:C.solutionId,storeId:C.storeId,appVersion:C.version,storeType:C.storeType,targetType:""},S,A,u._contextActivationMgr.getRequirementsChecker(),{clientId:u._contextActivationMgr._loggableUserId,sessionStartInfoJson:u._contextActivationMgr._sessionStartInfoJson},u._sdxTelemetryContext)}else{var I;if(C.id.toLowerCase()===c.SdxAssetIds.ExperimentationSdx)(I=u._contextActivationMgr._flightingTreatmentVariables[a])!=d&&(u._sourceLocationOverrideResourceId=I),u._sdxTelemetryContext[i]=u._sourceLocationOverrideResourceId;1==u._initialDisplayMode&&(u._sdxTelemetryContext[o]=l),p.SDXCatalog.activateAsync({assetId:C.id,storeId:C.storeLocator,appVersion:C.version,storeType:C.storeType,targetType:""},S,A,u._contextActivationMgr.getRequirementsChecker(),{clientId:u._contextActivationMgr._loggableUserId,sessionStartInfoJson:u._contextActivationMgr._sessionStartInfoJson},u._sdxTelemetryContext)}else{var T=e.noTargetType||e.osfControl.getOsfControlType()===c.OsfControlTarget.TaskPane?d:e.osfControl.getOsfControlType(),O=p.CatalogFactory.resolve(C.storeType);c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?O.activateAsync({assetId:C.solutionId,storeId:C.storeId,appVersion:C.version,storeType:C.storeType,targetType:C.storeType===c.StoreType.SPCatalog?T:""},S,A):O.activateAsync({assetId:C.id,storeId:C.storeLocator,appVersion:C.version,storeType:C.storeType,targetType:C.storeType===c.StoreType.SPCatalog?T:""},S,A)}return void u.invokePreactivationCompletedCallback()}if(c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?C.solutionId===_&&s.RuntimeTelemetryHelper.LogCommonMessageTag(r+u.getCorrelationId(),d,23381916):C.id===_&&s.RuntimeTelemetryHelper.LogCommonMessageTag(r+u.getCorrelationId(),d,544219483),s.AppLoadTimeHelper.ActivationStart(u._telemetryContext,u._sqmDWords[0],u._sqmDWords[1],u.getCorrelationId(),u._id,c.ActivationTypes.V2Enabled),s.AppLoadTimeHelper.ServerCallStart(u._telemetryContext),C.storeType===c.StoreType.Exchange||C.storeType===c.StoreType.InMemory)c.OsfManifestManager.getManifestAsync(e,(function(e){e.statusCode===c.ProxyCallStatusCode.Succeeded&&e.value&&!f._etoken&&(f._etoken=e.value.getInMemoryEToken()||""),f._onGetManifestCompleted(e)}));else if(C.storeType===c.StoreType.Registry&&u._contextActivationMgr._enableDevCatalog||C.storeType===c.StoreType.HardCodedPreinstall)if(e.osfControl.getReason()==Microsoft.Office.WebExtension.InitializationReason.DocumentOpened||C.storeType===c.StoreType.Registry&&u._contextActivationMgr._enableDevCatalog&&!c.OsfManifestManager.hasManifestForControl(e)){var x=function(t){var n=new c.Manifest.Manifest(t,y._contextActivationMgr.getAppUILocale());if(e.osfControl!=d&&e.osfControl._sharedRuntimeId!=d&&e.osfControl._sharedRuntimeId.length>0){var r=c.OsfManifestManager.getSharedRuntimeManifestCacheKey(e.osfControl._solutionId,e.osfControl._sharedRuntimeId);!c.OsfManifestManager.hasManifest(r,e.osfControl._version)&&c.OsfManifestManager.cacheManifest(r,e.osfControl._version,n)}!c.OsfManifestManager.hasManifest(n.getMarketplaceID(),n.getMarketplaceVersion())&&c.OsfManifestManager.cacheManifest(n.getMarketplaceID(),n.getMarketplaceVersion(),n),c.OsfManifestManager.getManifestAsync(e,Function.createDelegate(y,y._onGetManifestCompleted))},E=function(e){alert("Error when requesting manifest file: "+e)};c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?c.OUtil.xhrGet(u._contextActivationMgr._devCatalogUrl+"/"+C.solutionId+".xml",x,E):c.OUtil.xhrGet(u._contextActivationMgr._devCatalogUrl+"/"+C.id+".xml",x,E)}else{if(e.osfControl!=d&&e.osfControl._sharedRuntimeId!=d&&e.osfControl._sharedRuntimeId.length>0){var b=c.OsfManifestManager.getSharedRuntimeManifestCacheKey(e.osfControl._solutionId,e.osfControl._sharedRuntimeId);if(!c.OsfManifestManager.hasManifest(b,e.osfControl._version)){var M=c.OsfManifestManager.getCachedManifest(e.osfControl._solutionId,e.osfControl._version);c.OsfManifestManager.cacheManifest(b,e.osfControl._version,M)}}c.OsfManifestManager.getManifestAsync(e,Function.createDelegate(u,u._onGetManifestCompleted))}else if(C.storeType===c.StoreType.OneDrive&&u._contextActivationMgr._enableOneDriveCatalog){var R,P=function(t){var n=new c.Manifest.Manifest(t,y._contextActivationMgr.getAppUILocale());c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?c.OsfManifestManager.cacheManifest(C.solutionId,n.getMarketplaceVersion(),n):c.OsfManifestManager.cacheManifest(C.id,n.getMarketplaceVersion(),n),c.OsfManifestManager.getManifestAsync(e,Function.createDelegate(y,y._onGetManifestCompleted))},N=function(){y._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(y,y._refresh),d,d,d,d,c.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},U=window.location.protocol+"//"+window.location.host;c.OneDriveOAuth.setHostCallbackUri(U),R=c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?u._contextActivationMgr._oneDriveCatalogBaseApiUrl+n+C.solutionId+t:u._contextActivationMgr._oneDriveCatalogBaseApiUrl+n+C.id+t;c.OneDriveOAuth.getAccessToken((function(e){R+=e,c.OUtil.xhrGet(R,P,N)}),(function(){y._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(y,y._refresh),d,d,d,d,c.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)}))}else C.storeType===c.StoreType.SPApp?(s.AppLoadTimeHelper.EntitlementCheckStart(u._telemetryContext),e.baseUrl=u._contextActivationMgr.getPageBaseUrl(),e.pageUrl=u._contextActivationMgr._docUrl,e.webUrl=u._contextActivationMgr._webUrl,e.appWebUrl=u._contextActivationMgr._webUrl,c.OsfManifestManager.getSPAppEntitlementsAsync(e,Function.createDelegate(u,u._onGetEntitlementsCompleted))):C.storeType===c.StoreType.FileSystem||C.storeType===c.StoreType.Registry||C.storeType===c.StoreType.HardCodedPreinstall?u._showActivationWarning(c.OsfControlStatus.UnsupportedStore,Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,d,d,d,d,c.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType):C.storeType===c.StoreType.OneDrive?u._showActivationWarning(c.OsfControlStatus.UnsupportedStore,Strings.OsfRuntime.L_AgaveUnsupportedStoreType_ERR,d,d,d,d,c.ErrorStatusCodes.WAC_AgaveUnsupportedStoreType):u._showActivationError(c.OsfControlStatus.UnknownStore,Strings.OsfRuntime.L_AgaveUnknownStoreType_ERR,d,d,d,d,d,d,c.ErrorStatusCodes.E_MANIFEST_REFERENCE_INVALID)}catch(e){var F="Error getting app data.";p.WACUtils.logExceptionToBrowserConsole(F,e),s.RuntimeTelemetryHelper.LogExceptionTag(F,e,u.getCorrelationId(),18420419),u._contextActivationMgr._enableFirstPartySDXErrorMessages&&u.isFirstParty()?u._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(u,u._refresh),d,d,d,d,c.ErrorStatusCodes.WAC_AgaveOsfControlActivationError):u._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(u,u._refresh),d,d,d,d,c.ErrorStatusCodes.WAC_AgaveOsfControlActivationError)}u.invokePreactivationCompletedCallback()},createIframeForDialogControl:function(e,t,n){for(var r=this;r._div.childNodes.length>0;)r._div.removeChild(r._div.childNodes.item(0));var o=r._createIframeForControl(e);r._iframeUrl=t,r._appDomains=n,r._setIframeAttribute(o,t),r._div.appendChild(o),r._contextActivationMgr.registerOsfControl(r)},deActivate:function(){var e=null,t=this;try{if(c.OUtil.writeProfilerMark(c.OsfControlActivationPerfMarker.DeactivationStart),t._contextActivationMgr.dismissMessages(t._id),t._retryActivate=e,t._status!==c.OsfControlStatus.NotActivated){for(t._agaveEndPoint&&(Microsoft.Office.Common.XdmCommunicationManager.deleteClientEndPoint(t._agaveEndPoint._conversationId),t._agaveEndPoint=e),t._frame&&(c.OUtil.removeEventListener(t._frame,"load",t._iframeOnLoadDelegate),t._frame=e),t._timer&&(window.clearTimeout(t._timer),t._timer=e);t._div.childNodes.length>0;)t._div.removeChild(t._div.childNodes.item(0));t._status=c.OsfControlStatus.NotActivated,t._conversationId&&t._contextActivationMgr._getServiceEndPoint().unregisterConversation(t._conversationId),t._contextActivationMgr.raiseOsfControlStatusChange(t)}t._controlFocus=!1,c.OUtil.removeEventListener(t._div,"keydown",t._onKeyDownEventDelegate),t._iframeIsLoaded=!1,t._iframeLoadedNotified=!1,c.OUtil.writeProfilerMark(c.OsfControlActivationPerfMarker.DeactivationEnd)}catch(e){var n="Deactivate failed.";p.WACUtils.logExceptionToBrowserConsole(n,e),s.RuntimeTelemetryHelper.LogExceptionTag(n,e,t.getCorrelationId(),18420420)}},startActivate:function(){var e=this;for(e._controlFocus=!0,e._pageStatus=c.OsfControlPageStatus.Loading,e._sdxTelemetryContext={activationStart:performance.now(),performanceTimestampOrigin:Date.now()-performance.now(),osfControlId:e._id},c.OUtil.writeProfilerMark(c.OsfControlActivationPerfMarker.ActivationStart),e._frame&&(c.OUtil.removeEventListener(e._frame,"load",e._iframeOnLoadDelegate),e._frame=null);e._div.childNodes.length>0;)e._div.removeChild(e._div.childNodes.item(0));e._contextActivationMgr._ErrorUXHelper.showProgress(e._div,e._id)},refresh:function(){this._refresh()},_restartActivate:function(){this.deActivate(),this.startActivate(),this.invokePreactivationCompletedCallback()},purge:function(e){var t=this,n=Function._validateParams(arguments,[{name:"purgeManifest",type:Boolean,mayBeNull:!1}]);if(n)throw n;try{t._contextActivationMgr._ErrorUXHelper.purgeOsfControlNotification(t._id),t.deActivate(),e&&c.OsfManifestManager.purgeManifest(t._solutionId,t._version),t._contextActivationMgr.unregisterOsfControl(t)}catch(e){var r="Purge failed.";p.WACUtils.logExceptionToBrowserConsole(r,e),s.RuntimeTelemetryHelper.LogExceptionTag(r,e,t.getCorrelationId(),18420421)}},invokeVirtualOsfControlActivationCallback:function(e){var t=this;try{t._virtualOsfControlActivationCallback&&(t._virtualOsfControlActivationCallback(t,e),t._isvirtualOsfControlCallbackInvoked=!0)}catch(e){var n="invokeVirtualOsfControlActivationCallback failed.";p.WACUtils.logExceptionToBrowserConsole(n,e),s.RuntimeTelemetryHelper.LogExceptionTag(n,e,t.getCorrelationId(),36496280)}},ensureToGetVirtualOsfControlManifest:function(e){var t=null,n=this,r=n;if(n._manifest)e(n._manifest);else{var o={assetId:n._solutionId,appVersion:n._version,storeType:n._storeType,storeId:n._storeId,targetType:t},i=function(n){var o=t;n.status===p.DataServiceResultCode.Succeeded&&n.value?o=n.value:r._status=c.OsfControlStatus.ActivationFailed,e(o)},a=p.CatalogFactory.resolve(o.storeType);a!=t?a.getAndCacheManifest(o,n._storeId,new p.AddinCommandsTelemetryContext(n.getCorrelationId()),i):(alert("AddinCommands is not supported in "+o.storeType+" store."),i({status:p.DataServiceResultCode.Failed,value:t}))}},invokePreactivationCompletedCallback:function(){this._preactivationCallback&&this._preactivationCallback()},getSolutionId:function(){return this._solutionId},getMarketplaceID:function(){return this._solutionId},getVersion:function(){return this._version},getMarketplaceVersion:function(){return this._version},getContainingDiv:function(){return this._div},getID:function(){return this._id},getSettings:function(){return this._settings},setSettings:function(e){this._settings=e},getReason:function(){return this._reason==Microsoft.Office.WebExtension.InitializationReason.DocumentOpened?Microsoft.Office.WebExtension.InitializationReason.DocumentOpened:Microsoft.Office.WebExtension.InitializationReason.Inserted},getInitializationReason:function(){return this._reason},getManifest:function(){return this._manifest},getOsfControlType:function(){return this._osfControlType},getSharedRuntimeId:function(){return this._sharedRuntimeId},getSnapshotUrl:function(){return this._snapshotUrl},getStoreType:function(){return this._storeType},isFirstParty:function(){return c.OsfControl.isFirstPartyStoreString(this._storeType)},hostInfoFlags:function(){return this._hostInfoFlags},updateAgaveEndPointTargetUrl:function(e){this.ensureAgaveEndPoint(),this._agaveEndPoint&&(this._agaveEndPoint._targetUrl=e)},getStoreId:function(){return this._storeId},getStoreLocator:function(){return this._storeId},getHostCustomMessage:function(){return this._hostCustomMessage},getProperty:function(e){var t=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1}]);if(t)throw t;return this._settings[e]},addProperty:function(e,t){var n=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1},{name:"value",type:String,mayBeNull:!1}]);if(n)throw n;this._settings[e]=t},removeProperty:function(e){var t=Function._validateParams(arguments,[{name:"name",type:String,mayBeNull:!1}]);if(t)throw t;delete this._settings[e]},getStatus:function(){return this._status},getPageStatus:function(){return this._pageStatus},checkAppDomains:function(e){var t=Microsoft.Office.Common.XdmCommunicationManager.checkUrlWithAppDomains(this._appDomains,e);return t||this.isTargetSubdomainOfSourceLocation(e)},isTargetSubdomainOfSourceLocation:function(e){return Microsoft.Office.Common.XdmCommunicationManager.isTargetSubdomainOfSourceLocation(this._agavePageUrl,e)},getNotificationParams:function(){return this._notificationParams},removeFirstNotification:function(){this._notificationParams.shift()},getIframeUrl:function(){return this._iframeUrl},getPermission:function(){return this._permission},getTrustNoPrompt:function(){return!1},getEToken:function(){return this._etoken},getCorrelationId:function(){return this._appCorrelationId},getAgavePageUrl:function(){return this._agavePageUrl},getAgaveWindowName:function(){return this._agaveWindowName},notifyAgave:function(e,t){this._agaveEndPoint&&this._agaveEndPoint.invoke("Office_notifyAgave",null,[e,t])},sendMessageToSdx:function(e,t){this._agaveEndPoint&&this._agaveEndPoint.invoke("Office_sendMessageToSdx",t,e)},isUILessAddInCommands:function(){return this._isUILessAddInCommands},getOwnerAddinSolutionId:function(){return this._ownerAddinSolutionId},getOwnerAddinAssetId:function(){return this._ownerAddinSolutionId},getOwnerAddinStoreType:function(){return this._ownerAddinStoreType},getFeatureGates:function(){return this._featureGates},getOwnerAddinControlRecreated:function(){return this._ownerAddinControlRecreated},setOwnerAddinControlRecreated:function(e){this._ownerAddinControlRecreated=e},_onKeydownEvent:function(e){var t="input, button, a",n=this;if(e.preventDefault=e.preventDefault||function(){e.returnValue=!1},117==e.keyCode&&(e.ctrlKey||e.metaKey)){e.preventDefault(),e.stopPropagation();var r=c.AgaveHostAction.CtrlF6Exit;e.shiftKey&&(r=c.AgaveHostAction.CtrlF6ExitShift),n._contextActivationMgr._notifyHost(n._id,r)}else if(9==e.keyCode){e.preventDefault(),e.stopPropagation();var o=n._div.querySelectorAll(t);if(0==o.length)return;c.OUtil.focusToNextTabbable(o,e.target||e.srcElement,e.shiftKey)||(e.shiftKey?n._contextActivationMgr._notifyHost(n._id,c.AgaveHostAction.TabExitShift):n._agaveEndPoint?n.notifyAgave(c.AgaveHostAction.TabIn):n._contextActivationMgr._notifyHost(n._id,c.AgaveHostAction.TabExit))}else if(27==e.keyCode)e.preventDefault(),n._contextActivationMgr._notifyHost(n._id,c.AgaveHostAction.EscExit);else if(113==e.keyCode)e.preventDefault(),n._contextActivationMgr._notifyHost(n._id,c.AgaveHostAction.F2Exit);else if(13==e.keyCode||32==e.keyCode)for(var i=n._div.querySelectorAll(t),a=0;a<i.length;a++){var s=e.target||e.srcElement;if(i[a]===s)return e.preventDefault(),e.stopPropagation(),void s.click()}else e.preventDefault(),e.stopPropagation()},_onGetEntitlementsCompleted:function(e){var t=null,n=this;if(e.statusCode===c.ProxyCallStatusCode.Succeeded&&e.value){s.AppLoadTimeHelper.EntitlementCheckEnd(n._telemetryContext);for(var r,o=e.context.referenceInUse,i=e.value.entitlements,a=i.length,l=t,d=0;d<a;d++)r=i[d],c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?r.OfficeExtensionID&&o.solutionId&&r.OfficeExtensionID.toLowerCase()===o.solutionId.toLowerCase()&&(l&&!n._lessThan(l.OfficeExtensionVersion,r.OfficeExtensionVersion)||(l=r)):r.OfficeExtensionID&&o.id&&r.OfficeExtensionID.toLowerCase()===o.id.toLowerCase()&&(l&&!n._lessThan(l.OfficeExtensionVersion,r.OfficeExtensionVersion)||(l=r));(r=l)?r.OfficeExtensionKillbit?n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveDisabledByAdmin_ERR,t,t,t,t,t,t,c.ErrorStatusCodes.E_OEM_EXTENSION_KILLED):(e.context.manifestUrl=r.EncodedAbsUrl,e.context.appInstanceId=r.AppInstanceID,e.context.productId=r.ProductID,e.context.appInstanceId?c.OsfManifestManager.getAppInstanceInfoByIdAsync(e.context,Function.createDelegate(n,n._onGetAppInstanceInfoByIdCompleted)):c.OsfManifestManager.getManifestAsync(e.context,Function.createDelegate(n,n._onGetManifestCompleted))):n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveNotExist_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createCallback((function(e){e.osfControl._refresh(e)}),{clearCache:!0,referenceInUse:e.context.referenceInUse,osfControl:e.context.osfControl}),t,t,t,t,c.ErrorStatusCodes.E_MANIFEST_DOES_NOT_EXIST)}else n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(n,n._refresh),t,t,t,t,c.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetAppInstanceInfoByIdCompleted:function(e){var t=null,n=this;if(e.statusCode===c.ProxyCallStatusCode.Succeeded&&e.value){var r=e.value,o=e.context;r.AppWebFullUrl&&(o.appWebUrl=r.AppWebFullUrl),o.clientId=r.AppPrincipalId,o.remoteAppUrl=r.RemoteAppUrl,o.appWebUrl&&o.productId?c.OsfManifestManager.getSPTokenByProductIdAsync(o,Function.createDelegate(n,n._onGetSPTokenByProductIdCompleted)):c.OsfManifestManager.getManifestAsync(o,Function.createDelegate(n,n._onGetManifestCompleted))}else n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveServerConnectionFailed_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(n,n._refresh),t,t,t,t,c.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},_onGetSPTokenByProductIdCompleted:function(e){e.statusCode===c.ProxyCallStatusCode.Succeeded&&e.value&&(this._etoken=e.value),c.OsfManifestManager.getManifestAsync(e.context,Function.createDelegate(this,this._onGetManifestCompleted))},_retryActivation:function(){var e=this;e._retryLoadingNum--,e._pageStatus===c.OsfControlPageStatus.Ready||e._retryLoadingNum<=0?(e._contextActivationMgr._ErrorUXHelper.removeProgressDiv(e._div,e._id),e._retryLoadingNum=2):e._refresh()},_iframeOnLoad:function(){var e="Stage1Time",t="Stage11Time",n=this,r=n;n._iframeIsLoaded=!0,n._appContextIsSetToIframeName&&r._contextActivationMgr._ErrorUXHelper&&(r._contextActivationMgr._ErrorUXHelper.removeProgressDiv(r._div,r._id),r._pageStatus=c.OsfControlPageStatus.Ready,n._contextActivationMgr._enableSetFocusOnTaskpaneOnUserAction?r._frame&&r._frame.contentWindow&&(r._focusOnIframeWhenLoaded||r.getStatus()===c.OsfControlStatus.Activated&&r.getPageStatus()===c.OsfControlPageStatus.Ready&&r.getInitializationReason()===Microsoft.Office.WebExtension.InitializationReason.Inserted)&&r._frame.contentWindow.focus():r._focusOnIframeWhenLoaded&&r._frame&&r._frame.contentWindow&&r._frame.contentWindow.focus(),r.ensureAgaveEndPoint(),n._telemetryContext.Timers&&n._telemetryContext.Timers[t]&&!n._telemetryContext.Timers[t].Finished&&s.AppLoadTimeHelper.OfficeJSLoaded(n._telemetryContext)),s.AppLoadTimeHelper.PageLoaded(n._telemetryContext),n._appContextIsSetToIframeName&&r._contextActivationMgr._ErrorUXHelper&&n._telemetryContext.Timers&&n._telemetryContext.Timers[e]&&!n._telemetryContext.Timers[e].Finished&&s.AppLoadTimeHelper.ActivationEnd(n._telemetryContext);r._pageStatus!==c.OsfControlPageStatus.Ready?r._timer=window.setTimeout((function(){!function(e){var t=null;if(e){if(e._contextActivationMgr._ErrorUXHelper&&(c.OUtil.writeProfilerMark(c.OsfControlActivationPerfMarker.SelectionTimeout),e._contextActivationMgr._ErrorUXHelper.removeProgressDiv(e._div,e._id)),e._pageStatus!==c.OsfControlPageStatus.Ready){if(2===e._retryLoadingNum){var n=c.ErrorStatusCodes.WAC_AgaveActivationError;switch(e._pageStatus){case c.OsfControlPageStatus.FailedOriginCheck:n=c.ErrorStatusCodes.WAC_AgaveOriginCheckError;break;case c.OsfControlPageStatus.FailedPermissionCheck:n=c.ErrorStatusCodes.WAC_AgavePermissionCheckError;break;case c.OsfControlPageStatus.FailedHandleRequest:n=c.ErrorStatusCodes.WAC_AgaveHostHandleRequestError}if(e._contextActivationMgr._enableFirstPartySDXErrorMessages&&e.isFirstParty()){var r="Timeout loading contents in iframe. Error: "+n;e._storeType.toLowerCase()==c.StoreType.FirstParty.toLowerCase()?p.FirstPartyCatalog.LogFirstPartyCatalogMonitoringError(r,e._solutionId):e._storeType.toLowerCase()==c.StoreType.Sdx.toLowerCase()&&p.SDXCatalog.LogSDXCatalogMonitoringError(r,e._solutionId),e._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveActivationError_ERR_FirstParty,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(e,e._retryActivation),t,t,t,t,n)}else e._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveActivationError_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(e,e._retryActivation),t,t,t,t,n)}else if(1===e._retryLoadingNum)if(e._contextActivationMgr._enableFirstPartySDXErrorMessages&&e.isFirstParty()){r="User retry failed to load contents in iframe.";e._storeType.toLowerCase()==c.StoreType.FirstParty.toLowerCase()?p.FirstPartyCatalog.LogFirstPartyCatalogMonitoringError(r,e._solutionId):e._storeType.toLowerCase()==c.StoreType.Sdx.toLowerCase()&&p.SDXCatalog.LogSDXCatalogMonitoringError(r,e._solutionId),e._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_ActivateAttempLoading_ERR_FirstParty,Strings.OsfRuntime.L_ActivateButton_TXT,Function.createDelegate(e,e._retryActivation),t,t,t,t,c.ErrorStatusCodes.WAC_ActivateAttempLoading)}else e._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_ActivateAttempLoading_ERR,Strings.OsfRuntime.L_ActivateButton_TXT,Function.createDelegate(e,e._retryActivation),t,t,t,t,c.ErrorStatusCodes.WAC_ActivateAttempLoading)}else e._notifyHostIFrameOnLoaded();e._timer&&(window.clearTimeout(e._timer),e._timer=t),e._pageIsReadyTimerExpired=!0}}(r)}),5e3*r._retryLoadingNum+1):r._notifyHostIFrameOnLoaded()},_handleNotReady:function(){var e=null,t="CheckWopiHost IsHostFrameTrusted Value:",n=this,r=!0;return n._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotInitialized||n._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotReady?(n._contextActivationMgr.registerNotReadyOsfControl(n),n._timer1=window.setTimeout((function(){!function(n){if(n){if(n._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotInitialized||n._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotReady)if(n._autoRetryCheckingNum>=0)n._autoRetryCheckingNum--,s.RuntimeTelemetryHelper.LogCommonMessageTag(t+n._contextActivationMgr._isHostFrameTrusted,n._contextActivationMgr._contextMgrCorrelationId,572926152),n._refresh();else if(n._retryCheckingNum>=0){n._retryCheckingNum--,s.RuntimeTelemetryHelper.LogCommonMessageTag(t+n._contextActivationMgr._isHostFrameTrusted,n._contextActivationMgr._contextMgrCorrelationId,572926151);c.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady;n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UnknownHost_Error_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(n,n._refresh),e,e,e,e,c.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady)}else{s.RuntimeTelemetryHelper.LogCommonMessageTag(t+n._contextActivationMgr._isHostFrameTrusted,n._contextActivationMgr._contextMgrCorrelationId,572926150);c.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady;n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UnknownHost_Error_ERR,e,e,e,e,e,e,c.ErrorStatusCodes.WAC_WopiHostCheckStatusNotReady)}else s.RuntimeTelemetryHelper.LogCommonMessageTag(t+n._contextActivationMgr._isHostFrameTrusted,n._contextActivationMgr._contextMgrCorrelationId,572926149),n._status==c.OsfControlStatus.NotActivated&&n._refresh();n._timer1&&(window.clearTimeout(n._timer1),n._timer1=e)}}(n)}),5e3*(n._retryCheckingNum+1))):n._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotTrusted||n._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotImplemented?(s.RuntimeTelemetryHelper.LogCommonMessageTag(t+n._contextActivationMgr._isHostFrameTrusted,n._contextActivationMgr._contextMgrCorrelationId,572926148),n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UntrustedHost_Error_ERR,e,e,e,e,e,e,c.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted),n._timer1&&(window.clearTimeout(n._timer1),n._timer1=e)):(s.RuntimeTelemetryHelper.LogCommonMessageTag(t+n._contextActivationMgr._isHostFrameTrusted,n._contextActivationMgr._contextMgrCorrelationId,572926147),r=!1,n._timer1&&(window.clearTimeout(n._timer1),n._timer1=e)),r},_checkWopiHost:function(e){var t=null,n="CheckWopiHost IsHostFrameTrusted Value:",r=this,o=!1,i=r;return e&&(i._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotTrusted||i._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotImplemented?(s.RuntimeTelemetryHelper.LogCommonMessageTag(n+r._contextActivationMgr._isHostFrameTrusted,r._contextActivationMgr._contextMgrCorrelationId,572926146),i._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_UntrustedHost_Error_ERR,t,t,t,t,t,t,c.ErrorStatusCodes.WAC_WopiHostCheckStatusNotTrusted),o=!0,i._timer1&&(window.clearTimeout(i._timer1),i._timer1=t)):r._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotInitialized||r._contextActivationMgr._isHostFrameTrusted===c.HostFrameTrustState.NotReady?o=i._handleNotReady():i._timer1&&(window.clearTimeout(i._timer1),i._timer1=t)),s.RuntimeTelemetryHelper.LogCommonMessageTag(n+r._contextActivationMgr._isHostFrameTrusted,r._contextActivationMgr._contextMgrCorrelationId,595354007),o},_isOsfControlInEmbeddingMode:function(e){var t=!1;try{t=null!=e.getContainingDiv().parentNode.parentNode.id.match(/^(m_excelEmbedRenderer_|ewaSynd).+$/gi)}catch(e){p.WACUtils.logExceptionToBrowserConsole("_isOsfControlInEmbeddingMode error.",e)}return t},_createIframeAndActivateOsfControl:function(e){var t=this;s.RuntimeTelemetryHelper.LogCommonMessageTag("IFrame Created"+t._iframeUrl,t._contextActivationMgr._contextMgrCorrelationId,594356319);var n=t._createIframeForControl(e);t._activate(n,t._iframeUrl)},_createIframeForControl:function(e){var t,n=this,r=document.createElement("iframe");for(var o in r.setAttribute("id",n._id),r.setAttribute("width","100%"),r.setAttribute("height","100%"),r.setAttribute("frameborder","0"),r.setAttribute("allowfullscreen","true"),t=n._contextActivationMgr._enableFirstPartySDXErrorMessages&&n.isFirstParty()?e:Strings.OsfRuntime.L_IframeTitle_TXT+" "+e,r.setAttribute("title",t),r.style.msUserSelect="element",n._setSandboxAttribute(r),n._contextActivationMgr._iframeAttributeBag)r.setAttribute(o,n._contextActivationMgr._iframeAttributeBag[o]);return n._frame=r,r},_setSandboxAttribute:function(e){var t="allow-scripts allow-forms allow-same-origin allow-popups allow-popups-to-escape-sandbox allow-modals allow-downloads";c.OUtil.checkFlight("Microsoft.Office.SharedOnline.AllowStorageAccessByUserActivationOnIFrame")&&(t+=" allow-storage-access-by-user-activation"),e.setAttribute("sandbox",t);var n="geolocation;camera";this._contextActivationMgr._disableMicrophonePermission||(n+=";microphone"),this._contextActivationMgr._accessibilityAllowFocusAddinTaskpane&&(n+=";focus-without-user-activation *"),e.setAttribute("allow",n)},_onGetManifestCompleted:function(e){var t=null,n=this;if(e.statusCode===c.ProxyCallStatusCode.Succeeded&&e.value){s.AppLoadTimeHelper.ManifestRequestEnd(n._telemetryContext),s.AppLoadTimeHelper.ServerCallEnd(n._telemetryContext);var r=e.value,o=e.context,i=o.referenceInUse,a=i.storeType,l=r.getDefaultDisplayName();if(n._manifest=r,o.manifestCached&&!o.retried){var d=r.getMarketplaceVersion();if(n._lessThan(d,i.version)&&a===c.StoreType.SPApp)return void n._refresh({clearCache:!0,referenceInUse:i,osfControl:o.osfControl,retried:!0})}if(!1===r.requirementsSupported||void 0===r.requirementsSupported&&!n._contextActivationMgr.getRequirementsChecker().isManifestSupported(r)){r.requirementsSupported=!1;var u,f;return u=Strings.OsfRuntime.L_AgaveManifestRequirementsError_ERR||Strings.OsfRuntime.L_AgaveManifestError_ERR,f=c.ErrorStatusCodes.WAC_AgaveRequirementsError,void n._showActivationError(c.OsfControlStatus.ActivationFailed,u,t,t,null,t,t,!0,f)}if(r.requirementsSupported=!0,n._iframeUrl=r.getDefaultSourceLocation(n._contextActivationMgr.getFormFactor()),n._iframeUrl&&n.updateUrlsForSdx(),n._permission=r.getPermission(),n._appDomains=r.getAppDomains(),a===c.StoreType.SPApp&&n._iframeUrl&&(o.clientId&&(n._iframeUrl=n._iframeUrl.replace(/~clientid/gi,o.clientId)),o.appWebUrl&&(n._iframeUrl=n._iframeUrl.replace(/~appweburl/gi,o.appWebUrl)),o.remoteAppUrl&&(n._iframeUrl=n._iframeUrl.replace(/~remoteappurl/gi,o.remoteAppUrl))),!n._contextActivationMgr._doesUrlHaveSupportedProtocol(n._iframeUrl))return void n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestError_ERR,t,t,t,t,t,t,c.ErrorStatusCodes.E_MANIFEST_INVALID_VALUE_FORMAT);n.processManifestForCustomFunctions(r),n._isvirtualOsfControl?!o.showNewerVersion&&n.invokeVirtualOsfControlActivationCallback(r):n._createIframeAndActivateOsfControl(l)}else s.RuntimeTelemetryHelper.LogExceptionTag("GetManifest failed:"+p.WACUtils.serializeObjectToString(e),t,t,18420422),n._showActivationError(c.OsfControlStatus.ActivationFailed,Strings.OsfRuntime.L_AgaveManifestRetrieve_ERR,Strings.OsfRuntime.L_RetryButton_TXT,Function.createDelegate(n,n._refresh),t,t,t,t,c.ErrorStatusCodes.E_MANIFEST_SERVER_UNAVAILABLE)},isCurrentLocaleDefaultLocale:function(e){return e.getDefaultLocale().toLowerCase()!=this._contextActivationMgr.getAppUILocale().toLowerCase()},processManifestForExtendedOverrides:function(e,t){var n=this;return n._processManifestForExtendedOverridesPromise&&!n._isUpgrading?n._processManifestForExtendedOverridesPromise:(n._processManifestForExtendedOverridesPromise=n.processManifestForExtendedOverridesInternal(e,t),n._processManifestForExtendedOverridesPromise)},processManifestForExtendedOverridesInternal:function(e,t){var n=null,r=this,o=r;if(r._isManifestProcessedForExtendedOverrides&&!r._isUpgrading)return Promise.resolve(n);if(!e)return Promise.resolve(n);if(r.getInitializationReason()!==Microsoft.Office.WebExtension.InitializationReason.Inserted&&r.getInitializationReason()!==Microsoft.Office.WebExtension.InitializationReason.DocumentOpened)return Promise.resolve(n);r._isManifestProcessedForExtendedOverrides=!0;try{if(!e.getExtendedOverrides().url){var i="Missing extendedOverrides url info for manifest contains ExtendedOverrides node";return s.RuntimeTelemetryHelper.LogExceptionTag(i,n,r.getCorrelationId(),572926145),Promise.reject(i)}p.ExtendedManifestUtility.ensureFinalExtendedOverridesUrls(e,r._contextActivationMgr)}catch(e){i="Failed to construct ExtendedOverrides";return s.RuntimeTelemetryHelper.LogExceptionTag(i,e,r.getCorrelationId(),572926144),Promise.reject(i)}if(e.getExtendedOverrides().hasFinalUrls&&!p.OsfExtendedManifestCache.wasExtendedManifestAlreadyFetched(e._id)){var a=[p.ExtendedManifestUtility.downloadContent(e.getExtendedOverrides().url)];return e.getExtendedOverrides().resourcesUrl&&e.getDefaultLocale().toLowerCase()!=r._contextActivationMgr.getAppUILocale().toLowerCase()&&a.push(p.ExtendedManifestUtility.downloadContent(e.getExtendedOverrides().resourcesUrl)),Promise.all(a).then((function(e){if(e.length<1||e.length>2){var r="Invalid number of files fetched.";throw s.RuntimeTelemetryHelper.LogExceptionTag(r,n,o.getCorrelationId(),572926115),r}var i=JSON.parse(e[0]),a=n;2==e.length&&(a=JSON.parse(e[1]));var l=p.ExtendedManifestUtility.validateAndSubstituteExtendedManifestTokens(i,a);if(!l){r="Did not get a validated extended manifest.";throw s.RuntimeTelemetryHelper.LogExceptionTag(r,n,o.getCorrelationId(),572926114),r}var d=p.ManifestUtil.constructAddInId(o._solutionId,o._version,o._storeType,o._storeId);return p.ShortcutsMappingTableManager.validateExtendedManifestShortcutKeys(l,d,!0).then((function(){t&&p.AddinShortcutsPreferenceSettingHelper.clearSettingsByExtendedManifest(l),p.OsfExtendedManifestCache.set(d,JSON.stringify(l));var e=new c.AddinIdInfo(d);o.sendParseExtendedManifestTelemetry(l.shortcuts,e.getPrivacyCompliantSolutionId(),o._storeType)})),n})).catch((function(e){throw s.RuntimeTelemetryHelper.LogExceptionTag("Promise rejected.",e,o.getCorrelationId(),572926113),e}))}return Promise.resolve(n)},sendParseExtendedManifestTelemetry:function(e,t,n){var r="function";if("object"==typeof Otel&&typeof Otel.Telemetry===r&&typeof Otel.Telemetry.sendOtelEvent===r){var o={otelEvent:{eventName:"Office.Extensibility.ExtendedManifest.ParseExtendedManifest",dataFields:[{name:"ContainsShortcut",dataType:0,value:e},{name:"SolutionId",dataType:1,value:t},{name:"StoreType",dataType:1,value:n}],telemetryProperties:p.TelemetryProperties}};Otel.Telemetry.sendOtelEvent(o)}else s.RuntimeTelemetryHelper.LogCommonMessageTag("The Otel isn't available, couldn't call sendOtelEvent for logging the shortcuts telemetry",null,572926112)},isCustomFunctionSandbox:function(){var e=this;if("object"==typeof e._settings&&"number"==typeof e._settings.length)for(var t=0;t<e._settings.length;t++)if("object"==typeof e._settings[t]&&"number"==typeof e._settings[t].length&&"string"==typeof e._settings[t][0]&&"string"==typeof e._settings[t][1]&&"customfunctionaddinid"==e._settings[t][0].toLowerCase())return!0;return!1},processManifestForCustomFunctions:function(e){var t=this,n=t;if((!t._isManifestProcessedForCustomFunctions||t._isUpgrading)&&(t._isManifestProcessedForCustomFunctions=!0,e&&e.containsCustomFunctionsForAppHost(t._contextActivationMgr._hostType))){var r=c.getManifestHostType(t._contextActivationMgr._hostType),o=t._contextActivationMgr.getFormFactor(),i=new p.Parser.ParsingContext(r,o,null,e),a=new p.Parser.AddinCommandsManifestParser(r,o),s={assetId:t._solutionId,appVersion:t._version,storeType:t._storeType,storeId:t._storeId,targetType:null},d={setErrorMessageForAddin:function(e,t){l.msAjaxDebug.trace("Error parsing app manifest: "+t)}},u=a.parseExtensions(s,e,d);if("object"==typeof u.ExtensionPoints&&"number"==typeof u.ExtensionPoints.length)for(var f=e.isXLLCompatible(),m=0;m<u.ExtensionPoints.length;m++)if("CustomFunctions"===u.ExtensionPoints[m].type){var g=u.ExtensionPoints[m],v=function(){var t={osfControl:n,locale:n._getCustomFunctionsLocale(e),invariantNamespace:n._getCustomFunctionsInvariantNamespace(i,g.namespaceResId),namespace:i.resources.ShortStrings[g.namespaceResId],metadataUrl:i.resources.Urls[g.metadataResId],title:e.getDefaultDisplayName(),isXllCompatible:f,manifest:e._xmlProcessor.getNodeXml(e._xmlProcessor.getDocumentElement())};n._contextActivationMgr._notifyHost(n._id,c.AgaveHostAction.InstallCustomFunctions,t)};t.isCustomFunctionSandbox()?(t._iframeUrl=i.resources.Urls[g.pageResId],t._isUpgrading&&v()):v();break}}},setIsUpgrading:function(e){this._isUpgrading=e},getIsUpgrading:function(){return this._isUpgrading},setUpgradingFailed:function(e){this._isUpgradingFailed=e},getUpgradingFailed:function(){return this._isUpgradingFailed},updateUrlsForSdx:function(e){var t=this;if(t.isFirstParty()){var n=".js",r=t._iframeUrl.substr(t._iframeUrl.length-n.length,n.length).toLowerCase()===n,o=/^(?:[a-z]+:)?\/\//i.test(t._iframeUrl);if(r||!o){var i=void 0,a=r?"index.html":t._iframeUrl;if(null!==e){var s=e.lastIndexOf("/");-1!==s&&(i=e.substr(0,s)+"/"+a)}r&&(t._bundleUrl=t._iframeUrl),t._iframeUrl=null!=i?i:t._sdxIframeTemplateUrl}}},updateUrlsForSdxBundle:function(e){var t=this;if(t._contextActivationMgr._enableServiceDeliveredExperience){var n=".js";t._iframeUrl.substr(t._iframeUrl.length-n.length,n.length).toLowerCase()===n&&(t._bundleUrl=t._iframeUrl,t._iframeUrl=null!=e?e:t._sdxIframeTemplateUrl)}},_getCustomFunctionsLocale:function(e){return e._UILocale?e._UILocale.toLocaleLowerCase():e._defaultLocale?e._defaultLocale.toLocaleLowerCase():""},_getCustomFunctionsInvariantNamespace:function(e,t){var n=e.manifest._xmlProcessor.selectSingleNode("o:OfficeApp"),r=e.selectSingleNode(n,["ov:VersionOverrides","ov:Resources","bt:ShortStrings","bt:String [@id = '"+t+"']"]);return r?r.getAttribute("DefaultValue"):null},_lessThan:function(e,t){return c.OsfManifestManager.versionLessThan(e,t)},_showTrustError:function(e,t,n,r,o,i,a,s){var l=null,d=this,u=c.OUtil.formatString(Strings.OsfRuntime.L_AgaveName_INFO,t||"");u=d._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(u);var p=c.OUtil.formatString(Strings.OsfRuntime.L_AgaveProvider_INFO,n||"");p=d._contextActivationMgr._ErrorUXHelper.getHTMLEncodedString(p),s=null==s?!!d.getManifest()&&d.getManifest().isSSOAddin():s;var f=Strings.OsfRuntime.L_AgaveNewAppTitle_TXT,m=Strings.OsfRuntime.L_AgaveTrustAddIn_INFO,g=Strings.OsfRuntime.L_TrustButton_TXT,v=d._osfControlType===c.OsfControlType.DocumentLevel?c.NotificationType.TrustPromptContent:c.NotificationType.TrustPromptTaskpane;d._retryActivate=i,d._contextActivationMgr.displayNotification({id:d._id,infoType:c.InfoType.SecurityInfo,clientName:e,name:t||l,provider:n,title:f,description:m,icon:r||l,buttonTxt:g,buttonCallback:i,url:a||l,dismissCallback:l,reDisplay:!0,displayDeactive:!0,logAsError:!0,retryAll:!0,errorCode:c.ErrorStatusCodes.E_TRUSTCENTER_MOE_UNACTIVATED,iframeNotificationUrl:null,notificationType:v})},_showActivationError:function(e,t,n,r,o,i,a,s,l){var d=!0,u=null,p=this;if(p._status=e,p._contextActivationMgr._enableFirstPartySDXErrorMessages&&p.isFirstParty())var f={id:p._id,infoType:c.InfoType.Error,status:e,title:a||Strings.OsfRuntime.L_AgaveErrorTile_TXT_FirstParty,description:t,icon:u,buttonTxt:n||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:r||u,url:o||u,dismissCallback:i||u,reDisplay:!i&&d,displayDeactive:d,detailView:!!s&&d,logAsError:d,errorCode:l||0};else f={id:p._id,infoType:c.InfoType.Error,status:e,title:a||Strings.OsfRuntime.L_AgaveErrorTile_TXT,description:t,icon:u,buttonTxt:n||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:r||u,url:o||u,dismissCallback:i||u,reDisplay:!i&&d,displayDeactive:d,detailView:!!s&&d,logAsError:d,errorCode:l||0};p._contextActivationMgr.displayNotification(f),p._contextActivationMgr.raiseOsfControlStatusChange(p)},_showActivationWarning:function(e,t,n,r,o,i,a){var s=!0,l=null,d=this;if(d._status=e,d._contextActivationMgr._enableFirstPartySDXErrorMessages&&d.isFirstParty())var u={id:d._id,infoType:c.InfoType.Warning,status:e,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT_FirstParty,description:t,icon:l,buttonTxt:n||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:r||l,url:o||l,dismissCallback:i||l,reDisplay:!i&&s,displayDeactive:s,logAsError:s,errorCode:a||0};else u={id:d._id,infoType:c.InfoType.Warning,status:e,title:Strings.OsfRuntime.L_AgaveWarningTitle_TXT,description:t,icon:l,buttonTxt:n||Strings.OsfRuntime.L_OkButton_TXT,buttonCallback:r||l,url:o||l,dismissCallback:i||l,reDisplay:!i&&s,displayDeactive:s,logAsError:s,errorCode:a||0};d._contextActivationMgr.displayNotification(u),d._contextActivationMgr.raiseOsfControlStatusChange(d)},_refresh:function(e){this.deActivate(),this.activate(e)},_activateAgavesBlockedBySandboxNotSupport:function(e){e.activateAgavesBlockedBySandboxNotSupport();var t=c.OUtil.getLocalStorage();t&&t.setItem(c.Constants.IgnoreSandBoxSupport,"true")},_setCachedFlag:function(e){this._contextActivationMgr._setCachedFlag(e)},_getCachedFlag:function(e){return this._contextActivationMgr._getCachedFlag(e)},_deleteCachedFlag:function(e){this._contextActivationMgr._deleteCachedFlag(e)},_notifyHostIFrameOnLoaded:function(){var e=this;e._contextActivationMgr._changeGateOnPageReadyFix?e._contextActivationMgr._notifyHost&&!e._iframeLoadedNotified&&(e._contextActivationMgr._notifyHost(e._id,c.AgaveHostAction.PageIsReady),e._iframeLoadedNotified=!0):e._contextActivationMgr._notifyHost&&e._contextActivationMgr._notifyHost(e._id,c.AgaveHostAction.PageIsReady)},_addETokenAsQueryParameter:function(e){var t=document.createElement("a");t.href=e;var n=this.getEToken(),r=c.Constants.ETokenParameterName+"="+encodeURIComponent(c.OUtil.encodeBase64(n)),o=t.search.length>1?t.search.substr(1)+"&":"";t.search=o+r;var i=t.href;return t=null,i},_addAsQueryParameter:function(e,t,n){var r=document.createElement("a");r.href=e;var o=encodeURIComponent(t)+"="+encodeURIComponent(n),i=r.search.length>1?r.search.substr(1)+"&":"";r.search=i+o;var a=r.href;return r=null,a},_activate:function(e,t){var n="OsfControlId",r=!0,o=this,i=o;if(s.AppLoadTimeHelper.PageStart(o._telemetryContext),o._storeType===c.StoreType.Sdx){var a=performance.now(),l=!1,d=!1,u=!1,f=function(){u||(u=r,s.RuntimeTelemetryHelper.LogCommonMessageTag("SDX Activation Duration = "+(performance.now()-i._sdxTelemetryContext.activationStart)+".",null,42271587),p.SDXCatalog.recordActivationActivity(r,i._sdxTelemetryContext),i._solutionId.toLowerCase()===c.SdxAssetIds.ExperimentationSdx&&setTimeout((function(){return i.deActivate()}),6e4))};o._iframeOnLoadDelegate=Function.createDelegate(o,(function(){var e=this;e._sdxTelemetryContext.iframeOnLoadReceived=performance.now(),l||(l=r,p.SDXCatalog.recordActivity("PageLoad",a,r,[{name:n,string:e._id},{name:"AssetId",string:e._solutionId}]),d&&f()),e._iframeOnLoad.apply(e,arguments)})),o._iframeOnGetAppContextDelegate=function(){d||(d=r,p.SDXCatalog.recordActivity("OfficeJsReady",a,r,[{name:n,string:i._id},{name:"AssetId",string:i._solutionId}]),l&&f())}}o._setIframeAttribute(e,t),o._pageIsReadyTimerExpired=!1,c.OUtil.addEventListener(e,"load",o._iframeOnLoadDelegate),o._div.appendChild(e),o._status=c.OsfControlStatus.Activated,c.OUtil.writeProfilerMark(c.OsfControlActivationPerfMarker.ActivationEnd),o._contextActivationMgr.raiseOsfControlStatusChange(o),s.AppLoadTimeHelper.OfficeJSStartToLoad(o._telemetryContext)},_setIframeAttribute:function(e,t){var n=this;n._storeType!==c.StoreType.Sdx?t=n._addETokenAsQueryParameter(t):n._contextActivationMgr._enableDisplayUILocaleQueryString&&n.isFirstParty()&&(t=n._addAsQueryParameter(t,c.Constants.DisplayLanguageParameterName,n._contextActivationMgr._appUILocale));var r=n._contextActivationMgr.getClientId()+"_"+n._contextActivationMgr.getDocUrl()+"_"+n._id,o=c.OUtil.getFrameName(r);n._conversationId=c.OUtil.generateConversationId();var i=n._hostInfoFlags;c.OUtil.checkFlight(c.FlightTreatmentNames.LogAllAddinsAsPublic)&&(i|=c.HostInfoFlags.PublicAddin),c.OUtil.checkFlight(c.FlightTreatmentNames.IsPrivateAddin)&&(s.PrivacyRules.IsPrivateAddin(n._ownerAddinStoreType||n._storeType,n._storeId,n._exchangeExtensionProviderName,n._exchangeExtensionType,n._assetId)||(i|=c.HostInfoFlags.PublicAddin));var a=[n._contextActivationMgr._hostType,n._contextActivationMgr._hostPlatform,n._contextActivationMgr._hostSpecificFileVersion,n._contextActivationMgr._appUILocale,n.getCorrelationId(),n._isDialog?"isDialog":null,n._contextActivationMgr._disableLogging?"disableLogging":null,i].join("|"),l=t,d=window.location.origin;if(void 0===d||d&&"null"===d){var u=c.OUtil.parseUrl(window.location.href);d=u.protocol+"//"+u.hostname+(u.port?":"+u.port:"")}var f=n._conversationId+"|"+n._id+"|"+(d.indexOf("$")>=0?encodeURIComponent(d):d),m={};if(m[c.WindowNameItemKeys.BaseFrameName]=o,m[c.WindowNameItemKeys.HostInfo]=a,m[c.WindowNameItemKeys.XdmInfo]=f,m[c.WindowNameItemKeys.SerializerVersion]=c.SerializerVersion.Browser,m[c.WindowNameItemKeys.Flights]=JSON.stringify(c.Flights),n._solutionId.toLowerCase()===c.SdxAssetIds.ExperimentationSdx&&n.addProperty("sdxTelemetryContext",JSON.stringify(n._sdxTelemetryContext)),n._contextActivationMgr._enable3rdPartySetAppContextInIframeName||n.isFirstParty()){var g=n.getAppContext(),v=JSON.stringify(g).length;s.RuntimeTelemetryHelper.LogCommonMessageTag("AppContext length is: "+v,n.getCorrelationId(),593896220),v<c.MaxAppContextLength?(m[c.WindowNameItemKeys.AppContext]=g,n._appContextIsSetToIframeName=!0):s.RuntimeTelemetryHelper.LogCommonMessageTag("We got a huge appContext exceeding maximum, appContext length is: "+v,n.getCorrelationId(),593896219)}var h=c.OUtil.getLocalStorage();if(h){var y="CustomFunctionsRuntimeLogging",C=h.getItem(y);C&&(m[y]=C)}n._contextActivationMgr._getServiceEndPoint().registerConversation(n._conversationId,l,n._appDomains),e.setAttribute("src",l),n._sdxTelemetryContext.iframeUrl=l,n._agaveWindowName=p.WACUtils.serializeObjectToString(m),e.setAttribute("name",n._agaveWindowName),c.OUtil.addClass(e,"AddinIframe"),n._agavePageUrl=l},getAppContext:function(){var e=this,t=e.getEToken(),n=0;if(e._contextActivationMgr._hostSpecificFileVersion&&-1!=e._contextActivationMgr._hostSpecificFileVersion.indexOf(".")){var r=e._contextActivationMgr._hostSpecificFileVersion.split("."),o=r[1];isNaN(o)||(n=parseInt(r[1]))}var i=e._contextActivationMgr._requirementsChecker._getSupportedSet(),a=new c.OfficeAppContext(e.getSolutionId(),e._contextActivationMgr._appName,e._contextActivationMgr._appVersion,e._contextActivationMgr._appUILocale,e._contextActivationMgr._dataLocale,e._contextActivationMgr._docUrl||window.location.href,e._contextActivationMgr._clientMode,e.getSettings(),e.getReason(),e.getOsfControlType(),t,e._appCorrelationId,e.getID(),!1,!0,n,i,e.getHostCustomMessage(),e._contextActivationMgr._hostFullVersion||c.Constants.FileVersion,window.innerHeight,window.innerWidth,e.getManifest()?e.getManifest().getDefaultDisplayName():null,e._appDomains,void 0,e.getFeatureGates(),void 0,e._initialDisplayMode);a._wacHostEnvironment=e._contextActivationMgr._wacHostEnvironment||"0",a._isFromWacAutomation=!!e._contextActivationMgr._isFromWacAutomation,a._addInSourceLocationSubdomainAllowedIsEnabled=!0,a._addInSourceUrl=e._agavePageUrl,a._appSettings=e._contextActivationMgr._appSettings;var s=e._contextActivationMgr._uiHostSupportsAuthTokenAddinList;if(s){var l=e.getSolutionId();l&&(l=l.toLowerCase());for(var d=0;d<s.length;d++)if(l===s[d]){a._wopiHostOriginForSingleSignOn=e._contextActivationMgr._wopiHostOriginFromWacPropBag;break}}return a},ensureAgaveEndPoint:function(){var e=this;if(!e._agaveEndPoint){var t=e._conversationId+c.SharedConstants.NotificationConversationIdSuffix;e._agaveEndPoint=Microsoft.Office.Common.XdmCommunicationManager.connect(t,e._frame.contentWindow,e._iframeUrl)}},_getConversationId:function(){return this._conversationId},_doesBrowserSupportRequiredFeatures:function(){var e=!1;if(Object.defineProperty)try{Object.defineProperty({},"myTestProperty",{get:function(){return this.desc},set:function(e){this.desc=e}}),e=!0}catch(e){}return e},_isAddinCommands:function(e){var t=this;if(t._isvirtualOsfControl)e(!0);else if(t._contextActivationMgr._enableAddinCommands&&t._contextActivationMgr._enableTaskpaneUpgradeToAppCommand&&null!=t._virtualOsfControlActivationCallback){var n={marketplaceId:t._solutionId,marketplaceVersion:t._version,storeType:t._storeType,storeId:t._storeId,targetData:{}};t._contextActivationMgr.isAddinCommandsAsync(n,(function(t,n){e(n)}))}else e(!1)}},function(e){var t=function(){var t=null;function n(){}return n.getAll=function(){var r=[],o=[];return e.OsfCache.get(e.OsfCache.c_osfCacheTableName,n.c_osfExtendedManifestIdsCacheKey).then((function(n){return n?(JSON.parse(n).forEach((function(t){o.push(e.OsfCache.get(e.OsfCache.c_extendedManifestTableName,t).then((function(e){if(e){var n={addinId:t,extendedManifest:JSON.parse(e)};r.push(n)}})))})),Promise.all(o)):t})).then((function(){return r}))},n.get=function(n){return e.OsfCache.get(e.OsfCache.c_extendedManifestTableName,n).then((function(e){return e?{addinId:n,extendedManifest:JSON.parse(e)}:t}))},n.set=function(t,r){var o=this,i=JSON.stringify(JSON.parse(r)),a=[];return e.OsfCache.get(e.OsfCache.c_osfCacheTableName,n.c_osfExtendedManifestIdsCacheKey).then((function(e){return e?(a=JSON.parse(e)).indexOf(t)<0?(a.push(t),o.setExtendedManifestHelper(a,t,i,!1)):o.setExtendedManifestHelper(a,t,i,!0):(a.push(t),o.setExtendedManifestHelper(a,t,i,!1))}))},n.clear=function(r){var o=this,i=[];return e.OsfCache.get(e.OsfCache.c_osfCacheTableName,n.c_osfExtendedManifestIdsCacheKey).then((function(e){var n="The addin to be removed isn't in cache";if(e){var a=(i=JSON.parse(e)).indexOf(r);if(!(a<0))return i.splice(a,1),o.clearExtendedManifestHelper(i,r);s.RuntimeTelemetryHelper.LogCommonMessageTag(n,t,572926110)}else s.RuntimeTelemetryHelper.LogCommonMessageTag(n,t,572926111)}))},n.wasExtendedManifestAlreadyFetched=function(e){return n.s_fetchedExtendedManifestIdsInMemory&&n.s_fetchedExtendedManifestIdsInMemory.indexOf(e)>=0},n.onChanged=function(e){n.s_onCacheChangedCallbacks.push(e)},n.clearExtendedManifestHelper=function(t,r){return e.OsfCache.remove(e.OsfCache.c_extendedManifestTableName,r).then((function(){var o=n.s_fetchedExtendedManifestIdsInMemory.indexOf(r);return n.s_fetchedExtendedManifestIdsInMemory.splice(o,1),e.OsfCache.set(e.OsfCache.c_osfCacheTableName,n.c_osfExtendedManifestIdsCacheKey,JSON.stringify(t)).then((function(){n.processCallbacks()}))}))},n.setExtendedManifestHelper=function(t,r,o,i){return i?e.OsfCache.get(e.OsfCache.c_extendedManifestTableName,r).then((function(t){if(o!=t)return e.OsfCache.set(e.OsfCache.c_extendedManifestTableName,r,o).then((function(){n.processCallbacks()}))})):e.OsfCache.set(e.OsfCache.c_extendedManifestTableName,r,o).then((function(){return n.s_fetchedExtendedManifestIdsInMemory.push(r),e.OsfCache.set(e.OsfCache.c_osfCacheTableName,n.c_osfExtendedManifestIdsCacheKey,JSON.stringify(t)).then((function(){n.processCallbacks()}))}))},n.processCallbacks=function(){n.s_onCacheChangedCallbacks.forEach((function(e){e()}))},n.c_osfExtendedManifestIdsCacheKey="OsfExtendedManifestIds",n.s_fetchedExtendedManifestIdsInMemory=[],n.s_onCacheChangedCallbacks=[],n}();e.OsfExtendedManifestCache=t,t.onChanged((function(){e.ActionMetadataManager.init(!1)}))}(p||(p={})),c.OUtil.setNamespace("Manifest",c),c.Manifest.HostApp=function(e){this._appName=e,this._minVersion=null},c.Manifest.HostApp.prototype={getAppName:function(){return this._appName},getMinVersion:function(){return this._minVersion},_setMinVersion:function(e){this._minVersion=e}},c.Manifest.ExtensionSettings=function(){this._sourceLocations={},this._defaultHeight=null,this._defaultWidth=null},c.Manifest.ExtensionSettings.prototype={getDefaultHeight:function(){return this._defaultHeight},getDefaultWidth:function(){return this._defaultWidth},getSourceLocations:function(){return this._sourceLocations},_addSourceLocation:function(e,t){this._sourceLocations[e.toLocaleLowerCase()]=t},_setDefaultWidth:function(e){this._defaultWidth=e},_setDefaultHeight:function(e){this._defaultHeight=e}},c.Manifest.WebAppInfoAuthorization=function(){this._resource=null,this._scopes=null},c.Manifest.WebAppInfoAuthorization.prototype={getResource:function(){return this._resource},getScopes:function(){return this._scopes}},c.Manifest.EquivalentAddins=function(){this._equivalentAddins=[]},c.Manifest.EquivalentAddins.prototype={isXLLCompatible:function(){for(var e=0;e<this._equivalentAddins.length;e++)if(this._equivalentAddins[e].isXLLCompatible())return!0;return!1},add:function(e){this._equivalentAddins.push(e)},getEquivalentAddins:function(){return this._equivalentAddins}},c.Manifest.EquivalentAddin=function(){this._progId=null,this._fileName=null,this._type=null},c.Manifest.EquivalentAddin.prototype={getProgId:function(){return this._progId},getFileName:function(){return this._fileName},getType:function(){return this._type},isXLLCompatible:function(){return"XLL"==this._type},isComAddin:function(){return"COM"==this._type}},function(e){e[e.Short=0]="Short",e[e.Long=1]="Long"}(u||(u={})),c.Manifest.Runtimes=function(){this._runtimes=[]},c.Manifest.Runtimes.prototype={getSharedRuntime:function(e){var t=null,n=this;if(e==t||n._runtimes==t)return t;for(var r=0;r<n._runtimes.length;r++)if(n._runtimes[r]!=t&&n._runtimes[r].Resid===e)return n._runtimes[r];return t},add:function(e){if(null!=e&&null!=this._runtimes){if(null!=this.getSharedRuntime(e.Resid))throw l.msAjaxError.argument("Manifest parser failure: cannot have same Resid for different runtime.");this._runtimes.push(e)}},getRuntimes:function(){return this._runtimes}},c.Manifest.Runtime=function(){this.Resid=null,this.LifeTime=u.Short},c.Manifest.Manifest=function(e,t){var n=null,r="ov:VersionOverrides",o="VersionOverrides",i="xsi:type",a="o:OfficeApp",s="1.1",d=this;if(d._UILocale=t||"en-us","string"==typeof e){var f;d._displayNames={},d._descriptions={},d._iconUrls={},d._extensionSettings={},d._highResolutionIconUrls={},d._versionOverrides={},d._ribbonExtensionControls={},d._xmlProcessor=new c.XmlProcessor(e,c.ManifestNamespaces[s]),d._xmlProcessor.selectSingleNode(a)?(f=function(){var e=this,t=e._xmlProcessor.selectSingleNode("o:Hosts",g);e._hosts=e._parseHosts(t),t&&(e._hostsXml=t.xml||t.outerHTML);t=e._xmlProcessor.selectSingleNode("o:Requirements",g),e._requirements=e._parseRequirements(t),t&&(e._requirementsXml=t.xml||t.outerHTML);(t=e._xmlProcessor.selectSingleNode("o:HighResolutionIconUrl",g))&&e._parseLocaleAwareSettings(t,Function.createDelegate(e,e._addHighResolutionIconUrl))},d._manifestSchemaVersion=c.ManifestSchemaVersion[s]):(d._xmlProcessor=new c.XmlProcessor(e,c.ManifestNamespaces["1.0"]),f=function(){var e=this,t=e._xmlProcessor.selectSingleNode("o:Capabilities",g),n=e._xmlProcessor.selectNodes("o:Capability",t);e._capabilities=e._parseCapabilities(n)},d._manifestSchemaVersion=c.ManifestSchemaVersion["1.0"]);var m=d._xmlProcessor.getDocumentElement();d._target=c.OUtil.parseEnum(m.getAttribute(i),c.OfficeAppType);var g=d._xmlProcessor.selectSingleNode(a);if(m=d._xmlProcessor.selectSingleNode("o:Id",g),d._id=d._xmlProcessor.getNodeValue(m),!new RegExp("^[a-f0-9]{8}(-[a-f0-9]{4}){3}-[a-f0-9]{12}$","i").test(d._id))throw l.msAjaxError.argument("Manifest");m=d._xmlProcessor.selectSingleNode("o:Version",g);try{d._version=d.complementVersion(d._xmlProcessor.getNodeValue(m))}catch(e){d._version=d._xmlProcessor.getNodeValue(m)}if(m=d._xmlProcessor.selectSingleNode("o:ProviderName",g),d._providerName=d._xmlProcessor.getNodeValue(m),m=d._xmlProcessor.selectSingleNode("o:IdIssuer",g),d._idIssuer=d._parseIdIssuer(m),(m=d._xmlProcessor.selectSingleNode("o:AlternateId",g))&&(d._alternateId=d._xmlProcessor.getNodeValue(m)),m=d._xmlProcessor.selectSingleNode("o:DefaultLocale",g),d._defaultLocale=d._xmlProcessor.getNodeValue(m),m=d._xmlProcessor.selectSingleNode("o:DisplayName",g),d._parseLocaleAwareSettings(m,Function.createDelegate(d,d._addDisplayName)),m=d._xmlProcessor.selectSingleNode("o:Description",g),d._parseLocaleAwareSettings(m,Function.createDelegate(d,d._addDescription)),m=d._xmlProcessor.selectSingleNode("o:AppDomains",g),d._appDomains=d._parseAppDomains(m),(m=d._xmlProcessor.selectSingleNode("o:IconUrl",g))&&d._parseLocaleAwareSettings(m,Function.createDelegate(d,d._addIconUrl)),(m=d._xmlProcessor.selectSingleNode("o:Signature",g))&&(d._signature=d._xmlProcessor.getNodeValue(m)),d._parseExtensionSettings(),m=d._xmlProcessor.selectSingleNode("o:Permissions",g),d._permissions=d._parsePermission(m),d._allowSnapshot=!0,(m=d._xmlProcessor.selectSingleNode("o:AllowSnapshot",g))&&(d._allowSnapshot=d._parseBooleanNode(m)),d._manifestSchemaVersion===c.ManifestSchemaVersion[s]){var v="ov:";if(d._target==c.OfficeAppType.ContentApp&&(v="c:"),m=d._xmlProcessor.selectSingleNode(v+o,g)){var h=d._xmlProcessor.selectSingleNode(v+"WebApplicationInfo",m);if(h){var y=d._xmlProcessor.selectSingleNode(v+"Resource",h);d._webApplicationResource=d._xmlProcessor.getNodeValue(y);var C=d._xmlProcessor.selectSingleNode(v+"Id",h);d._webApplicationId=d._xmlProcessor.getNodeValue(C);var _=d._xmlProcessor.selectSingleNode(v+"MsaId",h);d._webApplicationMsaId=_?d._xmlProcessor.getNodeValue(_):d._webApplicationId;var S=d._xmlProcessor.selectSingleNode(v+"Scopes",h);d._webApplicationScopes=d._parseWebApplicationScopes(S,v),d._webApplicationAuthorizations=d._parseWebAppInfoAuthorizations(h,v)}}}if(d._manifestSchemaVersion===c.ManifestSchemaVersion[s]&&d._target==c.OfficeAppType.TaskPaneApp){v="ov:";if(m=d._xmlProcessor.selectSingleNode(v+o,g)){var A=d._xmlProcessor.selectSingleNode(v+"EquivalentAddins",m);d._equivalentAddins=d._parseEquivalentAddins(A,v)}}if(d._manifestSchemaVersion===c.ManifestSchemaVersion[s])(I=d._xmlProcessor.selectSingleNode(r,g))&&(d._manifestSourceLocationOverrides=d._parseSourceLocationOverrides(I));if(d._manifestSchemaVersion===c.ManifestSchemaVersion[s]&&d._target==c.OfficeAppType.TaskPaneApp){var I,T=d._xmlProcessor.selectSingleNode("o:ExtendedOverrides",g);if(T!=n&&d._parseExtendedOverrides(T),(I=d._xmlProcessor.selectSingleNode(r,g))!==n){var O=d._xmlProcessor.selectSingleNode("ov:Hosts",I);if(O!==n){var x=d._xmlProcessor.selectNodes("ov:Host",O);if(x!==n)for(var E=x.length,b=0;b<E;b++){var M=x[b].getAttribute(i);if("Document"===M||"Workbook"===M||"Presentation"===M){d._versionOverrides[M]={};var R=d._xmlProcessor.selectSingleNode("ov:Runtimes",x[b]);if(R)d._versionOverrides[M]._runtimes=d._parseRuntimes(R);else{var P=new c.Manifest.Runtime;P.Resid="OEP.SharedRuntime.Url",P.LifeTime=u.Long;var N=new c.Manifest.Runtimes;N.add(P),d._versionOverrides[M]._runtimes=N}var U=new p.Parser.AddinCommandsManifestParser(M,"DesktopFormFactor"),F=new p.Parser.AddinCommandsManifestParser(M,"AllFormFactors"),w={setErrorMessageForAddin:function(e){l.msAjaxDebug.trace("Error parsing app manifest: "+e)}},D={assetId:d._id,appVersion:d._version,storeType:n,storeId:n,targetType:n},k=U.parseExtensions(D,d,w),L=F.parseExtensions(D,d,w);d._versionOverrides[M]._addinCommandsExtensionPoints=k.ExtensionPoints,d._versionOverrides[M]._functionFileResid=k.functionFileResid,d._versionOverrides[M]._customFunctionExtensionPoint=L.ExtensionPoints[0],d._versionOverrides[M]._showTaskpaneControls=d._retrieveAppCommandShowTaskpaneControls(M),d._validateShowTaskpaneSharedRuntime(M),d._generateRibbonExtensionControlMap(M)}}}}}f.apply(d)}else e(d)},c.Manifest.Manifest.prototype={getSourceLocationOverrideByResourceId:function(e){return e&&this._manifestSourceLocationOverrides?this._manifestSourceLocationOverrides[e]:null},getManifestSchemaVersion:function(){return this._manifestSchemaVersion},getMarketplaceID:function(){return this._id},getMarketplaceVersion:function(){return this._version},getDefaultLocale:function(){return this._defaultLocale},getProviderName:function(){return this._providerName},getIdIssuer:function(){return this._idIssuer},getAlternateId:function(){return this._alternateId},getSignature:function(){return this._signature},getCapabilities:function(){return this._capabilities},getDisplayName:function(e){return this._displayNames[e.toLocaleLowerCase()]},getDefaultDisplayName:function(){return this._getDefaultValue(this._displayNames)},getDescription:function(e){return this._descriptions[e]},getDefaultDescription:function(){return this._getDefaultValue(this._descriptions)},getIconUrl:function(e){return this._iconUrls[e]},getDefaultIconUrl:function(){return this._getDefaultValue(this._iconUrls)},getSourceLocation:function(e,t){return this._getExtensionSetting(t).getSourceLocations()[e.toLocaleLowerCase()]},getDefaultSourceLocation:function(e){var t=this._getExtensionSetting(e).getSourceLocations();return this._getDefaultValue(t)},getDefaultWidth:function(e){return this._getExtensionSetting(e).getDefaultWidth()},getDefaultHeight:function(e){return this._getExtensionSetting(e).getDefaultHeight()},getTarget:function(){return this._target},getOmexTargetCode:function(){switch(this._target){case c.OfficeAppType.ContentApp:return 2;case c.OfficeAppType.TaskPaneApp:return 1;case c.OfficeAppType.MailApp:return 3;default:return 0}},getPermission:function(){return this._permissions},hasPermission:function(e){return(this._permissions&e)===e},getHosts:function(){return this._hosts},getHostsXml:function(){return this._hostsXml},getRequirements:function(){return this._requirements},getRequirementsXml:function(){return this._requirementsXml},getHighResolutionIconUrl:function(e){return this._highResolutionIconUrls[e]},getDefaultHighResolutionIconUrl:function(){return this._getDefaultValue(this._highResolutionIconUrls)},getAppDomains:function(){return this._appDomains},getInMemoryEToken:function(){return this._inMemoryEToken},isAllowSnapshot:function(){return this._allowSnapshot},addManifestUrl:function(e){var t=p.WACUtils.getDomainForUrl(e);-1===this._appDomains.indexOf(t)&&this._appDomains.push(t)},getWebApplicationResource:function(){return this._webApplicationResource},getWebApplicationId:function(){return this._webApplicationId},getWebApplicationMsaId:function(){return this._webApplicationMsaId},getWebApplicationScopes:function(){return this._webApplicationScopes},getWebApplicationAuthorizations:function(){return this._webApplicationAuthorizations},getEquivalentAddins:function(){return this._equivalentAddins?this._equivalentAddins.getEquivalentAddins():[]},isXLLCompatible:function(){return!!this._equivalentAddins&&this._equivalentAddins.isXLLCompatible()},isSSOAddin:function(){return!!this._webApplicationResource&&!!this._webApplicationId},containsAddinCommands:function(e){var t=this._getCurrentHostTypeNode(e);if(null!==t&&null!=this._xmlProcessor.selectSingleNode("ov:DesktopFormFactor",t))return!0;return!1},getRibbonExtensionControlMap:function(){return this._ribbonExtensionControls},getExtendedOverrides:function(){return this._extendedOverrides},getExtendedOverridesTokens:function(){return this._extendedOverridesTokens?this._extendedOverridesTokens:[]},containsCustomFunctions:function(e){var t=this._getCurrentHostTypeNode(e);if(null!==t){var n=this._xmlProcessor.selectSingleNode("ov:AllFormFactors",t);if(null!==n){var r=this._xmlProcessor.selectNodes("ov:ExtensionPoint",n);if(null!==r)for(var o=r.length,i=0;i<o;i++){if("CustomFunctions"===r[i].getAttribute("xsi:type"))return!0}}}return!1},containsCustomFunctionsForAppHost:function(e){var t=c.getManifestHostType(e);return e!=c.HostType.Outlook&&this.containsCustomFunctions(t)},getSharedRuntimeForCustomFunctions:function(e){var t=null;if(e==t||this._versionOverrides==t)return t;var n=this._versionOverrides[e];return n==t||n._customFunctionExtensionPoint==t||n._runtimes==t?t:n._runtimes.getSharedRuntime(n._customFunctionExtensionPoint.pageResId)},getSharedRuntimeForTaskpane:function(e,t){var n=null;if(e==n||t==n||this._versionOverrides==n)return n;var r=this._versionOverrides[e];if(r==n||r._showTaskpaneControls==n||r._runtimes==n)return n;var o=n;return this._iterateAppCommandShowTaskpaneControls(r._showTaskpaneControls,(function(e){return e!=n&&e.action!=n&&((e.action.taskpaneId===t||e.id===t)&&(o=e.action.sourceLocationResid,!0))})),o==n?n:r._runtimes.getSharedRuntime(o)},getTaskpaneIdByRuntimeId:function(e,t){var n=null;if(e==n||t==n||this._versionOverrides==n)return n;var r=this._versionOverrides[e];if(r==n||r._showTaskpaneControls==n||r._runtimes==n)return n;var o=n;return this._iterateAppCommandShowTaskpaneControls(r._showTaskpaneControls,(function(e){return e!=n&&e.action!=n&&(e.action.sourceLocationResid===t&&(o=e.action.taskpaneId,!0))})),o},getSharedRuntimeById:function(e,t){var n=null;if(this._versionOverrides==n)return n;var r=this._versionOverrides[e];return r==n||r._runtimes==n?n:r._runtimes.getSharedRuntime(t)},getSharedRuntimeForAppCmdsExecuteFunction:function(e){var t=null;if(e==t||this._versionOverrides==t)return t;var n=this._versionOverrides[e];return n==t||n._runtimes==t?t:n._runtimes.getSharedRuntime(n._functionFileResid)},getSharedRuntimeId:function(e,t,n){var r=t?this.getSharedRuntimeForAppCmdsExecuteFunction(e):this.getSharedRuntimeForTaskpane(e,n);return null!==r?r.Resid:null},sharedRuntimeHasShortLifeTime:function(e,t){var n=null;if(e===n||t===n||this._versionOverrides===n)return!1;var r=this._versionOverrides[e];if(r===n||r._runtimes===n)return!1;var o=r._runtimes.getSharedRuntime(t);return o!==n&&o.LifeTime===u.Short},complementVersion:function(e){return RegExp("^[0-9]{1,5}(\\.[0-9]{1,5}){3}$").test(e)||(RegExp("^[0-9]{1,5}(\\.[0-9]{1,5}){2}$").test(e)?e+=".0":RegExp("^[0-9]{1,5}\\.[0-9]{1,5}$").test(e)?e+=".0.0":RegExp("^[0-9]{1,5}$").test(e)&&(e+=".0.0.0")),e},_iterateAppCommandShowTaskpaneControls:function(e,t){if(null!=e&&null!=t)for(var n=0;n<e.length&&!t(e[n]);n++);},_generateRibbonExtensionControlMap:function(e){var t=null,n=this;if(e==t||n._versionOverrides==t)return t;var r=n._versionOverrides[e];if(r!=t&&r._addinCommandsExtensionPoints!=t)for(var o=r._addinCommandsExtensionPoints.length,i=0;i<o;i++){var a=r._addinCommandsExtensionPoints[i];if("PrimaryCommandSurface"===a.type&&a.tabs)for(var s=0;s<a.tabs.length;s++){var l=a.tabs[s];n._ribbonExtensionControls[l.id]=l,n._addRibbonControlsToMap(l)}}},_addRibbonControlsToMap:function(e){if(e&&e.children)for(var t=0;t<e.children.length;t++){var n=e.children[t];!n||n instanceof p.Parser.MenuControl||(this._ribbonExtensionControls[n.id]=n),this._addRibbonControlsToMap(n)}},_retrieveAppCommandShowTaskpaneControls:function(e){var t=null,n=this;if(e==t||n._versionOverrides==t)return t;var r=n._versionOverrides[e],o=[];if(r!=t&&r._addinCommandsExtensionPoints!=t)for(var i=r._addinCommandsExtensionPoints.length,a=0;a<i;a++){var s=r._addinCommandsExtensionPoints[a];if(s!=t)if("PrimaryCommandSurface"===s.type){if(s.tabs==t)continue;for(var l=0;l<s.tabs.length;l++){var c=s.tabs[l];if(c!=t&&c.children!=t)for(var d=0;d<c.children.length;d++){var u=c.children[d];u!=t&&u.children!=t&&n._getShowTaskpaneControlsFromControlsParent(u,o)}}}else if("ContextMenu"===s.type){if(s.children==t)continue;var p=s.children[0];if(p==t||p.children==t)continue;n._getShowTaskpaneControlsFromControlsParent(p,o)}}return o},_getShowTaskpaneControlsFromControlsParent:function(e,t){var n="ShowTaskpane",r=null;if(e!=r&&e.children!=r&&t!=r)for(var o=0;o<e.children.length;o++){var i=e.children[o];if(i!=r)if("Button"===i.controlType)i.action!=r&&i.actionType===n&&t.push(i);else{if(i.children==r)continue;for(var a=0;a<i.children.length;a++){var s=i.children[a];s!=r&&s.action!=r&&s.actionType===n&&t.push(s)}}}},_validateShowTaskpaneSharedRuntime:function(e){var t=null;if(e!=t&&this._versionOverrides!=t){var n=this._versionOverrides[e];if(n!=t&&n._runtimes!=t&&n._showTaskpaneControls!=t){var r=[];this._iterateAppCommandShowTaskpaneControls(n._showTaskpaneControls,(function(e){var o="Manifest parser failure: resid and taskpaneid not correct";if(e==t||e.action==t)return!1;var i=n._runtimes.getSharedRuntime(e.action.sourceLocationResid),a=t;if(i==t||i.LifeTime!=u.Long){if(e.action.taskpaneId==t)return!1}else a=i.Resid;for(var s=[e.action.taskpaneId,a],c=!0,d=0;d<r.length;d++){if(r[d][0]==s[0]&&r[d][1]==s[1]){if(s[0]==t)throw l.msAjaxError.argument(o);c=!1;break}if(r[d][1]==s[1]&&r[d][1]!=t||r[d][0]==s[0]&&r[d][0]!=t)throw c=!1,l.msAjaxError.argument(o)}return c&&r.push(s),!1}))}}},_getDefaultValue:function(e){var t,n=this;if(n._UILocale&&(t=e[n._UILocale]||e[n._UILocale.toLocaleLowerCase()]||void 0),!t&&n._defaultLocale&&(t=e[n._defaultLocale]||e[n._defaultLocale.toLocaleLowerCase()]||void 0),!t){var r;for(var o in e){r=o;break}t=e[r]}return t},_getExtensionSetting:function(e){var t,n=this;if(void 0!==n._extensionSettings[e])t=n._extensionSettings[e];else for(var r in n._extensionSettings){t=n._extensionSettings[r];break}return t},_addDisplayName:function(e,t){this._displayNames[e.toLocaleLowerCase()]=t},_addDescription:function(e,t){this._descriptions[e]=t},_addIconUrl:function(e,t){this._iconUrls[e]=t},_parseLocaleAwareSettings:function(e,t){if(!e)throw l.msAjaxError.argument("Manifest");var n=e.getAttribute("DefaultValue");t(this._defaultLocale,n);var r=this._xmlProcessor.selectNodes("o:Override",e);if(r)for(var o=r.length,i=0;i<o;i++){var a=r[i];t(a.getAttribute("Locale"),a.getAttribute("Value"))}},_parseBooleanNode:function(e){if(e){var t=this._xmlProcessor.getNodeValue(e).toLowerCase();return"true"===t||"1"===t}return!1},_parseIdIssuer:function(e){if(e){var t=this._xmlProcessor.getNodeValue(e);return c.OUtil.parseEnum(t,c.ManifestIdIssuer)}return c.ManifestIdIssuer.Custom},_parseCapabilities:function(e){for(var t,n=[],r=0;r<e.length;r++){t=e[r].getAttribute("Name"),t=c.OUtil.parseEnum(t,c.Capability),n.push(t)}return n},_parsePermission:function(e){if(!e)throw l.msAjaxError.argument("Manifest");var t=this._xmlProcessor.getNodeValue(e);return c.OUtil.parseEnum(t,c.OsfControlPermission)},_parseExtensionSettings:function(){var e,t,n,r=this,o=r;for(var i in c.FormFactor){var a=r._xmlProcessor.selectSingleNode("o:OfficeApp");if(t=r._xmlProcessor.selectSingleNode("o:"+c.FormFactor[i],a)){e=new c.Manifest.ExtensionSettings,n=r._xmlProcessor.selectSingleNode("o:SourceLocation",t);r._parseLocaleAwareSettings(n,(function(t,n){e._addSourceLocation(t,n),o.addManifestUrl(n)})),(n=r._xmlProcessor.selectSingleNode("o:RequestedWidth",t))&&e._setDefaultWidth(r._xmlProcessor.getNodeValue(n)),(n=r._xmlProcessor.selectSingleNode("o:RequestedHeight",t))&&e._setDefaultHeight(r._xmlProcessor.getNodeValue(n)),r._extensionSettings[i]=e}}if(!e)throw l.msAjaxError.argument("Manifest")},_parseHosts:function(e){var t=[];if(e)for(var n=this._xmlProcessor.selectNodes("o:Host",e),r=0;r<n.length;r++)t.push(n[r].getAttribute("Name"));return t},_parseWebApplicationScopes:function(e,t){var n=[];if(e)for(var r=this._xmlProcessor.selectNodes(t+"Scope",e),o=0;o<r.length;o++)n.push(this._xmlProcessor.getNodeValue(r[o]));return n},_parseWebAppInfoAuthorizations:function(e,t){var n=this,r=[],o=n._xmlProcessor.selectSingleNode(t+"Authorizations",e);if(o){var i=n._xmlProcessor.selectNodes(t+"Authorization",o);if(i)for(var a=0;a<i.length;a++){var s=i[a],l=new c.Manifest.WebAppInfoAuthorization,d=n._xmlProcessor.selectSingleNode(t+"Resource",s);d&&(l._resource=n._xmlProcessor.getNodeValue(d));var u=n._xmlProcessor.selectSingleNode(t+"Scopes",s);if(u){var p=n._xmlProcessor.selectNodes(t+"Scope",u);if(p){for(var f=[],m=0;m<p.length;m++){var g=p[m];f.push(n._xmlProcessor.getNodeValue(g))}l._scopes=f}}r.push(l)}}return r},_parseRequirements:function(e){var t=this,n={sets:[],methods:[]};if(e){var r=t._xmlProcessor.selectSingleNode("o:Sets",e);n.sets=t._parseSets(r);var o=t._xmlProcessor.selectSingleNode("o:Methods",e);n.methods=t._parseMethods(o)}return n},_parseSets:function(e){var t=[];if(e)for(var n=e.getAttribute("DefaultMinVersion"),r=this._xmlProcessor.selectNodes("o:Set",e),o=0;o<r.length;o++){var i=r[o],a=i.getAttribute("MinVersion");t.push({name:i.getAttribute("Name"),version:a||n})}return t},_parseMethods:function(e){var t=[];if(e)for(var n=this._xmlProcessor.selectNodes("o:Method",e),r=0;r<n.length;r++)t.push(n[r].getAttribute("Name"));return t},_parseSourceLocationOverrides:function(e){var t={};if(e){var n=this._xmlProcessor.selectSingleNode("ov:Resources",e);if(n){var r=this._xmlProcessor.selectSingleNode("bt:Urls",n);if(r){var o=this._xmlProcessor.selectNodes("bt:Url",r);if(o)for(var i=0;i<o.length;i++){var a=o[i],s=a.getAttribute("id"),l=a.getAttribute("DefaultValue");s&&l&&(t[s]=l)}}}}return t},_parseAppDomains:function(e){var t=[];if(e)for(var n=this._xmlProcessor.selectNodes("o:AppDomain",e),r=0;r<n.length;r++){var o=p.WACUtils.getDomainForUrl(this._xmlProcessor.getNodeValue(n[r]));-1===t.indexOf(o)&&t.push(o)}return t},_parseRuntimes:function(e){var t=null;if(e==t)return t;var n=new c.Manifest.Runtimes,r=this._xmlProcessor.selectNodes("ov:Runtime",e);if(r==t)return t;for(var o=0;o<r.length;o++){var i=this._parseRuntime(r[o]);n.add(i)}return n},_parseRuntime:function(e){if(null==e)return null;var t=new c.Manifest.Runtime;return t.Resid=e.getAttribute("resid"),"long"===e.getAttribute("lifetime")?t.LifeTime=u.Long:t.LifeTime=u.Short,t},_parseEquivalentAddins:function(e,t){var n=new c.Manifest.EquivalentAddins;if(e)for(var r=this._xmlProcessor.selectNodes(t+"EquivalentAddin",e),o=0;o<r.length;o++){var i=this._parseEquivalentAddin(r[o],t);n.add(i)}return n},_parseEquivalentAddin:function(e,t){var n=this,r=new c.Manifest.EquivalentAddin;if(e){var o=n._xmlProcessor.selectSingleNode(t+"ProgId",e);o&&(r._progId=n._xmlProcessor.getNodeValue(o));var i=n._xmlProcessor.selectSingleNode(t+"FileName",e);i&&(r._fileName=n._xmlProcessor.getNodeValue(i));var a=n._xmlProcessor.selectSingleNode(t+"Type",e);if(!a)throw l.msAjaxError.argument("Manifest");var s=""+n._xmlProcessor.getNodeValue(a);r._type=s.toUpperCase()}return r},_parseExtendedOverrides:function(e){var t="xsi:type",n=this;n._extendedOverrides={url:e.getAttribute("Url"),resourcesUrl:e.getAttribute("ResourcesUrl"),hasFinalUrls:!1};var r=n._xmlProcessor.selectSingleNode("o:Tokens",e);if(null!=r){var o=n._xmlProcessor.selectNodes("o:Token",r);if(null!=o){for(var i=[],a=0;a<o.length;a++){var s=o[a],l=n._xmlProcessor.selectNodes("o:Override",s),d=[],u=s.getAttribute(t);if(u==c.ExtendedManifestSupportTokens.Requirements)for(var p=0;p<l.length;p++){var f=n._xmlProcessor.selectSingleNode("o:Requirements",l[p]),m={value:l[p].getAttribute("Value"),data:n._parseRequirements(f)};d.push(m)}else if(u==c.ExtendedManifestSupportTokens.Locale)for(p=0;p<l.length;p++){m={value:l[p].getAttribute("Value"),data:l[p].getAttribute("Locale").toLowerCase()};d.push(m)}var g={name:s.getAttribute("Name"),defaultValue:s.getAttribute("DefaultValue"),type:s.getAttribute(t),overrides:d};i.push(g)}n._extendedOverridesTokens=i}}},_addHighResolutionIconUrl:function(e,t){this._highResolutionIconUrls[e]=t},_isAddinCommandsManifest:function(e){return this.containsAddinCommands(e)||this.containsCustomFunctions(e)},_getCurrentHostTypeNode:function(e){var t=null,n=this,r=n._xmlProcessor.selectSingleNode("o:OfficeApp");if(r!==t&&n.getManifestSchemaVersion()===c.ManifestSchemaVersion[1.1]){var o=n._xmlProcessor.selectSingleNode("ov:VersionOverrides",r);if(o!==t){var i=n._xmlProcessor.selectSingleNode("ov:Hosts",o);if(i!==t){var a=n._xmlProcessor.selectNodes("ov:Host",i);if(a!==t)for(var s=a.length,l=0;l<s;l++){if(a[l].getAttribute("xsi:type")===e)return a[l]}}}}return t}},c.OsfManifestManager=function(){var e="undefined",t="marketplaceVersion",n="marketplaceID",r="string",o=!0,i=null,a=!1,l={},d="en-us",u={};function f(e,t){return e+"_"+t}return{getManifestAsync:function(e,t){var n="OEM_getManifestAsync",d="getManifestAsync failed:",u="Invalid manifest in getManifestAsync.",m=this;if(c.OUtil.validateParamObject(e,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a}},t),c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)){var g=m,v=(S=e.referenceInUse).solutionId;e.osfControl!=i&&e.osfControl._sharedRuntimeId!=i&&e.osfControl._sharedRuntimeId.length>0&&(v=c.OsfManifestManager.getSharedRuntimeManifestCacheKey(S.solutionId,e.osfControl._sharedRuntimeId));var h=f(v,S.version),y=l[h];if(e.manifestCached=a,y)e.manifestCached=o,g.manifestContainsDownloadResources(y)?g.downloadResourcesAsync(e,t,y,h):t({statusCode:c.ProxyCallStatusCode.Succeeded,value:y,context:e});else if(e.clientEndPoint&&e.manifestUrl){s.AppLoadTimeHelper.ManifestRequestStart(e.osfControl._telemetryContext);var C=function(n){var a;if(n.statusCode===c.ProxyCallStatusCode.Succeeded&&n.value)try{var l;a=n.context.osfControl,typeof n.value===r?(n.context.manifestCached=o,l=n.value):(n.context.manifestCached=n.value.cached,l=n.value.manifest),s.AppLoadTimeHelper.SetManifestDataCachedFlag(a._telemetryContext,n.value.cached),n.value=new c.Manifest.Manifest(l,a._contextActivationMgr.getAppUILocale()),c.OsfManifestManager.cacheManifest(S.solutionId,S.version,n.value)}catch(e){var f;n.value=i,a&&(f=a._appCorrelationId);var m=u;p.WACUtils.logExceptionToBrowserConsole(m,e),s.RuntimeTelemetryHelper.LogExceptionTag(m,e,f,18420423)}else s.RuntimeTelemetryHelper.LogExceptionTag(d+p.WACUtils.serializeObjectToString(n),i,i,18420424);g.manifestContainsDownloadResources(y)?g.downloadResourcesAsync(e,t,n.value,h):t(n)},_={manifestUrl:e.manifestUrl,id:S.solutionId,version:S.version,clearCache:e.clearCache||a};m._invokeProxyMethodAsync(e,n,C,_)}else t({statusCode:c.ProxyCallStatusCode.Failed,value:i,context:e})}else{var S;g=m,v=(S=e.referenceInUse).id;e.osfControl!=i&&e.osfControl._sharedRuntimeId!=i&&e.osfControl._sharedRuntimeId.length>0&&(v=c.OsfManifestManager.getSharedRuntimeManifestCacheKey(S.id,e.osfControl._sharedRuntimeId));h=f(v,S.version),y=l[h];if(e.manifestCached=a,y)e.manifestCached=o,g.manifestContainsDownloadResources(y)?g.downloadResourcesAsync(e,t,y,h):t({statusCode:c.ProxyCallStatusCode.Succeeded,value:y,context:e});else if(e.clientEndPoint&&e.manifestUrl){s.AppLoadTimeHelper.ManifestRequestStart(e.osfControl._telemetryContext);C=function(n){var a;if(n.statusCode===c.ProxyCallStatusCode.Succeeded&&n.value)try{var l;a=n.context.osfControl,typeof n.value===r?(n.context.manifestCached=o,l=n.value):(n.context.manifestCached=n.value.cached,l=n.value.manifest),s.AppLoadTimeHelper.SetManifestDataCachedFlag(a._telemetryContext,n.value.cached),n.value=new c.Manifest.Manifest(l,a._contextActivationMgr.getAppUILocale()),c.OsfManifestManager.cacheManifest(S.id,S.version,n.value)}catch(e){var f;n.value=i,a&&(f=a._appCorrelationId);var m=u;p.WACUtils.logExceptionToBrowserConsole(m,e),s.RuntimeTelemetryHelper.LogExceptionTag(m,e,f,544219482)}else s.RuntimeTelemetryHelper.LogExceptionTag(d+p.WACUtils.serializeObjectToString(n),i,i,544219481);g.manifestContainsDownloadResources(y)?g.downloadResourcesAsync(e,t,n.value,h):t(n)},_={manifestUrl:e.manifestUrl,id:S.id,version:S.version,clearCache:e.clearCache||a};m._invokeProxyMethodAsync(e,n,C,_)}else t({statusCode:c.ProxyCallStatusCode.Failed,value:i,context:e})}},manifestContainsDownloadResources:function(e){return this.manifestContainsExtendedOverrides(e)},manifestContainsExtendedOverrides:function(e){return"object"==typeof e&&"function"==typeof e.getExtendedOverrides&&"object"==typeof e.getExtendedOverrides()},downloadResourcesAsync:function(e,t,n,r){this.manifestContainsExtendedOverrides(n)&&this.downloadExtendedOverridesAsync(e,t,n,r)},downloadExtendedOverridesAsync:function(e,t,n,r){var o=this,a=function(e,t,n,a){var l=e.osfControl._appCorrelationId;p.WACUtils.logExceptionToBrowserConsole(a,n),s.RuntimeTelemetryHelper.LogExceptionTag(a,n,l,573125015),o._cachedManifests&&o._cachedManifests[r]&&(o._cachedManifests[r]=void 0),t({statusCode:c.ProxyCallStatusCode.Failed,value:i,context:e})};!this.manifestContainsExtendedOverrides(n)&&a(e,t,"Unreachable","Unreachable code path executed!");try{var l=e.osfControl.getInitializationReason()==Microsoft.Office.WebExtension.InitializationReason.Inserted;e.osfControl.processManifestForExtendedOverrides(n,l).then((function(){return function(e,t,n){t({statusCode:c.ProxyCallStatusCode.Succeeded,value:n,context:e})}(e,t,n)})).catch((function(n){return a(e,t,n,"Invalid ExtendedOverrides content.")}))}catch(n){a(e,t,n,"Unexpected exception from OsfControlV2.processManifestForExtendedOverrides()")}},getAppInstanceInfoByIdAsync:function(e,t){c.OUtil.validateParamObject(e,{webUrl:{type:String,mayBeNull:a},appInstanceId:{type:String,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a}},t);var n={webUrl:e.webUrl,appInstanceId:e.appInstanceId,clearCache:e.clearCache||a};this._invokeProxyMethodAsync(e,"OEM_getSPAppInstanceInfoByIdAsync",t,n)},getSPTokenByProductIdAsync:function(e,t){c.OUtil.validateParamObject(e,{appWebUrl:{type:String,mayBeNull:a},productId:{type:String,mayBeNull:a}},t);var n=this;e.osfControl._contextActivationMgr._createSharePointIFrameProxy(e.appWebUrl,(function(r){if(r){var o={webUrl:e.appWebUrl,productId:e.productId,clearCache:e.clearCache||a,clientEndPoint:r};n._invokeProxyMethodAsync(e,"OEM_getSPTokenByProductIdAsync",t,o)}else t({statusCode:c.ProxyCallStatusCode.ProxyNotReady,value:i,context:e})}))},getSPAppEntitlementsAsync:function(e,t){var n="/";if(c.OUtil.validateParamObject(e,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},baseUrl:{type:String,mayBeNull:a},pageUrl:{type:String,mayBeNull:a},webUrl:{type:String,mayBeNull:o}},t),e.webUrl)this.getCorporateCatalogEntitlementsAsync(e,t);else{var r=document.createElement("a");r.href=e.pageUrl;var s=r.pathname,l=s.split(n),d=l.length-1,u=r.href.substring(0,r.href.length-s.length);u&&u.charAt(u.length-1)!==n&&(u+=n);for(var p=[u],f=0;f<d;f++)l[f]&&(u=u+l[f]+n,p.push(u));r=i;var m=this,g=e.osfControl._contextActivationMgr,v=p.pop(),h=function(e){if(e.statusCode===c.ProxyCallStatusCode.Succeeded){var r=e.value;r&&r.charAt(r.length-1)!==n&&(r+=n),g._webUrl=r,e.context.webUrl=r,e.context.appWebUrl=r,m.getCorporateCatalogEntitlementsAsync(e.context,t)}else t(e)},y=function(n){if(n){e.clientEndPoint=n;var r={pageUrl:e.pageUrl,baseUrl:v,clearCache:e.clearCache||a};m._invokeProxyMethodAsync(e,"OEM_getSPAppWebUrlFromPageUrlAsync",h,r)}else p.length>0?(v=p.pop(),g._createSharePointIFrameProxy(v,y)):t({statusCode:c.ProxyCallStatusCode.Failed,value:i,context:e})};g._createSharePointIFrameProxy(v,y)}},getOneDriveEntitlementsAsync:function(e,t){var n,r,o="Content-Type",i="/root:/Manifests";c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?(n=e.referenceInUse.storeId,r=e.referenceInUse.storeId+i):(n=e.referenceInUse.storeLocator,r=e.referenceInUse.storeLocator+i);var a=c.OneDriveOAuth.getAccessTokenFromCookie(),s="?access_token="+a,l=r+s,d=new XMLHttpRequest,u=new XMLHttpRequest;d.onreadystatechange=function(){var t="/children";if(4==d.readyState&&200==d.status){var n,r=JSON.parse(d.response).id;n=c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?e.referenceInUse.storeId+"/items/"+r+t+s:e.referenceInUse.storeLocator+"/items/"+r+t+s,u.open("GET",n),u.setRequestHeader(o,"json"),u.send()}};var p=[],f=0,m=0,g=function(){f==m&&t({statusCode:c.ProxyCallStatusCode.Succeeded,value:{entitlements:p},context:e})},v=function(e,t){m++;var n=t;try{var r=new c.Manifest.Manifest(e.responseText),o=[];o.push(r.getDefaultDisplayName()),o.push(n),o.push(r.getDefaultDescription()),o.push(r.getTarget()),o.push(r.getMarketplaceVersion()),o.push(n),o.push(c.StoreType.OneDrive),o.push(r.getDefaultWidth()||0),o.push(r.getDefaultHeight()||0),o.push(r.getDefaultIconUrl()),o.push(r.getProviderName()),o.push(r.getDefaultLocale()),o.push(c.StoreType.OneDrive),p.push(o)}catch(e){}g()},h=function(){m++,g()};u.onreadystatechange=function(){if(4==u.readyState&&200==u.status){for(var e=JSON.parse(u.responseText),t=0;t<e.value.length;t++)if(".xml"==e.value[t].name.substr(e.value[t].name.length-4).toLowerCase()){var r=n+"/root:/Manifests/"+e.value[t].name+":/content?access_token="+a;c.OUtil.xhrGetFull(r,e.value[t].name,v,h),f++}g()}},d.open("GET",l),d.setRequestHeader(o,"json"),d.send()},getCorporateCatalogEntitlementsAsync:function(e,t){c.OUtil.validateParamObject(e,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},webUrl:{type:String,mayBeNull:a}},t),s.AppLoadTimeHelper.AuthenticationStart(e.osfControl._telemetryContext);var n=this,r=0,l=function(d){if(d){s.AppLoadTimeHelper.AuthenticationEnd(e.osfControl._telemetryContext),e.clientEndPoint=d;var u={webUrl:e.webUrl,applicationName:c.HostCapability[e.hostType],officeExtentionTarget:e.noTargetType||e.osfControl.getOsfControlType()===c.OsfControlTarget.TaskPane?i:e.osfControl.getOsfControlType(),clearCache:e.clearCache||a,supportedManifestVersions:{"1.0":o,1.1:o}};n._invokeProxyMethodAsync(e,"OEM_getEntitlementSummaryAsync",t,u)}else r<c.Constants.AuthenticatedConnectMaxTries?(r++,setTimeout((function(){e.osfControl._contextActivationMgr._createSharePointIFrameProxy(e.webUrl,l)}),500)):t({statusCode:c.ProxyCallStatusCode.ProxyNotReady,value:i,context:e})};e.osfControl._contextActivationMgr._createSharePointIFrameProxy(e.webUrl,l)},_invokeProxyMethodAsync:function(e,t,n,o){var a,l=[o.clientEndPoint?o.clientEndPoint._targetUrl:e.clientEndPoint._targetUrl,t];for(var d in o)((a=typeof o[d])===r||"number"===a||"boolean"===a)&&l.push(o[d]);var f=l.join("."),m=u,g={onCompleted:n,context:e,methodName:t},v=m[f];if(v)v.push(g);else{m[f]=[g];var h=e.clientEndPoint;o.clientEndPoint&&(h=o.clientEndPoint,delete o.clientEndPoint),e.referenceInUse&&e.referenceInUse.storeType===c.StoreType.OMEX&&(o.officeVersion=c.Constants.ThreePartsFileVersion),h.invoke(t,(function(e,t){var n=i,r=c.ProxyCallStatusCode.Failed;0===e&&t.status&&(n=t.result,r=c.ProxyCallStatusCode.Succeeded);var o=m[f];delete m[f];for(var a=o.length,l=0;l<a;l++){var d,u=o.shift();try{u.context&&u.context.osfControl&&(d=u.context.osfControl._appCorrelationId),t&&t.failureInfo&&s.RuntimeTelemetryHelper.LogProxyFailure(d,u.methodName,t.failureInfo),u.onCompleted({statusCode:r,value:n,context:u.context})}catch(e){var g="_invokeProxyMethodAsync failed.";p.WACUtils.logExceptionToBrowserConsole(g,e),s.RuntimeTelemetryHelper.LogExceptionTag(g,e,d,18420425)}}}),o)}},removeOmexCacheAsync:function(e,t){c.OUtil.validateParamObject(e,{osfControl:{type:Object,mayBeNull:a},referenceInUse:{type:Object,mayBeNull:a},clientEndPoint:{type:Object,mayBeNull:a}},t);var n,r=e.referenceInUse;c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?(n={applicationName:e.hostType,assetID:r.solutionId,officeExtentionTarget:e.osfControl.getOsfControlType(),clearEntitlement:e.clearEntitlement||a,clearToken:e.clearToken||a,clearAppState:e.clearAppState||a,clearManifest:e.clearManifest||a,appVersion:e.appVersion},e.anonymous?n.contentMarket=r.storeId:(n.assetContentMarket=e.osfControl._omexEntitlement.contentMarket,n.userContentMarket=r.storeId)):(n={applicationName:e.hostType,assetID:r.id,officeExtentionTarget:e.osfControl.getOsfControlType(),clearEntitlement:e.clearEntitlement||a,clearToken:e.clearToken||a,clearAppState:e.clearAppState||a,clearManifest:e.clearManifest||a,appVersion:e.appVersion},e.anonymous?n.contentMarket=r.storeLocator:(n.assetContentMarket=e.osfControl._omexEntitlement.contentMarket,n.userContentMarket=r.storeLocator)),this._invokeProxyMethodAsync(e,"OMEX_removeCacheAsync",t,n)},purgeManifest:function(r,o){var i=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a},{name:t,type:String,mayBeNull:a}]);if(i)throw i;var s=f(r,o);typeof l[s]!=e&&delete l[s]},cacheManifestFromXml:function(e,r,o,i){var s=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a},{name:t,type:String,mayBeNull:a},{name:"manifestXml",type:String,mayBeNull:a},{name:"uiLocale",type:String,mayBeNull:a}]);if(s)throw s;this.cacheManifest(e,r,new c.Manifest.Manifest(o,i))},cacheManifest:function(e,r,o){var i=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a},{name:t,type:String,mayBeNull:a},{name:"manifest",type:Object,mayBeNull:a}]);if(i)throw i;var s=f(e,r);o._UILocale=o._UILocale||d,l[s]=o},hasManifest:function(r,i){var s=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a},{name:t,type:String,mayBeNull:a}]);if(s)throw s;var c=f(r,i);return typeof l[c]!=e?o:a},hasManifestForControl:function(e){return c.OUtil.validateParamObject(e,{referenceInUse:{type:Object,mayBeNull:a}},i),c.OUtil.checkFlight(c.FlightTreatmentNames.OSFSolutionRefactor)?this.hasManifest(e.referenceInUse.solutionId,e.referenceInUse.version):this.hasManifest(e.referenceInUse.id,e.referenceInUse.version)},getCachedManifest:function(e,r){var o=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a},{name:t,type:String,mayBeNull:a}]);if(o)throw o;var i=f(e,r);return l[i]},getSharedRuntimeManifestCacheKey:function(e,t){var r=Function._validateParams(arguments,[{name:n,type:String,mayBeNull:a},{name:"sharedRuntimeId",type:String,mayBeNull:a}]);if(r)throw r;return e+t},versionLessThan:function(e,t){for(var n,r,o=e.split("."),i=t.split("."),s=Math.min(o.length,i.length),l=0;l<s;l++)try{if((n=parseFloat(o[l]))!=(r=parseFloat(i[l])))return n<r}catch(e){}if(o.length>=i.length)return a;s=i.length;var c=0;for(l=o.length;l<s;l++){try{r=parseFloat(i[l])}catch(e){r=0}c+=r}return c>0},_setUILocale:function(e){d=e}}}(),c.AddinIdInfo=function(e){var t=null,n=e.split("|");8!=n.length&&s.RuntimeTelemetryHelper.LogCommonMessageTag("OSF.AddinIdInfo.constructor: Unexpected format of the addinId",t,573125014);var r=n[0],o=n[1],i=n[2],a=n[3],l=n[4],d=t;return"2"!=r&&s.RuntimeTelemetryHelper.LogCommonMessageTag("OSF.AddinIdInfo.constructor: Unexpected format version: "+r+".",t,573125013),{getSolutionId:function(){return o},getSolutionVersion:function(){return i},getFormatVersion:function(){return r},getStoreTypeId:function(){return a},getStoreLocation:function(){return l},getPrivacyCompliantSolutionId:function(){return d==t&&c.OUtil.checkFlight("Microsoft.Office.SharedOnline.IsPrivateAddin")&&(d=s.PrivacyRules.GetAssetId(p.ManifestUtil.GetStoreTypeName(a),l,o)),d==t?o:d},needToRestoreManifest:function(){return a==c.StoreTypeEnum.Registry.toString()}}},function(e){!function(e){var t="missingModifierKey",n="invalidParameter",r="downloadError",o="invalidKeyCode",i="invalidExtendedOverride",a="tokenError";e[e.Invalid=0]="Invalid",e[e[a]=1]=a,e[e[i]=2]=i,e[e[o]=3]=o,e[e[r]=4]=r,e[e[n]=5]=n,e[e[t]=6]=t}(e.OsfRuntimeErrorCode||(e.OsfRuntimeErrorCode={}));var t=function(e){function t(n,r){var o=e.call(this,r)||this;return Object.setPrototypeOf(o,t.prototype),o.code=n,o.name="OsfRuntimeError",o}return i(t,e),t}(Error);e.OsfRuntimeError=t;var n=function(e){function t(n,r){var o=e.call(this,n,"Multiple Errors")||this;return Object.setPrototypeOf(o,t.prototype),o.messages=r,r.forEach((function(e){})),o}return i(t,e),t}(t);e.OsfMultiError=n}(p||(p={})),c.ManifestSchemaVersion={"1.0":"1.0",1.1:"1.1"},c.ManifestNamespaces={"1.0":'xmlns="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"',1.1:'xmlns="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:o="http://schemas.microsoft.com/office/appforoffice/1.1" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bt="http://schemas.microsoft.com/office/officeappbasictypes/1.0" xmlns:ov="http://schemas.microsoft.com/office/taskpaneappversionoverrides" xmlns:c="http://schemas.microsoft.com/office/contentappversionoverrides"'},c.OsfNavigationMode={DefaultMode:0,CategoryMode:1,TrustPageMode:2,QueryResultMode:3},c.RequirementsChecker=function(e,t,n,r,o){var i=this;i.setCapabilities(e),i.setHosts(t),i.setRequirements(n),i.setSupportedControlTargets(r),i.setSupportedOmexAppVersions(o),i.setFilteringEnabled(!1)},c.RequirementsChecker.prototype={defaultMinMaxVersion:"1.1",isManifestSupported:function(e){if(!this.isFilteringEnabled())return!0;if(!e)return!1;switch(e.getManifestSchemaVersion()||c.ManifestSchemaVersion["1.0"]){case c.ManifestSchemaVersion["1.0"]:return this._checkManifest1_0(e);case c.ManifestSchemaVersion[1.1]:return this._checkManifest1_1(e);default:return!1}},isEntitlementFromOmexSupported:function(e){var t,n=this;if(!n.isFilteringEnabled())return!0;if(!e)return!1;switch(e.appSubType){case"1":t=c.OsfControlTarget.TaskPane;break;case"2":t=c.OsfControlTarget.InContent;break;case"3":t=c.OsfControlTarget.Contextual;break;case"4":t=c.OsfControlTarget.TaskPane;break;default:return!1}if(!n._checkControlTarget(t))return!1;if(!e.requirements&&!e.hosts)return!e.hasOwnProperty("appVersions")||void 0===e.appVersions||n._checkOmexAppVersions(e.appVersions);var r,o,i,a,s=new c.Manifest.Manifest((function(){}));return e.requirements&&(s._xmlProcessor=new c.XmlProcessor(e.requirements,c.ManifestNamespaces[1.1]),o=s._xmlProcessor.getDocumentElement()),r=s._parseRequirements(o),e.hosts&&(s._xmlProcessor=new c.XmlProcessor(e.hosts,c.ManifestNamespaces[1.1]),a=s._xmlProcessor.getDocumentElement()),i=s._parseHosts(a),n._checkHosts(i)&&n._checkSets(r.sets)&&n._checkMethods(r.methods)},isEntitlementFromCorpCatalogSupported:function(e){var t=this;if(!t.isFilteringEnabled())return!0;if(!e)return!1;var n=c.OfficeAppType[e.OEType];if(!t._checkControlTarget(n))return!1;var r,o,i,a,s,l=new c.Manifest.Manifest((function(){}));e.OfficeExtensionCapabilitiesXML&&(l._xmlProcessor=new c.XmlProcessor(e.OfficeExtensionCapabilitiesXML,c.ManifestNamespaces[1.1]),a=l._xmlProcessor.getDocumentElement(),o=(s=l._parseRequirements(a)).sets,i=s.methods,r=l._parseHosts(a));return t._checkHosts(r)&&t._checkSets(o)&&t._checkMethods(i)},setCapabilities:function(e){this._supportedCapabilities=this._scalarArrayToObject(e)},setHosts:function(e){this._supportedHosts=this._scalarArrayToObject(e)},setRequirements:function(e){var t=this;t._supportedSets=e&&t._arrayToSetsObject(e.sets)||{},t._supportedMethods=e&&t._scalarArrayToObject(e.methods)||{}},setSupportedControlTargets:function(e){this._supportedControlTargets=this._scalarArrayToObject(e)},setSupportedOmexAppVersions:function(e){this._supportedOmexAppVersions=e&&e.slice?e.slice(0):[]},setFilteringEnabled:function(e){this._filteringEnabled=!!e},isFilteringEnabled:function(){return this._filteringEnabled},_checkManifest1_0:function(e){return this._checkCapabilities(e.getCapabilities())},_checkCapabilities:function(e){if(!e||0===e.length)return!0;for(var t=0;t<e.length;t++)if(this._supportedCapabilities[e[t]])return!0;return!1},_checkManifest1_1:function(e){var t=e.getRequirements()||{};return this._checkHosts(e.getHosts())&&this._checkSets(t.sets)&&this._checkMethods(t.methods)},_checkHosts:function(e){if(!e||0===e.length)return!0;for(var t=0;t<e.length;t++)if(this._supportedHosts[e[t]])return!0;return!1},_checkSets:function(e){var t=this;if(!e||0===e.length)return!0;for(var n=0;n<e.length;n++){var r=e[n],o=t._supportedSets[r.name.toLowerCase()];if(!o)return!1;if(r.version&&(t._compareVersionStrings(o.minVersion||t.defaultMinMaxVersion,r.version)>0||t._compareVersionStrings(o.maxVersion||t.defaultMinMaxVersion,r.version)<0))return!1}return!0},_checkMethods:function(e){if(!e||0===e.length)return!0;for(var t=0;t<e.length;t++)if(!this._supportedMethods[e[t]])return!1;return!0},_checkControlTarget:function(e){return null!=e&&this._supportedControlTargets[e]},_checkOmexAppVersions:function(e){if(!e)return!1;for(var t=0;t<this._supportedOmexAppVersions.length;t++)if(e.indexOf(this._supportedOmexAppVersions[t])>=0)return!0;return!1},_scalarArrayToObject:function(e){var t={};if(e&&e.length)for(var n=0;n<e.length;n++)null!=e[n]&&(t[e[n]]=!0);return t},_arrayToSetsObject:function(e){var t={};if(e&&e.length)for(var n=0;n<e.length;n++){var r=e[n];r&&null!=r.name&&(t[r.name.toLowerCase()]=r)}return t},_getSupportedSet:function(){for(var e={},t=Object.getOwnPropertyNames(this._supportedSets),n=0;n<t.length;n++){var r=this._supportedSets[t[n]];e[r.name.toLowerCase()]=r.maxVersion||this.defaultMinMaxVersion}return"undefined"!=typeof JSON?JSON.stringify(e):e},_getSupportedSetAsDmsCapabilities:function(){var e=this;return Object.getOwnPropertyNames(this._supportedSets).map((function(t){var n=e._supportedSets[t];return{Name:n.name.toLowerCase(),Version:n.maxVersion||e.defaultMinMaxVersion}}))},_compareVersionStrings:function(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length),r=0;r<n;r++){var o=parseInt(e[r],10)||0,i=parseInt(t[r],10)||0;if(o!==i)return o-i}return 0}},p.appSpecificCheckOrigin=function(e,t,n,r){try{return!(!(t&&t.source&&t.source.location&&t.source.location.pathname)||t.source.location.pathname.indexOf("projection.aspx")<0&&t.source.location.href!=window.location.href)&&r(e,n)}catch(e){return!1}};var f=window;f.OfficeExt=p,f.Telemetry=s},9971:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(1870);function o(e){const t=Object(r.a)();return t.runningContextualAddinCommand&&t.runningContextualAddinCommand.controlId===e?t.runningContextualAddinCommand:null}},9972:function(e,t,n){"use strict";n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return d}));var r=n(9971),o=n(5167),i=n(2502),a=n(2112),s=n(1870),l=n(2933);function c(e){const t=Object(o.d)(e);if(t){const e=Object(a.a)(t.targetWindow);let n=e?e.tabId:t.targetWindow===window?"Main":null;const r=Object(s.a)().taskPanes.get(n);if(!r)return null;for(let e of r.values())return Object(l.a)(e.targetWindow,e.hostItemIndex)}const n=Object(r.a)(e);return n?n.hostItemIndex:Object(i.a)(e)}function d(e){const t=Object(o.d)(e);if(t){const e=Object(a.a)(t.targetWindow);return e?e.tabId:t.targetWindow===window?"Main":null}return null}},9973:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(6533);function o(e,t){const n=Object(r.a)(t);return!!n&&n.get_Id()===e+"ItemSend"}}}]);
//# sourceMappingURL=owa.133.js.map
self.scriptsLoaded['owa.133.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.133.js'] = (new Date()).getTime();