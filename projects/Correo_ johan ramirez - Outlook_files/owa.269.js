self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.269.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[269],{10310:function(t){t.exports=JSON.parse('{"a":"Cea"}')},10311:function(t){t.exports=JSON.parse('{"b":"oca","d":"pca","e":"qca","c":"rca","f":"sca","a":"tca"}')},1843:function(t,e,n){"use strict";n.d(e,"l",(function(){return f})),n.d(e,"n",(function(){return b})),n.d(e,"k",(function(){return p})),n.d(e,"m",(function(){return I}));var a=n(20),i=n(2131);n.d(e,"b",(function(){return i.a}));var r=n(2090);n.d(e,"i",(function(){return r.a}));n(1872);var c=n(1877);n.d(e,"d",(function(){return c.a})),n.d(e,"e",(function(){return c.b})),n.d(e,"o",(function(){return c.c}));var o=n(2091);n.d(e,"a",(function(){return o.b}));var s=n(1943);n.d(e,"g",(function(){return s.a})),n.d(e,"h",(function(){return s.b}));var l=n(2080);n.d(e,"j",(function(){return l.a}));var u=n(1967);n.d(e,"c",(function(){return u.a}));var d=n(2064);n.d(e,"f",(function(){return d.b}));var m=n(1736);const h=new a.c(()=>Promise.all([n.e(0),n.e(823)]).then(n.bind(null,3371))),f=new a.b(h,t=>t.loadProviders),b=new a.b(h,t=>t.removeFileProvider),p=new a.b(h,t=>t.addFileProvider),I=new a.b(h,t=>t.removeAndAddFileProvider);Object(a.f)(m.a,h,t=>t.resetFileProviderStoreOrchestrator)},1872:function(t,e,n){"use strict";var a=n(3),i=n(2418);const r=Object(a.createStore)("fileProviderStore",Object(i.a)());e.a=r},1877:function(t,e,n){"use strict";n.d(e,"b",(function(){return r})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return c}));var a=n(3);const i=Object(a.action)("FILE_PROVIDER_ADDED",t=>({providerViewState:t})),r=Object(a.action)("FILE_PROVIDER_REMOVED",t=>({providerType:t})),c=Object(a.action)("PROVIDERS_LOADED",t=>({providers:t}))},1943:function(t,e,n){"use strict";n.d(e,"b",(function(){return i})),n.d(e,"a",(function(){return r}));var a=n(1872);const i=()=>[...Object(a.a)().providers.values()],r=t=>Object(a.a)().providers.get(t)||null},1967:function(t,e,n){"use strict";var a;n.d(e,"a",(function(){return a})),function(t){t[t.Loaded=0]="Loaded",t[t.Loading=1]="Loading",t[t.NotLoaded=2]="NotLoaded",t[t.Throttled=3]="Throttled"}(a||(a={}))},2064:function(t,e,n){"use strict";var a=n(32);function i(t){return Object.assign({__type:"GetNewAttachmentDataProviderCreationInfoRequest:#Exchange"},t)}function r(t){const e=i({ProviderType:t});return void 0===(n=e)||n.__type||(n=i(n)),Object(a.a)("GetNewAttachmentDataProviderCreationInfo",n,r);var n,r}function c(t){return Object.assign({__type:"GetAttachmentDataProviderCreatorRequest:#Exchange"},t)}function o(t){const e=c({ProviderType:t});return void 0===(n=e)||n.__type||(n=c(n)),Object(a.a)("GetAttachmentDataProviderCreator",n,i);var n,i}var s=n(2406),l=n(2369);n.d(e,"a",(function(){return I})),n.d(e,"b",(function(){return g}));const u="code",d="token",m=3e3,h=3;function f(t){return{state:t}}function b(t){return t.state}function p(t){return t.code}function I(t,e,n,a,i){const c={providerType:t,getAuthUrlInfo:null,getCSRFToken:b,getOAuthCode:p};return async function t(e,n,a,i,c,l,u){try{let t;if(7===e||9===e||8===e){const n=await o(e);t=n.AttachmentDataProviderCreator.ProviderAppKey,a=n.AttachmentDataProviderCreator.AuthorizationUri}else{t=(await r(e)).ProviderAppKey}n.getAuthUrlInfo=Object(s.d)(e,a,i,t,c,l)}catch(r){u>0&&setTimeout(()=>t(e,n,a,i,c,l,--u),m)}}(t,c,e,n,a,i,h),c}let O=null;function j(){if(!O){if(O={},Object(l.a)(3)&&(O[3]=I(3,"https://app.box.com/api/oauth2/authorize",Object(s.c)(3),u,f)),Object(l.a)(2)&&(O[2]=I(2,"https://www.dropbox.com/oauth2/authorize",Object(s.b)(2),u,f)),Object(l.a)(6)){const t=I(6,"https://www.facebook.com/dialog/oauth",Object(s.b)(6),d,t=>({state:t,scope:"user_photos,email"}));t.getCSRFToken=b,t.getOAuthCode=t=>t.access_token,O[6]=t}if(Object(l.a)(5)){const t=I(5,"https://accounts.google.com/o/oauth2/auth",`${s.a}/ADPRedirect.aspx`,u,t=>{const e={state:t,provider:5..toString(),url:Object(s.b)()};return{state:JSON.stringify(e),scope:"https://www.googleapis.com/auth/drive",access_type:"offline",prompt:"consent",include_granted_scopes:"true"}});t.getCSRFToken=t=>{return JSON.parse(t.state).state},O[5]=t}Object(l.a)(1)&&(O[1]=I(1,"https://login.live.com/oauth20_authorize.srf",Object(s.c)(1),u,t=>({state:t,scope:"wl.basic onedrive.readwrite wl.offline_access"}))),Object(l.a)(7)&&(O[7]=I(7,"",Object(s.c)(7),u,f)),Object(l.a)(8)&&(O[8]=I(8,"",Object(s.c)(8),u,f)),Object(l.a)(9)&&(O[9]=I(9,"",Object(s.c)(9),u,f))}return O}function g(t){const e=j();return t in e?e[t]:null}},2080:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(1872);function i(){return Object(a.a)().loadState}},2090:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var a=n(2450),i=n(2384),r=n(2417),c=n(5),o=n(266);function s(t,e=!1){if(e)return"";switch(t){case 0:return Object(c.b)(r.b);case 1:return Object(c.b)(r.a);case 2:case 9:return Object(c.b)(a.b);case 3:case 7:return Object(c.b)(a.a);case 5:return Object(c.b)(a.e);case 6:return Object(c.b)(a.d);case 4:return Object(c.b)(a.f);case 10:return Object(c.b)(i.b);case 8:return Object(c.b)(a.c);default:return Object(o.a)(t)}}},2091:function(t,e,n){"use strict";var a;n.d(e,"b",(function(){return a})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return r})),function(t){t[t.Groups=1e4]="Groups"}(a||(a={}));const i=Object.freeze([1,3,2,6,5,7,8,9]),r=Object.freeze([...i,0,4,10])},2121:function(t,e,n){"use strict";var a;n.d(e,"a",(function(){return a})),function(t){t[t.linkIds=0]="linkIds",t[t.quotedBodyLinkIds=1]="quotedBodyLinkIds"}(a||(a={}))},2131:function(t,e,n){"use strict";var a;!function(t){t[t.None=0]="None",t[t.Images=1]="Images"}(a||(a={})),e.a=a},2369:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var a=n(1754),i=n(283),r=n(266),c=n(44);function o(t){const e=Object(a.a)();switch(t){case 5:return(null==e?void 0:e.GoogleDriveAttachmentsEnabled)&&(null==e?void 0:e.ThirdPartyAttachmentsEnabled)&&Object(c.j)("doc-fileProvider-gdrive");case 4:case 0:return!0;case 3:return(null==e?void 0:e.BoxAttachmentsEnabled)&&(null==e?void 0:e.ThirdPartyAttachmentsEnabled)&&Object(c.j)("doc-fileProvider-box");case 2:return(null==e?void 0:e.DropboxAttachmentsEnabled)&&(null==e?void 0:e.ThirdPartyAttachmentsEnabled)&&Object(c.j)("doc-fileProvider-dropbox");case 6:return(null==e?void 0:e.ThirdPartyAttachmentsEnabled)&&Object(c.j)("doc-fileProvider-facebook");case 1:return!!Object(i.a)()||(null==e?void 0:e.OnedriveAttachmentsEnabled)&&(null==e?void 0:e.ThirdPartyAttachmentsEnabled);case 10:return Object(c.j)("doc-filePicker-mailMessageAttachment");case 7:case 8:case 9:return(null==e?void 0:e.ThirdPartyAttachmentsEnabled)&&Object(c.j)("doc-fileProvider-wopiClient");default:return Object(r.a)(t)}}},2384:function(t){t.exports=JSON.parse('{"a":"Mma","b":"Nma"}')},2406:function(t,e,n){"use strict";var a=n(597),i=n(2);function r(t,e,n){if(!t||!e||!n)throw new Error("Key and Value parameters should not be null");return t.indexOf("?")>0?`${t}&${e}=${n}`:`${t}?${e}=${n}`}n.d(e,"a",(function(){return c})),n.d(e,"b",(function(){return o})),n.d(e,"c",(function(){return s})),n.d(e,"d",(function(){return l}));const c=Object(i.R)()?"https://exchangelabs.live-int.com/owa":"https://outlook.office.com/owa";function o(t){const e=t?encodeURIComponent(`?provider=${t}`):"",n=t&&6===t?"AddFacebookFileProvider.html":"AddFileProvider.html";return`${Object(a.n)()}/mail/${n}${e}`}function s(t){const e=`${Object(a.n)()}/mail/AddFileProvider.html`,n=encodeURIComponent(`provider=${t}&url=${e}`);return`${c}/ADPRedirect.aspx?${n}`}function l(t,e,n,a,i,c){return()=>{const t=function(){const t="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789".split(""),e=t.length-1,n=[];for(let a=0;a<16;a++)n.push(t[Math.round(Math.random()*e)]);return"owa_csrf_token_"+n.join("")}();let o=r(e,"client_id",a);if(o=r(o,"redirect_uri",n),o=r(o,"response_type",i),c){const e=c(t);o=Object.keys(e).reduce((t,n)=>r(t,n,e[n]),o)}return{authUrl:o,redirectUrl:n,csrfToken:t}}}},2417:function(t){t.exports=JSON.parse('{"b":"Oma","a":"Pma"}')},2418:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(14),i=n(1967);function r(){return{providers:new a.ObservableMap,loadState:i.a.NotLoaded,removalPending:new a.ObservableMap}}},2450:function(t){t.exports=JSON.parse('{"b":"Gma","a":"Hma","e":"Ima","d":"Jma","f":"Kma","c":"Lma"}')},2653:function(t,e,n){"use strict";n.d(e,"n",(function(){return l})),n.d(e,"m",(function(){return u})),n.d(e,"j",(function(){return d})),n.d(e,"i",(function(){return m})),n.d(e,"k",(function(){return h})),n.d(e,"f",(function(){return f})),n.d(e,"a",(function(){return b})),n.d(e,"c",(function(){return p})),n.d(e,"g",(function(){return I})),n.d(e,"d",(function(){return O})),n.d(e,"h",(function(){return j})),n.d(e,"e",(function(){return A})),n.d(e,"l",(function(){return v})),n.d(e,"b",(function(){return C}));var a=n(3108),i=n(96),r=n(1897),c=n(2023),o=n(2687),s=n(121);function l(){return Object(i.d)()||Object(i.e)()}function u(t){return function(t){if(t.length<2)return!1;const e=t[0]-parseInt(r.b),n=t[1]-parseInt(r.c);return 0==e&&n>=0}("string"==typeof t?t.split(".").map(t=>parseInt(t)):[])}function d(t){const e="string"==typeof t?t.split("."):[];return e.length&&e[0]!=r.b}function m(){return Object(a.a)()&&Object(s.a)("smimeExtension")}function h(t){return 0!==t}function f(t){const e=[];e.push(t.UserEmailAddress),e.push(t.LogonEmailAddress),e.push(t.UserPrincipalName),e.push(t.UserLegacyExchangeDN);const n=t.UserProxyAddresses;return n&&n.length>0&&n.forEach((function(t){e.indexOf(t)>=0||e.push(t)})),e}function b(t){let e=65001;return t.UseGB18030?e=54936:t.UseISO885915&&(e=28605),e}function p(t){return{AllowUserChoiceOfSigningCertificate:t.AllowUserChoiceOfSigningCertificate,IncludeCertificateChainWithoutRootCertificate:t.IncludeCertificateChainWithoutRootCertificate,IncludeCertificateChainAndRootCertificate:t.IncludeCertificateChainAndRootCertificate,EncryptTemporaryBuffers:t.EncryptTemporaryBuffers,SignedEmailCertificateInclusion:t.SignedEmailCertificateInclusion,IncludeSmimeCapabilitiesInMessage:t.IncludeSMIMECapabilitiesInMessage,CopyRecipientHeaders:t.CopyRecipientHeaders,OnlyUseSmartCard:t.OnlyUseSmartCard,EncryptionAlgorithms:t.EncryptionAlgorithms,SigningAlgorithms:t.SigningAlgorithms}}function I(t,e){const n=Object(o.a)().ClearSign;return e||t&&!n?c.a:r.e}function O(t){return btoa(unescape(encodeURIComponent(t)))}function j(t,e){const n=Object(o.a)();return t&&e?n.TripleWrapSignedEncryptedMail?14:12:t?n.ClearSign?11:10:6}function g(){return(Math.floor(4026531839*Math.random())+268435456).toString(16)}function A(t){return r.k+(t||g()+g()+g()+g())}function v(t,e){return e.IsInline&&-1===t.indexOf(e.ContentId)}function C(){return r.d+g()+"@"+g()+"."+g()}},2687:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(57);function i(){var t;return null===(t=a.a.userConfiguration)||void 0===t?void 0:t.SmimeAdminSettings}},3052:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return r}));const a=1024,i=1048576,r="Not support special characters"},3108:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(96),i=n(1897);function r(){return Object(a.d)()&&Object(a.m)([i.f])||Object(a.e)()&&Object(a.m)([i.g])}},3960:function(t,e,n){"use strict";var a=n(1893);const i=["ErrorTooLargeForLocalAttachmentSingle","ErrorTooLargeForLocalAttachmentMultiple","WarningFilesCanNotBeAttachedGenericError","WarningEmptyFilesCanNotBeAttached","WarningFilesCanNotBeAttachedWithNamesGenericError","WarningFilesCannotBeAttachedFromOtherMailboxes","WarningSeveralFilesCanNotBeAttachedGenericError","WarningInlineImageTypeNotSupported","WarningAttachmentsCanNotBeDeleted","InfoIncludeMostRecentAttachmentsMessage","ErrorSmimeHasCloudOrUriAttachments","ErrorAttachmentDownloadFailed","ErrorAttachmentDownloadFailedMultipleFiles","WarningSpecialCharactersAreNotSupported"];function r(t){t&&Object(a.a)(t,i)}n.d(e,"a",(function(){return r}))},3963:function(t,e,n){"use strict";var a=n(3350),i=n(3015),r=n(1829),c=n(40),o=n(699),s=Object(o.action)("replaceAttachmentInWell")((function(t,e,n,o){let s=t.docViewAttachments.indexOf(e);s>-1?(Object(i.a)(t,e),t.docViewAttachments.splice(s,0,n)):(s=t.imageViewAttachments.indexOf(e))>-1?(Object(i.a)(t,e),t.imageViewAttachments.splice(s,0,n)):c.d("Can't find the oldAttachment when invoking replaceAttachmentInWell"),n.isCloudy||Object(a.a)(t,o),Object(r.n)(n.attachmentId)})),l=n(1975);function u(t,e,n,a,i){const r=Object(l.h)(Object.assign(Object.assign({},n.AttachmentId),{mailboxInfo:e.attachmentId.mailboxInfo}),n,a,i,!0,!1,!1,null,null,!1);s(t,e,r,n.Size)}n.d(e,"a",(function(){return u}))},4019:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(61);function i(t){const e=t.maxTotalClassicAttachmentSize-t.totalClassicAttachmentSize;return e<0?(Object(a.o)("AttachmentSizeReachedMax",{},{isCore:!0}),0):e}},4104:function(t,e,n){"use strict";var a=n(3);const i={uploadFolders:new(n(14).ObservableMap)},r=Object(a.createStore)("attachmentsUploadFolderStore",i);var c,o=n(49);!function(t){t.User="User",t.Group="Group"}(c||(c={}));const s=Object(a.action)("preloadUploadFolder",(t=Object(o.g)().SessionSettings.UserEmailAddress,e=c.User)=>({mailboxId:t,uploadFolderMailboxType:e})),l=Object(a.action)("uploadFolderLoaded",(t,e)=>({mailboxId:t,uploadFolder:e}));Object(a.mutator)(l,t=>{const{mailboxId:e,uploadFolder:n}=t;r().uploadFolders.set(e,n)});var u=n(4622),d=n(5),m=n(266),h=n(701);const f="Email attachments";function b(t){switch(t){case c.Group:return f;case c.User:return Object(d.b)(u.a);default:return Object(m.a)(t)}}var p=n(32);var I=n(1785);function O(t,e){switch(e){case c.Group:const n=new Headers;return Object(I.f)(t,n),n;case c.User:return null;default:return Object(m.a)(e)}}function j(t=Object(o.g)().SessionSettings.UserEmailAddress){return r().uploadFolders.get(t)||null}var g=n(40);async function A(t=null,e=c.User){try{const i=j(t=t||Object(o.g)().SessionSettings.UserEmailAddress);if(i)return i;const r=function(t,e,n){return{mailboxId:t,folderId:n.FolderId,folderName:Object(h.a)(n.FolderName)?b(e):n.FolderName}}(t,e,await(n={},a={headers:O(t,e)},Object(p.a)("GetAttachmentDataProviderUploadFolderProps",n,a)));return l(t,r),r}catch(t){return g.h.warn("fetchUploadFolder got error: "+t.message),null}var n,a}Object(a.orchestrator)(s,async t=>{const{mailboxId:e,uploadFolderMailboxType:n}=t;j(e)||await A(e,n)}),n.d(e,"d",(function(){return s})),n.d(e,"b",(function(){return A})),n.d(e,"c",(function(){return j})),n.d(e,"a",(function(){return c}))},4443:function(t,e,n){"use strict";e.a={AttachmentCreationClassicFromLocalFile:{name:"AttachmentCreationClassicFromLocalFile",customData:(t,e,n,a,i)=>a?[a.size]:[0]},AttachmentCreationFromRecentAttachment:{name:"AttachmentCreationFromRecentAttachment",customData:(t,e,n,a,i,r)=>[(null==a?void 0:a.size)||0,null==a?void 0:a.fileType]},AttachmentCreationCloudyFromLocalFile:{name:"AttachmentCreationCloudyFromLocalFile"},AttachmentDeletionAction:{name:"AttachmentDeletionAction",customData:(t,e,n,a)=>({generatedAttachmentId:e.attachmentId.Id}),cosmosOnlyData:(t,e,n,a)=>JSON.stringify({attachmentId:e.attachmentId.Id,fileType:a}),options:{isCore:!0}}}},4622:function(t){t.exports=JSON.parse('{"a":"bga"}')},4769:function(t,e,n){"use strict";n.d(e,"a",(function(){return l}));var a=n(4770),i=n(5),r=n(40),c=n(3052),o=n(4019),s=n(1866);function l(t,e,n){let l=0;for(let e,n=0;e=t[n];n++)l+=e.size;const u=Object(o.a)(e);if(l>u){const e=Math.floor(u/c.b);let r,o;return t.length>1?(o="ErrorTooLargeForLocalAttachmentMultiple",r=Object(i.c)(Object(i.b)(a.a),e)):(o="ErrorTooLargeForLocalAttachmentSingle",r=Object(i.c)(Object(i.b)(a.b),e)),Object(s.a)(n,o,[r]),!0}return r.h.info("Attachment: TotalSize = "+Math.floor(e.totalClassicAttachmentSize/1048576)),!1}},4770:function(t){t.exports=JSON.parse('{"a":"yea","b":"zea"}')},4828:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"CreateAttachmentJsonRequest:#Exchange"},t)}n.d(e,"a",(function(){return a}))},4946:function(t,e,n){"use strict";var a=n(699);e.a=Object(a.action)("updateChangeKeyOnItemId")((function(t,e){t.ChangeKey=e}))},5117:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"CreateAttachmentRequest:#Exchange"},t)}n.d(e,"a",(function(){return a}))},5543:function(t){t.exports=JSON.parse('{"a":"Lda"}')},5547:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(3);const i=Object(a.action)("setAnnouncedComponentMessage",(t,e)=>({attachmentWell:t,message:e}))},5559:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"ReferenceAttachment:#Exchange"},t)}n.d(e,"a",(function(){return a}))},5577:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"ItemIdAttachment:#Exchange"},t)}n.d(e,"a",(function(){return a}))},5763:function(t,e,n){"use strict";var a=n(61),i=n(4443),r=n(3015),c=n(4946),o=n(702);const s={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"DeleteAttachmentFromDraft"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AttachmentIdInput"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"deleteAttachmentFromDraft"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"AttachmentId"},value:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}}}]}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"RootItemId"}}]}}]}}]};n.d(e,"b",(function(){return u}));e.a=Object(a.r)(i.a.AttachmentDeletionAction,(async function(t,e,n,a){const i=await l(e.attachmentId,n);Object(r.a)(t,e),Object(c.a)(n,i.RootItemId.RootItemChangeKey)}));const l=async function(t,e,n){var a;const i=Object(o.a)(),r=await i.mutate({variables:{attachmentId:{Id:t.Id,mailboxInfo:t.mailboxInfo,RootItemId:t.RootItemId||e.Id,RootItemChangeKey:t.RootItemChangeKey}},context:{requestOptions:n},mutation:s});return null===(a=null==r?void 0:r.data)||void 0===a?void 0:a.deleteAttachmentFromDraft},u={invokeDeleteAttachmentFromDraftMutation:l}},6013:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"Item:#Exchange"},t)}n.d(e,"a",(function(){return a}))},6033:function(t,e,n){"use strict";var a=n(1937),i=n(1738),r=n(4430),c=n(44),o=n(699);e.a=Object(o.action)("setAttachmentPermissionLevel")((function(t,e,n,o){const s=Object(i.a)(t),l=s.model;l.PermissionType=e,n&&(l.AttachLongPathName=n,s.openUrl=Object(r.a)(l)),Object(c.j)("doc-attachment-referenceAttachmentExpiration")&&s.info&&s.info.sharingInfo&&(s.info.sharingInfo.expirationDate=o),Object(a.a)(t)}))},6094:function(t,e,n){"use strict";var a=n(7920),i=n(5),r=n(2046),c=n(2047),o=n(3960),s=n(61),l=n(266),u=n(1738),d=n(1724),m=n(7921),h=n(4769);var f=n(6603),b=n(1975),p=n(40),I=n(699),O=n(1810),j=n(1829),g=n(6033),A=n(3078);var v=n(3015),C=n(5547),y=n(4946),S=n(10310);function w(t,e,n,a,r,c,o){Object(C.a)(o,Object(i.b)(S.a)),Object(b.E)(t,e,n,a,c),Object(y.a)(r,a.AttachmentId.RootItemChangeKey),function(t,e,n){n&&0===n.ResultCode&&0===t.attachmentType&&(n.CanShareInternally||Object(A.e)(e.PermissionType)||(Object(s.o)("AttachmentsCanNotShareInternally"),Object(g.a)(t.attachmentId,0)),Object(j.n)(e.AttachmentId))}(t,n,c)}function T(t,e,n,a){let i=!0;1===t.attachmentType&&(Object(b.z)(t,2),i=!1),e&&Object(v.a)(e,t,i),n&&a&&O.k.importAndExecute(n,a)}var F=Object(I.action)("handleCreateAttachmentNotification")((function(t,e,n,a,i,r,c,o){const s=t;try{if(0!==s.ResultCode)throw new Error(`ResultCode:${s.ResultCode}, Id:${s.Id}, Exception: ${s.Exception}`);{const t=s.Response.ResponseMessages.Items[0];if(t&&t.Attachments.length>0)return Object(b.C)(i.attachmentId,!0),r(t.Attachments[0]),void w(i,n,a,t.Attachments[0],e,s.Response.SharingInformation,o.attachmentWellViewState)}}catch(t){p.d("Error handling the create attachment notification: "+t)}Object(b.C)(i.attachmentId,!1),c(new Error(s.Exception)),T(i,o.attachmentWellViewState,null,null)})),k=n(311);async function P(t,e){const n=Object(k.a)(),a={subscriptionId:n,requiresExplicitSubscribe:!1,subscriptionParameters:null},i=t=>{e(t),O.k.importAndExecute(a,i)};(await O.j.import())(a,i);const r=(await O.b.import())();t(n,a,r,i)}var N=n(32),E=n(910);var x=n(700);function U(t,e,n,a,i,r){const c=Object(x.a)(t.mailboxInfo)||{};return o={itemId:t,attachmentDataProviderId:n.providerId,location:n.location,attachmentId:n.fileId||"",subscriptionId:a,channelId:i,dataProviderParentItemId:n.fileParentId||"",providerEndpointUrl:n.providerEndpointUrl,cancellationId:e,isInline:r},s=c,void 0===o.itemId||o.itemId.__type||(o.itemId=Object(E.a)(o.itemId)),Object(N.a)("CreateAttachmentFromAttachmentDataProvider",o,s);var o,s}var D=n(3052),R=Object(I.action)("createAttachmentFromAttachmentDataProvider")((function(t,e,n,a,i,r,c,o,l){const u=new s.b("AttachmentCreationClassicFromAttachmentDataProvider");u.addCustomData([i.providerType]);const d=t=>{c(t),u.end()},m=t=>{o(),u.endWithError("ServerError",t)};P(async(e,n,c,s)=>{try{if(0===i.providerType){if(function(t){return-1!==t.indexOf("%")||-1!==t.indexOf("#")}(i.name))throw new Error(D.c)}if(0===r.attachmentType&&Object(b.B)(Object(b.k)(i.size),.05,t=>{Object(b.x)(r,t)},r.attachmentId),!await U(t,a,i,e,c,!1))throw new Error("Empty response for createAttachmentFromAttachmentDataProvider request")}catch(t){return Object(b.C)(r.attachmentId,!1),o(t),void T(r,l.attachmentWellViewState,n,s)}},a=>{F(a,t,e,n,r,d,m,l)})}));var z=n(4443),M=n(1785);function W(t,e,n,a,i,r){return new Promise(async(c,o)=>{const s=new XMLHttpRequest;s.onreadystatechange=function(){if(4===s.readyState)if(200===s.status){let t;try{t=JSON.parse(s.responseText)}catch(t){p.d("Attachment: Deserialize response failed with error: "+t.Message),p.d("Attachment: Deserialize response Failure Stack Trace: "+t.stack),o(t)}c(t)}else o(new Error("Request failed with status "+s.status+". Message: "+s.responseText))},s.ontimeout=function(){o(new Error("Request timed out"))},r&&(s.upload.onprogress=r),s.open("POST",t,!0),s.setRequestHeader("X-OWA-Action",n);const l=await Object(M.d)(a);l&&Object.keys(l).forEach(t=>{s.setRequestHeader(t,l[t])});const u=JSON.stringify(e);i?(s.setRequestHeader("X-OWA-UrlPostData",encodeURI(u)),s.send(i)):s.send(u)})}var L=n(13);function _(t){const e=Object(L.a)();return e.baseUrl?`${e.baseUrl}${t}`:`/owa${t}`}var B=n(4828),V=n(5117),$=n(245),q=n(702);const G={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"AddAttachmentToDraft"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"options"}},type:{kind:"NonNullType",type:{kind:"NamedType",name:{kind:"Name",value:"AddAttachmentToDraftOptions"}}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"addAttachmentToDraft"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"options"},value:{kind:"Variable",name:{kind:"Name",value:"options"}}}]}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"attachment"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"OwsTypeName"}},{kind:"Field",name:{kind:"Name",value:"AttachmentId"},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"Id"}},{kind:"Field",name:{kind:"Name",value:"RootItemId"}},{kind:"Field",name:{kind:"Name",value:"RootItemChangeKey"}}]}},{kind:"Field",name:{kind:"Name",value:"IsInline"}},{kind:"Field",name:{kind:"Name",value:"ContentId"}},{kind:"Field",name:{kind:"Name",value:"LastModifiedTime"}},{kind:"InlineFragment",typeCondition:{kind:"NamedType",name:{kind:"Name",value:"ReferenceAttachment"}},selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"ProviderType"}},{kind:"Field",name:{kind:"Name",value:"WebUrl"}},{kind:"Field",name:{kind:"Name",value:"AttachLongPathName"}}]}}]}},{kind:"Field",name:{kind:"Name",value:"isCancelled"}}]}}]}}]};var J=n(44);const Q=_("/service.svc/CreateAttachmentFromLocalFile");async function H(t,e,n,a,i,r){if(p.h.info(`Attachment: createAttachment Id: ${t.Id}, ChangeKey: ${t.ChangeKey}`),Object(J.j)("mon-cmp-graphQLAttachments")){const i=function(t){const e=Object.assign(Object.assign({},t),{OwsTypeName:t.__type});delete e.__type,e.AttachmentId&&delete e.AttachmentId.__typename;return e}(e),c=Object(q.a)(),o=(await c.mutate({variables:{options:{ParentItemId:t,Attachment:i,CancellationId:n,attachmentType:"LocalFile",fileBlob:a,mailboxInfo:t.mailboxInfo,isInline:e.IsInline,sliceInformation:r}},mutation:G})).data.addAttachmentToDraft;return{ResponseMessages:{Items:[{Attachments:[Object.assign(Object.assign({},o.attachment),{__type:o.attachment.OwsTypeName})],IsCancelled:o.isCancelled,ResponseClass:"Success",ResponseCode:"NoError"}]}}}{const c=Object(V.a)({ParentItemId:t,Attachments:[e],RequireImageType:e.IsInline,IncludeContentIdInResponse:e.IsInline,ClientSupportsIrm:!0,CancellationId:n});r&&(c.SliceNumber=r.sliceNumber,c.TotalSlices=r.totalSlices);const o=Object(B.a)({Header:Object($.b)(),Body:c}),s=e;return(await W(Q,o,"CreateAttachmentFromLocalFile",t.mailboxInfo,s&&a?a:null,i)).Body}}function K(t,e){let n="Attachment: createAttachment failed",a=null!=e?e:"genericError";return(null==t?void 0:t.MessageText)&&(n+=` with MessageText: ${t.MessageText}`),p.h.warn(n),(null==t?void 0:t.ResponseCode)&&(a=t.ResponseCode),{errorMessage:n,errorCode:a}}function X(t){const e=Object.assign({},t);return Object.keys(e).forEach((function(t,n){null===e[t]&&(e[t]=void 0)})),e}var Y=Object(s.r)(z.a.AttachmentCreationClassicFromLocalFile,(async function(t,e,n,a,i){let r=null;0===i.attachmentType&&(r=function(t){const e=t.loaded/t.total;Object(b.x)(i,e)});const c=X(e),o=(await H(t,c,n,a,r)).ResponseMessages.Items[0];if(o&&o.Attachments.length>0&&o.Attachments[0]){return{attachment:o.Attachments[0],sharingInfo:null}}throw K(o)})),Z=n(5577),tt=Object(s.r)(z.a.AttachmentCreationFromRecentAttachment,(async function(t,e,n,a,i,r){let c=null;0===i.attachmentType&&(c=function(t){const e=t.loaded/t.total;Object(b.x)(i,e)});let o=X(e);if(r){o=function(t,e){return Object(Z.a)({AttachmentId:t.AttachmentId,AttachmentIdToAttach:e,ContentType:t.ContentType,Name:t.Name,Size:t.Size,Thumbnail:t.Thumbnail,ThumbnailMimeType:t.ThumbnailMimeType,CreateAttachmentInlineType:2})}(o,a.fileId)}const s=await H(t,o,n,null,c),l=s.ResponseMessages.Items[0];if(l&&l.Attachments.length>0&&l.Attachments[0]){return{attachment:l.Attachments[0],sharingInfo:s.SharingInformation}}throw K(l)}));function et(t,e,n,a,i,r){const c=Object(x.a)(t.mailboxInfo)||{};return s=c,void 0===(o={itemId:t,uri:e,name:n,subscriptionId:a,isInline:i,contentId:r}).itemId||o.itemId.__type||(o.itemId=Object(E.a)(o.itemId)),Object(N.a)("CreateAttachmentFromUri",o,s);var o,s}var nt=Object(I.action)("createAttachmentFromUri")((function(t,e,n,a,i,r,c,o,l){const u=new s.b("AttachmentCreationFromUri");u.addCustomData({size:i?i.size:0});const d=t=>{c(t),u.end()},m=t=>{o(),u.endWithError("ServerError",t)};P(async(e,a,c,s)=>{try{if(0===r.attachmentType&&Object(b.B)(Object(b.l)(i.size),.05,t=>{Object(b.x)(r,t)},r.attachmentId),!await et(t,i.uri,i.name,e,n.IsInline,null))throw new Error("Empty response for createAttachmentFromUriProvider request")}catch(t){Object(b.C)(r.attachmentId,!1),o(),T(r,l.attachmentWellViewState,a,s)}},a=>{F(a,t,e,n,r,d,m,l)})})),at=n(7923);function it(t,e,n){const a=Object(x.a)(t.mailboxInfo)||{};return Object(at.a)({itemId:t,attachmentDataProviderId:n.providerId,location:n.location,attachmentId:n.fileId||"",dataProviderParentItemId:n.fileParentId||"",providerEndpointUrl:n.providerEndpointUrl,cancellationId:e,thumbnailUrl:n.thumbnailUrl,previewUrl:n.previewUrl,isFolder:n.isFolder,mimeType:n.type},a)}var rt=n(3909),ct=Object(s.r)({name:"AttachmentCreationCloudyFromAttachmentDataProvider",customData:(t,e,n,a,i)=>[n.providerType,n.fileType]},(async function t(e,n,a,r,c){return 0===r.attachmentType&&Object(b.B)(4e3,.05,t=>{Object(b.x)(r,t)},r.attachmentId),it(e,n,a).then(async o=>{const s=o.ResponseMessages.Items.length>0?o.ResponseMessages.Items[0]:null;if(s&&s.Attachments.length>0){return Object(b.C)(r.attachmentId,!0),{attachment:s.Attachments[0],sharingInfo:o.SharingInformation}}if(Object(b.C)(r.attachmentId,!1),Object(J.j)("doc-authContext")&&!c&&o.SharingInformation&&!Object(i.k)(o.SharingInformation.ClaimsChallenge)){const c=o.SharingInformation.ClaimsChallenge;if(!Object(i.k)(c)){try{const t=await rt.a.import();await t(c)}catch(t){throw K(s,o.SharingInformation.ResultCode.toString())}return t(e,n,a,r,!0)}}throw K(s)})}));const ot=_("/service.svc/CreateReferenceAttachmentFromLocalFile");async function st(t,e,n,a,i,r,c,o,s,l){var u;const d={requestObject:(u={ParentItemId:t,FileName:e.Name,SubscriptionId:i,ChannelId:r,FileSizeInBytes:e.Size,SliceNumber:c,TotalSlices:o,CancellationId:n,FileContentToUpload:"",GroupSmtpAddress:s,UploadFolderId:l},Object.assign({__type:"CreateReferenceAttachmentFromLocalFileRequest:#Exchange"},u))};return await W(ot,d,"CreateReferenceAttachmentFromLocalFile",t.mailboxInfo,a,void 0)}var lt=n(4104);var ut=Object(s.r)(z.a.AttachmentCreationCloudyFromLocalFile,(function(t,e,n,a,i,r,c,o,s){P((e,c,l,u)=>{!async function(t,e,n,a,i,r,c,o,s,l,u,d){var m;const h=Math.ceil(a.size/l);Object(b.B)(Object(b.q)(a.size),.05,t=>{Object(b.x)(i,t)},i.attachmentId);let f=null;const p=null===(m=null==d?void 0:d.attachmentWellViewState)||void 0===m?void 0:m.groupId;if(p&&(f=Object(lt.c)(p)?Object(lt.c)(p).folderId:null,!f)){const t=await Object(lt.b)(p,lt.a.Group);t&&(f=t.folderId)}for(let m=0;m<h;m++){const I=0+m*l,O=Math.min(I+l,a.size),j=a.slice(I,O);try{if(!await st(t,e,n,j,r,o,m,h,p,f))throw new Error("Empty response for createReferenceAttachmentFromLocalFile request")}catch(t){return Object(b.C)(i.attachmentId,!1),u(),void T(i,d.attachmentWellViewState,c,s)}}}(t,n,a,i,r,e,c,l,u,10485760,o,s)},a=>{F(a,t,e,n,r,c,o,s)})}));var dt=n(1791),mt=n(5719),ht=n(279),ft=n(6604);function bt(t,e,n,a,i,r,c,o){const l=new s.b("UploadLocalFileAndCreateCloudyAttachment",{timeout:3e5}),[{uploadPromise:u,cancel:d},m]=Object(ft.a)(n.Name,r,i,({loaded:t,total:e})=>{const n=t/e;Object(b.x)(c,n)}),{model:{Id:h,EndPointUrl:f,Type:p}}=m;let I=!1;return{onCompletePromise:(async()=>{let i=null;try{const{errorResponse:r,result:d}=await u;if(r){const t=await r.text();throw new Error(`Unable to upload file with status code: ${r.status}; response: ${t}`)}const m=function(t,e,n,a){return{fileType:dt.a.Cloud,name:t.name,size:t.size,providerId:e,providerType:n,location:pt(t,n),providerEndpointUrl:a,isFolder:!1,fileId:t.id,fileParentId:t.parentReference.id,thumbnailUrl:"",previewUrl:"",type:Object(mt.c)(t)}}(d,h,p,f),I=await it(t,a,m),O=I.ResponseMessages.Items[0];if(O&&O.Attachments.length>0){Object(b.C)(c.attachmentId,!0);const a=O.Attachments[0];return w(c,e,n,a,t,I.SharingInformation,o.attachmentWellViewState),a}throw new Error(O.MessageText)}catch(t){if(Object(b.C)(c.attachmentId,!1),T(c,o.attachmentWellViewState),I)return null;throw i=t,t}finally{i?(new s.b("UploadLocalFileAndCreateCloudyAttachmentError",{isCore:!0}).endWithError(i),l.endWithError(i)):l.end()}})(),cancel:()=>{I=!0,d()}}}function pt(t,e){return 1===e?`${t.parentReference.path}/${t.name}`:Object(ht.parse)(t.webUrl).path}var It=n(11115);const Ot=14680064;function jt(t,e,n,a){t.addCustomData([e]),n?t.end():t.endWithError("ServerError",a)}function gt(t,e,n,a,i,r={}){r.sliceSizeInBytes=r.sliceSizeInBytes||Ot;const c=new s.b("AttachmentCreationClassicFromLocalFileSliced",{timeout:3e5}),{action:o,getLastResponseMessage:u}=function(t,e,n,a,i){let r=null,c=null;return{action:async(o,s,l)=>{c||(c=function(t){const e=[];for(let n=0;n<t;n++)e[n]=0;return e}(l));let u=null;0===i.attachmentType&&(u=function(t){c[s]=t.loaded;const e=c.reduce((t,e)=>t+e,0)/a.size;Object(b.x)(i,e)});const d=X(e),m=await H(t,d,n,o,u,{sliceNumber:s,totalSlices:l});if(r=m.ResponseMessages.Items[0],!function(t){return t&&t.Attachments.length>0&&t.Attachments[0]}(r))throw K(r);e=Object.assign(Object.assign({},e),{AttachmentId:r.Attachments[0].AttachmentId})},getLastResponseMessage:()=>r}}(t,e,n,a,i),{onCompletePromise:d,cancel:m}=Object(It.a)(a,o,{sliceSize:r.sliceSizeInBytes,numberOfSlicesToParallelize:1});let h=!1;return{onCompletePromise:d.then(t=>{switch(t){case 0:return jt(c,a.size,!0),{status:0,attachment:u().Attachments[0]};case 1:return{status:1};default:return Object(l.a)(t)}}).catch(t=>{if(h)return{status:1};throw jt(c,a.size,!1,t),t}),cancel:()=>{h=!0,m()}}}function At(t,e,n,a,i,r,c={shouldShare:!1}){const o=a&&(a.fileType===dt.a.Cloud||a.fileType===dt.a.CloudSuggestion||a.fileType===dt.a.ContextualSuggestion);let s=null;const u=Object.assign(Object.assign({},e.AttachmentId),{mailboxInfo:t.mailboxInfo}),{shouldShare:d}=c;let m=()=>{};if((h=a).fileType===dt.a.AttachmentItem||h.fileType===dt.a.AttachmentItemSuggestion||(h.fileType===dt.a.Cloud||h.fileType===dt.a.CloudSuggestion||h.fileType===dt.a.ContextualSuggestion)&&4===h.providerType)s=tt(t,e,n,a,i,o).then(t=>t);else if(d||o){if(!d&&o){return{createAttachmentPromise:new Promise((c,o)=>{R(t,u,e,n,a,i,c,o,r)}),cancelCreateAttachment:m}}if(!d||!o){if(c.shouldShare&&c.shareProperties&&!c.shareProperties.groupMailboxId){const{onCompletePromise:o,cancel:s}=bt(t,u,e,n,c.shareProperties.folderInfo,a.fileObject,i,r);return{createAttachmentPromise:o,cancelCreateAttachment:s}}return{createAttachmentPromise:new Promise((c,o)=>(ut(t,u,e,n,a.fileObject,i,c,o,r),e)),cancelCreateAttachment:m}}s=ct(t,n,a,i)}else if(a&&a.fileType===dt.a.Local&&a.fileObject){const{onCompletePromise:r,cancel:c}=gt(t,e,n,a.fileObject,i);m=c,s=r.then(t=>{switch(t.status){case 0:return{attachment:t.attachment,sharingInfo:null};case 1:return null;default:return Object(l.a)(t)}})}else{if(a&&a.fileType===dt.a.Uri){return{createAttachmentPromise:new Promise((c,o)=>{nt(t,u,e,n,a,i,c,o,r)}),cancelCreateAttachment:m}}s=Y(t,e,n,a&&a.fileType===dt.a.Local?a.fileObject:null,i)}var h;return function(t,e,n,a,i,r,c){return{createAttachmentPromise:r.then(r=>r?(w(a,e,n,r.attachment,t,r.sharingInfo,i.attachmentWellViewState),r.attachment):null).catch(t=>{throw T(a,i.attachmentWellViewState,null,null),t}),cancelCreateAttachment:c}}(t,u,e,i,r,s,m)}var vt=n(5763);function Ct(t){return e={cancellationId:t},Object(N.a)("CancelAttachment",e,n);var e,n}const yt="ErrorNonExistentMailbox";var St=n(1865);function wt(t){if(null==t)return null;switch(t){case 0:return St.i;case 5:return St.e;case 1:return St.h;case 2:return St.b;case 3:return St.a;case 7:return St.j;case 9:return St.k;case 8:return St.l;case 4:return St.f;case 6:return St.c;case 10:return St.g;default:return Object(l.a)(t)}}var Tt=n(4209),Ft=n(6013),kt=n(7038),Pt=n(7039),Nt=n(5559),Et=n(5543),xt=n(1866);function Ut(t,e){const n=Object(u.a)(t.item.attachmentId);if(n){!function(t,e,n){Object(xt.a)(n,t,[e])}("WarningAttachmentsCanNotBeDeleted",Object(i.c)(Object(i.b)(Et.a),n.model.Name),e)}}var Dt=n(1788),Rt=n(10311);const zt=4;function Mt(t,e,n){Object(xt.a)(n,t,[e])}function Wt(t,e){const n=(a=t=>t.reason,t.reduce((t,e)=>{const n=a(e);return t[n]?t[n].push(e):t[n]=[e],t},{}));var a;Object.keys(n).forEach(t=>{const a=n[t];switch(parseInt(t)){case 0:!function(t,e){let n=null,a=null;if(1===t.length&&null!==t[0].item.tryAgainCallback){const n=t[0],a=n.item.file.name,r=Object(i.c)(Object(i.b)(Rt.e),a),c={key:"WarningFilesCanNotBeAttachedWithNamesGenericError",source:Dt.c.Compose,rank:Dt.b.Info,message:r,messageParts:[r]},o={text:Object(i.b)(Rt.a),action:()=>n.item.tryAgainCallback()};return c.messageParts.push(o),void Object(xt.a)(e,"WarningFilesCanNotBeAttachedWithNamesGenericError",t=>c)}if(t.length<zt){const e=t.map(t=>t.item.file.name).join(", ");a="WarningFilesCanNotBeAttachedWithNamesGenericError",n=Object(i.c)(Object(i.b)(Rt.b),e)}else a="WarningSeveralFilesCanNotBeAttachedGenericError",n=Object(i.c)(Object(i.b)(Rt.d),t.length);Mt(a,n,e)}(a,e);break;case 1:!function(t,e){Mt("WarningFilesCannotBeAttachedFromOtherMailboxes",Object(i.b)(Rt.c),e)}(0,e);break;case 2:!function(t,e){Mt("WarningSpecialCharactersAreNotSupported",Object(i.b)(Rt.f),e)}(0,e)}})}class Lt{constructor(t,e,n,a=null,i=null){this.attachmentWellViewState=t,this.parentItemId=e,this.infoBar=n,this.onAnyAttachmentCreatedInParentItemCallback=a,this.onAnyAttachmentDeletedInParentItemCallback=i,this.uploadQueue=[],this.deleteQueue=[],this.uploadFailures=[],this.onFinishPromise=new Promise((t,e)=>{this.onFinish=function(e){t(e)}})}enqueueAttachmentCreation(t,e,n=null,a=null,i=null){const{isInline:r,shouldShare:c,isHiddenInline:s,skipProcessInlineImage:l}=e;if(Object(o.a)(this.infoBar),!c&&Object(h.a)(t,this.attachmentWellViewState,this.infoBar))return[];t=Object(m.a)(t,r,this.infoBar);for(let o,u=0;o=t[u];u++){let t,u=null;const d={Name:null,ContentType:null,ContentId:null,ContentLocation:null,AttachmentOriginalUrl:null,Size:0,LastModifiedTime:null,IsInline:!1,IsInlineToUniqueBody:!1,IsInlineToNormalBody:!1,ThumbnailMimeType:null,Thumbnail:null};if(c){const e=o;t=Object(Nt.a)(Object.assign(Object.assign({},d),{Name:e.name,Size:e.size,ContentType:e.type,ProviderType:wt(e.providerType),AttachmentIsFolder:e.isFolder,IsInline:!1,PermissionType:0,AttachLongPathName:null,ProviderEndpointUrl:null,AttachmentThumbnailUrl:null,AttachmentPreviewUrl:null,OriginalPermissionType:0})),0===e.providerType&&(t.AttachmentOriginalUrl=e.location)}else if(o.fileType===dt.a.Base64InlineImage){const e=o;t=Object(Tt.a)(Object.assign(Object.assign({},d),{Name:e.name,Size:e.size,ContentType:e.type,IsInline:!0,Content:e.dataUri,IsContactPhoto:!1,ImageThumbnailSalientRegions:null,ImageThumbnailHeight:0,ImageThumbnailWidth:0})),u=e.tempId}else if(o.fileType===dt.a.MailItem){const e=o;if(e.mimeContent)t=Object(kt.a)(Object.assign(Object.assign({},d),{Name:o.name,Size:o.size,IsInline:!1,Item:Object(Ft.a)({MimeContent:Object(Pt.a)({Value:e.mimeContent})}),ContentType:"message/rfc822"}));else{const n=Object(E.a)({Id:e.itemId});t=Object(Z.a)(Object.assign(Object.assign({},d),{Name:o.name,IsInline:!1,ItemId:n,Size:o.size,AttachmentIdToAttach:null,CreateAttachmentInlineType:0}))}}else if(o.fileType===dt.a.AttachmentItem||o.fileType===dt.a.AttachmentItemSuggestion){const e=o;t=Object(Z.a)(Object.assign(Object.assign({},d),{Name:e.name,AttachmentIdToAttach:e.attachmentItemId,__type:e.type,Size:o.size,ItemId:null,CreateAttachmentInlineType:0}))}else o.fileType===dt.a.Uri?t=Object(Tt.a)(Object.assign(Object.assign({},d),{Name:o.name,AttachmentOriginalUrl:o.uri,Size:o.size,ContentType:o.type,IsInline:r,Content:"",IsContactPhoto:!1,ImageThumbnailSalientRegions:null,ImageThumbnailHeight:0,ImageThumbnailWidth:0})):(t=Object(Tt.a)(Object.assign(Object.assign({},d),{Name:o.name,Size:o.size,ContentType:o.type,IsInline:r,Content:"",IsContactPhoto:!1,ImageThumbnailSalientRegions:null,ImageThumbnailHeight:0,ImageThumbnailWidth:0})),u=o.tempId);const m={Id:u||Object(k.a)(),mailboxInfo:this.parentItemId.mailboxInfo};let h;r?h=Object(b.i)(m,m.Id,s,0,l):(h=Object(b.g)(m,!1,!1,c,o.fileType,!0),e.isAddedFromSmartDoc&&(h.fileType=dt.a.SmartDoc),this.attachmentWellViewState.supportedMenuActions&&(h.strategy.supportedMenuActions=this.attachmentWellViewState.supportedMenuActions),e.downsellFromLink&&Object(b.A)(h,6,11)),Object(f.a)(h,this.attachmentWellViewState,t,m);const I={attachmentState:h,file:o,attachment:t,shouldShareInfo:e,cancelPendingUpload:()=>{},onAttachmentCreatedCallback:n,onAttachmentCanceledOrFailedCallback:a,tryAgainCallback:i};p.h.info("Attachment: UploadQueue enqueue attachment: Name="+o.name),this.uploadQueue.push(I)}return this.startProcessIfNotStarted(),t}deleteAttachment(t,e=null){Object(o.a)(this.infoBar);const n=1===t.attachmentType,a=n?0===t.status:t.actionCompletePercent<=1;if(n||Object(b.A)(t,3,a?10:6),a&&this.currentUploadItem)if(this.currentUploadItem.attachmentState.attachmentId===t.attachmentId){p.h.info("Attachment: Cancelling attachment: TempId="+t.attachmentId);const n=this.currentUploadItem;if(n.cancelPendingUpload(),0===t.attachmentType&&t.isCloudy){if(p.h.info(`Attachment: Put attachment: Id= ${t.attachmentId} into deleteQueue`),0===this.deleteQueue.filter(e=>e.attachmentState.attachmentId===t.attachmentId).length){const n={attachmentState:t,onAttachmentDeletedCallback:e};this.deleteQueue.push(n)}this.startProcessIfNotStarted()}else this.isCancelling||(this.isCancelling=!0,Ct(t.attachmentId.Id).then(e=>{this.isCancelling=!1,e?(Object(v.a)(this.attachmentWellViewState,t),n.onAttachmentCanceledOrFailedCallback&&n.onAttachmentCanceledOrFailedCallback(!0)):this.onAttachmentDeleteFailure(t)}))}else p.h.info("Attachment: Removing attachment: TempId= "+t.attachmentId+" from queue"),function(t,e){for(let n=0;n<e.length;n++){const a=e[n];a.attachmentState.attachmentId===t.attachmentId&&(a.onAttachmentCanceledOrFailedCallback&&a.onAttachmentCanceledOrFailedCallback(!0),e.splice(n,1))}}(t,this.uploadQueue),Object(v.a)(this.attachmentWellViewState,t);else{if(p.h.info(`Attachment: Put attachment: Id= ${t.attachmentId} into deleteQueue`),0===this.deleteQueue.filter(e=>e.attachmentState.attachmentId===t.attachmentId).length){const n={attachmentState:t,onAttachmentDeletedCallback:e};this.deleteQueue.push(n)}this.startProcessIfNotStarted()}}onAttachmentDeleteFailure(t){var e,n;e={item:t,reason:0},n=this.infoBar,Object(o.a)(n),Ut(e,n),1!==t.attachmentType&&Object(b.A)(t,0,0),p.h.warn("Attachment: Failed to cancel attachment: TempId="+t.attachmentId)}startProcessIfNotStarted(){this.isInProgress||(this.datapoint=new s.b("AttachmentQueueManager"),this.isInProgress=!0,this.processNextAttachment("NewProcess"))}processNextAttachment(t){if(p.h.info("Attachment: Invoking processNextAttachment from: "+t),0!==this.deleteQueue.length){const{attachmentState:t,onAttachmentDeletedCallback:e}=this.deleteQueue[0],n=Object(u.a)(t.attachmentId);p.h.info("Attachment: Deleting attachment: Id= "+t.attachmentId),Object(vt.a)(this.attachmentWellViewState,t,this.parentItemId,t.fileType).then(()=>{this.deleteQueue.shift(),_t(e,this.parentItemId,t.attachmentId,n.model),_t(this.onAnyAttachmentDeletedInParentItemCallback,this.parentItemId,t.attachmentId,n.model),this.processNextAttachment("DeleteAttachmentFinish")}).catch(e=>{this.deleteQueue.shift(),this.onAttachmentDeleteFailure(t),this.logDeletionFailure(e.message,t),this.processNextAttachment("DeleteAttachmentFinish")})}else if(0!==this.uploadQueue.length){this.currentUploadItem=this.uploadQueue.shift();const t=this.currentUploadItem.onAttachmentCreatedCallback,e={attachmentWellViewState:this.attachmentWellViewState,parentItemId:this.parentItemId,infoBar:this.infoBar},{createAttachmentPromise:n,cancelCreateAttachment:a}=At(this.parentItemId,this.currentUploadItem.attachment,this.currentUploadItem.attachmentState.attachmentId.Id,this.currentUploadItem.file,this.currentUploadItem.attachmentState,e,this.currentUploadItem.shouldShareInfo);this.currentUploadItem.cancelPendingUpload=a,n.then(e=>{if(e){const n=Object.assign(Object.assign({},e.AttachmentId),{mailboxInfo:this.parentItemId.mailboxInfo});_t(t,this.parentItemId,n,e),_t(this.onAnyAttachmentCreatedInParentItemCallback,this.parentItemId,n,e)}this.processNextAttachment("CreateAttachmentFinish")}).catch(t=>{let e=0;(null==t?void 0:t.message)===D.c&&(e=2),t&&t.errorCode===yt&&(e=1),this.uploadFailures.push({item:this.currentUploadItem,reason:e}),this.currentUploadItem.onAttachmentCanceledOrFailedCallback&&this.currentUploadItem.onAttachmentCanceledOrFailedCallback(!1),this.logCreationFailure(),this.processNextAttachment("CreateAttachmentFinish")})}else this.finishProcess()}finishProcess(){p.h.info("Attachment: AttachmentQueueManager: finishProcess"),this.isInProgress=!1;const t=this.currentUploadItem&&this.currentUploadItem.attachmentState?this.currentUploadItem.attachmentState.attachmentId:null;this.currentUploadItem=null,this.onFinish(t),this.datapoint.end(),this.datapoint=null,Wt(this.uploadFailures,this.infoBar),this.uploadFailures=[]}logCreationFailure(){Object(s.o)("AttachmentCreationFailure")}logDeletionFailure(t,e){Object(s.o)("AttachmentDeletionFailure",[t],{cosmosOnlyData:JSON.stringify({attachmentId:e.attachmentId.Id})})}}function _t(t,e,n,a){t&&t(e,n,a)}n.d(e,"a",(function(){return Vt})),n.d(e,"b",(function(){return $t}));const Bt={};function Vt(t,e,n,r,c={isInline:!1,isHiddenInline:!1,shouldShare:!1,skipProcessInlineImage:!1},l,u,m,h,f){if(!e)return Object(o.a)(r),Object(xt.a)(r,"WarningFilesCanNotBeAttachedGenericError",[Object(i.b)(a.a)]),[];const b=qt(t,e,r,l),{isInline:p,shouldShare:I}=c;return function(t,e,n,a){for(let i=0;i<t.length;i++){const r=t[i];Object(s.o)("AttachmentCreation",[n,a],{cosmosOnlyData:JSON.stringify({fileType:r.fileType,size:r.size,ext:Object(d.d)(r.name)||"",logTraceId:e})})}}(n,f,p,I),b.enqueueAttachmentCreation(n,c,u,m,h)}function $t(t,e,n,a,i){const r=qt(t,n,a);!function(t){const e=t.attachmentType;switch(e){case 1:Object(s.o)("AttachmentDeletion",[!0,!1,0]);break;case 0:const n=Object(u.a)(t.attachmentId);Object(s.o)("AttachmentDeletion",[!1,t.isCloudy],{cosmosOnlyData:JSON.stringify({size:n.model.Size})});break;default:Object(l.a)(e)}}(e),r.deleteAttachment(e,i)}function qt(t,e,n,a){let i=Bt[e.Id];return i||(i=function(t,e,n,a=null,i=null){return new Lt(t,e,n,a,i)}(t,e,n,r.a,c.a),Bt[e.Id]=i,i.onFinishPromise.then(t=>{delete Bt[e.Id],a&&a(t)})),i}},6603:function(t,e,n){"use strict";var a=n(3350),i=n(3609),r=n(3822),c=n(699),o=n(1975);e.a=Object(c.action)("addAttachmentIntoWellBeforeUpload")((function(t,e,n,c,s=null){let l;n.AttachmentId=c,Object(i.a)([{attachmentId:Object.assign(Object.assign({},n.AttachmentId),{mailboxInfo:c.mailboxInfo}),attachment:n,modelInitializationValues:s}],!1,!0,!0),Object(o.s)(t)?(e.inlineAttachments.push(t),l=!0):(t.isPlaceholderAttachment=!0,Object(r.a)(n)?e.imageViewAttachments.push(t):e.docViewAttachments.push(t)),!l&&t.isCloudy||Object(a.a)(e,n.Size)}))},6604:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var a=n(266),i=n(2781),r=n(1843),c=n(283);function o(t,e,n,a){const o=Object(c.a)()?1:0,l=Object(r.h)(),[u]=l.filter(t=>t.type===o);if(!u)throw new Error("Unable to upload file as couldnt find OneDrive provider");const{model:{EndPointUrl:d}}=u,m={fileToUpload:{fileName:t,fileBlob:e},conflictBehavior:"rename",folderInfo:s(n),onProgress:a};return[1===o?Object(i.w)(1,i.e,m):Object(i.w)(0,d,m),u]}function s(t){const{identifierType:e,identifier:n}=t;switch(e){case 0:return{type:0,identifier:n};case 1:return{type:1,identifier:n};default:return Object(a.a)(e)}}},7038:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"ItemAttachment:#Exchange"},t)}n.d(e,"a",(function(){return a}))},7039:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"MimeContentType:#Exchange"},t)}n.d(e,"a",(function(){return a}))},7040:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var a=n(1791),i=n(1822),r=n(1751);function c(t){if(Object(i.a)(t)){const e=t;return{fileType:a.a.Cloud,name:e.Name,size:e.Size,providerId:"",providerType:4,location:e.AttachLongPathName,providerEndpointUrl:"",isFolder:!1,thumbnailUrl:e.AttachmentThumbnailUrl,previewUrl:e.AttachmentPreviewUrl,fileId:e.AttachmentId.Id,fileParentId:"",type:e.ContentType}}return{attachmentItemId:t.AttachmentId.Id,name:t.Name,size:t.Size,fileType:a.a.AttachmentItem,type:r.c,EmbeddedItemClass:t.EmbeddedItemClass,ContentType:t.ContentType}}},7920:function(t){t.exports=JSON.parse('{"a":"lca"}')},7921:function(t,e,n){"use strict";n.d(e,"a",(function(){return u}));var a=n(7922),i=n(1866),r=n(5),c=n(3960),o=n(1791),s=n(1724);function l(t,e,n,a){const r=[],c=[];if(t.forEach(t=>{n(t)?r.push(t):c.push(t)}),c.length>0){const t=c.map(t=>t.name).join(", "),{messageId:n,message:r}=a(t);Object(i.a)(e,n,[r])}return r}function u(t,e,n){Object(c.a)(n);let i=[];for(let e=0;e<t.length;e++)i.push(t[e]);return i=function(t,e){return l(t,e,t=>!(t.fileType===o.a.Local&&0===t.size),(function(t){return{messageId:"WarningEmptyFilesCanNotBeAttached",message:Object(r.c)(Object(r.b)(a.a),t)}}))}(i,n),e&&(i=function(t,e){return l(t,e,t=>Object(s.g)(t.name,t.type),(function(t){return{messageId:"WarningInlineImageTypeNotSupported",message:Object(r.c)(Object(r.b)(a.b),t)}}))}(i,n)),i}},7922:function(t){t.exports=JSON.parse('{"a":"Aea","b":"Bea"}')},7923:function(t,e,n){"use strict";n.d(e,"a",(function(){return r}));var a=n(32),i=n(910);function r(t,e){return void 0===t.itemId||t.itemId.__type||(t.itemId=Object(i.a)(t.itemId)),Object(a.a)("CreateReferenceAttachmentFromAttachmentDataProvider",t,e)}}}]);
//# sourceMappingURL=owa.269.js.map
self.scriptsLoaded['owa.269.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.269.js'] = (new Date()).getTime();