self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.54.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[54],{1975:function(e,t,n){"use strict";var a=n(5980),r=n(3820),i=n(2354);const o={};class c{constructor(e,t,n){this.estimatedTimeToCompleteInMS=e,this.updateIntervalInPercent=t,this.updatePropertyHandler=n,this.start=()=>{this.currentTimePercent+=this.updateIntervalInPercent;const e=this.getActionCompletePercent();e<=this.maxPercent?(this.updatePropertyHandler(e),this.nextUpdateTimer=setTimeout(this.start,this.estimatedTimeToCompleteInMS*this.updateIntervalInPercent)):this.nextUpdateTimer=null},this.currentTimePercent=0,this.maxPercent=1-this.updateIntervalInPercent}complete(){this.clearUpdateTimer(),this.updatePropertyHandler(1),setTimeout(()=>this.updatePropertyHandler(1.1),500)}abort(){this.clearUpdateTimer(),this.updatePropertyHandler(0)}clearUpdateTimer(){this.nextUpdateTimer&&(clearTimeout(this.nextUpdateTimer),this.nextUpdateTimer=null)}getActionCompletePercent(){return Math.sqrt(2*this.currentTimePercent-this.currentTimePercent*this.currentTimePercent)}}function u(e,t){const n=o[e.Id];n&&(t?n.complete():n.abort(),delete o[e.Id])}function s(e,t,n,a){const r=new c(e,t,n);o[a.Id]=r,r.start()}var d=n(5269),l=n(3);Object(l.orchestrator)(a.a,async e=>{let t;!function(e){Object(i.a)(e,7,13)}(e.attachment);try{t=await Object(d.a)(null,null,null,e.attachment.attachmentId.Id)}catch(e){}const n=t?14:15;!function(e,t,n,a,o){u(e,!0),Object(r.a)(n,o),Object(i.a)(n,a,t)}(e.attachment.attachmentId,n,e.attachment,0,7)});var m=n(2472),f=n(4066),h=n(40);function b(e){return Object.assign({__type:"ConvertLocalToRefAttachmentRequest:#Exchange"},e)}var p=n(32);function v(e,t,n,a,r){const i=function(e,t,n,a,r){return b({ewsAttachmentId:{RootItemChangeKey:t.ChangeKey,RootItemId:t.Id,Id:e},itemId:e,subscriptionId:n,channelId:a,cancellationId:r})}(e,t,n,a,r);return void 0===(o={requestObject:i}).requestObject||o.requestObject.__type||(o.requestObject=b(o.requestObject)),Object(p.a)("ConvertLocalToRefAttachment",o,c);var o,c}var O=n(61),I=n(1738),j=n(3237),y=n(3909),C=n(44),g=n(1810),w=n(699);const S={};var T=Object(w.action)("convertClassicToCloudy")((function e(t,n,a,r=!0){const o=new O.b("AttachmentConvertClassicToCloudy");!function(e){Object(i.a)(e,5,8)}(t);return async function(e,t,n,a){const[r,i,o,c]=await Object(j.a)(n);S[e.Id]=r;try{await v(e.Id,t,r,c,r)}catch(e){a(e.message),g.k.importAndExecute(i,o)}}(t.attachmentId,n,i=>{if(P(t,i.ResultCode),A(o,t.attachmentId,i.ResultCode,i.Exception),0===i.ResultCode&&i.Response&&i.Response.ResponseMessages&&i.Response.ResponseMessages.Items&&i.Response.ResponseMessages.Items.length>0&&"NoError"===i.Response.ResponseMessages.Items[0].ResponseCode){const e=i.Response.ResponseMessages.Items[0];a(!0,e.Attachments[0])}else if(Object(C.j)("doc-authcontextStage2")&&25===i.ResultCode&&!r){const r=i.ClaimsChallenge;r?(async()=>{let i=!1;try{const e=await y.a.import();await e(r)}catch(e){i=!0}i?(h.h.info("convertClassicToCloud remediateAuth failed"),a(!1,null)):(h.h.info("Retry convertClassicToCloud after remediateAuth"),e(t,n,a,!0))})():a(!1,null)}else a(!1,null);return!0},e=>{P(t,1),a(!1,null),A(o,t.attachmentId,1,e)})}));function P(e,t){switch(t){case 0:break;case 11:Object(i.a)(e,0,0);break;default:Object(i.a)(e,0,9)}delete S[e.attachmentId.Id]}function A(e,t,n,a){const r=Object(I.a)(t);e.addCosmosOnlyData(JSON.stringify({size:r.model.Size})),e.addCustomData([n]),0===n||11===n?e.end():e.endWithError("ServerError",new Error(a))}function k(e){return Object.assign({__type:"CancelConvertLocalToRefAttachmentRequest:#Exchange"},e)}function x(e){const t=function(e){return k({cancellationId:e})}(e);return void 0===(n=t)||n.__type||(n=k(n)),Object(p.a)("CancelConvertLocalToRefAttachment",n,a);var n,a}var N=Object(O.r)({name:"CancelConvertClassicToCloudy"},(function(e){const t=(n=e.attachmentId.Id,S[n]);var n;if(!t)throw new Error("Failed to find the cancellationId of ConvertClassicToCloudy");Object(i.a)(e,5,10),x(t)})),D=n(3029),E=Object(l.mutatorAction)("setActionCompletePercent",(function(e,t){e.actionCompletePercent=t})),R=n(3593),L=n(3459),U=n(1932),_=n(3609),V=n(4065),F=n(3460),q=n(2206),M=n(3666),W=n(2823),B=Object(w.action)("updateAttachment")((function(e,t,n,a,r){Object(V.a)(e.attachmentId);const o=Object.assign(Object.assign({},a.AttachmentId),{mailboxInfo:t.mailboxInfo});if(n.AttachmentId=o,a.Name&&(n.Name=a.Name),a.Size&&(n.Size=a.Size),a.ContentType&&(n.ContentType=a.ContentType),a.__type&&(n.__type=a.__type),n.IsInline&&(n.ContentId=a.ContentId),Object(q.b)(a)){const e=n;e.AttachLongPathName=a.AttachLongPathName,e.PermissionType=a.PermissionType,e.ProviderType=a.ProviderType,e.AttachmentThumbnailUrl=a.AttachmentThumbnailUrl,e.AttachmentPreviewUrl=a.AttachmentPreviewUrl}if(Object(_.a)([{attachmentId:o,attachment:n,permissionInfo:r}],!1),e.attachmentId=o,Object(M.a)(e))Object(L.a)(e,1);else{Object(U.h)(e,!1),setTimeout(()=>{E(e,1.1)},500),Object(i.a)(e,0,0),Object(R.a)(e,!1);const t=Object(I.a)(o);Object(W.a)(e,t,!1,e.strategy.supportedMenuActions),t.download.url||Object(F.a)(o,e.isReadOnly,!0)}}));function z(e){return Object.assign({__type:"ConvertRefToLocalAttachmentRequest:#Exchange"},e)}function H(e,t,n,a,r,i,o,c){const u=function(e,t,n,a,r,i,o,c){return z({ewsAttachmentId:e,emailId:t,subscriptionId:n,channelId:a,cancellationId:r,fullPathLocation:i,attachmentDataProviderId:c,PermissionLevel:o})}(e,t,n,a,r,i,o,c);return void 0===(s={requestObject:u}).requestObject||s.requestObject.__type||(s.requestObject=z(s.requestObject)),Object(p.a)("ConvertRefToLocalAttachment",s,d);var s,d}function $(e){return Q(Object(I.a)(e).model.Size)}function G(e){return 2856+.00145*e}function J(e){return 4*Q(e)}function K(e){return 4*Q(e)}function X(e){return 2*Q(e)}function Q(e){return Math.round(e/256)}var Y=n(4209);const Z={},ee=Object(l.action)("convertCloudyToClassic",(e,t,n,a,r,i)=>({attachment:e,parentItemId:t,fullPathLocation:n,permissionLevel:a,replaceAttachmentHandler:r,source:i}));var te=ee;function ne(e,t){switch(t){case 0:break;case 11:Object(i.a)(e,0,0);break;default:Object(i.a)(e,0,12)}delete Z[e.attachmentId.Id]}function ae(e,t,n,a,r){var i;const o=Object(I.a)(t);e.addCosmosOnlyData(JSON.stringify({size:o.model.Size,attachmentId:null===(i=o.model.AttachmentId)||void 0===i?void 0:i.Id})),e.addCustomData([n,r]),0===n||11===n?e.end():e.endWithError("ServerError",new Error(a))}Object(l.orchestrator)(ee,e=>{const t=e.attachment;!async function(e,t,n,a,r,o){const c=new O.b("AttachmentConvertCloudyToClassic");!function(e){Object(i.a)(e,6,11)}(e);await async function(e,t,n,a,r,i){const[o,c,u,s]=await Object(j.a)(r);Z[e.Id]=o;try{await H(e.Id,t,o,s,o,n,a)}catch(e){i(e.message),g.k.importAndExecute(c,u)}}(e.attachmentId,t,n,a,t=>{if(ne(e,t.ResultCode),ae(c,e.attachmentId,t.ResultCode,t.Exception,o),0===t.ResultCode){const e=Object(Y.a)({Name:t.Item.Name,Size:t.Item.Size,AttachmentId:t.NewAttachmentId});r(!0,e)}else r(!1,null);return!0},t=>{ne(e,1),r(!1,null),ae(c,e.attachmentId,1,t,o)})}(t,e.parentItemId,e.fullPathLocation,e.permissionLevel,(n,a)=>{n?e.replaceAttachmentHandler(t,a,!1,!0):u(t.attachmentId,n)},e.source),s($(t.attachmentId),.1,e=>{E(t,e)},t.attachmentId)});var re={name:"CancelConvertCloudyToClassic"};function ie(e){return Object.assign({__type:"CancelConvertRefToLocalAttachmentRequest:#Exchange"},e)}function oe(e){const t=function(e){return ie({cancellationId:e})}(e);return void 0===(n=t)||n.__type||(n=ie(n)),Object(p.a)("CancelConvertRefToLocalAttachment",n,a);var n,a}var ce=n(71);const ue=Object(l.action)("cancel_ConvertCloudyToClassic",e=>Object(ce.b)(re,{attachmentViewState:e}));var se=ue;Object(l.orchestrator)(ue,e=>{const t=function(e){return Z[e]}(e.attachmentViewState.attachmentId.Id);if(!t)throw new Error("Failed to find the cancellationId of ConvertCloudyToClassic");Object(i.a)(e.attachmentViewState,6,10),oe(t)});var de=n(1829),le=n(2239),me=n(2866),fe=n(2247),he=n(1865);async function be(e){const t=await fe.h.import(),n=e.model;n.ProviderType===he.d.ONE_DRIVE_PRO&&t(n.AttachLongPathName,me.a.OneDrivePro,!1).then(async t=>{if(!t||0!==t.ResultCode)return;const n=Object(le.b)(e.model,!0),a=await de.f.importAndExecute(n,e.attachmentClass,e.model,!0,e.model.ProviderType,t);de.k.importAndExecute(e.id,a),Object(de.n)(e.id)})}var pe=n(1724);function ve(e,t,n){if(e&&t===he.d.ONE_DRIVE_PRO&&(Object(C.j)("doc-SxS-jsApi-ODB-Base")||Object(C.j)("doc-SxS-jsApi-ODB-BaseNoEditString")||Object(C.j)("doc-SxS-jsApi-ODB-Readonly"))){const e=n&&n.substring(n.lastIndexOf("."));switch(Object(pe.f)(e)){case pe.a.Word:return Object(C.j)("doc-SxS-jsApi-ODB-Word");case pe.a.Excel:return Object(C.j)("doc-SxS-jsApi-ODB-Excel");case pe.a.PowerPoint:return!Object(C.j)("doc-SxS-jsApi-ODB-Readonly")&&Object(C.j)("doc-SxS-jsApi-ODB-PowerPoint")}}return!1}var Oe=n(3592),Ie=n(1791);function je(e,t,n=!1,a=0,r=!1){return{attachmentType:1,attachmentId:e,isInline:!0,isHiddenInline:n,placeholderId:t,status:a,fileType:Ie.a.Inline,skipProcessInlineImage:r}}function ye(e){return!!e.strategy.isSaveToCloudSupported&&-1===e.completedActions.indexOf(2)}var Ce=n(3821);n.d(t,"a",(function(){return m.a})),n.d(t,"h",(function(){return f.a})),n.d(t,"c",(function(){return N})),n.d(t,"e",(function(){return T})),n.d(t,"u",(function(){return D.a})),n.d(t,"w",(function(){return D.c})),n.d(t,"v",(function(){return D.b})),n.d(t,"D",(function(){return D.d})),n.d(t,"x",(function(){return E})),n.d(t,"y",(function(){return R.a})),n.d(t,"z",(function(){return L.a})),n.d(t,"A",(function(){return i.a})),n.d(t,"E",(function(){return B})),n.d(t,"r",(function(){return W.a})),n.d(t,"o",(function(){return W.b})),n.d(t,"d",(function(){return se})),n.d(t,"f",(function(){return te})),n.d(t,"m",(function(){return be})),n.d(t,"b",(function(){return ve})),n.d(t,"B",(function(){return s})),n.d(t,"C",(function(){return u})),n.d(t,"k",(function(){return G})),n.d(t,"l",(function(){return K})),n.d(t,"q",(function(){return J})),n.d(t,"j",(function(){return X})),n.d(t,"g",(function(){return Oe.a})),n.d(t,"i",(function(){return je})),n.d(t,"p",(function(){return $})),n.d(t,"t",(function(){return ye})),n.d(t,"s",(function(){return M.a})),n.d(t,"n",(function(){return Ce.a}))},2430:function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"d",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"e",(function(){return c}));const a="originalsrc",r="shash",i="data-auth",o="&reserved=0",c="Verified"},2472:function(e,t,n){"use strict";var a;!function(e){e[e.ChangePermissions=0]="ChangePermissions",e[e.CopyLink=1]="CopyLink",e[e.Download=2]="Download",e[e.OpenInNewTab=3]="OpenInNewTab",e[e.Preview=4]="Preview",e[e.SaveToCloud=5]="SaveToCloud",e[e.ViewInProvider=6]="ViewInProvider",e[e.ConvertClassicToCloudy=7]="ConvertClassicToCloudy",e[e.ConvertCloudyToClassic=8]="ConvertCloudyToClassic",e[e.ImportCalendarEventAttachment=9]="ImportCalendarEventAttachment",e[e.MoveAttachmentToInline=10]="MoveAttachmentToInline",e[e.RefreshLink=11]="RefreshLink",e[e.IgnoreExpiration=12]="IgnoreExpiration"}(a||(a={})),t.a=a},2866:function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"g",(function(){return s})),n.d(t,"c",(function(){return d})),n.d(t,"d",(function(){return l}));var a=n(20),r=n(2943);n.d(t,"a",(function(){return r.a}));const i=new a.c(()=>Promise.all([n.e(0),n.e(26),n.e(94),n.e(884)]).then(n.bind(null,6103))),o=new a.b(i,e=>e.createGetSharingInfoResponse),c=new a.b(i,e=>e.checkSharingLinkUrlDomain),u=new a.b(i,e=>e.getLinkProviderType),s=new a.b(i,e=>e.isOneDriveProRelatedLink),d=new a.b(i,e=>e.convertToAttachmentDataProviderType),l=new a.b(i,e=>e.convertToLinkProviderType)},2943:function(e,t,n){"use strict";var a;n.d(t,"a",(function(){return a})),function(e){e[e.OneDrivePro=0]="OneDrivePro",e[e.OneDriveConsumer=1]="OneDriveConsumer",e[e.Dropbox=2]="Dropbox",e[e.Box=3]="Box",e[e.GDrive=5]="GDrive",e[e.OfficeOneDrivePro=31]="OfficeOneDrivePro"}(a||(a={}))},3325:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(1724);function r(e){var t;return(null===(t=function(e){let t="";return(null==e?void 0:e.model)&&(t=Object(a.c)(e.model.Name||"")||e.model.ContentType||""),t}(e))||void 0===t?void 0:t.substring(0,4))||""}},3351:function(e,t,n){"use strict";n.d(t,"f",(function(){return o})),n.d(t,"g",(function(){return c})),n.d(t,"h",(function(){return u}));var a=n(20),r=n(2430);n.d(t,"b",(function(){return r.b})),n.d(t,"d",(function(){return r.d})),n.d(t,"a",(function(){return r.a})),n.d(t,"c",(function(){return r.c})),n.d(t,"e",(function(){return r.e}));const i=new a.c(()=>n.e(1354).then(n.bind(null,7197))),o=new a.b(i,e=>e.evaluateSafeLink),c=(new a.b(i,e=>e.evaluateSafeLinks),new a.b(i,e=>e.isSafeLink)),u=new a.b(i,e=>e.isSafeLinkUrl)},3459:function(e,t,n){"use strict";var a=n(699);t.a=Object(a.action)("setInlineAttachmentStatus")((function(e,t){e.status=t}))},3460:function(e,t,n){"use strict";var a=n(1738),r=n(3665),i=n(699);t.a=Object(i.action)("refreshDownloadUrl")((function(e,t,n=!1){const i=Object(a.a)(e),o=Object(r.a)(e,i.model,t,n);i.download.url=o}))},3592:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var a=n(1932),r=n(1791);function i(e,t,n,i,o=r.a.Unknown,c=!1,u=null){const s=Object(a.d)(e,t,i,c,o,u),d=s.strategy;return Object.assign(Object.assign({},s),{attachmentType:0,strategy:Object.assign(Object.assign({},d),{isSaveToCloudSupported:!1,isViewingInProviderSupported:!1,isOpeningInProviderSupported:!1,isOpeningByLinkSupported:!1,isConvertClassicToCloudySupported:!1,isConvertCloudyToClassicSupported:!1,isMoveAttachmentToInlineSupported:!1,showActionsMenu:!1,supportedMenuActions:[]}),shouldShowContextMenu:!1,shouldShowImageOverlay:!1,shouldShowActionsContainer:!1,ongoingAction:n?0:1,completedActions:[],actionMessage:0,actionCompletePercent:n?1.1:.01})}},3593:function(e,t,n){"use strict";var a=n(699);t.a=Object(a.action)("setAttachmentShouldShowContextMenu")((function(e,t){e.shouldShowContextMenu=t}))},3609:function(e,t,n){"use strict";var a=n(44),r=n(5),i=n(4503),o=n(5730),c=n(2859),u=n(4884),s=n(4429),d=n(3665),l=n(4430),m=n(2206),f=n(3822),h=n(2239),b=n(40),p=n(699),v=n(1940);var O=n(2065),I=n(1822);t.a=Object(p.action)("addAndInitializeAttachments")((function(e,t,n=!1,j=!1){const y=Object(v.a)();n||(e=e.filter(e=>!y.attachments.has(e.attachment.AttachmentId.Id))),e.map(e=>{const{attachmentId:n,attachment:y,permissionInfo:C,modelInitializationValues:g}=e,w=function(e,t){const n={id:e,type:Object(O.a)(t),download:{url:null},attachmentClass:0,previewImage:{url:null},thumbnailImage:{url:null},info:{allowDownload:!1,supportedPermissionLevels:[],sharingInfo:null},model:t};if(1===n.type&&Object(I.a)(t)){return Object.assign(Object.assign({},n),{type:1,openUrl:null,originalUrl:null,isFolder:t.AttachmentIsFolder,requiresFetchingSharingInformation:!1})}return n}(n,y);return j||function(e,t,n){const O=Object(m.a)(e),I=Object(h.b)(e.model,!0),j=Object(o.a)(I,e.model);e.attachmentClass=j,e.info=Object(i.a)(I,j,e.model,O,O?e.model.ProviderType:null,t),e.info.allowDownload&&(e.download.url=Object(d.a)(e.id,e.model,!0,!0)),O&&(e.openUrl=Object(l.a)(e.model)),(O&&Object(a.j)("doc-unwrap-safelinks")?Object(s.a)(e.model):Promise.resolve(void 0)).then(t=>{if(t&&(e.originalUrl=t),O&&!n){const t=e.model,n=Object(c.a)(t.ProviderType);(null==n?void 0:n.requiresFetchingSharingInformation)&&!Object(r.k)(t.AttachLongPathName)&&(e.requiresFetchingSharingInformation=!0)}if(Object(f.a)(e.model)){const t=e.id.Id;Object(u.a)(e.id,e.model,O).then(Object(p.action)("updateAttachmentThumbnailUrl")((function(e){Object(v.a)().attachments.has(t)&&(Object(v.a)().attachments.get(t).thumbnailImage.url=e)})),e=>{b.h.warn(e)})}})}(w,C,t),function(e,t){t=t||{},Object.keys(t).forEach(n=>{t[n]&&(e[n]=t[n])})}(w,g||{}),w}).forEach(e=>{var t;const n=e.model;if(n&&!n.AttachmentOriginalUrl){const a=y.attachments.get(e.id.Id);(null===(t=null==a?void 0:a.model)||void 0===t?void 0:t.AttachmentOriginalUrl)&&(n.AttachmentOriginalUrl=a.model.AttachmentOriginalUrl)}if(n&&Object(m.b)(n)){const t=n;if(!t.AttachLongPathName){const n=y.attachments.get(e.id.Id),a=null==n?void 0:n.model;(null==a?void 0:a.AttachLongPathName)&&(t.AttachLongPathName=a.AttachLongPathName)}}y.attachments.set(e.id.Id,e)})}))},3665:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(1865),r=n(2206),i=n(2377);function o(e,t,n,o=!1){if(Object(r.b)(t))switch(t.ProviderType){case a.b:return function(e){const t=e.AttachLongPathName,n=t.lastIndexOf("?");return`${t.substring(0,n)}?dl=1`}(t)}return Object(i.a)(e,t,0,Object(r.b)(t),n,o)}},3666:function(e,t,n){"use strict";function a(e){return 1===e.attachmentType}n.d(t,"a",(function(){return a}))},3822:function(e,t,n){"use strict";n.d(t,"a",(function(){return d}));var a=n(2859),r=n(2034),i=n(2239),o=n(1724),c=n(1822),u=n(3664),s=n(4617);function d(e){if(!Object(i.b)(e,!0).directFileAccessEnabled&&!e.IsInline||Object(r.b)(e.AttachmentId.Id))return!1;if(e.Thumbnail)return!0;const t=Object(o.g)(e.Name,e.ContentType,!1),n=Object(o.h)(e.Name);if((Object(u.a)(e)||Object(s.a)(e))&&(t||n))return!0;if(Object(c.a)(e)){const n=Object(a.a)(e.ProviderType);if(e.AttachmentThumbnailUrl||t&&n&&n.supportImageThumbnail)return!0}return!1}},4065:function(e,t,n){"use strict";var a=n(1940),r=n(699);t.a=Object(r.action)("deleteAttachment")((function(e){Object(a.a)().attachments.delete(e.Id)}))},4066:function(e,t,n){"use strict";n.d(t,"a",(function(){return l}));var a=n(2823),r=n(5981),i=n(5982),o=n(3592),c=n(1791),u=n(1975),s=n(3609),d=n(1738);function l(e,t,n,l,m,f,h,b=null,p,v=!1){Object(s.a)([{attachmentId:e,attachment:t}],n,m);const O=Object(d.a)(e),I=Object(o.a)(e,n,l,1===O.type,c.a.Unknown,!1,b);if(Object(a.a)(I,O,!1,p,f,h),v){const e=O.model.ProviderType;Object(u.b)(I.isCloudy,e,O.model.Name)?Object(i.a)(O,I):Object(r.a)(I)}return I}},4067:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(61),r=n(2321),i=n(2865),o=n(40);async function c(e,t,n,c,u){const s=new a.b("getWacInfoForOneDriveJsApi",{isCore:!0});c&&s.addCustomData({redeemSharingLinkIfNecessary:c});try{const a="u!"+btoa(t).replace(/^\=+|\=+$/g,"").replace("/","_").replace("+","-"),o=`${new RegExp(/.+?\:\/\/.+?(\/)/g).exec(t)[0]}_api/v2.0/shares/${a}/root?select=openWith/wac,officeBundle,@content.downloadUrl,webDavUrl,name,size,currentUserRole,sensitivityLabel&action=${n?"Open":"View"}`,d=new Object;c&&(d.prefer="redeemSharingLinkIfNecessary");const l=Object(r.a)({ProviderType:e,Url:o,Headers:JSON.stringify(d)}),m=(new Date).getTime(),f=await Object(i.a)(l);if(200===f.Status&&f.Body){const e=(new Date).getTime(),t=JSON.parse(f.Body);return t.fetchStartTime=m,t.responseStartTime=e,!t.openWith.wac&&u||(t.openWith.wac.fileGetUrl=t["@content.downloadUrl"],t.openWith.wac.accessTokenExpiry&&(t.openWith.wac.accessTokenExpiry=new Date(Number(t.openWith.wac.accessTokenExpiry))),!n&&t.currentUserRole&&(t.currentUserRole.readOnly=!0)),s.end(),t}{s.addCustomData({StatusCode:f.Status});const e=f.Headers;if(e){const t=JSON.parse(e);t&&s.addCustomData({SharePointError:t.SharePointError,SPClientServiceRequestDuration:t.SPClientServiceRequestDuration,SPRequestGuid:t.SPRequestGuid})}throw new Error(`Result status is: ${f.Status} or empty response body.`)}}catch(e){s.endWithError("ServerError",e),o.h.warn(`Something went wrong while calling fetchDataProviderResourceOperation: ${e}`)}return null}},4209:function(e,t,n){"use strict";function a(e){return Object.assign({__type:"FileAttachment:#Exchange"},e)}n.d(t,"a",(function(){return a}))},4429:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(3351);async function r(e){let t,n;return(n=await a.f.import())&&(t=await n(e.AttachLongPathName)),t}},4430:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var a=n(5),r=n(1865),i=n(3078),o=n(29);function c(e){return Object(a.k)(e)?null:("/"!=(e=e.trim())[e.length-1]&&(e+="/"),e)}function u(e){let t=e.AttachLongPathName;if(Object(i.e)(e.PermissionType)||e.ProviderType!==r.i)return t;const n=Object(o.a)(),a=n.ApplicationSettings;if(null!==t&&null!==a){let e;e=c(a.VDirIsPublicProperty||n.PublicComputersDetectionEnabled&&n.SessionSettings.IsPublicComputerSession?a.ExternalSPMySiteHostURL:a.InternalSPMySiteHostURL),null!==e&&(t=function(e,t){const n=new RegExp("^(https?)\\:[\\/\\\\]{2}([\\w\\.-]+)(\\:[0-9]{1,4})?(.*)$","i"),a=n.exec(e),r=n.exec(t);let i,o,c;return a&&r&&a.length>=5&&r.length>=5&&(r[1]&&r[2]&&(c=r[1]+"://"+r[2],i=!0),r[3]&&(c+=r[3]),a[4]&&(o=!0,c+=a[4])),i&&o?c:null}(t,e))}return null!==t?t:e.AttachLongPathName}},4503:function(e,t,n){"use strict";var a=n(3078),r=n(1724),i=n(7),o=n(44);var c=n(4560),u=n(2859);function s(e,t,n,s,d,l=null){if(1===t)return{allowDownload:!1,supportedPermissionLevels:null,sharingInfo:null};const m=Object(r.b)(n.Name),f=Object(c.a)(e,n,m),h=function(e,t,n){if(!e)return null;if(n&&n.length>0)return n;const a=Object(u.a)(t);return null==a?void 0:a.supportedPermissionLevels}(s,d,Object(a.a)(l,0)),b=(p=l)&&0===p.ResultCode?(Object(o.j)("doc-attachment-referenceAttachmentExpiration")||(p.ExpirationDate=null),{getSharingInfoSucceeded:!0,blocksDownload:p.BlocksDownload,canonicalUrl:p.CanonicalUrl,canShareInternally:p.CanShareInternally,canShareExternally:p.CanShareExternally,expirationDate:p.ExpirationDate?Object(i.qc)(p.ExpirationDate):null,canRefresh:!1,shareId:p.ShareId,siteUrl:p.SiteUrl,linkType:p.Type,itemUniqueId:p.ItemUniqueId,mimeType:p.MimeType}):null;var p;return s?function(e,t,n){return{allowDownload:e,supportedPermissionLevels:t,sharingInfo:n}}(f,h,b):function(e){return{allowDownload:e,supportedPermissionLevels:null,sharingInfo:null}}(f)}n.d(t,"a",(function(){return s}))},4560:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(1822),r=n(2859),i=n(2239),o=n(44);function c(e,t,n){let c=e.level!==i.a.Block&&e.directFileAccessEnabled;return c&&Object(a.a)(t)&&(c=function(e,t){if(e.AttachLongPathName){const t=document.createElement("a");if(t.href=e.AttachLongPathName,!Object(o.j)("doc-unwrap-safelinks")&&t.host.indexOf(u,0)>0||t.search.indexOf(s,0)>0)return!1}if(function(e){const t=Object(r.a)(e);return null==t?void 0:t.supportDownload}(e.ProviderType)&&!e.AttachmentIsFolder)return".fluid"!==t&&!function(e,t){return!(e||t&&"application/onenote"!==t&&"image/png"!==t)}(t,e.ContentType);return!1}(t,n)),c}const u="safelinks.protection.outlook.com",s="b7780972f918485c8cfc32b1ba7438eb"},4882:function(e,t,n){"use strict";var a=n(2045),r=n(2017),i=n(3);t.a=Object(i.mutatorAction)("disableWacPreview",(function(e){e.previewMethod===r.a.Wac&&(e.previewMethod=r.a.Unsupported,e.supportedOpenActions=e.supportedOpenActions.filter(e=>e!==a.a.Preview))}))},4883:function(e,t,n){"use strict";n.d(t,"a",(function(){return m}));var a=n(61),r=n(3205),i=n(5157),o=n(700);const c={},u={},s=[];let d=0;const l=2;async function m(e,t,n,r){const i=new a.b("InitializeWacUrl");n&&i.addCustomProperty("actionSource",n);const o=h(e,t,i);return o||new Promise((a,o)=>{const c={attachmentId:e,isEdit:t,actionSource:n,datapoint:i,resolve:a,reject:o};r?f(c):(s.push(c),async function e(){if(!s.length)return;if(d>=l)return;const t=s.shift();d++;try{await f(t)}finally{d--,e()}}())})}async function f(e){var t;const{attachmentId:n,isEdit:a,actionSource:s,datapoint:d,resolve:l,reject:m}=e,f=h(n,a,d);if(f)return void l(f);let b;d.addCustomProperty("ReturnFromCache",!1);try{if(b=await Object(i.a)(n.Id,a,null,Object(o.a)(n.mailboxInfo),s),0===b.Status){(a?u:c)[n.Id]={expireTime:(new Date).getTime()+36e5,value:b}}b.WacUrl||d.addCustomProperty("WacUrlIsEmpty",!0),d.addCustomProperty("WacAttachmentResponseStatus",null===(t=b.Status)||void 0===t?void 0:t.toString()),d.end(),l(b)}catch(e){Object(r.a)(e)&&Object(r.c)(d,e.response),Object(r.d)(d,e.toString()),d.endWithError("ServerError"),m(e)}}function h(e,t,n){const a=t?u:c,r=a[e.Id];if(r){if(r.expireTime>=(new Date).getTime())return n.addCustomProperty("ReturnFromCache",!0),n.end(),r.value;delete a[e.Id]}return null}},4884:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(1865),r=n(4207),i=n(2377);async function o(e,t,n){if(!n)return Object(i.a)(e,t,2,n,!0);const o=t;return o.ProviderType===a.e&&o.AttachLongPathName?Object(r.a)(o):o.AttachmentThumbnailUrl||null}},5157:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(2657);function r(e,t,n,r,i){if(i){const e="getWacAttachmentInfo"+i;(r=r||{}).headers=r.headers||new Headers,r.headers.set("X-OWA-ActionName",e)}return Object(a.a)({attachmentId:e,isEdit:t,draftId:n,appId:null},r)}},5269:function(e,t,n){"use strict";var a=n(702);const r={kind:"Document",definitions:[{kind:"OperationDefinition",operation:"mutation",name:{kind:"Name",value:"ImportEventsFromIcsFile"},variableDefinitions:[{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"fileContent"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"calendarId"}},type:{kind:"NamedType",name:{kind:"Name",value:"CalendarIdInput"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"folderId"}},type:{kind:"NamedType",name:{kind:"Name",value:"String"}}},{kind:"VariableDefinition",variable:{kind:"Variable",name:{kind:"Name",value:"mailboxInfo"}},type:{kind:"NamedType",name:{kind:"Name",value:"MailboxInfoInput"}}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"importEventsFromIcsFile"},arguments:[{kind:"Argument",name:{kind:"Name",value:"input"},value:{kind:"ObjectValue",fields:[{kind:"ObjectField",name:{kind:"Name",value:"fileContent"},value:{kind:"Variable",name:{kind:"Name",value:"fileContent"}}},{kind:"ObjectField",name:{kind:"Name",value:"attachmentId"},value:{kind:"Variable",name:{kind:"Name",value:"attachmentId"}}},{kind:"ObjectField",name:{kind:"Name",value:"calendarId"},value:{kind:"Variable",name:{kind:"Name",value:"calendarId"}}},{kind:"ObjectField",name:{kind:"Name",value:"folderId"},value:{kind:"Variable",name:{kind:"Name",value:"folderId"}}},{kind:"ObjectField",name:{kind:"Name",value:"mailboxInfo"},value:{kind:"Variable",name:{kind:"Name",value:"mailboxInfo"}}}]}}],selectionSet:{kind:"SelectionSet",selections:[{kind:"Field",name:{kind:"Name",value:"numberOfEventsImported"}}]}}]}}]};async function i(e,t,n,i,o){var c;const u=Object(a.a)(),s={fileContent:e,folderId:t,calendarId:n?{id:n.id,changeKey:n.changeKey,mailboxInfo:n.mailboxInfo}:null,mailboxInfo:o,attachmentId:i},d=await u.mutate({variables:s,mutation:r});return null===(c=null==d?void 0:d.data)||void 0===c?void 0:c.importEventsFromIcsFile}n.d(t,"a",(function(){return i}))},5980:function(e,t,n){"use strict";var a=n(3),r=n(71);const i=Object(a.action)("addCalendarEventsAttachment",(e,t)=>Object(r.b)({name:"AttachmentAddCalendarEvent",customData:{addToCalendarSource:t}},{attachment:e}));t.a=i},5981:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var a=n(4882),r=n(2017),i=n(4883);async function o(e){if(e.strategy.previewMethod===r.a.Wac){const t=await Object(i.a)(e.attachmentId,!1);9!==t.Status&&6!==t.Status||Object(a.a)(e.strategy)}}},5982:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(4882),r=n(4429),i=n(4067),o=n(44);async function c(e,t){const n=e,c=Object(o.j)("doc-unwrap-safelinks")?await Object(r.a)(e.model):n.openUrl;await Object(i.a)(0,c,!1,!1,!0)||Object(a.a)(t.strategy)}}}]);
//# sourceMappingURL=owa.54.js.map
self.scriptsLoaded['owa.54.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.54.js'] = (new Date()).getTime();