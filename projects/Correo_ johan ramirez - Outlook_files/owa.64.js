self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.64.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[64],{1748:function(e,t,n){"use strict";n.d(t,"g",(function(){return a})),n.d(t,"d",(function(){return s})),n.d(t,"e",(function(){return u})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return d})),n.d(t,"f",(function(){return l})),n.d(t,"a",(function(){return f})),n.d(t,"i",(function(){return g})),n.d(t,"h",(function(){return b}));var c=n(1918),r=n(546),o=n(1925);function a(e,t){const n=Object(c.a)().calendarFolderEvents.get(t);return n?n.locksInfo.get(e):null}function s(e){const t=l(e);return t?[...t.locksInfo.entries()].reduce(Object(o.c)(),[]):[]}function u(e){const t=l(e);return t?[...t.locksInfo.entries()].reduce(Object(o.d)(),{}):{}}function i(e,t){const n=l(e);return n?[...n.locksInfo.entries()].reduce(Object(o.e)(Object(o.m)(t)),[]):[]}function d(){return[...Object(c.a)().calendarFolderEvents.keys()]}function l(e){return Object(c.a)().calendarFolderEvents.get(e)||null}function f(e){const t=l(e);return(null==t?void 0:t.events)?[...t.events.values()]:[]}function g(e){return!!l(e)}function b(e){const t=s(e);return t&&t.length>0?t.sort((e,t)=>{const n=Object(r.l)(e),c=Object(r.l)(t);return n>c?-1:n<c?1:0})[0]:null}},1810:function(e,t,n){"use strict";var c=n(20);var r={ChannelData:"ChannelData",SubscriptionAdded:"SubscriptionAdded",SubscriptionRemoved:"SubscriptionRemoved",SubscriptionUpdated:"SubscriptionUpdated",NotificationData:"NotificationData",TraceWarn:"TraceWarn",TraceError:"TraceError"};n.d(t,"j",(function(){return a})),n.d(t,"k",(function(){return s})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return i})),n.d(t,"g",(function(){return d})),n.d(t,"h",(function(){return l})),n.d(t,"e",(function(){return f})),n.d(t,"i",(function(){return g})),n.d(t,"f",(function(){return b})),n.d(t,"d",(function(){return v})),n.d(t,"a",(function(){return r}));const o=new c.c(()=>Promise.all([n.e(0),n.e(663)]).then(n.bind(null,19157))),a=new c.a(o,e=>e.subscribe),s=new c.a(o,e=>e.unsubscribe),u=new c.b(o,e=>e.getChannelId),i=new c.a(o,e=>e.getChannelReady),d=new c.a(o,e=>e.retryDisconnectionWithMinimumReconnectInterval),l=new c.a(o,e=>e.setup),f=new c.a(o,e=>e.handleNotification),g=new c.a(o,e=>e.NotificationManager.stopConnection),b=new c.a(o,e=>e.initializeNotificationManager),v=new c.b(o,e=>e.getNotificationEmitter)},1837:function(e,t,n){"use strict";var c=n(3035),r=n(44),o=function(e){Object(r.j)("cal-cacheDiagnostics")&&setTimeout(()=>Object(c.a)(e),0)};n.d(t,"a",(function(){return o}))},1918:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var c=n(3),r=n(14);const o={calendarFolderEvents:new r.ObservableMap,fullItemsMruMap:new r.ObservableMap,calendarFolderWorkingHours:new r.ObservableMap},a=Object(c.createStore)("calendarEventsStore",o)},1925:function(e,t,n){"use strict";function c(e,t){t.locksInfo.get(e)||t.locksInfo.set(e,{lockedDateRange:null,lockedEvents:{}})}var r=n(1),o=n(2598),a=n(14);function s(e,t,n=!1){const{Key:c}=t,s=Object(r.__rest)(t,["Key"]),i=n?s:(d=s,Object.keys(d).reduce((e,t)=>(void 0!==d[t]&&(e[t]=d[t]),e),{}));var d;Object(a.isObservable)(e)?u(e,i):Object(o.a)(e,i,void 0)}function u(e,t){if(e===t)return;const n=Array.isArray(e)||Object(a.isObservableArray)(e),c=Array.isArray(t)||Object(a.isObservableArray)(t);if(n||c){const r=e,a=t;if(!e&&c)return a.length>0?a:r;if(!t&&n)return r.length>0&&r.splice(0),r;if(n&&c){if(r.length===a.length&&r.length>0)for(let e=0;e<r.length;e++)i(r[e])?Object(o.a)(r[e],a[e],u):r[e]=a[e];else r.length!==a.length&&(r.splice(0),r.push(...a));return r}return a}if(i(e)&&i(t)){if(!Object(a.isObservable)(e))return;return Object(o.a)(e,t,u)}}function i(e){return"[object Object]"===Object.prototype.toString.call(e)}var d=n(7),l=n(1837);function f(e,t,n=!1){const c=function(e,t,n){const c=[];for(let r=0;r<e.length;r++){const o=e[r],a=t.get(o.Key);a?(s(a,o,n),c.push(a)):c.push(o)}return c}(e,t,n);return c.forEach(e=>{t.set(e.Key,e)}),function(e){e.sort((e,t)=>Object(d.p)(e.Start,t.Start))}(c),Object(l.a)({lockId:"",updateMessage:`Upserted ${c.length} items in the cache`}),c}function g(e,t,n,r=!1,o=!1){c(t,n);const{events:a}=n;if(r){const t=a.get(e.Key);t&&(s(t,e,o),e=t)}const[u]=f([e],a,o),{lockedEvents:i}=n.locksInfo.get(t);return i[e.Key]=!0,Object(l.a)({lockId:t,updateMessage:`Event with startTime ${u.Start} added to the lock`}),u}var b=n(546);function v(e,t){const n={start:e.Start,end:e.End};for(let e=0;e<t.length;e++)if(0===Object(b.j)(t[e],n,!0))return!0;return!1}function h(e,t,n){const{dateRangesToRetain:c,eventsToRetain:r}=n;return function(e,t,n){const{dateRangesToRetain:c,eventsToRetain:r}=t,o=[];return e.forEach((e,t)=>{const a=v(e,[n]),s=v(e,c),u=r[e.Key]||s;a&&!u&&o.push(e)}),o.forEach(t=>{e.delete(t.Key)}),o}(t,{dateRangesToRetain:c.filter(t=>0===Object(b.j)(t,e,!0)),eventsToRetain:r},e)}function k(e,t,n){const c=[];return t.forEach(t=>{-1!==e.indexOf(t.Key)&&function(e,t){const{dateRangesToRetain:n,eventsToRetain:c}=t;return!v(e,n)&&!c[e.Key]}(t,n)&&c.push(t)}),c.forEach(e=>{t.delete(e.Key)}),c}function j(e=(()=>!0)){return(t,[n,c])=>(e([n,c])&&Object.keys(c.lockedEvents).forEach(e=>t[e]=!0),t)}function O(e=(()=>!0)){return(t,[n,c])=>(e([n,c])&&c.lockedDateRange&&t.push(c.lockedDateRange),t)}function p(e=(()=>!0)){return(t,[n,c])=>(e([n,c])&&t.push(n),t)}function R(e){return([t,n])=>n.lockedDateRange&&0===Object(b.j)(n.lockedDateRange,e,!1)}const E=e=>([t])=>t!==e;var I;function $(e,t,n){c(t,n);const r=n.locksInfo.get(t),{lockedDateRange:o,lockedEvents:a}=r,s=[...n.locksInfo.entries()].reduce(O(e!==I.EventIds?E(t):()=>!0),[]),u=[...n.locksInfo.entries()].reduce(j(e!==I.DateRange?E(t):()=>!0),{});!o||e!==I.All&&e!==I.DateRange||(h(o,n.events,{dateRangesToRetain:s,eventsToRetain:u}),r.lockedDateRange=null);const i=Object.keys(a);i.length>0&&(e===I.All||e===I.EventIds)&&(k(i,n.events,{dateRangesToRetain:s,eventsToRetain:u}),r.lockedEvents={})}!function(e){e[e.All=0]="All",e[e.DateRange=1]="DateRange",e[e.EventIds=2]="EventIds"}(I||(I={}));var y=n(40);function w(e,t,n,r){c(n,r);let{lockedDateRange:o}=r.locksInfo.get(n);const a=o?`${o.start} - ${o.end}`:"null";var s,u;o&&(s=o,u=e,0==Object(b.j)(s,u,!0)||function(e,t){let n=0;return n=Object(d.p)(e.start,t.start)<0?Object(d.w)(t.start,e.end):Object(d.w)(e.start,t.end),1==n}(s,u))&&!Object(b.c)(e,o,!0)?Object(b.c)(o,e,!0)?y.h.info(`[addEventsForLock]: Date range in lock ${n} already contains the range to be added.`):o=Object(b.f)(o,e):(y.h.info(`[addEventsForLock] Replacing all items in cache for lock "${n}". Date range: ${e.start} - ${e.end}`),$(I.DateRange,n,r),o=e);const i=f(t,r.events);return r.locksInfo.get(n).lockedDateRange=o,y.h.info(`[addEvents] New range in cache for lock "${n}": ${o.start} - ${o.end}`),Object(l.a)({lockId:n,updateMessage:`${i.length} events added to the lock. Previous locked daterange: ${a}. New locked daterange: ${o.start} - ${o.end}`}),i}function D(e,t,n){const c=t.events.size;let r=[];t.events.forEach((e,t)=>{const c={start:e.Start,end:e.End};n.some(e=>0===Object(b.j)(c,e,!0))&&r.push(t)}),r.forEach(e=>{t.events.delete(e)}),e.forEach(e=>{t.events.set(e.Key,e)}),Object(l.a)({lockId:"",updateMessage:`Replaced ${r.length} items of initial ${c} from cache with ${e.length} items`})}function m(e,t,n){if(0===e.length)return[];c(t,n);const r=n.locksInfo.get(t);e=e.filter(e=>r.lockedEvents[e]);const o=[...n.locksInfo.entries()].reduce(O(),[]),a=[...n.locksInfo.entries()].reduce(j(E(t)),{}),s=k(e,n.events,{dateRangesToRetain:o,eventsToRetain:a});return e.forEach(e=>{delete r.lockedEvents[e]}),s}function T(e,t,n){c(t,n);const r=n.locksInfo.get(t),o=r.lockedDateRange;if(!o||Object(b.c)(e,r.lockedDateRange,!0))return;Object(l.a)({lockId:t,updateMessage:`Now evicting events in cache except for events in date range ${e.start} - ${e.end}. Current locked cache range: ${o.start} - ${o.end}`});const a=[...n.locksInfo.entries()].reduce(O(E(t)),[e]),s=[...n.locksInfo.entries()].reduce(j(),{}),u=h(o,n.events,{dateRangesToRetain:a,eventsToRetain:s});y.h.info(`[owa-events-cache:evictEventsExceptInDateRangeForLock] Evicted ${u.length} events for lock '${t}'`),Object(b.c)(o,e,!0)?r.lockedDateRange=Object.assign({},e):r.lockedDateRange=function(e,t){const n=-1===Object(d.p)(e.start,t.start),c=1===Object(d.p)(e.end,t.end);let{start:r,end:o}=e;n&&(r=t.start);c&&(o=t.end);return{start:r,end:o}}(e,o),Object(l.a)({lockId:t,updateMessage:`Evicted ${u.length} events for lock. New locked cache range: ${o.start} - ${o.end}`})}function M(e,t){const{events:n}=t,c=[];return n.forEach((t,n)=>{e(t)&&c.push(t)}),c.forEach(e=>{n.delete(e.Key)}),function(e,t){[...t.locksInfo.keys()].forEach(n=>{const c=t.locksInfo.get(n);e.forEach(e=>delete c.lockedEvents[e.Key])})}(c,t),Object(l.a)({lockId:"",updateMessage:`Unloaded ${c.length} items from cache`}),c.reverse()}function K(e,t){$(I.All,e,t),t.locksInfo.delete(e)}function S(e,t){const n=[];return t.forEach(t=>{const c={start:t.Start,end:t.End};0===Object(b.j)(e,c,!0)&&n.push(t)}),n}var A=n(6);function N(e,t,n){const c=n&&n.locksInfo.get(t)?n.locksInfo.get(t).lockedDateRange:null;if(null!=c&&Object(b.c)(c,e,!0)){const c=S(e,n.events);if(Object(A.f)("debugEventsCache")){const n=c?c.length:"no";Object(l.a)({lockId:t,updateMessage:`Returning ${n} items from cache for date range: ${e.start} - ${e.end}`})}return c}return null}function F(e,t,n){const{lockedDateRange:c=null,lockedEvents:r=[]}=n.locksInfo.get(t)||{};return null===c&&0===Object.keys(r).length?e.map(e=>null):function(e,t,n){const{lockedDateRange:c,lockedEvents:r}=n.locksInfo.get(t),o={};return e.forEach(e=>{const t=n.events.get(e);if(t){const e={start:t.Start,end:t.End};(!!c&&0===Object(b.j)(c,e,!0)||r[t.Key])&&(o[t.Key]=t)}}),e.map(e=>o[e]||null)}(e,t,n)}let C=0;function U(e){const t=e||`events_cache_lock_${C}`;return C++,t}function _(){return{events:new a.ObservableMap,locksInfo:new a.ObservableMap}}n.d(t,"a",(function(){return g})),n.d(t,"b",(function(){return w})),n.d(t,"r",(function(){return f})),n.d(t,"p",(function(){return D})),n.d(t,"i",(function(){return m})),n.d(t,"h",(function(){return T})),n.d(t,"o",(function(){return M})),n.d(t,"n",(function(){return K})),n.d(t,"q",(function(){return s})),n.d(t,"k",(function(){return N})),n.d(t,"j",(function(){return S})),n.d(t,"l",(function(){return F})),n.d(t,"g",(function(){return U})),n.d(t,"f",(function(){return _})),n.d(t,"c",(function(){return O})),n.d(t,"d",(function(){return j})),n.d(t,"e",(function(){return p})),n.d(t,"m",(function(){return R}))},2598:function(e,t,n){"use strict";var c=n(915),r=n(920),o=n(552),a=Object(r.a)((function(e,t,n,r){Object(c.a)(t,Object(o.a)(t),e,r)}));t.a=a},3035:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var c=n(3);const r=Object(c.action)("logCacheUpdateForDiagnostics",e=>({cacheUpdateLog:e}))}}]);
//# sourceMappingURL=owa.64.js.map
self.scriptsLoaded['owa.64.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.64.js'] = (new Date()).getTime();