self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.970.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[970],{10084:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var a=n(32),r=n(7837);function i(t,e){return void 0===t||t.__type||(t=Object(r.a)(t)),Object(a.a)("GetAttachmentPreviews",t,e)}},1829:function(t,e,n){"use strict";n.d(e,"d",(function(){return s})),n.d(e,"l",(function(){return u})),n.d(e,"h",(function(){return d})),n.d(e,"f",(function(){return m})),n.d(e,"k",(function(){return l})),n.d(e,"j",(function(){return h})),n.d(e,"i",(function(){return v})),n.d(e,"g",(function(){return f})),n.d(e,"e",(function(){return w})),n.d(e,"m",(function(){return I}));var a=n(20),r=n(1937);n.d(e,"n",(function(){return r.a})),n.d(e,"o",(function(){return r.b})),n.d(e,"p",(function(){return r.c}));var i=n(1940);n.d(e,"a",(function(){return i.a}));var o=n(2034);n.d(e,"c",(function(){return o.a})),n.d(e,"b",(function(){return o.b}));const c=new a.c(()=>Promise.all([n.e(0),n.e(24),n.e(26),n.e(47),n.e(299),n.e(634)]).then(n.bind(null,3685))),s=new a.a(c,t=>t.addAndInitializeAttachments),u=new a.a(c,t=>t.setPreviewImageUrl),d=new a.a(c,t=>t.refreshDownloadUrl),m=new a.a(c,t=>t.createAttachmentInfo),l=new a.a(c,t=>t.setAttachmentInfo),h=new a.a(c,t=>t.refreshThumbnailImageUrl),v=new a.a(c,t=>t.refreshPreviewImageUrl),f=new a.b(c,t=>t.getAttachment),w=new a.b(c,t=>t.checkPendingAttachmentOperation),I=new a.b(c,t=>t.shouldShowImageView)},1910:function(t,e,n){"use strict";n.d(e,"n",(function(){return c})),n.d(e,"q",(function(){return s})),n.d(e,"a",(function(){return u})),n.d(e,"p",(function(){return d})),n.d(e,"f",(function(){return m})),n.d(e,"t",(function(){return l})),n.d(e,"g",(function(){return h})),n.d(e,"d",(function(){return v})),n.d(e,"e",(function(){return f})),n.d(e,"j",(function(){return w})),n.d(e,"i",(function(){return I})),n.d(e,"l",(function(){return A})),n.d(e,"k",(function(){return b})),n.d(e,"c",(function(){return P})),n.d(e,"o",(function(){return g})),n.d(e,"r",(function(){return O})),n.d(e,"b",(function(){return p})),n.d(e,"m",(function(){return j})),n.d(e,"h",(function(){return S})),n.d(e,"s",(function(){return C}));var a=n(20),r=n(2046);n.d(e,"u",(function(){return r.a}));var i=n(2047);n.d(e,"v",(function(){return i.a}));const o=new a.c(()=>Promise.all([n.e(0),n.e(9),n.e(10),n.e(12),n.e(13),n.e(24),n.e(26),n.e(34),n.e(47),n.e(50),n.e(54),n.e(103),n.e(168),n.e(269),n.e(652),n.e(555)]).then(n.bind(null,3072))),c=new a.a(o,t=>t.initializeAttachments),s=new a.a(o,t=>t.reinitializeAttachments),u=(new a.a(o,t=>t.setInlineAttachmentStatus),new a.a(o,t=>t.addAttachmentIntoWellBeforeUpload)),d=new a.b(o,t=>t.refreshSharingTipsAttachmentWell),m=new a.b(o,t=>t.createAttachmentsViaQueueManager),l=new a.b(o,t=>t.createAttachmentsFromRecentAttachments),h=new a.a(o,t=>t.deleteAttachmentViaQueueManager),v=new a.b(o,t=>t.createAttachmentFullViewStateAndStoreBackingModel),f=new a.b(o,t=>t.createAttachmentFullViewState),w=new a.b(o,t=>t.getAttachmentWellInitialValue),I=new a.b(o,t=>t.getAttachmentWellForCompose),A=new a.b(o,t=>t.getConversationAttachmentWellInitialValue),b=(new a.b(o,t=>t.getMaxClassicAttachmentsSize),new a.b(o,t=>t.getAvailableLocalAttachmentSize)),P=new a.b(o,t=>t.createAttachmentFileFromExistingMailboxAttachment),g=new a.a(o,t=>t.mergeToConversationAttachmentWell),O=new a.a(o,t=>t.sortConversationAttachmentWell),p=new a.a(o,t=>t.convertImageViewAttachmentToInlineAttachment),j=new a.b(o,t=>t.getLastCloudyAttachmentsSharingIssueForBlockOnSend),S=new a.b(o,t=>t.getAllValidAttachments),C=new a.b(o,t=>t.uploadLocalFile)},19322:function(t,e,n){"use strict";n.r(e);var a=n(699),r=n(1945),i=Object(a.action)("removeAttachmentPreviewsForRow")((function(t){const e=r.a.rowAttachmentPreviewWellViews,n=e.get(t);if(!n)return;const a=r.a.attachmentViewStates;n.imageViewStateIds.forEach(t=>{a.delete(t)}),n.documentViewStateIds.forEach(t=>{a.delete(t)}),e.delete(t)})),o=n(1829),c=n(1910),s=n(1692),u=n(3),d=n(311),m=n(44),l=n(14);const h=Object(u.mutatorAction)("setAttachmentViewStates",(t,e)=>{r.a.attachmentViewStates.set(t,e)}),v=Object(u.mutatorAction)("addAttachmentViewStateKey",(t,e,n)=>{e?t.imageViewStateIds.push(n):t.documentViewStateIds.push(n)}),f=Object(a.action)("processAttachmentPreviewsForItems")((function(t,e,n,a){const r=t.filter(t=>t.AttachmentPreviews),o={countOfAllPreviews:0,countOfLinkPreviews:0,invalidPreviewsInfo:""},c=[];r.forEach(t=>{c.push(...t.AttachmentPreviews.Previews)});const u=b(c,o);a.addCustomData(o);const d={};u.forEach(t=>{var n;const a=null===(n=t.ParentItemId)||void 0===n?void 0:n.Id;e.indexOf(a)>-1&&(d[a]||(d[a]=[]),d[a].push(t))}),e.forEach(t=>{const e=s.u.items.get(t);e?d[t]?w(t,d[t],n):(e.shouldShowAttachmentPreviews=!1,i(t)):delete d[t]})}));async function w(t,e,n){const a={documentViewStateIds:[],imageViewStateIds:[]};await Promise.all(e.map(async e=>{I(e),await async function(t,e,n,a,i){var s;const u=function(t,e){return t+"_"+e}(t,null===(s=n.AttachmentId)||void 0===s?void 0:s.Id);let d=r.a.attachmentViewStates.get(u);const m=l.observable.object(Object.assign(Object.assign({},n.AttachmentId),{mailboxInfo:i}));await c.d.import().then(async t=>{d=d||t(m,n,!0,!0,!1,!1,!1,e),n=(await o.g.import())(m).model,h(u,d);const r=await o.m.import();v(a,r(n),u)})}(t,Object.assign(Object.assign({},e.ParentItemId),{mailboxInfo:n}),e.Attachment,a,n)})),A(t,a)}const I=Object(u.mutatorAction)("addGuidIfNotPresent",t=>{var e,n;(null===(e=t.Attachment)||void 0===e?void 0:e.AttachmentId)&&!(null===(n=t.Attachment.AttachmentId)||void 0===n?void 0:n.Id)&&(t.Attachment.AttachmentId.Id=Object(d.a)())}),A=Object(u.mutatorAction)("setRowAttachmentPreviewWellViews",(t,e)=>{r.a.rowAttachmentPreviewWellViews.set(t,e)});function b(t,e){const n=t.filter(P);let a;if(n.length!==t.length){a=t.filter(t=>!P(t)).map(t=>(function(t){var e,n;const a=t.Attachment.AttachmentId?t.Attachment.AttachmentId.Id:"UNDEFINED",r=null===(e=t.ParentItemId)||void 0===e?void 0:e.Id,i=g(t),o=O(t);return`attachId=${a},isLink=${i},isLinkWoUrl=${o},hasNoName=${!t.Attachment.Name},noId=${!(null===(n=t.Attachment)||void 0===n?void 0:n.AttachmentId)},itemId=${r}`})(t)).join(";")}var r,i,o;return e&&(e.countOfAllPreviews+=t.length,e.countOfLinkPreviews+=t.filter(t=>g(t)).length,e.invalidPreviewsInfo=(r=e.invalidPreviewsInfo,i=a,o="|",r?[r,i].join(o):i)),n.filter(p)}function P(t){var e;return!!(null===(e=t.Attachment)||void 0===e?void 0:e.AttachmentId)&&!!t.Attachment.Name&&!O(t)}function g(t){const e=t.Attachment;return null==e?void 0:e.IsLink}function O(t){const e=t.Attachment;return(null==e?void 0:e.IsLink)&&!e.AttachLongPathName}function p(t){return!g(t)||Object(m.j)("doc-linkDiscovery-useNewProperty")}var j=n(61);const S=Object(a.action)("processAttachmentsForConversation")((function(t,e,n,a={listView:r.a}){var o,c;const s=a.listView.conversationItems.get(t.ConversationId.Id);if(!s)return;n.convCountWithHasLinkedFile+=s.hasSharepointLink?1:0;let u=[];if((null===(o=t.AttachmentPreviews)||void 0===o?void 0:o.Previews)&&(u=b(t.AttachmentPreviews.Previews,n)),s.hasSharepointLink&&!(null===(c=t.AttachmentPreviews)||void 0===c?void 0:c.Previews.some(t=>g(t)))&&n.convCountWithMissingLinkPreviews++,u.length>0){const n=function(t){const e=[];for(let n=0,a=t.length;n<a;n++){const a=t[n],r=a.Attachment;let i=-1;if(r.IsInline)for(let t=0;t<e.length;t++){const n=e[t];if(n.Attachment.IsInline&&n.Attachment.Name==r.Name&&n.ParentItemId.Id!=a.ParentItemId.Id){i=t;break}}-1==i&&e.push(a)}return e}(u);w(t.ConversationId.Id,n,e);const a=u.length-n.length;a>0&&Object(j.p)("IP_II_DP",[a])}else s.shouldShowAttachmentPreviews=!1,i(t.ConversationId.Id),Object(j.p)("IP_FP")}));var C=n(10084),T=n(7837);function E(t,e,n){const a=Object(T.a)(Object.assign(Object.assign({},n),{ConversationIds:t}));return Object(C.a)(a,e).then(t=>t)}var V=n(1679),M=n(283),N=n(700);const k=new Map;function y(t,e,n,a={rowIdsToGetPreviewsMap:k}){let r=a.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];r||(r={conversationsIdsArray:[],itemIdsArray:[]},a.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress]=r),r.conversationsIdsArray.some(t=>t.Id==e.Id)||r.conversationsIdsArray.push(e),-1==r.itemIdsArray.indexOf(n)&&r.itemIdsArray.push(n)}async function F(t,e,n={rowIdsToGetPreviewsMap:k}){const a=n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];if(!a)return Promise.resolve();const r=a.conversationsIdsArray,i=a.itemIdsArray,o=Object(M.a)();delete n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];const c=new j.b("GetAttachmentPreviews");try{return E(r,Object(N.a)(t),{IncludeInlineAttachments:o}).then(n=>{void 0!==n.Conversations?(1==e?f(n.Conversations,i,t,c):function(t,e,n){const a={countOfAllPreviews:0,countOfLinkPreviews:0,invalidPreviewsInfo:"",convCountWithHasLinkedFile:0,convCountWithMissingLinkPreviews:0};t.forEach(t=>{S(t,e,a)}),n.addCustomData(a)}(n.Conversations,t,c),c.end()):_(e,i,r,c)}).catch(()=>{_(e,i,r,c)})}catch(t){_(e,i,r,c)}return Promise.resolve()}const _=Object(u.mutatorAction)("handleGetAttachmentPreviewsFail",(t,e,n,a)=>{a.endWithError("ServerError"),1==t?e.forEach(t=>{const e=s.u.items.get(t);e&&(V.Z.rowAttachmentPreviewWellViews.get(t)||(e.shouldShowAttachmentPreviews=!1))}):n.forEach(t=>{const e=t.Id,n=V.Z.conversationItems.get(e);n&&(V.Z.rowAttachmentPreviewWellViews.get(e)||(n.shouldShowAttachmentPreviews=!1))})});function L(t){const e=[t],n=[],a={},r={};try{return E(e,Object(N.a)(t.mailboxInfo),{FullPreviewsPerConversation:300,PreviewsPerConversation:300,MinimumAttachmentSize:0,IncludeInlineAttachments:!1}).then(e=>(void 0!==e.Conversations&&e.Conversations.forEach(e=>{if(e.ConversationId.Id==t.Id&&e.AttachmentPreviews&&e.AttachmentPreviews.Previews){b(e.AttachmentPreviews.Previews,null).forEach(e=>{n.push(e.Attachment),a[e.Attachment.AttachmentId.Id]=Object.assign(Object.assign({},e.ParentItemId),{mailboxInfo:t.mailboxInfo}),r[e.Attachment.AttachmentId.Id]=e.ItemReceivedTime})}}),[n,a,r])).catch(()=>[n,a,r])}catch(t){}return Promise.resolve([n,a,r])}n.d(e,"getPreviews",(function(){return F})),n.d(e,"add",(function(){return y})),n.d(e,"getAttachmentsForConversationWell",(function(){return L})),n.d(e,"removeAttachmentPreviewsForRow",(function(){return i}))},1937:function(t,e,n){"use strict";n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i})),n.d(e,"c",(function(){return o}));var a=n(3);const r=Object(a.action)("REFRESH_SHARING_TIPS_FOR_ATTACHMENT",t=>({attachmentId:t})),i=Object(a.action)("SET_ATTACHMENT_CONTENTID",(t,e)=>({attachmentId:t,attachmentContentId:e})),o=Object(a.action)("SET_ATTACHMENT_ISINLINE",(t,e)=>({attachmentId:t,isInline:e}))},1940:function(t,e,n){"use strict";var a=n(14),r=n(3);const i={attachments:new a.ObservableMap({})},o=Object(r.createStore)("attachment",i);e.a=o},2034:function(t,e,n){"use strict";function a(t){return(null==t?void 0:t.AttachmentId)&&r(t.AttachmentId.Id)}function r(t){return t&&-1!==t.indexOf("smime-")}n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return r}))},2046:function(t,e,n){"use strict";var a=n(3);e.a=Object(a.action)("ON_ATTACHMENT_CREATED",(t,e,n,a=!0)=>({parentItemId:t,attachmentId:e,attachment:n,shouldTriggerAddInAttachmentsChangedCallback:a}))},2047:function(t,e,n){"use strict";var a=n(3);e.a=Object(a.action)("ON_ATTACHMENT_DELETED",(t,e,n,a=!0)=>({parentItemId:t,attachmentId:e,attachment:n,shouldTriggerAddInAttachmentsChangedCallback:a}))},311:function(t,e,n){"use strict";n.d(e,"a",(function(){return i})),n.d(e,"b",(function(){return o}));const a=/^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$/;function r(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function i(){return r()+r()+"-"+r()+"-"+r()+"-"+r()+"-"+r()+r()+r()}function o(t){return a.test(t)}},700:function(t,e,n){"use strict";function a(t,e){return t?Object.assign({mailboxInfo:t},e):null!=e?e:void 0}n.d(e,"a",(function(){return a}))},7837:function(t,e,n){"use strict";function a(t){return Object.assign({__type:"GetAttachmentPreviewsRequest:#Exchange"},t)}n.d(e,"a",(function(){return a}))}}]);
//# sourceMappingURL=owa.970.js.map
self.scriptsLoaded['owa.970.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.970.js'] = (new Date()).getTime();